{"ast":null,"code":"import { KeyboardEvents, closest, EventHandler, extend } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, addClass, removeClass } from '@syncfusion/ej2-base';\nimport * as event from '../base/constant';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\n/**\n * Keyboard interaction\n */\n\nvar KeyboardInteraction =\n/** @class */\nfunction () {\n  function KeyboardInteraction(parent) {\n    this.selectedCells = [];\n    this.keyConfigs = {\n      downArrow: 'downarrow',\n      upArrow: 'uparrow',\n      rightArrow: 'rightarrow',\n      leftArrow: 'leftarrow',\n      shiftDownArrow: 'shift+downarrow',\n      shiftUpArrow: 'shift+uparrow',\n      shiftRightArrow: 'shift+rightarrow',\n      shiftLeftArrow: 'shift+leftarrow',\n      ctrlLeftArrow: 'ctrl+leftarrow',\n      ctrlRightArrow: 'ctrl+rightarrow',\n      altOne: 'alt+1',\n      altTwo: 'alt+2',\n      altThree: 'alt+3',\n      altFour: 'alt+4',\n      altFive: 'alt+5',\n      altSix: 'alt+6',\n      altSeven: 'alt+7',\n      altEight: 'alt+8',\n      altNine: 'alt+9',\n      enter: 'enter',\n      escape: 'escape',\n      delete: 'delete',\n      home: 'home',\n      pageUp: 'pageup',\n      pageDown: 'pagedown',\n      tab: 'tab',\n      shiftTab: 'shift+tab'\n    };\n    this.parent = parent;\n    this.parent.element.tabIndex = this.parent.element.tabIndex === -1 ? 0 : this.parent.element.tabIndex;\n    this.keyboardModule = new KeyboardEvents(this.parent.element, {\n      keyAction: this.keyActionHandler.bind(this),\n      keyConfigs: this.keyConfigs,\n      eventName: 'keydown'\n    });\n    this.addEventListener();\n  }\n\n  KeyboardInteraction.prototype.keyActionHandler = function (e) {\n    switch (e.action) {\n      case 'downArrow':\n      case 'shiftDownArrow':\n        this.processDown(e, e.shiftKey);\n        break;\n\n      case 'upArrow':\n      case 'shiftUpArrow':\n        this.processUp(e, e.shiftKey);\n        break;\n\n      case 'leftArrow':\n      case 'shiftLeftArrow':\n        this.processLeft(e, e.shiftKey);\n        break;\n\n      case 'rightArrow':\n      case 'shiftRightArrow':\n        this.processRight(e, e.shiftKey);\n        break;\n\n      case 'ctrlLeftArrow':\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n\n        if (this.parent.headerModule) {\n          this.parent.headerModule.element.querySelector('.e-prev button').focus();\n        }\n\n        break;\n\n      case 'ctrlRightArrow':\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n\n        if (this.parent.headerModule) {\n          this.parent.headerModule.element.querySelector('.e-next button').focus();\n        }\n\n        break;\n\n      case 'altOne':\n      case 'altTwo':\n      case 'altThree':\n      case 'altFour':\n      case 'altFive':\n      case 'altSix':\n      case 'altSeven':\n      case 'altEight':\n      case 'altNine':\n        this.processViewNavigation(e);\n        break;\n\n      case 'enter':\n        this.processEnter(e);\n        break;\n\n      case 'home':\n        this.focusFirstCell();\n        break;\n\n      case 'tab':\n      case 'shiftTab':\n        this.processTab(e, e.shiftKey);\n        break;\n\n      case 'delete':\n        this.processDelete(e);\n        break;\n\n      case 'escape':\n        this.processEscape();\n    }\n  };\n\n  KeyboardInteraction.prototype.addEventListener = function () {\n    this.parent.on(event.cellMouseDown, this.onCellMouseDown, this);\n  };\n\n  KeyboardInteraction.prototype.removeEventListener = function () {\n    this.parent.off(event.cellMouseDown, this.onCellMouseDown);\n  };\n\n  KeyboardInteraction.prototype.onCellMouseDown = function (e) {\n    if (e.event.shiftKey) {\n      return;\n    }\n\n    this.initialTarget = this.getClosestCell(e.event);\n\n    if (this.parent.activeViewOptions.readonly || this.parent.currentView === 'MonthAgenda' || !this.initialTarget) {\n      return;\n    }\n\n    if (e.event.target.classList.contains(cls.WORK_CELLS_CLASS) && e.event.which !== 3) {\n      this.parent.removeSelectedClass();\n      EventHandler.add(this.parent.getContentTable(), 'mousemove', this.onMouseSelection, this);\n      EventHandler.add(this.parent.getContentTable(), 'mouseup', this.onMoveup, this);\n    }\n\n    if (e.event.target.classList.contains(cls.ALLDAY_CELLS_CLASS) && e.event.which !== 3) {\n      this.parent.removeSelectedClass();\n      var allDayRow = this.parent.getAllDayRow();\n      EventHandler.add(allDayRow, 'mousemove', this.onMouseSelection, this);\n      EventHandler.add(allDayRow, 'mouseup', this.onMoveup, this);\n    }\n  };\n\n  KeyboardInteraction.prototype.onMouseSelection = function (e) {\n    var appointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n    addClass(appointments, 'e-allow-select');\n    var selectionEdges = this.parent.boundaryValidation(e.pageY, e.pageX);\n\n    if (selectionEdges.bottom || selectionEdges.top || selectionEdges.left || selectionEdges.right) {\n      var parent_1 = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n      var yInBounds = parent_1.offsetHeight <= parent_1.scrollHeight && parent_1.scrollTop >= 0 && parent_1.scrollTop + parent_1.offsetHeight <= parent_1.scrollHeight;\n      var xInBounds = parent_1.offsetWidth <= parent_1.scrollWidth && parent_1.scrollLeft >= 0 && parent_1.scrollLeft + parent_1.offsetWidth <= parent_1.scrollWidth;\n\n      if (yInBounds && (selectionEdges.top || selectionEdges.bottom)) {\n        parent_1.scrollTop += selectionEdges.top ? -e.target.offsetHeight : e.target.offsetHeight;\n      }\n\n      if (xInBounds && (selectionEdges.left || selectionEdges.right)) {\n        parent_1.scrollLeft += selectionEdges.left ? -e.target.offsetWidth : e.target.offsetWidth;\n      }\n    }\n\n    var target = this.getClosestCell(e);\n\n    if (target) {\n      this.selectCells(true, target);\n    }\n  };\n\n  KeyboardInteraction.prototype.getClosestCell = function (e) {\n    return closest(e.target, '.' + cls.WORK_CELLS_CLASS + ',.' + cls.ALLDAY_CELLS_CLASS);\n  };\n\n  KeyboardInteraction.prototype.onMoveup = function (e) {\n    var _this = this;\n\n    var appointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n    removeClass(appointments, 'e-allow-select');\n\n    if (e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n      EventHandler.remove(this.parent.getContentTable(), 'mousemove', this.onMouseSelection);\n      EventHandler.remove(this.parent.getContentTable(), 'mouseup', this.onMoveup);\n    }\n\n    if (e.target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      var allDayRow = this.parent.getAllDayRow();\n      EventHandler.remove(allDayRow, 'mousemove', this.onMouseSelection);\n      EventHandler.remove(allDayRow, 'mouseup', this.onMoveup);\n    }\n\n    if (this.isPreventAction(e)) {\n      return;\n    }\n\n    var queryStr = '.' + cls.WORK_CELLS_CLASS + ',.' + cls.ALLDAY_CELLS_CLASS + ',.' + cls.HEADER_CELLS_CLASS;\n    var target = closest(e.target, queryStr);\n    this.parent.activeCellsData = this.getSelectedElements(target);\n    var cellData = {};\n    this.parent.eventWindow.convertToEventData(this.parent.activeCellsData, cellData);\n    var args = {\n      data: cellData,\n      element: this.parent.activeCellsData.element,\n      event: e,\n      requestType: 'cellSelect',\n      showQuickPopup: false\n    };\n    this.parent.trigger(event.select, args, function (selectArgs) {\n      var isPopupShow = selectArgs.showQuickPopup || _this.parent.quickInfoOnSelectionEnd;\n\n      if (isPopupShow) {\n        var cellArgs = extend(_this.parent.activeCellsData, {\n          cancel: false,\n          event: e,\n          name: 'cellClick'\n        });\n\n        _this.parent.notify(event.cellClick, cellArgs);\n      }\n    });\n  };\n\n  KeyboardInteraction.prototype.processEnter = function (e) {\n    if (this.parent.activeViewOptions.readonly || this.isPreventAction(e)) {\n      return;\n    }\n\n    var target = e.target;\n\n    if (closest(target, '.' + cls.POPUP_WRAPPER_CLASS)) {\n      if (target.classList.contains(cls.QUICK_POPUP_EVENT_DETAILS_CLASS) || target.classList.contains(cls.EVENT_CREATE_CLASS) || target.classList.contains(cls.EDIT_EVENT_CLASS) || target.classList.contains(cls.DELETE_EVENT_CLASS) || target.classList.contains(cls.CLOSE_CLASS)) {\n        target.click();\n        e.preventDefault();\n      } else if (target.classList.contains(cls.SUBJECT_CLASS)) {\n        this.parent.element.querySelector('.' + cls.EVENT_CREATE_CLASS).click();\n        e.preventDefault();\n      }\n\n      return;\n    }\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS) || target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      this.parent.activeCellsData = this.getSelectedElements(target);\n      var args = extend(this.parent.activeCellsData, {\n        cancel: false,\n        event: e\n      });\n      this.parent.notify(event.cellClick, args);\n      return;\n    }\n\n    if (target.classList.contains(cls.APPOINTMENT_CLASS) || target.classList.contains(cls.MORE_EVENT_CLOSE_CLASS) || target.classList.contains(cls.ALLDAY_APPOINTMENT_SECTION_CLASS) || target.classList.contains(cls.MORE_INDICATOR_CLASS)) {\n      target.click();\n      return;\n    }\n\n    if (target.classList.contains(cls.MORE_EVENT_HEADER_DATE_CLASS)) {\n      this.parent.setScheduleProperties({\n        selectedDate: this.parent.getDateFromElement(target)\n      });\n      this.parent.changeView(this.parent.getNavigateView(), e);\n      this.processEscape();\n      return;\n    }\n  };\n\n  KeyboardInteraction.prototype.getSelectedElements = function (target) {\n    var cellDetails;\n\n    if (this.selectedCells.length > 1) {\n      var start = this.parent.getCellDetails(this.selectedCells[0]);\n      var end = this.parent.getCellDetails(this.selectedCells.slice(-1)[0]);\n      start.endTime = end.endTime;\n      start.element = target;\n      cellDetails = start;\n    } else {\n      cellDetails = this.parent.getCellDetails(target);\n    }\n\n    return cellDetails;\n  };\n\n  KeyboardInteraction.prototype.getCells = function (isInverseTable, start, end) {\n    var tableEle = this.parent.getContentTable();\n    var cells = [].slice.call(tableEle.querySelectorAll('td'));\n    var maxRow = tableEle.rows.length;\n    var maxColumn = tableEle.rows[0].cells.length;\n\n    if (start.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      var allDayRow = this.parent.getAllDayRow();\n      cells = [].slice.call(allDayRow.cells);\n      maxRow = 1;\n      maxColumn = allDayRow.cells.length;\n    }\n\n    var startIndex = cells.indexOf(start);\n    var endIndex = cells.indexOf(end);\n    var inverseCells = [];\n\n    if (isInverseTable) {\n      for (var i = 0; i < maxColumn; i++) {\n        for (var j = 0; j < maxRow; j++) {\n          inverseCells.push(cells[maxColumn * j + i]);\n        }\n      }\n\n      startIndex = inverseCells.indexOf(start);\n      endIndex = inverseCells.indexOf(end);\n    }\n\n    if (startIndex > endIndex) {\n      var temp = startIndex;\n      startIndex = endIndex;\n      endIndex = temp;\n    }\n\n    var sCells = isInverseTable ? inverseCells : cells;\n    return sCells.slice(startIndex, endIndex + 1);\n  };\n\n  KeyboardInteraction.prototype.focusFirstCell = function () {\n    if (this.parent.currentView === 'Agenda') {\n      var focusCell = this.parent.getContentTable().querySelector('.' + cls.AGENDA_CELLS_CLASS);\n      focusCell.setAttribute('tabindex', '0');\n      focusCell.focus();\n      return;\n    }\n\n    this.parent.eventBase.removeSelectedAppointmentClass();\n\n    if (this.parent.activeView.isTimelineView()) {\n      var cell = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS + ' tr:not(.' + cls.HIDDEN_CLASS + ') .' + cls.WORK_CELLS_CLASS + ':not(.' + cls.RESOURCE_GROUP_CELLS_CLASS + ')');\n      this.selectCells(false, cell);\n    } else {\n      this.selectCells(false, this.parent.getWorkCellElements()[0]);\n    }\n  };\n\n  KeyboardInteraction.prototype.isInverseTableSelect = function () {\n    return this.parent.activeView.isInverseTableSelect;\n  };\n  /** @hidden */\n\n\n  KeyboardInteraction.prototype.selectCells = function (isMultiple, targetCell) {\n    var _this = this;\n\n    this.parent.removeSelectedClass();\n    var target = targetCell instanceof Array ? targetCell.slice(-1)[0] : targetCell;\n\n    if (isMultiple) {\n      var initialId_1;\n      var args = {\n        element: targetCell,\n        requestType: 'mousemove',\n        allowMultipleRow: true\n      };\n      this.parent.trigger(event.select, args, function (selectArgs) {\n        var allowMultipleRow = !selectArgs.allowMultipleRow || !_this.parent.allowMultiRowSelection;\n\n        if (allowMultipleRow && ['Day', 'Week', 'WorkWeek'].indexOf(_this.parent.currentView) > -1) {\n          target = target.parentElement.children[_this.initialTarget.cellIndex];\n        }\n\n        var selectedCells = _this.getCells(_this.isInverseTableSelect(), _this.initialTarget, target);\n\n        if (_this.parent.activeViewOptions.group.resources.length > 0) {\n          initialId_1 = _this.initialTarget.getAttribute('data-group-index');\n          var resourceSelectedCells = [];\n\n          for (var _i = 0, selectedCells_1 = selectedCells; _i < selectedCells_1.length; _i++) {\n            var cell = selectedCells_1[_i];\n\n            if (cell.getAttribute('data-group-index') === initialId_1) {\n              resourceSelectedCells.push(cell);\n            }\n          }\n\n          selectedCells = resourceSelectedCells;\n        }\n\n        _this.selectedCells = selectedCells;\n\n        if (selectedCells.length > 2 && !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n          var allDayCells = _this.getAllDayCells(selectedCells);\n\n          if (_this.parent.activeViewOptions.group.resources.length > 0) {\n            var resourceAllDayCells = [];\n\n            for (var _a = 0, allDayCells_1 = allDayCells; _a < allDayCells_1.length; _a++) {\n              var cell = allDayCells_1[_a];\n\n              if (cell.getAttribute('data-group-index') === initialId_1) {\n                resourceAllDayCells.push(cell);\n              }\n            }\n\n            allDayCells = resourceAllDayCells;\n          }\n\n          selectedCells = selectedCells.concat(allDayCells);\n        }\n\n        if (target.getAttribute('data-group-index') !== initialId_1 && _this.parent.activeViewOptions.group.resources.length > 0) {\n          target = _this.selectedCells[_this.selectedCells.length - 1];\n        }\n\n        _this.parent.addSelectedClass(selectedCells, target);\n      });\n    } else {\n      this.initialTarget = target;\n      this.selectedCells = [target];\n      this.parent.addSelectedClass([target], target);\n    }\n  };\n\n  KeyboardInteraction.prototype.selectAppointment = function (isReverse, target) {\n    var appointments = this.getAppointmentElements();\n\n    if (appointments.length < 0) {\n      return;\n    }\n\n    this.parent.eventBase.removeSelectedAppointmentClass();\n    var nextAppEle;\n\n    if (target.classList.contains(cls.APPOINTMENT_CLASS)) {\n      var targetIndex = appointments.indexOf(target);\n      nextAppEle = appointments[isReverse ? targetIndex - 1 : targetIndex + 1];\n    } else {\n      nextAppEle = isReverse ? appointments[appointments.length - 1] : appointments[0];\n    }\n\n    if (nextAppEle) {\n      this.parent.eventBase.addSelectedAppointments([nextAppEle]);\n      nextAppEle.focus();\n      addClass([nextAppEle], cls.AGENDA_SELECTED_CELL);\n    }\n  };\n\n  KeyboardInteraction.prototype.selectAppointmentElementFromWorkCell = function (isReverse, target) {\n    var _this = this;\n\n    this.parent.eventBase.removeSelectedAppointmentClass();\n    this.parent.removeSelectedClass();\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS) || target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      var appointmentElements_1 = this.getUniqueAppointmentElements();\n      var filteredElements_1 = [];\n      var selectedDate_1 = this.parent.getDateFromElement(target).getTime();\n      var selectedSeriesEvents = this.parent.eventsProcessed.filter(function (eventObject) {\n        return !isReverse ? eventObject[_this.parent.eventFields.startTime].getTime() >= selectedDate_1 : eventObject[_this.parent.eventFields.startTime].getTime() <= selectedDate_1;\n      });\n      selectedSeriesEvents.filter(function (event) {\n        appointmentElements_1.filter(function (element) {\n          if (JSON.stringify(event.Guid) === JSON.stringify(element.getAttribute('data-guid'))) {\n            filteredElements_1.push(element);\n          }\n        });\n      });\n\n      if (filteredElements_1.length > 0) {\n        var selectedElement = isReverse ? filteredElements_1[filteredElements_1.length - 1] : filteredElements_1[0];\n        var focusElements = this.getAppointmentElementsByGuid(selectedElement.getAttribute('data-guid'));\n        this.parent.eventBase.addSelectedAppointments(focusElements);\n        focusElements[focusElements.length - 1].focus();\n      }\n    }\n  };\n\n  KeyboardInteraction.prototype.getAllDayCells = function (cells) {\n    var allDayRow = this.parent.getAllDayRow();\n\n    if (!allDayRow) {\n      return [];\n    }\n\n    var startCell = cells[0];\n    var endCell = cells[cells.length - 1];\n    var start = this.parent.getCellDetails(startCell);\n    var end = this.parent.getCellDetails(endCell);\n\n    if (end.endTime.getTime() - start.startTime.getTime() >= util.MS_PER_DAY) {\n      var allDayCells = [].slice.call(allDayRow.cells);\n      return allDayCells.slice(startCell.cellIndex, endCell.cellIndex + 1);\n    }\n\n    return [];\n  };\n\n  KeyboardInteraction.prototype.getAppointmentElements = function () {\n    return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n  };\n\n  KeyboardInteraction.prototype.getAppointmentElementsByGuid = function (guid) {\n    return [].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]'));\n  };\n\n  KeyboardInteraction.prototype.getUniqueAppointmentElements = function () {\n    var appointments = this.getAppointmentElements();\n    var appointmentElements = [];\n    appointments.map(function (value) {\n      return value.getAttribute('data-guid');\n    }).filter(function (value, index, self) {\n      if (self.indexOf(value) === index) {\n        appointmentElements.push(appointments[index]);\n      }\n    });\n    return appointmentElements;\n  };\n\n  KeyboardInteraction.prototype.getWorkCellFromAppointmentElement = function (target) {\n    var selectedObject = this.parent.eventBase.getEventByGuid(target.getAttribute('data-guid'));\n    return this.parent.eventBase.selectWorkCellByTime([selectedObject]);\n  };\n\n  KeyboardInteraction.prototype.processViewNavigation = function (e) {\n    var index = parseInt(e.key, 10) - 1;\n\n    if (index < this.parent.views.length) {\n      var view = this.parent.viewCollections[index].option;\n      this.parent.changeView(view, e, undefined, index);\n\n      if (this.parent.headerModule) {\n        this.parent.headerModule.element.querySelector('.e-active-view button').focus();\n      }\n    }\n  };\n\n  KeyboardInteraction.prototype.processUp = function (e, isMultiple) {\n    if (isMultiple && (this.parent.activeView.isTimelineView() || this.parent.currentView === 'MonthAgenda')) {\n      return;\n    }\n\n    var target = e.target;\n    var selectedElements = this.parent.getSelectedElements();\n    var selectedEventElements = this.parent.eventBase.getSelectedAppointments();\n    var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n    var quickPopupWrapper = this.getQuickPopupElement();\n\n    if (selectedElements.length > 0 && !e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n      target = selectedElements[selectedElements.length - 1];\n    }\n\n    if (selectedEventElements.length > 0 && !moreEventWrapper.classList.contains(cls.POPUP_OPEN) && !quickPopupWrapper.classList.contains(cls.POPUP_OPEN) && ['Day', 'Week', 'WorkWeek', 'Month'].indexOf(this.parent.currentView) !== -1) {\n      target = this.getWorkCellFromAppointmentElement(selectedEventElements[selectedEventElements.length - 1]);\n      this.parent.eventBase.removeSelectedAppointmentClass();\n    }\n\n    if (!target) {\n      return;\n    }\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS) && !this.parent.element.querySelector('.' + cls.POPUP_OPEN)) {\n      var tableRows = this.parent.getTableRows();\n      var curRowIndex = tableRows.indexOf(target.parentElement);\n\n      if (curRowIndex > 0 && curRowIndex < tableRows.length) {\n        this.selectCells(isMultiple, tableRows[curRowIndex - 1].cells[target.cellIndex]);\n      }\n    } else if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      this.selectAppointment(true, target);\n    }\n  };\n\n  KeyboardInteraction.prototype.processDown = function (e, isMultiple) {\n    if (isMultiple && (this.parent.activeView.isTimelineView() || this.parent.currentView === 'MonthAgenda')) {\n      return;\n    }\n\n    var target = e.target;\n    var selectedCells = this.parent.getSelectedElements();\n    var selectedElements = this.parent.eventBase.getSelectedAppointments();\n    var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n    var quickPopupWrapper = this.getQuickPopupElement();\n\n    if (selectedCells.length > 0 && !e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n      target = selectedCells[selectedCells.length - 1];\n    }\n\n    if (selectedElements.length > 0 && !moreEventWrapper.classList.contains(cls.POPUP_OPEN) && !quickPopupWrapper.classList.contains(cls.POPUP_OPEN) && ['Day', 'Week', 'WorkWeek', 'Month'].indexOf(this.parent.currentView) !== -1) {\n      target = this.getWorkCellFromAppointmentElement(selectedElements[selectedElements.length - 1]);\n      this.parent.eventBase.removeSelectedAppointmentClass();\n    }\n\n    var tableRows = this.parent.getTableRows();\n\n    if (!target) {\n      return;\n    }\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS) && !this.parent.element.querySelector('.' + cls.POPUP_OPEN)) {\n      var curRowIndex = tableRows.indexOf(target.parentElement);\n\n      if (curRowIndex >= 0 && curRowIndex < tableRows.length - 1) {\n        this.selectCells(isMultiple, tableRows[curRowIndex + 1].cells[target.cellIndex]);\n      }\n    } else if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      this.selectAppointment(false, target);\n    }\n  };\n\n  KeyboardInteraction.prototype.processLeftRight = function (target) {\n    var tableEle = this.parent.getContentTable();\n    var curRowIndex = target.parentNode.sectionRowIndex;\n    var key = {\n      element: tableEle,\n      rowIndex: curRowIndex,\n      columnIndex: target.cellIndex,\n      maxIndex: tableEle.rows[curRowIndex].cells.length\n    };\n    return key;\n  };\n\n  KeyboardInteraction.prototype.getQuickPopupElement = function () {\n    return (this.parent.isAdaptive ? document.body : this.parent.element).querySelector('.' + cls.POPUP_WRAPPER_CLASS);\n  };\n\n  KeyboardInteraction.prototype.isCancelLeftRightAction = function (e, isMultiple) {\n    if (this.parent.currentView === 'Agenda' || isMultiple && this.parent.currentView === 'MonthAgenda') {\n      return true;\n    }\n\n    if (this.isPreventAction(e) && isMultiple) {\n      return true;\n    }\n\n    var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n    var quickPopupWrapper = this.getQuickPopupElement();\n\n    if (moreEventWrapper.classList.contains(cls.POPUP_OPEN) || quickPopupWrapper.classList.contains(cls.POPUP_OPEN)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  KeyboardInteraction.prototype.processRight = function (e, isMultiple) {\n    if (this.isCancelLeftRightAction(e, isMultiple)) {\n      return;\n    }\n\n    var selectedCells = this.parent.getSelectedElements();\n    var targetCell;\n    var selectedAppointments = this.parent.eventBase.getSelectedAppointments();\n    var target = e.target;\n\n    if (selectedCells.length > 0 && !target.classList.contains(cls.WORK_CELLS_CLASS) && !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      target = selectedCells[selectedCells.length - 1];\n    }\n\n    if (selectedAppointments.length > 0) {\n      target = this.getWorkCellFromAppointmentElement(selectedAppointments[selectedAppointments.length - 1]);\n      this.parent.eventBase.removeSelectedAppointmentClass();\n\n      if (!target) {\n        return;\n      }\n    }\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS)) {\n      var key = this.processLeftRight(target);\n\n      if (key.columnIndex >= 0 && key.columnIndex < key.maxIndex - 1) {\n        targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex].cells[target.cellIndex + 1], 'right');\n\n        if (!isNullOrUndefined(targetCell)) {\n          this.selectCells(isMultiple, targetCell);\n        }\n      } else if (key.columnIndex === key.maxIndex - 1) {\n        if (!this.isInverseTableSelect() && key.rowIndex < key.element.rows.length - 1) {\n          targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex + 1].cells[0], 'right');\n\n          if (!isNullOrUndefined(targetCell)) {\n            this.selectCells(isMultiple, targetCell);\n          }\n        } else if (!isMultiple) {\n          var rowIndex = this.isInverseTableSelect() ? key.rowIndex : 0;\n          this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n          var tableEle = this.parent.getContentTable();\n          this.selectCells(false, tableEle.rows[rowIndex].cells[0]);\n        }\n      }\n    } else if (target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      var curColIndex = target.cellIndex;\n      var allDayRow = this.parent.getAllDayRow();\n      var maxColIndex = allDayRow.cells.length;\n\n      if (curColIndex >= 0 && curColIndex < maxColIndex - 1) {\n        this.selectCells(isMultiple, allDayRow.cells[curColIndex + 1]);\n      } else if (curColIndex === maxColIndex - 1 && !isMultiple) {\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n        var allDayRow_1 = this.parent.getAllDayRow();\n        this.selectCells(false, allDayRow_1.cells[0]);\n      }\n    }\n  };\n\n  KeyboardInteraction.prototype.processLeft = function (e, isMultiple) {\n    if (this.isCancelLeftRightAction(e, isMultiple)) {\n      return;\n    }\n\n    var target = e.target;\n    var selectedCells = this.parent.getSelectedElements();\n    var targetCell;\n\n    if (selectedCells.length > 0 && !target.classList.contains(cls.WORK_CELLS_CLASS) && !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      target = selectedCells[selectedCells.length - 1];\n    }\n\n    var selectedElements = this.parent.eventBase.getSelectedAppointments();\n\n    if (selectedElements.length > 0) {\n      target = this.getWorkCellFromAppointmentElement(selectedElements[selectedElements.length - 1]);\n      this.parent.eventBase.removeSelectedAppointmentClass();\n\n      if (!target) {\n        return;\n      }\n    }\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS)) {\n      var key = this.processLeftRight(target);\n\n      if (key.columnIndex > 0 && key.columnIndex < key.maxIndex) {\n        targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex].cells[target.cellIndex - 1], 'left');\n\n        if (!isNullOrUndefined(targetCell)) {\n          this.selectCells(isMultiple, targetCell);\n        }\n      } else if (key.columnIndex === 0) {\n        if (!this.isInverseTableSelect() && key.rowIndex > 0) {\n          targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex - 1].cells[key.maxIndex - 1], 'left');\n\n          if (!isNullOrUndefined(targetCell)) {\n            this.selectCells(isMultiple, targetCell);\n          }\n        } else if (!isMultiple) {\n          this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n          var tableEle = this.parent.getContentTable();\n          var rowIndex = this.isInverseTableSelect() ? key.rowIndex : tableEle.rows.length - 1;\n          this.selectCells(false, tableEle.rows[rowIndex].cells[key.maxIndex - 1]);\n        }\n      }\n    } else if (target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      var curColIndex = target.cellIndex;\n      var allDayRow = this.parent.getAllDayRow();\n      var maxColIndex = allDayRow.cells.length;\n\n      if (curColIndex > 0 && curColIndex < maxColIndex) {\n        this.selectCells(isMultiple, allDayRow.cells[curColIndex - 1]);\n      } else if (curColIndex === 0 && !isMultiple) {\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n        var allDayRow_2 = this.parent.getAllDayRow();\n        this.selectCells(false, allDayRow_2.cells[maxColIndex - 1]);\n      }\n    }\n  };\n\n  KeyboardInteraction.prototype.calculateNextPrevDate = function (currentCell, target, type) {\n    var initialId = this.initialTarget.getAttribute('data-group-index');\n\n    if (this.parent.activeViewOptions.group.resources.length > 0 && this.parent.currentView === 'Month') {\n      if (currentCell && target && target.getAttribute('data-group-index') !== initialId) {\n        var currentDate = this.parent.getDateFromElement(currentCell);\n        var nextPrevDate = type === 'right' ? new Date(currentDate.setDate(currentDate.getDate() + 1)) : new Date(currentDate.setDate(currentDate.getDate() - 1));\n        target = [].slice.call(this.parent.element.querySelectorAll('td[data-date=\"' + this.parent.getMsFromDate(nextPrevDate).toString() + '\"]' + '[data-group-index=\"' + initialId + '\"]'))[0];\n      }\n    }\n\n    return target;\n  };\n\n  KeyboardInteraction.prototype.getFocusableElements = function (container) {\n    var queryString = 'a[href]:not([tabindex=\"-1\"]),input:not([disabled]):not([tabindex=\"-1\"]),' + 'textarea:not([disabled]):not([tabindex=\"-1\"]),button:not([disabled]):not([tabindex=\"-1\"]),' + 'select:not([disabled]):not([tabindex=\"-1\"]),[tabindex]:not([tabindex=\"-1\"]),[contentEditable=true]:not([tabindex=\"-1\"])';\n    return [].slice.call(container.querySelectorAll(queryString));\n  };\n\n  KeyboardInteraction.prototype.processTabOnPopup = function (e, popupElement) {\n    var _this = this;\n\n    var focusableElements = this.getFocusableElements(popupElement);\n    focusableElements = focusableElements.filter(function (element) {\n      var footerEle = _this.parent.element.querySelector('.' + cls.POPUP_FOOTER_CLASS);\n\n      if (footerEle && footerEle.offsetParent) {\n        return !(element.classList.contains(cls.EDIT_CLASS) || element.classList.contains(cls.DELETE_CLASS));\n      } else {\n        return !(element.classList.contains(cls.EDIT_EVENT_CLASS) || element.classList.contains(cls.DELETE_EVENT_CLASS));\n      }\n    });\n    var firstEle = focusableElements[0];\n    var lastEle = focusableElements[focusableElements.length - 1];\n\n    if (!isNullOrUndefined(lastEle) && document.activeElement === lastEle && !e.shiftKey) {\n      e.preventDefault();\n      firstEle.focus();\n    }\n\n    if (!isNullOrUndefined(firstEle) && document.activeElement === firstEle && e.shiftKey) {\n      e.preventDefault();\n      lastEle.focus();\n    }\n  };\n\n  KeyboardInteraction.prototype.processTab = function (e, isReverse) {\n    var target = e.target;\n    var popupWrapper = closest(target, '.' + cls.POPUP_WRAPPER_CLASS + ',.' + cls.MORE_POPUP_WRAPPER_CLASS);\n\n    if (popupWrapper && popupWrapper.classList.contains(cls.POPUP_OPEN)) {\n      if (popupWrapper.classList.contains(cls.MORE_POPUP_WRAPPER_CLASS)) {\n        this.parent.eventBase.removeSelectedAppointmentClass();\n      }\n\n      this.processTabOnPopup(e, popupWrapper);\n      return;\n    }\n\n    if (target.classList.contains(cls.ROOT)) {\n      this.parent.eventBase.removeSelectedAppointmentClass();\n      return;\n    }\n\n    if (target.classList.contains(cls.APPOINTMENT_CLASS)) {\n      var appointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n      var selectedAppointments = this.parent.eventBase.getSelectedAppointments();\n\n      if (selectedAppointments.length > 0) {\n        target = selectedAppointments[selectedAppointments.length - 1];\n      }\n\n      this.parent.eventBase.removeSelectedAppointmentClass();\n\n      if (!isReverse && target.getAttribute('data-guid') === appointments[appointments.length - 1].getAttribute('data-guid') || isReverse && target.getAttribute('data-guid') === appointments[0].getAttribute('data-guid')) {\n        return;\n      }\n\n      if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n        this.selectAppointment(isReverse, target);\n        e.preventDefault();\n      }\n\n      return;\n    }\n\n    var selectedCells = this.parent.getSelectedElements();\n\n    if (selectedCells.length > 0 && !target.classList.contains(cls.APPOINTMENT_CLASS)) {\n      target = selectedCells[selectedCells.length - 1];\n      this.selectAppointmentElementFromWorkCell(isReverse, target);\n      e.preventDefault();\n      return;\n    }\n  };\n\n  KeyboardInteraction.prototype.processDelete = function (e) {\n    if (document.activeElement && document.activeElement.classList.contains(cls.APPOINTMENT_CLASS)) {\n      addClass([document.activeElement], cls.APPOINTMENT_BORDER);\n      this.parent.activeEventData = this.parent.eventBase.getSelectedEvents();\n\n      if (this.parent.activeViewOptions.readonly || document.activeElement.classList.contains('e-read-only')) {\n        return;\n      }\n\n      this.parent.quickPopup.deleteClick();\n    }\n  };\n\n  KeyboardInteraction.prototype.processEscape = function () {\n    this.parent.quickPopup.onClosePopup();\n    this.parent.quickPopup.morePopup.hide();\n\n    if (this.parent.headerModule) {\n      this.parent.headerModule.hideHeaderPopup();\n    }\n  };\n\n  KeyboardInteraction.prototype.isPreventAction = function (e) {\n    var target = closest(e.target, '.' + cls.RESOURCE_GROUP_CELLS_CLASS);\n\n    if (this.parent.activeView.isTimelineView() && !isNullOrUndefined(target)) {\n      return true;\n    }\n\n    return false;\n  };\n  /**\n   * Get module name.\n   */\n\n\n  KeyboardInteraction.prototype.getModuleName = function () {\n    return 'keyboard';\n  };\n  /**\n   * To destroy the keyboard module.\n   * @return {void}\n   * @private\n   */\n\n\n  KeyboardInteraction.prototype.destroy = function () {\n    this.removeEventListener();\n    this.keyboardModule.destroy();\n  };\n\n  return KeyboardInteraction;\n}();\n\nexport { KeyboardInteraction };","map":{"version":3,"sources":["/Users/jay/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/keyboard.js"],"names":["KeyboardEvents","closest","EventHandler","extend","isNullOrUndefined","addClass","removeClass","event","util","cls","KeyboardInteraction","parent","selectedCells","keyConfigs","downArrow","upArrow","rightArrow","leftArrow","shiftDownArrow","shiftUpArrow","shiftRightArrow","shiftLeftArrow","ctrlLeftArrow","ctrlRightArrow","altOne","altTwo","altThree","altFour","altFive","altSix","altSeven","altEight","altNine","enter","escape","delete","home","pageUp","pageDown","tab","shiftTab","element","tabIndex","keyboardModule","keyAction","keyActionHandler","bind","eventName","addEventListener","prototype","e","action","processDown","shiftKey","processUp","processLeft","processRight","changeDate","activeView","getNextPreviousDate","headerModule","querySelector","focus","processViewNavigation","processEnter","focusFirstCell","processTab","processDelete","processEscape","on","cellMouseDown","onCellMouseDown","removeEventListener","off","initialTarget","getClosestCell","activeViewOptions","readonly","currentView","target","classList","contains","WORK_CELLS_CLASS","which","removeSelectedClass","add","getContentTable","onMouseSelection","onMoveup","ALLDAY_CELLS_CLASS","allDayRow","getAllDayRow","appointments","slice","call","querySelectorAll","APPOINTMENT_CLASS","selectionEdges","boundaryValidation","pageY","pageX","bottom","top","left","right","parent_1","CONTENT_WRAP_CLASS","yInBounds","offsetHeight","scrollHeight","scrollTop","xInBounds","offsetWidth","scrollWidth","scrollLeft","selectCells","_this","remove","isPreventAction","queryStr","HEADER_CELLS_CLASS","activeCellsData","getSelectedElements","cellData","eventWindow","convertToEventData","args","data","requestType","showQuickPopup","trigger","select","selectArgs","isPopupShow","quickInfoOnSelectionEnd","cellArgs","cancel","name","notify","cellClick","POPUP_WRAPPER_CLASS","QUICK_POPUP_EVENT_DETAILS_CLASS","EVENT_CREATE_CLASS","EDIT_EVENT_CLASS","DELETE_EVENT_CLASS","CLOSE_CLASS","click","preventDefault","SUBJECT_CLASS","MORE_EVENT_CLOSE_CLASS","ALLDAY_APPOINTMENT_SECTION_CLASS","MORE_INDICATOR_CLASS","MORE_EVENT_HEADER_DATE_CLASS","setScheduleProperties","selectedDate","getDateFromElement","changeView","getNavigateView","cellDetails","length","start","getCellDetails","end","endTime","getCells","isInverseTable","tableEle","cells","maxRow","rows","maxColumn","startIndex","indexOf","endIndex","inverseCells","i","j","push","temp","sCells","focusCell","AGENDA_CELLS_CLASS","setAttribute","eventBase","removeSelectedAppointmentClass","isTimelineView","cell","CONTENT_TABLE_CLASS","HIDDEN_CLASS","RESOURCE_GROUP_CELLS_CLASS","getWorkCellElements","isInverseTableSelect","isMultiple","targetCell","Array","initialId_1","allowMultipleRow","allowMultiRowSelection","parentElement","children","cellIndex","group","resources","getAttribute","resourceSelectedCells","_i","selectedCells_1","allDayCells","getAllDayCells","resourceAllDayCells","_a","allDayCells_1","concat","addSelectedClass","selectAppointment","isReverse","getAppointmentElements","nextAppEle","targetIndex","addSelectedAppointments","AGENDA_SELECTED_CELL","selectAppointmentElementFromWorkCell","appointmentElements_1","getUniqueAppointmentElements","filteredElements_1","selectedDate_1","getTime","selectedSeriesEvents","eventsProcessed","filter","eventObject","eventFields","startTime","JSON","stringify","Guid","selectedElement","focusElements","getAppointmentElementsByGuid","startCell","endCell","MS_PER_DAY","guid","appointmentElements","map","value","index","self","getWorkCellFromAppointmentElement","selectedObject","getEventByGuid","selectWorkCellByTime","parseInt","key","views","view","viewCollections","option","undefined","selectedElements","selectedEventElements","getSelectedAppointments","moreEventWrapper","MORE_POPUP_WRAPPER_CLASS","quickPopupWrapper","getQuickPopupElement","POPUP_OPEN","tableRows","getTableRows","curRowIndex","processLeftRight","parentNode","sectionRowIndex","rowIndex","columnIndex","maxIndex","isAdaptive","document","body","isCancelLeftRightAction","selectedAppointments","calculateNextPrevDate","curColIndex","maxColIndex","allDayRow_1","allDayRow_2","currentCell","type","initialId","currentDate","nextPrevDate","Date","setDate","getDate","getMsFromDate","toString","getFocusableElements","container","queryString","processTabOnPopup","popupElement","focusableElements","footerEle","POPUP_FOOTER_CLASS","offsetParent","EDIT_CLASS","DELETE_CLASS","firstEle","lastEle","activeElement","popupWrapper","ROOT","APPOINTMENT_BORDER","activeEventData","getSelectedEvents","quickPopup","deleteClick","onClosePopup","morePopup","hide","hideHeaderPopup","getModuleName","destroy"],"mappings":"AAAA,SAASA,cAAT,EAAyBC,OAAzB,EAAkCC,YAAlC,EAAgDC,MAAhD,QAA8D,sBAA9D;AACA,SAASC,iBAAT,EAA4BC,QAA5B,EAAsCC,WAAtC,QAAyD,sBAAzD;AACA,OAAO,KAAKC,KAAZ,MAAuB,kBAAvB;AACA,OAAO,KAAKC,IAAZ,MAAsB,cAAtB;AACA,OAAO,KAAKC,GAAZ,MAAqB,sBAArB;AACA;;;;AAGA,IAAIC,mBAAmB;AAAG;AAAe,YAAY;AACjD,WAASA,mBAAT,CAA6BC,MAA7B,EAAqC;AACjC,SAAKC,aAAL,GAAqB,EAArB;AACA,SAAKC,UAAL,GAAkB;AACdC,MAAAA,SAAS,EAAE,WADG;AAEdC,MAAAA,OAAO,EAAE,SAFK;AAGdC,MAAAA,UAAU,EAAE,YAHE;AAIdC,MAAAA,SAAS,EAAE,WAJG;AAKdC,MAAAA,cAAc,EAAE,iBALF;AAMdC,MAAAA,YAAY,EAAE,eANA;AAOdC,MAAAA,eAAe,EAAE,kBAPH;AAQdC,MAAAA,cAAc,EAAE,iBARF;AASdC,MAAAA,aAAa,EAAE,gBATD;AAUdC,MAAAA,cAAc,EAAE,iBAVF;AAWdC,MAAAA,MAAM,EAAE,OAXM;AAYdC,MAAAA,MAAM,EAAE,OAZM;AAadC,MAAAA,QAAQ,EAAE,OAbI;AAcdC,MAAAA,OAAO,EAAE,OAdK;AAedC,MAAAA,OAAO,EAAE,OAfK;AAgBdC,MAAAA,MAAM,EAAE,OAhBM;AAiBdC,MAAAA,QAAQ,EAAE,OAjBI;AAkBdC,MAAAA,QAAQ,EAAE,OAlBI;AAmBdC,MAAAA,OAAO,EAAE,OAnBK;AAoBdC,MAAAA,KAAK,EAAE,OApBO;AAqBdC,MAAAA,MAAM,EAAE,QArBM;AAsBdC,MAAAA,MAAM,EAAE,QAtBM;AAuBdC,MAAAA,IAAI,EAAE,MAvBQ;AAwBdC,MAAAA,MAAM,EAAE,QAxBM;AAyBdC,MAAAA,QAAQ,EAAE,UAzBI;AA0BdC,MAAAA,GAAG,EAAE,KA1BS;AA2BdC,MAAAA,QAAQ,EAAE;AA3BI,KAAlB;AA6BA,SAAK7B,MAAL,GAAcA,MAAd;AACA,SAAKA,MAAL,CAAY8B,OAAZ,CAAoBC,QAApB,GAA+B,KAAK/B,MAAL,CAAY8B,OAAZ,CAAoBC,QAApB,KAAiC,CAAC,CAAlC,GAAsC,CAAtC,GAA0C,KAAK/B,MAAL,CAAY8B,OAAZ,CAAoBC,QAA7F;AACA,SAAKC,cAAL,GAAsB,IAAI3C,cAAJ,CAAmB,KAAKW,MAAL,CAAY8B,OAA/B,EAAwC;AAC1DG,MAAAA,SAAS,EAAE,KAAKC,gBAAL,CAAsBC,IAAtB,CAA2B,IAA3B,CAD+C;AAE1DjC,MAAAA,UAAU,EAAE,KAAKA,UAFyC;AAG1DkC,MAAAA,SAAS,EAAE;AAH+C,KAAxC,CAAtB;AAKA,SAAKC,gBAAL;AACH;;AACDtC,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BJ,gBAA9B,GAAiD,UAAUK,CAAV,EAAa;AAC1D,YAAQA,CAAC,CAACC,MAAV;AACI,WAAK,WAAL;AACA,WAAK,gBAAL;AACI,aAAKC,WAAL,CAAiBF,CAAjB,EAAoBA,CAAC,CAACG,QAAtB;AACA;;AACJ,WAAK,SAAL;AACA,WAAK,cAAL;AACI,aAAKC,SAAL,CAAeJ,CAAf,EAAkBA,CAAC,CAACG,QAApB;AACA;;AACJ,WAAK,WAAL;AACA,WAAK,gBAAL;AACI,aAAKE,WAAL,CAAiBL,CAAjB,EAAoBA,CAAC,CAACG,QAAtB;AACA;;AACJ,WAAK,YAAL;AACA,WAAK,iBAAL;AACI,aAAKG,YAAL,CAAkBN,CAAlB,EAAqBA,CAAC,CAACG,QAAvB;AACA;;AACJ,WAAK,eAAL;AACI,aAAK1C,MAAL,CAAY8C,UAAZ,CAAuB,KAAK9C,MAAL,CAAY+C,UAAZ,CAAuBC,mBAAvB,CAA2C,UAA3C,CAAvB,EAA+ET,CAA/E;;AACA,YAAI,KAAKvC,MAAL,CAAYiD,YAAhB,EAA8B;AAC1B,eAAKjD,MAAL,CAAYiD,YAAZ,CAAyBnB,OAAzB,CAAiCoB,aAAjC,CAA+C,gBAA/C,EAAiEC,KAAjE;AACH;;AACD;;AACJ,WAAK,gBAAL;AACI,aAAKnD,MAAL,CAAY8C,UAAZ,CAAuB,KAAK9C,MAAL,CAAY+C,UAAZ,CAAuBC,mBAAvB,CAA2C,MAA3C,CAAvB,EAA2ET,CAA3E;;AACA,YAAI,KAAKvC,MAAL,CAAYiD,YAAhB,EAA8B;AAC1B,eAAKjD,MAAL,CAAYiD,YAAZ,CAAyBnB,OAAzB,CAAiCoB,aAAjC,CAA+C,gBAA/C,EAAiEC,KAAjE;AACH;;AACD;;AACJ,WAAK,QAAL;AACA,WAAK,QAAL;AACA,WAAK,UAAL;AACA,WAAK,SAAL;AACA,WAAK,SAAL;AACA,WAAK,QAAL;AACA,WAAK,UAAL;AACA,WAAK,UAAL;AACA,WAAK,SAAL;AACI,aAAKC,qBAAL,CAA2Bb,CAA3B;AACA;;AACJ,WAAK,OAAL;AACI,aAAKc,YAAL,CAAkBd,CAAlB;AACA;;AACJ,WAAK,MAAL;AACI,aAAKe,cAAL;AACA;;AACJ,WAAK,KAAL;AACA,WAAK,UAAL;AACI,aAAKC,UAAL,CAAgBhB,CAAhB,EAAmBA,CAAC,CAACG,QAArB;AACA;;AACJ,WAAK,QAAL;AACI,aAAKc,aAAL,CAAmBjB,CAAnB;AACA;;AACJ,WAAK,QAAL;AACI,aAAKkB,aAAL;AAtDR;AAwDH,GAzDD;;AA0DA1D,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BD,gBAA9B,GAAiD,YAAY;AACzD,SAAKrC,MAAL,CAAY0D,EAAZ,CAAe9D,KAAK,CAAC+D,aAArB,EAAoC,KAAKC,eAAzC,EAA0D,IAA1D;AACH,GAFD;;AAGA7D,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BuB,mBAA9B,GAAoD,YAAY;AAC5D,SAAK7D,MAAL,CAAY8D,GAAZ,CAAgBlE,KAAK,CAAC+D,aAAtB,EAAqC,KAAKC,eAA1C;AACH,GAFD;;AAGA7D,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BsB,eAA9B,GAAgD,UAAUrB,CAAV,EAAa;AACzD,QAAIA,CAAC,CAAC3C,KAAF,CAAQ8C,QAAZ,EAAsB;AAClB;AACH;;AACD,SAAKqB,aAAL,GAAqB,KAAKC,cAAL,CAAoBzB,CAAC,CAAC3C,KAAtB,CAArB;;AACA,QAAI,KAAKI,MAAL,CAAYiE,iBAAZ,CAA8BC,QAA9B,IAA0C,KAAKlE,MAAL,CAAYmE,WAAZ,KAA4B,aAAtE,IAAuF,CAAC,KAAKJ,aAAjG,EAAgH;AAC5G;AACH;;AACD,QAAIxB,CAAC,CAAC3C,KAAF,CAAQwE,MAAR,CAAeC,SAAf,CAAyBC,QAAzB,CAAkCxE,GAAG,CAACyE,gBAAtC,KAA2DhC,CAAC,CAAC3C,KAAF,CAAQ4E,KAAR,KAAkB,CAAjF,EAAoF;AAChF,WAAKxE,MAAL,CAAYyE,mBAAZ;AACAlF,MAAAA,YAAY,CAACmF,GAAb,CAAiB,KAAK1E,MAAL,CAAY2E,eAAZ,EAAjB,EAAgD,WAAhD,EAA6D,KAAKC,gBAAlE,EAAoF,IAApF;AACArF,MAAAA,YAAY,CAACmF,GAAb,CAAiB,KAAK1E,MAAL,CAAY2E,eAAZ,EAAjB,EAAgD,SAAhD,EAA2D,KAAKE,QAAhE,EAA0E,IAA1E;AACH;;AACD,QAAItC,CAAC,CAAC3C,KAAF,CAAQwE,MAAR,CAAeC,SAAf,CAAyBC,QAAzB,CAAkCxE,GAAG,CAACgF,kBAAtC,KAA6DvC,CAAC,CAAC3C,KAAF,CAAQ4E,KAAR,KAAkB,CAAnF,EAAsF;AAClF,WAAKxE,MAAL,CAAYyE,mBAAZ;AACA,UAAIM,SAAS,GAAG,KAAK/E,MAAL,CAAYgF,YAAZ,EAAhB;AACAzF,MAAAA,YAAY,CAACmF,GAAb,CAAiBK,SAAjB,EAA4B,WAA5B,EAAyC,KAAKH,gBAA9C,EAAgE,IAAhE;AACArF,MAAAA,YAAY,CAACmF,GAAb,CAAiBK,SAAjB,EAA4B,SAA5B,EAAuC,KAAKF,QAA5C,EAAsD,IAAtD;AACH;AACJ,GAnBD;;AAoBA9E,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BsC,gBAA9B,GAAiD,UAAUrC,CAAV,EAAa;AAC1D,QAAI0C,YAAY,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAc,KAAKnF,MAAL,CAAY8B,OAAZ,CAAoBsD,gBAApB,CAAqC,MAAMtF,GAAG,CAACuF,iBAA/C,CAAd,CAAnB;AACA3F,IAAAA,QAAQ,CAACuF,YAAD,EAAe,gBAAf,CAAR;AACA,QAAIK,cAAc,GAAG,KAAKtF,MAAL,CAAYuF,kBAAZ,CAA+BhD,CAAC,CAACiD,KAAjC,EAAwCjD,CAAC,CAACkD,KAA1C,CAArB;;AACA,QAAIH,cAAc,CAACI,MAAf,IAAyBJ,cAAc,CAACK,GAAxC,IAA+CL,cAAc,CAACM,IAA9D,IAAsEN,cAAc,CAACO,KAAzF,EAAgG;AAC5F,UAAIC,QAAQ,GAAG,KAAK9F,MAAL,CAAY8B,OAAZ,CAAoBoB,aAApB,CAAkC,MAAMpD,GAAG,CAACiG,kBAA5C,CAAf;AACA,UAAIC,SAAS,GAAGF,QAAQ,CAACG,YAAT,IAAyBH,QAAQ,CAACI,YAAlC,IAAkDJ,QAAQ,CAACK,SAAT,IAAsB,CAAxE,IACZL,QAAQ,CAACK,SAAT,GAAqBL,QAAQ,CAACG,YAA9B,IAA8CH,QAAQ,CAACI,YAD3D;AAEA,UAAIE,SAAS,GAAGN,QAAQ,CAACO,WAAT,IAAwBP,QAAQ,CAACQ,WAAjC,IAAgDR,QAAQ,CAACS,UAAT,IAAuB,CAAvE,IACZT,QAAQ,CAACS,UAAT,GAAsBT,QAAQ,CAACO,WAA/B,IAA8CP,QAAQ,CAACQ,WAD3D;;AAEA,UAAIN,SAAS,KAAKV,cAAc,CAACK,GAAf,IAAsBL,cAAc,CAACI,MAA1C,CAAb,EAAgE;AAC5DI,QAAAA,QAAQ,CAACK,SAAT,IAAsBb,cAAc,CAACK,GAAf,GAClB,CAACpD,CAAC,CAAC6B,MAAF,CAAS6B,YADQ,GACO1D,CAAC,CAAC6B,MAAF,CAAS6B,YADtC;AAEH;;AACD,UAAIG,SAAS,KAAKd,cAAc,CAACM,IAAf,IAAuBN,cAAc,CAACO,KAA3C,CAAb,EAAgE;AAC5DC,QAAAA,QAAQ,CAACS,UAAT,IAAuBjB,cAAc,CAACM,IAAf,GACnB,CAACrD,CAAC,CAAC6B,MAAF,CAASiC,WADS,GACK9D,CAAC,CAAC6B,MAAF,CAASiC,WADrC;AAEH;AACJ;;AACD,QAAIjC,MAAM,GAAG,KAAKJ,cAAL,CAAoBzB,CAApB,CAAb;;AACA,QAAI6B,MAAJ,EAAY;AACR,WAAKoC,WAAL,CAAiB,IAAjB,EAAuBpC,MAAvB;AACH;AACJ,GAvBD;;AAwBArE,EAAAA,mBAAmB,CAACuC,SAApB,CAA8B0B,cAA9B,GAA+C,UAAUzB,CAAV,EAAa;AACxD,WAAOjD,OAAO,CAACiD,CAAC,CAAC6B,MAAH,EAAW,MAAMtE,GAAG,CAACyE,gBAAV,GAA6B,IAA7B,GAAoCzE,GAAG,CAACgF,kBAAnD,CAAd;AACH,GAFD;;AAGA/E,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BuC,QAA9B,GAAyC,UAAUtC,CAAV,EAAa;AAClD,QAAIkE,KAAK,GAAG,IAAZ;;AACA,QAAIxB,YAAY,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAc,KAAKnF,MAAL,CAAY8B,OAAZ,CAAoBsD,gBAApB,CAAqC,MAAMtF,GAAG,CAACuF,iBAA/C,CAAd,CAAnB;AACA1F,IAAAA,WAAW,CAACsF,YAAD,EAAe,gBAAf,CAAX;;AACA,QAAI1C,CAAC,CAAC6B,MAAF,CAASC,SAAT,CAAmBC,QAAnB,CAA4BxE,GAAG,CAACyE,gBAAhC,CAAJ,EAAuD;AACnDhF,MAAAA,YAAY,CAACmH,MAAb,CAAoB,KAAK1G,MAAL,CAAY2E,eAAZ,EAApB,EAAmD,WAAnD,EAAgE,KAAKC,gBAArE;AACArF,MAAAA,YAAY,CAACmH,MAAb,CAAoB,KAAK1G,MAAL,CAAY2E,eAAZ,EAApB,EAAmD,SAAnD,EAA8D,KAAKE,QAAnE;AACH;;AACD,QAAItC,CAAC,CAAC6B,MAAF,CAASC,SAAT,CAAmBC,QAAnB,CAA4BxE,GAAG,CAACgF,kBAAhC,CAAJ,EAAyD;AACrD,UAAIC,SAAS,GAAG,KAAK/E,MAAL,CAAYgF,YAAZ,EAAhB;AACAzF,MAAAA,YAAY,CAACmH,MAAb,CAAoB3B,SAApB,EAA+B,WAA/B,EAA4C,KAAKH,gBAAjD;AACArF,MAAAA,YAAY,CAACmH,MAAb,CAAoB3B,SAApB,EAA+B,SAA/B,EAA0C,KAAKF,QAA/C;AACH;;AACD,QAAI,KAAK8B,eAAL,CAAqBpE,CAArB,CAAJ,EAA6B;AACzB;AACH;;AACD,QAAIqE,QAAQ,GAAG,MAAM9G,GAAG,CAACyE,gBAAV,GAA6B,IAA7B,GAAoCzE,GAAG,CAACgF,kBAAxC,GAA6D,IAA7D,GAAoEhF,GAAG,CAAC+G,kBAAvF;AACA,QAAIzC,MAAM,GAAG9E,OAAO,CAACiD,CAAC,CAAC6B,MAAH,EAAWwC,QAAX,CAApB;AACA,SAAK5G,MAAL,CAAY8G,eAAZ,GAA8B,KAAKC,mBAAL,CAAyB3C,MAAzB,CAA9B;AACA,QAAI4C,QAAQ,GAAG,EAAf;AACA,SAAKhH,MAAL,CAAYiH,WAAZ,CAAwBC,kBAAxB,CAA2C,KAAKlH,MAAL,CAAY8G,eAAvD,EAAwEE,QAAxE;AACA,QAAIG,IAAI,GAAG;AACPC,MAAAA,IAAI,EAAEJ,QADC;AACSlF,MAAAA,OAAO,EAAE,KAAK9B,MAAL,CAAY8G,eAAZ,CAA4BhF,OAD9C;AACuDlC,MAAAA,KAAK,EAAE2C,CAD9D;AAEP8E,MAAAA,WAAW,EAAE,YAFN;AAEoBC,MAAAA,cAAc,EAAE;AAFpC,KAAX;AAIA,SAAKtH,MAAL,CAAYuH,OAAZ,CAAoB3H,KAAK,CAAC4H,MAA1B,EAAkCL,IAAlC,EAAwC,UAAUM,UAAV,EAAsB;AAC1D,UAAIC,WAAW,GAAGD,UAAU,CAACH,cAAX,IAA6Bb,KAAK,CAACzG,MAAN,CAAa2H,uBAA5D;;AACA,UAAID,WAAJ,EAAiB;AACb,YAAIE,QAAQ,GAAGpI,MAAM,CAACiH,KAAK,CAACzG,MAAN,CAAa8G,eAAd,EAA+B;AAAEe,UAAAA,MAAM,EAAE,KAAV;AAAiBjI,UAAAA,KAAK,EAAE2C,CAAxB;AAA2BuF,UAAAA,IAAI,EAAE;AAAjC,SAA/B,CAArB;;AACArB,QAAAA,KAAK,CAACzG,MAAN,CAAa+H,MAAb,CAAoBnI,KAAK,CAACoI,SAA1B,EAAqCJ,QAArC;AACH;AACJ,KAND;AAOH,GAhCD;;AAiCA7H,EAAAA,mBAAmB,CAACuC,SAApB,CAA8Be,YAA9B,GAA6C,UAAUd,CAAV,EAAa;AACtD,QAAI,KAAKvC,MAAL,CAAYiE,iBAAZ,CAA8BC,QAA9B,IAA0C,KAAKyC,eAAL,CAAqBpE,CAArB,CAA9C,EAAuE;AACnE;AACH;;AACD,QAAI6B,MAAM,GAAI7B,CAAC,CAAC6B,MAAhB;;AACA,QAAI9E,OAAO,CAAC8E,MAAD,EAAS,MAAMtE,GAAG,CAACmI,mBAAnB,CAAX,EAAoD;AAChD,UAAI7D,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACoI,+BAA9B,KACA9D,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACqI,kBAA9B,CADA,IAEA/D,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACsI,gBAA9B,CAFA,IAGAhE,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACuI,kBAA9B,CAHA,IAIAjE,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACwI,WAA9B,CAJJ,EAIgD;AAC5ClE,QAAAA,MAAM,CAACmE,KAAP;AACAhG,QAAAA,CAAC,CAACiG,cAAF;AACH,OAPD,MAQK,IAAIpE,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAAC2I,aAA9B,CAAJ,EAAkD;AACnD,aAAKzI,MAAL,CAAY8B,OAAZ,CAAoBoB,aAApB,CAAkC,MAAMpD,GAAG,CAACqI,kBAA5C,EAAgEI,KAAhE;AACAhG,QAAAA,CAAC,CAACiG,cAAF;AACH;;AACD;AACH;;AACD,QAAIpE,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACyE,gBAA9B,KAAmDH,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACgF,kBAA9B,CAAvD,EAA0G;AACtG,WAAK9E,MAAL,CAAY8G,eAAZ,GAA8B,KAAKC,mBAAL,CAAyB3C,MAAzB,CAA9B;AACA,UAAI+C,IAAI,GAAG3H,MAAM,CAAC,KAAKQ,MAAL,CAAY8G,eAAb,EAA8B;AAAEe,QAAAA,MAAM,EAAE,KAAV;AAAiBjI,QAAAA,KAAK,EAAE2C;AAAxB,OAA9B,CAAjB;AACA,WAAKvC,MAAL,CAAY+H,MAAZ,CAAmBnI,KAAK,CAACoI,SAAzB,EAAoCb,IAApC;AACA;AACH;;AACD,QAAI/C,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACuF,iBAA9B,KAAoDjB,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAAC4I,sBAA9B,CAApD,IACAtE,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAAC6I,gCAA9B,CADA,IACmEvE,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAAC8I,oBAA9B,CADvE,EAC4H;AACxHxE,MAAAA,MAAM,CAACmE,KAAP;AACA;AACH;;AACD,QAAInE,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAAC+I,4BAA9B,CAAJ,EAAiE;AAC7D,WAAK7I,MAAL,CAAY8I,qBAAZ,CAAkC;AAAEC,QAAAA,YAAY,EAAE,KAAK/I,MAAL,CAAYgJ,kBAAZ,CAA+B5E,MAA/B;AAAhB,OAAlC;AACA,WAAKpE,MAAL,CAAYiJ,UAAZ,CAAuB,KAAKjJ,MAAL,CAAYkJ,eAAZ,EAAvB,EAAsD3G,CAAtD;AACA,WAAKkB,aAAL;AACA;AACH;AACJ,GArCD;;AAsCA1D,EAAAA,mBAAmB,CAACuC,SAApB,CAA8ByE,mBAA9B,GAAoD,UAAU3C,MAAV,EAAkB;AAClE,QAAI+E,WAAJ;;AACA,QAAI,KAAKlJ,aAAL,CAAmBmJ,MAAnB,GAA4B,CAAhC,EAAmC;AAC/B,UAAIC,KAAK,GAAG,KAAKrJ,MAAL,CAAYsJ,cAAZ,CAA2B,KAAKrJ,aAAL,CAAmB,CAAnB,CAA3B,CAAZ;AACA,UAAIsJ,GAAG,GAAG,KAAKvJ,MAAL,CAAYsJ,cAAZ,CAA2B,KAAKrJ,aAAL,CAAmBiF,KAAnB,CAAyB,CAAC,CAA1B,EAA6B,CAA7B,CAA3B,CAAV;AACAmE,MAAAA,KAAK,CAACG,OAAN,GAAgBD,GAAG,CAACC,OAApB;AACAH,MAAAA,KAAK,CAACvH,OAAN,GAAgBsC,MAAhB;AACA+E,MAAAA,WAAW,GAAGE,KAAd;AACH,KAND,MAOK;AACDF,MAAAA,WAAW,GAAG,KAAKnJ,MAAL,CAAYsJ,cAAZ,CAA2BlF,MAA3B,CAAd;AACH;;AACD,WAAO+E,WAAP;AACH,GAbD;;AAcApJ,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BmH,QAA9B,GAAyC,UAAUC,cAAV,EAA0BL,KAA1B,EAAiCE,GAAjC,EAAsC;AAC3E,QAAII,QAAQ,GAAG,KAAK3J,MAAL,CAAY2E,eAAZ,EAAf;AACA,QAAIiF,KAAK,GAAG,GAAG1E,KAAH,CAASC,IAAT,CAAcwE,QAAQ,CAACvE,gBAAT,CAA0B,IAA1B,CAAd,CAAZ;AACA,QAAIyE,MAAM,GAAGF,QAAQ,CAACG,IAAT,CAAcV,MAA3B;AACA,QAAIW,SAAS,GAAGJ,QAAQ,CAACG,IAAT,CAAc,CAAd,EAAiBF,KAAjB,CAAuBR,MAAvC;;AACA,QAAIC,KAAK,CAAChF,SAAN,CAAgBC,QAAhB,CAAyBxE,GAAG,CAACgF,kBAA7B,CAAJ,EAAsD;AAClD,UAAIC,SAAS,GAAG,KAAK/E,MAAL,CAAYgF,YAAZ,EAAhB;AACA4E,MAAAA,KAAK,GAAG,GAAG1E,KAAH,CAASC,IAAT,CAAcJ,SAAS,CAAC6E,KAAxB,CAAR;AACAC,MAAAA,MAAM,GAAG,CAAT;AACAE,MAAAA,SAAS,GAAGhF,SAAS,CAAC6E,KAAV,CAAgBR,MAA5B;AACH;;AACD,QAAIY,UAAU,GAAGJ,KAAK,CAACK,OAAN,CAAcZ,KAAd,CAAjB;AACA,QAAIa,QAAQ,GAAGN,KAAK,CAACK,OAAN,CAAcV,GAAd,CAAf;AACA,QAAIY,YAAY,GAAG,EAAnB;;AACA,QAAIT,cAAJ,EAAoB;AAChB,WAAK,IAAIU,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,SAApB,EAA+BK,CAAC,EAAhC,EAAoC;AAChC,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,MAApB,EAA4BQ,CAAC,EAA7B,EAAiC;AAC7BF,UAAAA,YAAY,CAACG,IAAb,CAAkBV,KAAK,CAACG,SAAS,GAAGM,CAAZ,GAAgBD,CAAjB,CAAvB;AACH;AACJ;;AACDJ,MAAAA,UAAU,GAAGG,YAAY,CAACF,OAAb,CAAqBZ,KAArB,CAAb;AACAa,MAAAA,QAAQ,GAAGC,YAAY,CAACF,OAAb,CAAqBV,GAArB,CAAX;AACH;;AACD,QAAIS,UAAU,GAAGE,QAAjB,EAA2B;AACvB,UAAIK,IAAI,GAAGP,UAAX;AACAA,MAAAA,UAAU,GAAGE,QAAb;AACAA,MAAAA,QAAQ,GAAGK,IAAX;AACH;;AACD,QAAIC,MAAM,GAAGd,cAAc,GAAGS,YAAH,GAAkBP,KAA7C;AACA,WAAOY,MAAM,CAACtF,KAAP,CAAa8E,UAAb,EAAyBE,QAAQ,GAAG,CAApC,CAAP;AACH,GA9BD;;AA+BAnK,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BgB,cAA9B,GAA+C,YAAY;AACvD,QAAI,KAAKtD,MAAL,CAAYmE,WAAZ,KAA4B,QAAhC,EAA0C;AACtC,UAAIsG,SAAS,GAAG,KAAKzK,MAAL,CAAY2E,eAAZ,GAA8BzB,aAA9B,CAA4C,MAAMpD,GAAG,CAAC4K,kBAAtD,CAAhB;AACAD,MAAAA,SAAS,CAACE,YAAV,CAAuB,UAAvB,EAAmC,GAAnC;AACAF,MAAAA,SAAS,CAACtH,KAAV;AACA;AACH;;AACD,SAAKnD,MAAL,CAAY4K,SAAZ,CAAsBC,8BAAtB;;AACA,QAAI,KAAK7K,MAAL,CAAY+C,UAAZ,CAAuB+H,cAAvB,EAAJ,EAA6C;AACzC,UAAIC,IAAI,GAAG,KAAK/K,MAAL,CAAY8B,OAAZ,CAAoBoB,aAApB,CAAkC,MAAMpD,GAAG,CAACkL,mBAAV,GACzC,WADyC,GAC3BlL,GAAG,CAACmL,YADuB,GACR,KADQ,GACAnL,GAAG,CAACyE,gBADJ,GACuB,QADvB,GACkCzE,GAAG,CAACoL,0BADtC,GACmE,GADrG,CAAX;AAEA,WAAK1E,WAAL,CAAiB,KAAjB,EAAwBuE,IAAxB;AACH,KAJD,MAKK;AACD,WAAKvE,WAAL,CAAiB,KAAjB,EAAwB,KAAKxG,MAAL,CAAYmL,mBAAZ,GAAkC,CAAlC,CAAxB;AACH;AACJ,GAhBD;;AAiBApL,EAAAA,mBAAmB,CAACuC,SAApB,CAA8B8I,oBAA9B,GAAqD,YAAY;AAC7D,WAAO,KAAKpL,MAAL,CAAY+C,UAAZ,CAAuBqI,oBAA9B;AACH,GAFD;AAGA;;;AACArL,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BkE,WAA9B,GAA4C,UAAU6E,UAAV,EAAsBC,UAAtB,EAAkC;AAC1E,QAAI7E,KAAK,GAAG,IAAZ;;AACA,SAAKzG,MAAL,CAAYyE,mBAAZ;AACA,QAAIL,MAAM,GAAIkH,UAAU,YAAYC,KAAvB,GAAgCD,UAAU,CAACpG,KAAX,CAAiB,CAAC,CAAlB,EAAqB,CAArB,CAAhC,GAA0DoG,UAAvE;;AACA,QAAID,UAAJ,EAAgB;AACZ,UAAIG,WAAJ;AACA,UAAIrE,IAAI,GAAG;AAAErF,QAAAA,OAAO,EAAEwJ,UAAX;AAAuBjE,QAAAA,WAAW,EAAE,WAApC;AAAiDoE,QAAAA,gBAAgB,EAAE;AAAnE,OAAX;AACA,WAAKzL,MAAL,CAAYuH,OAAZ,CAAoB3H,KAAK,CAAC4H,MAA1B,EAAkCL,IAAlC,EAAwC,UAAUM,UAAV,EAAsB;AAC1D,YAAIgE,gBAAgB,GAAI,CAAChE,UAAU,CAACgE,gBAAb,IAAmC,CAAChF,KAAK,CAACzG,MAAN,CAAa0L,sBAAxE;;AACA,YAAID,gBAAgB,IAAK,CAAC,KAAD,EAAQ,MAAR,EAAgB,UAAhB,EAA4BxB,OAA5B,CAAoCxD,KAAK,CAACzG,MAAN,CAAamE,WAAjD,IAAgE,CAAC,CAA1F,EAA8F;AAC1FC,UAAAA,MAAM,GAAGA,MAAM,CAACuH,aAAP,CAAqBC,QAArB,CAA8BnF,KAAK,CAAC1C,aAAN,CAAoB8H,SAAlD,CAAT;AACH;;AACD,YAAI5L,aAAa,GAAGwG,KAAK,CAACgD,QAAN,CAAehD,KAAK,CAAC2E,oBAAN,EAAf,EAA6C3E,KAAK,CAAC1C,aAAnD,EAAkEK,MAAlE,CAApB;;AACA,YAAIqC,KAAK,CAACzG,MAAN,CAAaiE,iBAAb,CAA+B6H,KAA/B,CAAqCC,SAArC,CAA+C3C,MAA/C,GAAwD,CAA5D,EAA+D;AAC3DoC,UAAAA,WAAW,GAAG/E,KAAK,CAAC1C,aAAN,CAAoBiI,YAApB,CAAiC,kBAAjC,CAAd;AACA,cAAIC,qBAAqB,GAAG,EAA5B;;AACA,eAAK,IAAIC,EAAE,GAAG,CAAT,EAAYC,eAAe,GAAGlM,aAAnC,EAAkDiM,EAAE,GAAGC,eAAe,CAAC/C,MAAvE,EAA+E8C,EAAE,EAAjF,EAAqF;AACjF,gBAAInB,IAAI,GAAGoB,eAAe,CAACD,EAAD,CAA1B;;AACA,gBAAInB,IAAI,CAACiB,YAAL,CAAkB,kBAAlB,MAA0CR,WAA9C,EAA2D;AACvDS,cAAAA,qBAAqB,CAAC3B,IAAtB,CAA2BS,IAA3B;AACH;AACJ;;AACD9K,UAAAA,aAAa,GAAGgM,qBAAhB;AACH;;AACDxF,QAAAA,KAAK,CAACxG,aAAN,GAAsBA,aAAtB;;AACA,YAAIA,aAAa,CAACmJ,MAAd,GAAuB,CAAvB,IAA4B,CAAChF,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACgF,kBAA9B,CAAjC,EAAoF;AAChF,cAAIsH,WAAW,GAAG3F,KAAK,CAAC4F,cAAN,CAAqBpM,aAArB,CAAlB;;AACA,cAAIwG,KAAK,CAACzG,MAAN,CAAaiE,iBAAb,CAA+B6H,KAA/B,CAAqCC,SAArC,CAA+C3C,MAA/C,GAAwD,CAA5D,EAA+D;AAC3D,gBAAIkD,mBAAmB,GAAG,EAA1B;;AACA,iBAAK,IAAIC,EAAE,GAAG,CAAT,EAAYC,aAAa,GAAGJ,WAAjC,EAA8CG,EAAE,GAAGC,aAAa,CAACpD,MAAjE,EAAyEmD,EAAE,EAA3E,EAA+E;AAC3E,kBAAIxB,IAAI,GAAGyB,aAAa,CAACD,EAAD,CAAxB;;AACA,kBAAIxB,IAAI,CAACiB,YAAL,CAAkB,kBAAlB,MAA0CR,WAA9C,EAA2D;AACvDc,gBAAAA,mBAAmB,CAAChC,IAApB,CAAyBS,IAAzB;AACH;AACJ;;AACDqB,YAAAA,WAAW,GAAGE,mBAAd;AACH;;AACDrM,UAAAA,aAAa,GAAGA,aAAa,CAACwM,MAAd,CAAqBL,WAArB,CAAhB;AACH;;AACD,YAAKhI,MAAM,CAAC4H,YAAP,CAAoB,kBAApB,MAA4CR,WAA7C,IAA6D/E,KAAK,CAACzG,MAAN,CAAaiE,iBAAb,CAA+B6H,KAA/B,CAAqCC,SAArC,CAA+C3C,MAA/C,GAAwD,CAAzH,EAA4H;AACxHhF,UAAAA,MAAM,GAAGqC,KAAK,CAACxG,aAAN,CAAoBwG,KAAK,CAACxG,aAAN,CAAoBmJ,MAApB,GAA6B,CAAjD,CAAT;AACH;;AACD3C,QAAAA,KAAK,CAACzG,MAAN,CAAa0M,gBAAb,CAA8BzM,aAA9B,EAA6CmE,MAA7C;AACH,OApCD;AAqCH,KAxCD,MAyCK;AACD,WAAKL,aAAL,GAAqBK,MAArB;AACA,WAAKnE,aAAL,GAAqB,CAACmE,MAAD,CAArB;AACA,WAAKpE,MAAL,CAAY0M,gBAAZ,CAA6B,CAACtI,MAAD,CAA7B,EAAuCA,MAAvC;AACH;AACJ,GAlDD;;AAmDArE,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BqK,iBAA9B,GAAkD,UAAUC,SAAV,EAAqBxI,MAArB,EAA6B;AAC3E,QAAIa,YAAY,GAAG,KAAK4H,sBAAL,EAAnB;;AACA,QAAI5H,YAAY,CAACmE,MAAb,GAAsB,CAA1B,EAA6B;AACzB;AACH;;AACD,SAAKpJ,MAAL,CAAY4K,SAAZ,CAAsBC,8BAAtB;AACA,QAAIiC,UAAJ;;AACA,QAAI1I,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACuF,iBAA9B,CAAJ,EAAsD;AAClD,UAAI0H,WAAW,GAAG9H,YAAY,CAACgF,OAAb,CAAqB7F,MAArB,CAAlB;AACA0I,MAAAA,UAAU,GAAG7H,YAAY,CAAE2H,SAAS,GAAGG,WAAW,GAAG,CAAjB,GAAqBA,WAAW,GAAG,CAA9C,CAAzB;AACH,KAHD,MAIK;AACDD,MAAAA,UAAU,GAAGF,SAAS,GAAG3H,YAAY,CAACA,YAAY,CAACmE,MAAb,GAAsB,CAAvB,CAAf,GAA2CnE,YAAY,CAAC,CAAD,CAA7E;AACH;;AACD,QAAI6H,UAAJ,EAAgB;AACZ,WAAK9M,MAAL,CAAY4K,SAAZ,CAAsBoC,uBAAtB,CAA8C,CAACF,UAAD,CAA9C;AACAA,MAAAA,UAAU,CAAC3J,KAAX;AACAzD,MAAAA,QAAQ,CAAC,CAACoN,UAAD,CAAD,EAAehN,GAAG,CAACmN,oBAAnB,CAAR;AACH;AACJ,GAnBD;;AAoBAlN,EAAAA,mBAAmB,CAACuC,SAApB,CAA8B4K,oCAA9B,GAAqE,UAAUN,SAAV,EAAqBxI,MAArB,EAA6B;AAC9F,QAAIqC,KAAK,GAAG,IAAZ;;AACA,SAAKzG,MAAL,CAAY4K,SAAZ,CAAsBC,8BAAtB;AACA,SAAK7K,MAAL,CAAYyE,mBAAZ;;AACA,QAAIL,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACyE,gBAA9B,KAAmDH,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACgF,kBAA9B,CAAvD,EAA0G;AACtG,UAAIqI,qBAAqB,GAAG,KAAKC,4BAAL,EAA5B;AACA,UAAIC,kBAAkB,GAAG,EAAzB;AACA,UAAIC,cAAc,GAAG,KAAKtN,MAAL,CAAYgJ,kBAAZ,CAA+B5E,MAA/B,EAAuCmJ,OAAvC,EAArB;AACA,UAAIC,oBAAoB,GAAG,KAAKxN,MAAL,CAAYyN,eAAZ,CAA4BC,MAA5B,CAAmC,UAAUC,WAAV,EAAuB;AACjF,eAAQ,CAACf,SAAD,GAAce,WAAW,CAAClH,KAAK,CAACzG,MAAN,CAAa4N,WAAb,CAAyBC,SAA1B,CAAX,CAAgDN,OAAhD,MAA6DD,cAA3E,GACHK,WAAW,CAAClH,KAAK,CAACzG,MAAN,CAAa4N,WAAb,CAAyBC,SAA1B,CAAX,CAAgDN,OAAhD,MAA6DD,cADlE;AAEH,OAH0B,CAA3B;AAIAE,MAAAA,oBAAoB,CAACE,MAArB,CAA4B,UAAU9N,KAAV,EAAiB;AACzCuN,QAAAA,qBAAqB,CAACO,MAAtB,CAA6B,UAAU5L,OAAV,EAAmB;AAC5C,cAAIgM,IAAI,CAACC,SAAL,CAAenO,KAAK,CAACoO,IAArB,MAA+BF,IAAI,CAACC,SAAL,CAAejM,OAAO,CAACkK,YAAR,CAAqB,WAArB,CAAf,CAAnC,EAAsF;AAClFqB,YAAAA,kBAAkB,CAAC/C,IAAnB,CAAwBxI,OAAxB;AACH;AACJ,SAJD;AAKH,OAND;;AAOA,UAAIuL,kBAAkB,CAACjE,MAAnB,GAA4B,CAAhC,EAAmC;AAC/B,YAAI6E,eAAe,GAAGrB,SAAS,GAAGS,kBAAkB,CAACA,kBAAkB,CAACjE,MAAnB,GAA4B,CAA7B,CAArB,GAAuDiE,kBAAkB,CAAC,CAAD,CAAxG;AACA,YAAIa,aAAa,GAAG,KAAKC,4BAAL,CAAkCF,eAAe,CAACjC,YAAhB,CAA6B,WAA7B,CAAlC,CAApB;AACA,aAAKhM,MAAL,CAAY4K,SAAZ,CAAsBoC,uBAAtB,CAA8CkB,aAA9C;AACCA,QAAAA,aAAa,CAACA,aAAa,CAAC9E,MAAd,GAAuB,CAAxB,CAAd,CAA0CjG,KAA1C;AACH;AACJ;AACJ,GA1BD;;AA2BApD,EAAAA,mBAAmB,CAACuC,SAApB,CAA8B+J,cAA9B,GAA+C,UAAUzC,KAAV,EAAiB;AAC5D,QAAI7E,SAAS,GAAG,KAAK/E,MAAL,CAAYgF,YAAZ,EAAhB;;AACA,QAAI,CAACD,SAAL,EAAgB;AACZ,aAAO,EAAP;AACH;;AACD,QAAIqJ,SAAS,GAAGxE,KAAK,CAAC,CAAD,CAArB;AACA,QAAIyE,OAAO,GAAGzE,KAAK,CAACA,KAAK,CAACR,MAAN,GAAe,CAAhB,CAAnB;AACA,QAAIC,KAAK,GAAG,KAAKrJ,MAAL,CAAYsJ,cAAZ,CAA2B8E,SAA3B,CAAZ;AACA,QAAI7E,GAAG,GAAG,KAAKvJ,MAAL,CAAYsJ,cAAZ,CAA2B+E,OAA3B,CAAV;;AACA,QAAI9E,GAAG,CAACC,OAAJ,CAAY+D,OAAZ,KAAwBlE,KAAK,CAACwE,SAAN,CAAgBN,OAAhB,EAAxB,IAAqD1N,IAAI,CAACyO,UAA9D,EAA0E;AACtE,UAAIlC,WAAW,GAAG,GAAGlH,KAAH,CAASC,IAAT,CAAcJ,SAAS,CAAC6E,KAAxB,CAAlB;AACA,aAAOwC,WAAW,CAAClH,KAAZ,CAAkBkJ,SAAS,CAACvC,SAA5B,EAAuCwC,OAAO,CAACxC,SAAR,GAAoB,CAA3D,CAAP;AACH;;AACD,WAAO,EAAP;AACH,GAdD;;AAeA9L,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BuK,sBAA9B,GAAuD,YAAY;AAC/D,WAAO,GAAG3H,KAAH,CAASC,IAAT,CAAc,KAAKnF,MAAL,CAAY8B,OAAZ,CAAoBsD,gBAApB,CAAqC,MAAMtF,GAAG,CAACuF,iBAA/C,CAAd,CAAP;AACH,GAFD;;AAGAtF,EAAAA,mBAAmB,CAACuC,SAApB,CAA8B6L,4BAA9B,GAA6D,UAAUI,IAAV,EAAgB;AACzE,WAAO,GAAGrJ,KAAH,CAASC,IAAT,CAAc,KAAKnF,MAAL,CAAY8B,OAAZ,CAAoBsD,gBAApB,CAAqC,oBAAoBmJ,IAApB,GAA2B,IAAhE,CAAd,CAAP;AACH,GAFD;;AAGAxO,EAAAA,mBAAmB,CAACuC,SAApB,CAA8B8K,4BAA9B,GAA6D,YAAY;AACrE,QAAInI,YAAY,GAAG,KAAK4H,sBAAL,EAAnB;AACA,QAAI2B,mBAAmB,GAAG,EAA1B;AACAvJ,IAAAA,YAAY,CAACwJ,GAAb,CAAiB,UAAUC,KAAV,EAAiB;AAC9B,aAAOA,KAAK,CAAC1C,YAAN,CAAmB,WAAnB,CAAP;AACH,KAFD,EAEG0B,MAFH,CAEU,UAAUgB,KAAV,EAAiBC,KAAjB,EAAwBC,IAAxB,EAA8B;AACpC,UAAIA,IAAI,CAAC3E,OAAL,CAAayE,KAAb,MAAwBC,KAA5B,EAAmC;AAC/BH,QAAAA,mBAAmB,CAAClE,IAApB,CAAyBrF,YAAY,CAAC0J,KAAD,CAArC;AACH;AACJ,KAND;AAOA,WAAOH,mBAAP;AACH,GAXD;;AAYAzO,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BuM,iCAA9B,GAAkE,UAAUzK,MAAV,EAAkB;AAChF,QAAI0K,cAAc,GAAG,KAAK9O,MAAL,CAAY4K,SAAZ,CAAsBmE,cAAtB,CAAqC3K,MAAM,CAAC4H,YAAP,CAAoB,WAApB,CAArC,CAArB;AACA,WAAO,KAAKhM,MAAL,CAAY4K,SAAZ,CAAsBoE,oBAAtB,CAA2C,CAACF,cAAD,CAA3C,CAAP;AACH,GAHD;;AAIA/O,EAAAA,mBAAmB,CAACuC,SAApB,CAA8Bc,qBAA9B,GAAsD,UAAUb,CAAV,EAAa;AAC/D,QAAIoM,KAAK,GAAGM,QAAQ,CAAC1M,CAAC,CAAC2M,GAAH,EAAQ,EAAR,CAAR,GAAsB,CAAlC;;AACA,QAAIP,KAAK,GAAG,KAAK3O,MAAL,CAAYmP,KAAZ,CAAkB/F,MAA9B,EAAsC;AAClC,UAAIgG,IAAI,GAAG,KAAKpP,MAAL,CAAYqP,eAAZ,CAA4BV,KAA5B,EAAmCW,MAA9C;AACA,WAAKtP,MAAL,CAAYiJ,UAAZ,CAAuBmG,IAAvB,EAA6B7M,CAA7B,EAAgCgN,SAAhC,EAA2CZ,KAA3C;;AACA,UAAI,KAAK3O,MAAL,CAAYiD,YAAhB,EAA8B;AAC1B,aAAKjD,MAAL,CAAYiD,YAAZ,CAAyBnB,OAAzB,CAAiCoB,aAAjC,CAA+C,uBAA/C,EAAwEC,KAAxE;AACH;AACJ;AACJ,GATD;;AAUApD,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BK,SAA9B,GAA0C,UAAUJ,CAAV,EAAa8I,UAAb,EAAyB;AAC/D,QAAKA,UAAU,KAAK,KAAKrL,MAAL,CAAY+C,UAAZ,CAAuB+H,cAAvB,MAA2C,KAAK9K,MAAL,CAAYmE,WAAZ,KAA4B,aAA5E,CAAf,EAA4G;AACxG;AACH;;AACD,QAAIC,MAAM,GAAI7B,CAAC,CAAC6B,MAAhB;AACA,QAAIoL,gBAAgB,GAAG,KAAKxP,MAAL,CAAY+G,mBAAZ,EAAvB;AACA,QAAI0I,qBAAqB,GAAG,KAAKzP,MAAL,CAAY4K,SAAZ,CAAsB8E,uBAAtB,EAA5B;AACA,QAAIC,gBAAgB,GAAG,KAAK3P,MAAL,CAAY8B,OAAZ,CAAoBoB,aAApB,CAAkC,MAAMpD,GAAG,CAAC8P,wBAA5C,CAAvB;AACA,QAAIC,iBAAiB,GAAG,KAAKC,oBAAL,EAAxB;;AACA,QAAIN,gBAAgB,CAACpG,MAAjB,GAA0B,CAA1B,IAA+B,CAAC7G,CAAC,CAAC6B,MAAF,CAASC,SAAT,CAAmBC,QAAnB,CAA4BxE,GAAG,CAACyE,gBAAhC,CAApC,EAAuF;AACnFH,MAAAA,MAAM,GAAGoL,gBAAgB,CAACA,gBAAgB,CAACpG,MAAjB,GAA0B,CAA3B,CAAzB;AACH;;AACD,QAAIqG,qBAAqB,CAACrG,MAAtB,GAA+B,CAA/B,IAAoC,CAACuG,gBAAgB,CAACtL,SAAjB,CAA2BC,QAA3B,CAAoCxE,GAAG,CAACiQ,UAAxC,CAArC,IACA,CAACF,iBAAiB,CAACxL,SAAlB,CAA4BC,QAA5B,CAAqCxE,GAAG,CAACiQ,UAAzC,CADD,IAEA,CAAC,KAAD,EAAQ,MAAR,EAAgB,UAAhB,EAA4B,OAA5B,EAAqC9F,OAArC,CAA6C,KAAKjK,MAAL,CAAYmE,WAAzD,MAA0E,CAAC,CAF/E,EAEkF;AAC9EC,MAAAA,MAAM,GAAG,KAAKyK,iCAAL,CAAuCY,qBAAqB,CAACA,qBAAqB,CAACrG,MAAtB,GAA+B,CAAhC,CAA5D,CAAT;AACA,WAAKpJ,MAAL,CAAY4K,SAAZ,CAAsBC,8BAAtB;AACH;;AACD,QAAI,CAACzG,MAAL,EAAa;AACT;AACH;;AACD,QAAIA,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACyE,gBAA9B,KAAmD,CAAC,KAAKvE,MAAL,CAAY8B,OAAZ,CAAoBoB,aAApB,CAAkC,MAAMpD,GAAG,CAACiQ,UAA5C,CAAxD,EAAiH;AAC7G,UAAIC,SAAS,GAAG,KAAKhQ,MAAL,CAAYiQ,YAAZ,EAAhB;AACA,UAAIC,WAAW,GAAGF,SAAS,CAAC/F,OAAV,CAAkB7F,MAAM,CAACuH,aAAzB,CAAlB;;AACA,UAAIuE,WAAW,GAAG,CAAd,IAAmBA,WAAW,GAAGF,SAAS,CAAC5G,MAA/C,EAAuD;AACnD,aAAK5C,WAAL,CAAiB6E,UAAjB,EAA8B2E,SAAS,CAACE,WAAW,GAAG,CAAf,CAAV,CAA6BtG,KAA7B,CAAmCxF,MAAM,CAACyH,SAA1C,CAA7B;AACH;AACJ,KAND,MAOK,IAAI,KAAK7L,MAAL,CAAYmE,WAAZ,KAA4B,QAA5B,IAAwC,KAAKnE,MAAL,CAAYmE,WAAZ,KAA4B,aAAxE,EAAuF;AACxF,WAAKwI,iBAAL,CAAuB,IAAvB,EAA6BvI,MAA7B;AACH;AACJ,GA/BD;;AAgCArE,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BG,WAA9B,GAA4C,UAAUF,CAAV,EAAa8I,UAAb,EAAyB;AACjE,QAAKA,UAAU,KAAK,KAAKrL,MAAL,CAAY+C,UAAZ,CAAuB+H,cAAvB,MAA2C,KAAK9K,MAAL,CAAYmE,WAAZ,KAA4B,aAA5E,CAAf,EAA4G;AACxG;AACH;;AACD,QAAIC,MAAM,GAAI7B,CAAC,CAAC6B,MAAhB;AACA,QAAInE,aAAa,GAAG,KAAKD,MAAL,CAAY+G,mBAAZ,EAApB;AACA,QAAIyI,gBAAgB,GAAG,KAAKxP,MAAL,CAAY4K,SAAZ,CAAsB8E,uBAAtB,EAAvB;AACA,QAAIC,gBAAgB,GAAG,KAAK3P,MAAL,CAAY8B,OAAZ,CAAoBoB,aAApB,CAAkC,MAAMpD,GAAG,CAAC8P,wBAA5C,CAAvB;AACA,QAAIC,iBAAiB,GAAG,KAAKC,oBAAL,EAAxB;;AACA,QAAI7P,aAAa,CAACmJ,MAAd,GAAuB,CAAvB,IAA4B,CAAC7G,CAAC,CAAC6B,MAAF,CAASC,SAAT,CAAmBC,QAAnB,CAA4BxE,GAAG,CAACyE,gBAAhC,CAAjC,EAAoF;AAChFH,MAAAA,MAAM,GAAGnE,aAAa,CAACA,aAAa,CAACmJ,MAAd,GAAuB,CAAxB,CAAtB;AACH;;AACD,QAAIoG,gBAAgB,CAACpG,MAAjB,GAA0B,CAA1B,IAA+B,CAACuG,gBAAgB,CAACtL,SAAjB,CAA2BC,QAA3B,CAAoCxE,GAAG,CAACiQ,UAAxC,CAAhC,IACA,CAACF,iBAAiB,CAACxL,SAAlB,CAA4BC,QAA5B,CAAqCxE,GAAG,CAACiQ,UAAzC,CADD,IAEA,CAAC,KAAD,EAAQ,MAAR,EAAgB,UAAhB,EAA4B,OAA5B,EAAqC9F,OAArC,CAA6C,KAAKjK,MAAL,CAAYmE,WAAzD,MAA0E,CAAC,CAF/E,EAEkF;AAC9EC,MAAAA,MAAM,GAAG,KAAKyK,iCAAL,CAAuCW,gBAAgB,CAACA,gBAAgB,CAACpG,MAAjB,GAA0B,CAA3B,CAAvD,CAAT;AACA,WAAKpJ,MAAL,CAAY4K,SAAZ,CAAsBC,8BAAtB;AACH;;AACD,QAAImF,SAAS,GAAG,KAAKhQ,MAAL,CAAYiQ,YAAZ,EAAhB;;AACA,QAAI,CAAC7L,MAAL,EAAa;AACT;AACH;;AACD,QAAIA,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACyE,gBAA9B,KAAmD,CAAC,KAAKvE,MAAL,CAAY8B,OAAZ,CAAoBoB,aAApB,CAAkC,MAAMpD,GAAG,CAACiQ,UAA5C,CAAxD,EAAiH;AAC7G,UAAIG,WAAW,GAAGF,SAAS,CAAC/F,OAAV,CAAkB7F,MAAM,CAACuH,aAAzB,CAAlB;;AACA,UAAIuE,WAAW,IAAI,CAAf,IAAoBA,WAAW,GAAGF,SAAS,CAAC5G,MAAV,GAAmB,CAAzD,EAA4D;AACxD,aAAK5C,WAAL,CAAiB6E,UAAjB,EAA8B2E,SAAS,CAACE,WAAW,GAAG,CAAf,CAAV,CAA6BtG,KAA7B,CAAmCxF,MAAM,CAACyH,SAA1C,CAA7B;AACH;AACJ,KALD,MAMK,IAAI,KAAK7L,MAAL,CAAYmE,WAAZ,KAA4B,QAA5B,IAAwC,KAAKnE,MAAL,CAAYmE,WAAZ,KAA4B,aAAxE,EAAuF;AACxF,WAAKwI,iBAAL,CAAuB,KAAvB,EAA8BvI,MAA9B;AACH;AACJ,GA/BD;;AAgCArE,EAAAA,mBAAmB,CAACuC,SAApB,CAA8B6N,gBAA9B,GAAiD,UAAU/L,MAAV,EAAkB;AAC/D,QAAIuF,QAAQ,GAAG,KAAK3J,MAAL,CAAY2E,eAAZ,EAAf;AACA,QAAIuL,WAAW,GAAG9L,MAAM,CAACgM,UAAP,CAAkBC,eAApC;AACA,QAAInB,GAAG,GAAG;AACNpN,MAAAA,OAAO,EAAE6H,QADH;AAEN2G,MAAAA,QAAQ,EAAEJ,WAFJ;AAGNK,MAAAA,WAAW,EAAEnM,MAAM,CAACyH,SAHd;AAIN2E,MAAAA,QAAQ,EAAE7G,QAAQ,CAACG,IAAT,CAAcoG,WAAd,EAA2BtG,KAA3B,CAAiCR;AAJrC,KAAV;AAMA,WAAO8F,GAAP;AACH,GAVD;;AAWAnP,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BwN,oBAA9B,GAAqD,YAAY;AAC7D,WAAO,CAAC,KAAK9P,MAAL,CAAYyQ,UAAZ,GAAyBC,QAAQ,CAACC,IAAlC,GAAyC,KAAK3Q,MAAL,CAAY8B,OAAtD,EAA+DoB,aAA/D,CAA6E,MAAMpD,GAAG,CAACmI,mBAAvF,CAAP;AACH,GAFD;;AAGAlI,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BsO,uBAA9B,GAAwD,UAAUrO,CAAV,EAAa8I,UAAb,EAAyB;AAC7E,QAAI,KAAKrL,MAAL,CAAYmE,WAAZ,KAA4B,QAA5B,IAAyCkH,UAAU,IAAI,KAAKrL,MAAL,CAAYmE,WAAZ,KAA4B,aAAvF,EAAuG;AACnG,aAAO,IAAP;AACH;;AACD,QAAK,KAAKwC,eAAL,CAAqBpE,CAArB,KAA2B8I,UAAhC,EAA6C;AACzC,aAAO,IAAP;AACH;;AACD,QAAIsE,gBAAgB,GAAG,KAAK3P,MAAL,CAAY8B,OAAZ,CAAoBoB,aAApB,CAAkC,MAAMpD,GAAG,CAAC8P,wBAA5C,CAAvB;AACA,QAAIC,iBAAiB,GAAG,KAAKC,oBAAL,EAAxB;;AACA,QAAIH,gBAAgB,CAACtL,SAAjB,CAA2BC,QAA3B,CAAoCxE,GAAG,CAACiQ,UAAxC,KAAuDF,iBAAiB,CAACxL,SAAlB,CAA4BC,QAA5B,CAAqCxE,GAAG,CAACiQ,UAAzC,CAA3D,EAAiH;AAC7G,aAAO,IAAP;AACH;;AACD,WAAO,KAAP;AACH,GAbD;;AAcAhQ,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BO,YAA9B,GAA6C,UAAUN,CAAV,EAAa8I,UAAb,EAAyB;AAClE,QAAI,KAAKuF,uBAAL,CAA6BrO,CAA7B,EAAgC8I,UAAhC,CAAJ,EAAiD;AAC7C;AACH;;AACD,QAAIpL,aAAa,GAAG,KAAKD,MAAL,CAAY+G,mBAAZ,EAApB;AACA,QAAIuE,UAAJ;AACA,QAAIuF,oBAAoB,GAAG,KAAK7Q,MAAL,CAAY4K,SAAZ,CAAsB8E,uBAAtB,EAA3B;AACA,QAAItL,MAAM,GAAI7B,CAAC,CAAC6B,MAAhB;;AACA,QAAInE,aAAa,CAACmJ,MAAd,GAAuB,CAAvB,IAA4B,CAAChF,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACyE,gBAA9B,CAA7B,IACA,CAACH,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACgF,kBAA9B,CADL,EACwD;AACpDV,MAAAA,MAAM,GAAGnE,aAAa,CAACA,aAAa,CAACmJ,MAAd,GAAuB,CAAxB,CAAtB;AACH;;AACD,QAAIyH,oBAAoB,CAACzH,MAArB,GAA8B,CAAlC,EAAqC;AACjChF,MAAAA,MAAM,GAAG,KAAKyK,iCAAL,CAAuCgC,oBAAoB,CAACA,oBAAoB,CAACzH,MAArB,GAA8B,CAA/B,CAA3D,CAAT;AACA,WAAKpJ,MAAL,CAAY4K,SAAZ,CAAsBC,8BAAtB;;AACA,UAAI,CAACzG,MAAL,EAAa;AACT;AACH;AACJ;;AACD,QAAIA,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACyE,gBAA9B,CAAJ,EAAqD;AACjD,UAAI2K,GAAG,GAAG,KAAKiB,gBAAL,CAAsB/L,MAAtB,CAAV;;AACA,UAAI8K,GAAG,CAACqB,WAAJ,IAAmB,CAAnB,IAAwBrB,GAAG,CAACqB,WAAJ,GAAkBrB,GAAG,CAACsB,QAAJ,GAAe,CAA7D,EAAgE;AAC5DlF,QAAAA,UAAU,GAAG,KAAKwF,qBAAL,CAA2B1M,MAA3B,EAAmC8K,GAAG,CAACpN,OAAJ,CAAYgI,IAAZ,CAAiBoF,GAAG,CAACoB,QAArB,EAA+B1G,KAA/B,CAAqCxF,MAAM,CAACyH,SAAP,GAAmB,CAAxD,CAAnC,EAA+F,OAA/F,CAAb;;AACA,YAAI,CAACpM,iBAAiB,CAAC6L,UAAD,CAAtB,EAAoC;AAChC,eAAK9E,WAAL,CAAiB6E,UAAjB,EAA6BC,UAA7B;AACH;AACJ,OALD,MAMK,IAAI4D,GAAG,CAACqB,WAAJ,KAAoBrB,GAAG,CAACsB,QAAJ,GAAe,CAAvC,EAA0C;AAC3C,YAAI,CAAC,KAAKpF,oBAAL,EAAD,IAAgC8D,GAAG,CAACoB,QAAJ,GAAepB,GAAG,CAACpN,OAAJ,CAAYgI,IAAZ,CAAiBV,MAAjB,GAA0B,CAA7E,EAAgF;AAC5EkC,UAAAA,UAAU,GAAG,KAAKwF,qBAAL,CAA2B1M,MAA3B,EAAmC8K,GAAG,CAACpN,OAAJ,CAAYgI,IAAZ,CAAiBoF,GAAG,CAACoB,QAAJ,GAAe,CAAhC,EAAmC1G,KAAnC,CAAyC,CAAzC,CAAnC,EAAgF,OAAhF,CAAb;;AACA,cAAI,CAACnK,iBAAiB,CAAC6L,UAAD,CAAtB,EAAoC;AAChC,iBAAK9E,WAAL,CAAiB6E,UAAjB,EAA6BC,UAA7B;AACH;AACJ,SALD,MAMK,IAAI,CAACD,UAAL,EAAiB;AAClB,cAAIiF,QAAQ,GAAG,KAAKlF,oBAAL,KAA8B8D,GAAG,CAACoB,QAAlC,GAA6C,CAA5D;AACA,eAAKtQ,MAAL,CAAY8C,UAAZ,CAAuB,KAAK9C,MAAL,CAAY+C,UAAZ,CAAuBC,mBAAvB,CAA2C,MAA3C,CAAvB,EAA2ET,CAA3E;AACA,cAAIoH,QAAQ,GAAG,KAAK3J,MAAL,CAAY2E,eAAZ,EAAf;AACA,eAAK6B,WAAL,CAAiB,KAAjB,EAAwBmD,QAAQ,CAACG,IAAT,CAAcwG,QAAd,EAAwB1G,KAAxB,CAA8B,CAA9B,CAAxB;AACH;AACJ;AACJ,KAtBD,MAuBK,IAAIxF,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACgF,kBAA9B,CAAJ,EAAuD;AACxD,UAAIiM,WAAW,GAAG3M,MAAM,CAACyH,SAAzB;AACA,UAAI9G,SAAS,GAAG,KAAK/E,MAAL,CAAYgF,YAAZ,EAAhB;AACA,UAAIgM,WAAW,GAAGjM,SAAS,CAAC6E,KAAV,CAAgBR,MAAlC;;AACA,UAAI2H,WAAW,IAAI,CAAf,IAAoBA,WAAW,GAAGC,WAAW,GAAG,CAApD,EAAuD;AACnD,aAAKxK,WAAL,CAAiB6E,UAAjB,EAA6BtG,SAAS,CAAC6E,KAAV,CAAgBmH,WAAW,GAAG,CAA9B,CAA7B;AACH,OAFD,MAGK,IAAIA,WAAW,KAAKC,WAAW,GAAG,CAA9B,IAAmC,CAAC3F,UAAxC,EAAoD;AACrD,aAAKrL,MAAL,CAAY8C,UAAZ,CAAuB,KAAK9C,MAAL,CAAY+C,UAAZ,CAAuBC,mBAAvB,CAA2C,MAA3C,CAAvB,EAA2ET,CAA3E;AACA,YAAI0O,WAAW,GAAG,KAAKjR,MAAL,CAAYgF,YAAZ,EAAlB;AACA,aAAKwB,WAAL,CAAiB,KAAjB,EAAwByK,WAAW,CAACrH,KAAZ,CAAkB,CAAlB,CAAxB;AACH;AACJ;AACJ,GAvDD;;AAwDA7J,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BM,WAA9B,GAA4C,UAAUL,CAAV,EAAa8I,UAAb,EAAyB;AACjE,QAAI,KAAKuF,uBAAL,CAA6BrO,CAA7B,EAAgC8I,UAAhC,CAAJ,EAAiD;AAC7C;AACH;;AACD,QAAIjH,MAAM,GAAI7B,CAAC,CAAC6B,MAAhB;AACA,QAAInE,aAAa,GAAG,KAAKD,MAAL,CAAY+G,mBAAZ,EAApB;AACA,QAAIuE,UAAJ;;AACA,QAAIrL,aAAa,CAACmJ,MAAd,GAAuB,CAAvB,IAA4B,CAAChF,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACyE,gBAA9B,CAA7B,IACA,CAACH,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACgF,kBAA9B,CADL,EACwD;AACpDV,MAAAA,MAAM,GAAGnE,aAAa,CAACA,aAAa,CAACmJ,MAAd,GAAuB,CAAxB,CAAtB;AACH;;AACD,QAAIoG,gBAAgB,GAAG,KAAKxP,MAAL,CAAY4K,SAAZ,CAAsB8E,uBAAtB,EAAvB;;AACA,QAAIF,gBAAgB,CAACpG,MAAjB,GAA0B,CAA9B,EAAiC;AAC7BhF,MAAAA,MAAM,GAAG,KAAKyK,iCAAL,CAAuCW,gBAAgB,CAACA,gBAAgB,CAACpG,MAAjB,GAA0B,CAA3B,CAAvD,CAAT;AACA,WAAKpJ,MAAL,CAAY4K,SAAZ,CAAsBC,8BAAtB;;AACA,UAAI,CAACzG,MAAL,EAAa;AACT;AACH;AACJ;;AACD,QAAIA,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACyE,gBAA9B,CAAJ,EAAqD;AACjD,UAAI2K,GAAG,GAAG,KAAKiB,gBAAL,CAAsB/L,MAAtB,CAAV;;AACA,UAAI8K,GAAG,CAACqB,WAAJ,GAAkB,CAAlB,IAAuBrB,GAAG,CAACqB,WAAJ,GAAkBrB,GAAG,CAACsB,QAAjD,EAA2D;AACvDlF,QAAAA,UAAU,GAAG,KAAKwF,qBAAL,CAA2B1M,MAA3B,EAAmC8K,GAAG,CAACpN,OAAJ,CAAYgI,IAAZ,CAAiBoF,GAAG,CAACoB,QAArB,EAA+B1G,KAA/B,CAAqCxF,MAAM,CAACyH,SAAP,GAAmB,CAAxD,CAAnC,EAA+F,MAA/F,CAAb;;AACA,YAAI,CAACpM,iBAAiB,CAAC6L,UAAD,CAAtB,EAAoC;AAChC,eAAK9E,WAAL,CAAiB6E,UAAjB,EAA6BC,UAA7B;AACH;AACJ,OALD,MAMK,IAAI4D,GAAG,CAACqB,WAAJ,KAAoB,CAAxB,EAA2B;AAC5B,YAAI,CAAC,KAAKnF,oBAAL,EAAD,IAAgC8D,GAAG,CAACoB,QAAJ,GAAe,CAAnD,EAAsD;AAClDhF,UAAAA,UAAU,GAAG,KAAKwF,qBAAL,CAA2B1M,MAA3B,EAAmC8K,GAAG,CAACpN,OAAJ,CAAYgI,IAAZ,CAAiBoF,GAAG,CAACoB,QAAJ,GAAe,CAAhC,EAAmC1G,KAAnC,CAAyCsF,GAAG,CAACsB,QAAJ,GAAe,CAAxD,CAAnC,EAA+F,MAA/F,CAAb;;AACA,cAAI,CAAC/Q,iBAAiB,CAAC6L,UAAD,CAAtB,EAAoC;AAChC,iBAAK9E,WAAL,CAAiB6E,UAAjB,EAA6BC,UAA7B;AACH;AACJ,SALD,MAMK,IAAI,CAACD,UAAL,EAAiB;AAClB,eAAKrL,MAAL,CAAY8C,UAAZ,CAAuB,KAAK9C,MAAL,CAAY+C,UAAZ,CAAuBC,mBAAvB,CAA2C,UAA3C,CAAvB,EAA+ET,CAA/E;AACA,cAAIoH,QAAQ,GAAG,KAAK3J,MAAL,CAAY2E,eAAZ,EAAf;AACA,cAAI2L,QAAQ,GAAG,KAAKlF,oBAAL,KAA8B8D,GAAG,CAACoB,QAAlC,GAA6C3G,QAAQ,CAACG,IAAT,CAAcV,MAAd,GAAuB,CAAnF;AACA,eAAK5C,WAAL,CAAiB,KAAjB,EAAwBmD,QAAQ,CAACG,IAAT,CAAcwG,QAAd,EAAwB1G,KAAxB,CAA8BsF,GAAG,CAACsB,QAAJ,GAAe,CAA7C,CAAxB;AACH;AACJ;AACJ,KAtBD,MAuBK,IAAIpM,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACgF,kBAA9B,CAAJ,EAAuD;AACxD,UAAIiM,WAAW,GAAG3M,MAAM,CAACyH,SAAzB;AACA,UAAI9G,SAAS,GAAG,KAAK/E,MAAL,CAAYgF,YAAZ,EAAhB;AACA,UAAIgM,WAAW,GAAGjM,SAAS,CAAC6E,KAAV,CAAgBR,MAAlC;;AACA,UAAI2H,WAAW,GAAG,CAAd,IAAmBA,WAAW,GAAGC,WAArC,EAAkD;AAC9C,aAAKxK,WAAL,CAAiB6E,UAAjB,EAA6BtG,SAAS,CAAC6E,KAAV,CAAgBmH,WAAW,GAAG,CAA9B,CAA7B;AACH,OAFD,MAGK,IAAIA,WAAW,KAAK,CAAhB,IAAqB,CAAC1F,UAA1B,EAAsC;AACvC,aAAKrL,MAAL,CAAY8C,UAAZ,CAAuB,KAAK9C,MAAL,CAAY+C,UAAZ,CAAuBC,mBAAvB,CAA2C,UAA3C,CAAvB,EAA+ET,CAA/E;AACA,YAAI2O,WAAW,GAAG,KAAKlR,MAAL,CAAYgF,YAAZ,EAAlB;AACA,aAAKwB,WAAL,CAAiB,KAAjB,EAAwB0K,WAAW,CAACtH,KAAZ,CAAkBoH,WAAW,GAAG,CAAhC,CAAxB;AACH;AACJ;AACJ,GAvDD;;AAwDAjR,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BwO,qBAA9B,GAAsD,UAAUK,WAAV,EAAuB/M,MAAvB,EAA+BgN,IAA/B,EAAqC;AACvF,QAAIC,SAAS,GAAG,KAAKtN,aAAL,CAAmBiI,YAAnB,CAAgC,kBAAhC,CAAhB;;AACA,QAAI,KAAKhM,MAAL,CAAYiE,iBAAZ,CAA8B6H,KAA9B,CAAoCC,SAApC,CAA8C3C,MAA9C,GAAuD,CAAvD,IAA4D,KAAKpJ,MAAL,CAAYmE,WAAZ,KAA4B,OAA5F,EAAqG;AACjG,UAAIgN,WAAW,IAAI/M,MAAf,IAAyBA,MAAM,CAAC4H,YAAP,CAAoB,kBAApB,MAA4CqF,SAAzE,EAAoF;AAChF,YAAIC,WAAW,GAAG,KAAKtR,MAAL,CAAYgJ,kBAAZ,CAA+BmI,WAA/B,CAAlB;AACA,YAAII,YAAY,GAAIH,IAAI,KAAK,OAAV,GAAqB,IAAII,IAAJ,CAASF,WAAW,CAACG,OAAZ,CAAoBH,WAAW,CAACI,OAAZ,KAAwB,CAA5C,CAAT,CAArB,GACb,IAAIF,IAAJ,CAASF,WAAW,CAACG,OAAZ,CAAoBH,WAAW,CAACI,OAAZ,KAAwB,CAA5C,CAAT,CADN;AAEAtN,QAAAA,MAAM,GAAG,GAAGc,KAAH,CAASC,IAAT,CAAc,KAAKnF,MAAL,CAAY8B,OAAZ,CAAoBsD,gBAApB,CAAqC,mBACtD,KAAKpF,MAAL,CAAY2R,aAAZ,CAA0BJ,YAA1B,EAAwCK,QAAxC,EADsD,GACD,IADC,GACM,qBADN,GAC8BP,SAD9B,GAC0C,IAD/E,CAAd,EACoG,CADpG,CAAT;AAEH;AACJ;;AACD,WAAOjN,MAAP;AACH,GAZD;;AAaArE,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BuP,oBAA9B,GAAqD,UAAUC,SAAV,EAAqB;AACtE,QAAIC,WAAW,GAAG,6EACd,4FADc,GAEd,yHAFJ;AAGA,WAAO,GAAG7M,KAAH,CAASC,IAAT,CAAc2M,SAAS,CAAC1M,gBAAV,CAA2B2M,WAA3B,CAAd,CAAP;AACH,GALD;;AAMAhS,EAAAA,mBAAmB,CAACuC,SAApB,CAA8B0P,iBAA9B,GAAkD,UAAUzP,CAAV,EAAa0P,YAAb,EAA2B;AACzE,QAAIxL,KAAK,GAAG,IAAZ;;AACA,QAAIyL,iBAAiB,GAAG,KAAKL,oBAAL,CAA0BI,YAA1B,CAAxB;AACAC,IAAAA,iBAAiB,GAAGA,iBAAiB,CAACxE,MAAlB,CAAyB,UAAU5L,OAAV,EAAmB;AAC5D,UAAIqQ,SAAS,GAAG1L,KAAK,CAACzG,MAAN,CAAa8B,OAAb,CAAqBoB,aAArB,CAAmC,MAAMpD,GAAG,CAACsS,kBAA7C,CAAhB;;AACA,UAAID,SAAS,IAAIA,SAAS,CAACE,YAA3B,EAAyC;AACrC,eAAO,EAAEvQ,OAAO,CAACuC,SAAR,CAAkBC,QAAlB,CAA2BxE,GAAG,CAACwS,UAA/B,KAA8CxQ,OAAO,CAACuC,SAAR,CAAkBC,QAAlB,CAA2BxE,GAAG,CAACyS,YAA/B,CAAhD,CAAP;AACH,OAFD,MAGK;AACD,eAAO,EAAEzQ,OAAO,CAACuC,SAAR,CAAkBC,QAAlB,CAA2BxE,GAAG,CAACsI,gBAA/B,KAAoDtG,OAAO,CAACuC,SAAR,CAAkBC,QAAlB,CAA2BxE,GAAG,CAACuI,kBAA/B,CAAtD,CAAP;AACH;AACJ,KARmB,CAApB;AASA,QAAImK,QAAQ,GAAGN,iBAAiB,CAAC,CAAD,CAAhC;AACA,QAAIO,OAAO,GAAGP,iBAAiB,CAACA,iBAAiB,CAAC9I,MAAlB,GAA2B,CAA5B,CAA/B;;AACA,QAAI,CAAC3J,iBAAiB,CAACgT,OAAD,CAAlB,IAA+B/B,QAAQ,CAACgC,aAAT,KAA2BD,OAA1D,IAAqE,CAAClQ,CAAC,CAACG,QAA5E,EAAsF;AAClFH,MAAAA,CAAC,CAACiG,cAAF;AACAgK,MAAAA,QAAQ,CAACrP,KAAT;AACH;;AACD,QAAI,CAAC1D,iBAAiB,CAAC+S,QAAD,CAAlB,IAAgC9B,QAAQ,CAACgC,aAAT,KAA2BF,QAA3D,IAAuEjQ,CAAC,CAACG,QAA7E,EAAuF;AACnFH,MAAAA,CAAC,CAACiG,cAAF;AACAiK,MAAAA,OAAO,CAACtP,KAAR;AACH;AACJ,GAtBD;;AAuBApD,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BiB,UAA9B,GAA2C,UAAUhB,CAAV,EAAaqK,SAAb,EAAwB;AAC/D,QAAIxI,MAAM,GAAG7B,CAAC,CAAC6B,MAAf;AACA,QAAIuO,YAAY,GAAGrT,OAAO,CAAC8E,MAAD,EAAS,MAAMtE,GAAG,CAACmI,mBAAV,GAAgC,IAAhC,GAAuCnI,GAAG,CAAC8P,wBAApD,CAA1B;;AACA,QAAI+C,YAAY,IAAIA,YAAY,CAACtO,SAAb,CAAuBC,QAAvB,CAAgCxE,GAAG,CAACiQ,UAApC,CAApB,EAAqE;AACjE,UAAI4C,YAAY,CAACtO,SAAb,CAAuBC,QAAvB,CAAgCxE,GAAG,CAAC8P,wBAApC,CAAJ,EAAmE;AAC/D,aAAK5P,MAAL,CAAY4K,SAAZ,CAAsBC,8BAAtB;AACH;;AACD,WAAKmH,iBAAL,CAAuBzP,CAAvB,EAA0BoQ,YAA1B;AACA;AACH;;AACD,QAAIvO,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAAC8S,IAA9B,CAAJ,EAAyC;AACrC,WAAK5S,MAAL,CAAY4K,SAAZ,CAAsBC,8BAAtB;AACA;AACH;;AACD,QAAIzG,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACuF,iBAA9B,CAAJ,EAAsD;AAClD,UAAIJ,YAAY,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAc,KAAKnF,MAAL,CAAY8B,OAAZ,CAAoBsD,gBAApB,CAAqC,MAAMtF,GAAG,CAACuF,iBAA/C,CAAd,CAAnB;AACA,UAAIwL,oBAAoB,GAAG,KAAK7Q,MAAL,CAAY4K,SAAZ,CAAsB8E,uBAAtB,EAA3B;;AACA,UAAImB,oBAAoB,CAACzH,MAArB,GAA8B,CAAlC,EAAqC;AACjChF,QAAAA,MAAM,GAAGyM,oBAAoB,CAACA,oBAAoB,CAACzH,MAArB,GAA8B,CAA/B,CAA7B;AACH;;AACD,WAAKpJ,MAAL,CAAY4K,SAAZ,CAAsBC,8BAAtB;;AACA,UAAI,CAAC+B,SAAD,IAAcxI,MAAM,CAAC4H,YAAP,CAAoB,WAApB,MAAqC/G,YAAY,CAACA,YAAY,CAACmE,MAAb,GAAsB,CAAvB,CAAZ,CAAsC4C,YAAtC,CAAmD,WAAnD,CAAnD,IACAY,SAAS,IAAIxI,MAAM,CAAC4H,YAAP,CAAoB,WAApB,MAAqC/G,YAAY,CAAC,CAAD,CAAZ,CAAgB+G,YAAhB,CAA6B,WAA7B,CADtD,EACiG;AAC7F;AACH;;AACD,UAAI,KAAKhM,MAAL,CAAYmE,WAAZ,KAA4B,QAA5B,IAAwC,KAAKnE,MAAL,CAAYmE,WAAZ,KAA4B,aAAxE,EAAuF;AACnF,aAAKwI,iBAAL,CAAuBC,SAAvB,EAAkCxI,MAAlC;AACA7B,QAAAA,CAAC,CAACiG,cAAF;AACH;;AACD;AACH;;AACD,QAAIvI,aAAa,GAAG,KAAKD,MAAL,CAAY+G,mBAAZ,EAApB;;AACA,QAAI9G,aAAa,CAACmJ,MAAd,GAAuB,CAAvB,IAA4B,CAAChF,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BxE,GAAG,CAACuF,iBAA9B,CAAjC,EAAmF;AAC/EjB,MAAAA,MAAM,GAAGnE,aAAa,CAACA,aAAa,CAACmJ,MAAd,GAAuB,CAAxB,CAAtB;AACA,WAAK8D,oCAAL,CAA0CN,SAA1C,EAAqDxI,MAArD;AACA7B,MAAAA,CAAC,CAACiG,cAAF;AACA;AACH;AACJ,GAtCD;;AAuCAzI,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BkB,aAA9B,GAA8C,UAAUjB,CAAV,EAAa;AACvD,QAAImO,QAAQ,CAACgC,aAAT,IAA0BhC,QAAQ,CAACgC,aAAT,CAAuBrO,SAAvB,CAAiCC,QAAjC,CAA0CxE,GAAG,CAACuF,iBAA9C,CAA9B,EAAgG;AAC5F3F,MAAAA,QAAQ,CAAC,CAACgR,QAAQ,CAACgC,aAAV,CAAD,EAA2B5S,GAAG,CAAC+S,kBAA/B,CAAR;AACA,WAAK7S,MAAL,CAAY8S,eAAZ,GAA8B,KAAK9S,MAAL,CAAY4K,SAAZ,CAAsBmI,iBAAtB,EAA9B;;AACA,UAAI,KAAK/S,MAAL,CAAYiE,iBAAZ,CAA8BC,QAA9B,IAA0CwM,QAAQ,CAACgC,aAAT,CAAuBrO,SAAvB,CAAiCC,QAAjC,CAA0C,aAA1C,CAA9C,EAAwG;AACpG;AACH;;AACD,WAAKtE,MAAL,CAAYgT,UAAZ,CAAuBC,WAAvB;AACH;AACJ,GATD;;AAUAlT,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BmB,aAA9B,GAA8C,YAAY;AACtD,SAAKzD,MAAL,CAAYgT,UAAZ,CAAuBE,YAAvB;AACA,SAAKlT,MAAL,CAAYgT,UAAZ,CAAuBG,SAAvB,CAAiCC,IAAjC;;AACA,QAAI,KAAKpT,MAAL,CAAYiD,YAAhB,EAA8B;AAC1B,WAAKjD,MAAL,CAAYiD,YAAZ,CAAyBoQ,eAAzB;AACH;AACJ,GAND;;AAOAtT,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BqE,eAA9B,GAAgD,UAAUpE,CAAV,EAAa;AACzD,QAAI6B,MAAM,GAAG9E,OAAO,CAACiD,CAAC,CAAC6B,MAAH,EAAW,MAAMtE,GAAG,CAACoL,0BAArB,CAApB;;AACA,QAAI,KAAKlL,MAAL,CAAY+C,UAAZ,CAAuB+H,cAAvB,MAA2C,CAACrL,iBAAiB,CAAC2E,MAAD,CAAjE,EAA2E;AACvE,aAAO,IAAP;AACH;;AACD,WAAO,KAAP;AACH,GAND;AAOA;;;;;AAGArE,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BgR,aAA9B,GAA8C,YAAY;AACtD,WAAO,UAAP;AACH,GAFD;AAGA;;;;;;;AAKAvT,EAAAA,mBAAmB,CAACuC,SAApB,CAA8BiR,OAA9B,GAAwC,YAAY;AAChD,SAAK1P,mBAAL;AACA,SAAK7B,cAAL,CAAoBuR,OAApB;AACH,GAHD;;AAIA,SAAOxT,mBAAP;AACH,CAvvBwC,EAAzC;;AAwvBA,SAASA,mBAAT","sourcesContent":["import { KeyboardEvents, closest, EventHandler, extend } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, addClass, removeClass } from '@syncfusion/ej2-base';\nimport * as event from '../base/constant';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\n/**\n * Keyboard interaction\n */\nvar KeyboardInteraction = /** @class */ (function () {\n    function KeyboardInteraction(parent) {\n        this.selectedCells = [];\n        this.keyConfigs = {\n            downArrow: 'downarrow',\n            upArrow: 'uparrow',\n            rightArrow: 'rightarrow',\n            leftArrow: 'leftarrow',\n            shiftDownArrow: 'shift+downarrow',\n            shiftUpArrow: 'shift+uparrow',\n            shiftRightArrow: 'shift+rightarrow',\n            shiftLeftArrow: 'shift+leftarrow',\n            ctrlLeftArrow: 'ctrl+leftarrow',\n            ctrlRightArrow: 'ctrl+rightarrow',\n            altOne: 'alt+1',\n            altTwo: 'alt+2',\n            altThree: 'alt+3',\n            altFour: 'alt+4',\n            altFive: 'alt+5',\n            altSix: 'alt+6',\n            altSeven: 'alt+7',\n            altEight: 'alt+8',\n            altNine: 'alt+9',\n            enter: 'enter',\n            escape: 'escape',\n            delete: 'delete',\n            home: 'home',\n            pageUp: 'pageup',\n            pageDown: 'pagedown',\n            tab: 'tab',\n            shiftTab: 'shift+tab'\n        };\n        this.parent = parent;\n        this.parent.element.tabIndex = this.parent.element.tabIndex === -1 ? 0 : this.parent.element.tabIndex;\n        this.keyboardModule = new KeyboardEvents(this.parent.element, {\n            keyAction: this.keyActionHandler.bind(this),\n            keyConfigs: this.keyConfigs,\n            eventName: 'keydown'\n        });\n        this.addEventListener();\n    }\n    KeyboardInteraction.prototype.keyActionHandler = function (e) {\n        switch (e.action) {\n            case 'downArrow':\n            case 'shiftDownArrow':\n                this.processDown(e, e.shiftKey);\n                break;\n            case 'upArrow':\n            case 'shiftUpArrow':\n                this.processUp(e, e.shiftKey);\n                break;\n            case 'leftArrow':\n            case 'shiftLeftArrow':\n                this.processLeft(e, e.shiftKey);\n                break;\n            case 'rightArrow':\n            case 'shiftRightArrow':\n                this.processRight(e, e.shiftKey);\n                break;\n            case 'ctrlLeftArrow':\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n                if (this.parent.headerModule) {\n                    this.parent.headerModule.element.querySelector('.e-prev button').focus();\n                }\n                break;\n            case 'ctrlRightArrow':\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n                if (this.parent.headerModule) {\n                    this.parent.headerModule.element.querySelector('.e-next button').focus();\n                }\n                break;\n            case 'altOne':\n            case 'altTwo':\n            case 'altThree':\n            case 'altFour':\n            case 'altFive':\n            case 'altSix':\n            case 'altSeven':\n            case 'altEight':\n            case 'altNine':\n                this.processViewNavigation(e);\n                break;\n            case 'enter':\n                this.processEnter(e);\n                break;\n            case 'home':\n                this.focusFirstCell();\n                break;\n            case 'tab':\n            case 'shiftTab':\n                this.processTab(e, e.shiftKey);\n                break;\n            case 'delete':\n                this.processDelete(e);\n                break;\n            case 'escape':\n                this.processEscape();\n        }\n    };\n    KeyboardInteraction.prototype.addEventListener = function () {\n        this.parent.on(event.cellMouseDown, this.onCellMouseDown, this);\n    };\n    KeyboardInteraction.prototype.removeEventListener = function () {\n        this.parent.off(event.cellMouseDown, this.onCellMouseDown);\n    };\n    KeyboardInteraction.prototype.onCellMouseDown = function (e) {\n        if (e.event.shiftKey) {\n            return;\n        }\n        this.initialTarget = this.getClosestCell(e.event);\n        if (this.parent.activeViewOptions.readonly || this.parent.currentView === 'MonthAgenda' || !this.initialTarget) {\n            return;\n        }\n        if (e.event.target.classList.contains(cls.WORK_CELLS_CLASS) && e.event.which !== 3) {\n            this.parent.removeSelectedClass();\n            EventHandler.add(this.parent.getContentTable(), 'mousemove', this.onMouseSelection, this);\n            EventHandler.add(this.parent.getContentTable(), 'mouseup', this.onMoveup, this);\n        }\n        if (e.event.target.classList.contains(cls.ALLDAY_CELLS_CLASS) && e.event.which !== 3) {\n            this.parent.removeSelectedClass();\n            var allDayRow = this.parent.getAllDayRow();\n            EventHandler.add(allDayRow, 'mousemove', this.onMouseSelection, this);\n            EventHandler.add(allDayRow, 'mouseup', this.onMoveup, this);\n        }\n    };\n    KeyboardInteraction.prototype.onMouseSelection = function (e) {\n        var appointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n        addClass(appointments, 'e-allow-select');\n        var selectionEdges = this.parent.boundaryValidation(e.pageY, e.pageX);\n        if (selectionEdges.bottom || selectionEdges.top || selectionEdges.left || selectionEdges.right) {\n            var parent_1 = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            var yInBounds = parent_1.offsetHeight <= parent_1.scrollHeight && parent_1.scrollTop >= 0 &&\n                parent_1.scrollTop + parent_1.offsetHeight <= parent_1.scrollHeight;\n            var xInBounds = parent_1.offsetWidth <= parent_1.scrollWidth && parent_1.scrollLeft >= 0 &&\n                parent_1.scrollLeft + parent_1.offsetWidth <= parent_1.scrollWidth;\n            if (yInBounds && (selectionEdges.top || selectionEdges.bottom)) {\n                parent_1.scrollTop += selectionEdges.top ?\n                    -e.target.offsetHeight : e.target.offsetHeight;\n            }\n            if (xInBounds && (selectionEdges.left || selectionEdges.right)) {\n                parent_1.scrollLeft += selectionEdges.left ?\n                    -e.target.offsetWidth : e.target.offsetWidth;\n            }\n        }\n        var target = this.getClosestCell(e);\n        if (target) {\n            this.selectCells(true, target);\n        }\n    };\n    KeyboardInteraction.prototype.getClosestCell = function (e) {\n        return closest(e.target, '.' + cls.WORK_CELLS_CLASS + ',.' + cls.ALLDAY_CELLS_CLASS);\n    };\n    KeyboardInteraction.prototype.onMoveup = function (e) {\n        var _this = this;\n        var appointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n        removeClass(appointments, 'e-allow-select');\n        if (e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n            EventHandler.remove(this.parent.getContentTable(), 'mousemove', this.onMouseSelection);\n            EventHandler.remove(this.parent.getContentTable(), 'mouseup', this.onMoveup);\n        }\n        if (e.target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            var allDayRow = this.parent.getAllDayRow();\n            EventHandler.remove(allDayRow, 'mousemove', this.onMouseSelection);\n            EventHandler.remove(allDayRow, 'mouseup', this.onMoveup);\n        }\n        if (this.isPreventAction(e)) {\n            return;\n        }\n        var queryStr = '.' + cls.WORK_CELLS_CLASS + ',.' + cls.ALLDAY_CELLS_CLASS + ',.' + cls.HEADER_CELLS_CLASS;\n        var target = closest(e.target, queryStr);\n        this.parent.activeCellsData = this.getSelectedElements(target);\n        var cellData = {};\n        this.parent.eventWindow.convertToEventData(this.parent.activeCellsData, cellData);\n        var args = {\n            data: cellData, element: this.parent.activeCellsData.element, event: e,\n            requestType: 'cellSelect', showQuickPopup: false\n        };\n        this.parent.trigger(event.select, args, function (selectArgs) {\n            var isPopupShow = selectArgs.showQuickPopup || _this.parent.quickInfoOnSelectionEnd;\n            if (isPopupShow) {\n                var cellArgs = extend(_this.parent.activeCellsData, { cancel: false, event: e, name: 'cellClick' });\n                _this.parent.notify(event.cellClick, cellArgs);\n            }\n        });\n    };\n    KeyboardInteraction.prototype.processEnter = function (e) {\n        if (this.parent.activeViewOptions.readonly || this.isPreventAction(e)) {\n            return;\n        }\n        var target = (e.target);\n        if (closest(target, '.' + cls.POPUP_WRAPPER_CLASS)) {\n            if (target.classList.contains(cls.QUICK_POPUP_EVENT_DETAILS_CLASS) ||\n                target.classList.contains(cls.EVENT_CREATE_CLASS) ||\n                target.classList.contains(cls.EDIT_EVENT_CLASS) ||\n                target.classList.contains(cls.DELETE_EVENT_CLASS) ||\n                target.classList.contains(cls.CLOSE_CLASS)) {\n                target.click();\n                e.preventDefault();\n            }\n            else if (target.classList.contains(cls.SUBJECT_CLASS)) {\n                this.parent.element.querySelector('.' + cls.EVENT_CREATE_CLASS).click();\n                e.preventDefault();\n            }\n            return;\n        }\n        if (target.classList.contains(cls.WORK_CELLS_CLASS) || target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            this.parent.activeCellsData = this.getSelectedElements(target);\n            var args = extend(this.parent.activeCellsData, { cancel: false, event: e });\n            this.parent.notify(event.cellClick, args);\n            return;\n        }\n        if (target.classList.contains(cls.APPOINTMENT_CLASS) || target.classList.contains(cls.MORE_EVENT_CLOSE_CLASS) ||\n            target.classList.contains(cls.ALLDAY_APPOINTMENT_SECTION_CLASS) || target.classList.contains(cls.MORE_INDICATOR_CLASS)) {\n            target.click();\n            return;\n        }\n        if (target.classList.contains(cls.MORE_EVENT_HEADER_DATE_CLASS)) {\n            this.parent.setScheduleProperties({ selectedDate: this.parent.getDateFromElement(target) });\n            this.parent.changeView(this.parent.getNavigateView(), e);\n            this.processEscape();\n            return;\n        }\n    };\n    KeyboardInteraction.prototype.getSelectedElements = function (target) {\n        var cellDetails;\n        if (this.selectedCells.length > 1) {\n            var start = this.parent.getCellDetails(this.selectedCells[0]);\n            var end = this.parent.getCellDetails(this.selectedCells.slice(-1)[0]);\n            start.endTime = end.endTime;\n            start.element = target;\n            cellDetails = start;\n        }\n        else {\n            cellDetails = this.parent.getCellDetails(target);\n        }\n        return cellDetails;\n    };\n    KeyboardInteraction.prototype.getCells = function (isInverseTable, start, end) {\n        var tableEle = this.parent.getContentTable();\n        var cells = [].slice.call(tableEle.querySelectorAll('td'));\n        var maxRow = tableEle.rows.length;\n        var maxColumn = tableEle.rows[0].cells.length;\n        if (start.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            var allDayRow = this.parent.getAllDayRow();\n            cells = [].slice.call(allDayRow.cells);\n            maxRow = 1;\n            maxColumn = allDayRow.cells.length;\n        }\n        var startIndex = cells.indexOf(start);\n        var endIndex = cells.indexOf(end);\n        var inverseCells = [];\n        if (isInverseTable) {\n            for (var i = 0; i < maxColumn; i++) {\n                for (var j = 0; j < maxRow; j++) {\n                    inverseCells.push(cells[maxColumn * j + i]);\n                }\n            }\n            startIndex = inverseCells.indexOf(start);\n            endIndex = inverseCells.indexOf(end);\n        }\n        if (startIndex > endIndex) {\n            var temp = startIndex;\n            startIndex = endIndex;\n            endIndex = temp;\n        }\n        var sCells = isInverseTable ? inverseCells : cells;\n        return sCells.slice(startIndex, endIndex + 1);\n    };\n    KeyboardInteraction.prototype.focusFirstCell = function () {\n        if (this.parent.currentView === 'Agenda') {\n            var focusCell = this.parent.getContentTable().querySelector('.' + cls.AGENDA_CELLS_CLASS);\n            focusCell.setAttribute('tabindex', '0');\n            focusCell.focus();\n            return;\n        }\n        this.parent.eventBase.removeSelectedAppointmentClass();\n        if (this.parent.activeView.isTimelineView()) {\n            var cell = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS +\n                ' tr:not(.' + cls.HIDDEN_CLASS + ') .' + cls.WORK_CELLS_CLASS + ':not(.' + cls.RESOURCE_GROUP_CELLS_CLASS + ')');\n            this.selectCells(false, cell);\n        }\n        else {\n            this.selectCells(false, this.parent.getWorkCellElements()[0]);\n        }\n    };\n    KeyboardInteraction.prototype.isInverseTableSelect = function () {\n        return this.parent.activeView.isInverseTableSelect;\n    };\n    /** @hidden */\n    KeyboardInteraction.prototype.selectCells = function (isMultiple, targetCell) {\n        var _this = this;\n        this.parent.removeSelectedClass();\n        var target = (targetCell instanceof Array) ? targetCell.slice(-1)[0] : targetCell;\n        if (isMultiple) {\n            var initialId_1;\n            var args = { element: targetCell, requestType: 'mousemove', allowMultipleRow: true };\n            this.parent.trigger(event.select, args, function (selectArgs) {\n                var allowMultipleRow = (!selectArgs.allowMultipleRow) || (!_this.parent.allowMultiRowSelection);\n                if (allowMultipleRow && (['Day', 'Week', 'WorkWeek'].indexOf(_this.parent.currentView) > -1)) {\n                    target = target.parentElement.children[_this.initialTarget.cellIndex];\n                }\n                var selectedCells = _this.getCells(_this.isInverseTableSelect(), _this.initialTarget, target);\n                if (_this.parent.activeViewOptions.group.resources.length > 0) {\n                    initialId_1 = _this.initialTarget.getAttribute('data-group-index');\n                    var resourceSelectedCells = [];\n                    for (var _i = 0, selectedCells_1 = selectedCells; _i < selectedCells_1.length; _i++) {\n                        var cell = selectedCells_1[_i];\n                        if (cell.getAttribute('data-group-index') === initialId_1) {\n                            resourceSelectedCells.push(cell);\n                        }\n                    }\n                    selectedCells = resourceSelectedCells;\n                }\n                _this.selectedCells = selectedCells;\n                if (selectedCells.length > 2 && !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n                    var allDayCells = _this.getAllDayCells(selectedCells);\n                    if (_this.parent.activeViewOptions.group.resources.length > 0) {\n                        var resourceAllDayCells = [];\n                        for (var _a = 0, allDayCells_1 = allDayCells; _a < allDayCells_1.length; _a++) {\n                            var cell = allDayCells_1[_a];\n                            if (cell.getAttribute('data-group-index') === initialId_1) {\n                                resourceAllDayCells.push(cell);\n                            }\n                        }\n                        allDayCells = resourceAllDayCells;\n                    }\n                    selectedCells = selectedCells.concat(allDayCells);\n                }\n                if ((target.getAttribute('data-group-index') !== initialId_1) && _this.parent.activeViewOptions.group.resources.length > 0) {\n                    target = _this.selectedCells[_this.selectedCells.length - 1];\n                }\n                _this.parent.addSelectedClass(selectedCells, target);\n            });\n        }\n        else {\n            this.initialTarget = target;\n            this.selectedCells = [target];\n            this.parent.addSelectedClass([target], target);\n        }\n    };\n    KeyboardInteraction.prototype.selectAppointment = function (isReverse, target) {\n        var appointments = this.getAppointmentElements();\n        if (appointments.length < 0) {\n            return;\n        }\n        this.parent.eventBase.removeSelectedAppointmentClass();\n        var nextAppEle;\n        if (target.classList.contains(cls.APPOINTMENT_CLASS)) {\n            var targetIndex = appointments.indexOf(target);\n            nextAppEle = appointments[(isReverse ? targetIndex - 1 : targetIndex + 1)];\n        }\n        else {\n            nextAppEle = isReverse ? appointments[appointments.length - 1] : appointments[0];\n        }\n        if (nextAppEle) {\n            this.parent.eventBase.addSelectedAppointments([nextAppEle]);\n            nextAppEle.focus();\n            addClass([nextAppEle], cls.AGENDA_SELECTED_CELL);\n        }\n    };\n    KeyboardInteraction.prototype.selectAppointmentElementFromWorkCell = function (isReverse, target) {\n        var _this = this;\n        this.parent.eventBase.removeSelectedAppointmentClass();\n        this.parent.removeSelectedClass();\n        if (target.classList.contains(cls.WORK_CELLS_CLASS) || target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            var appointmentElements_1 = this.getUniqueAppointmentElements();\n            var filteredElements_1 = [];\n            var selectedDate_1 = this.parent.getDateFromElement(target).getTime();\n            var selectedSeriesEvents = this.parent.eventsProcessed.filter(function (eventObject) {\n                return (!isReverse ? (eventObject[_this.parent.eventFields.startTime].getTime() >= selectedDate_1) :\n                    (eventObject[_this.parent.eventFields.startTime].getTime() <= selectedDate_1));\n            });\n            selectedSeriesEvents.filter(function (event) {\n                appointmentElements_1.filter(function (element) {\n                    if (JSON.stringify(event.Guid) === JSON.stringify(element.getAttribute('data-guid'))) {\n                        filteredElements_1.push(element);\n                    }\n                });\n            });\n            if (filteredElements_1.length > 0) {\n                var selectedElement = isReverse ? filteredElements_1[filteredElements_1.length - 1] : filteredElements_1[0];\n                var focusElements = this.getAppointmentElementsByGuid(selectedElement.getAttribute('data-guid'));\n                this.parent.eventBase.addSelectedAppointments(focusElements);\n                (focusElements[focusElements.length - 1]).focus();\n            }\n        }\n    };\n    KeyboardInteraction.prototype.getAllDayCells = function (cells) {\n        var allDayRow = this.parent.getAllDayRow();\n        if (!allDayRow) {\n            return [];\n        }\n        var startCell = cells[0];\n        var endCell = cells[cells.length - 1];\n        var start = this.parent.getCellDetails(startCell);\n        var end = this.parent.getCellDetails(endCell);\n        if (end.endTime.getTime() - start.startTime.getTime() >= util.MS_PER_DAY) {\n            var allDayCells = [].slice.call(allDayRow.cells);\n            return allDayCells.slice(startCell.cellIndex, endCell.cellIndex + 1);\n        }\n        return [];\n    };\n    KeyboardInteraction.prototype.getAppointmentElements = function () {\n        return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n    };\n    KeyboardInteraction.prototype.getAppointmentElementsByGuid = function (guid) {\n        return [].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]'));\n    };\n    KeyboardInteraction.prototype.getUniqueAppointmentElements = function () {\n        var appointments = this.getAppointmentElements();\n        var appointmentElements = [];\n        appointments.map(function (value) {\n            return value.getAttribute('data-guid');\n        }).filter(function (value, index, self) {\n            if (self.indexOf(value) === index) {\n                appointmentElements.push(appointments[index]);\n            }\n        });\n        return appointmentElements;\n    };\n    KeyboardInteraction.prototype.getWorkCellFromAppointmentElement = function (target) {\n        var selectedObject = this.parent.eventBase.getEventByGuid(target.getAttribute('data-guid'));\n        return this.parent.eventBase.selectWorkCellByTime([selectedObject]);\n    };\n    KeyboardInteraction.prototype.processViewNavigation = function (e) {\n        var index = parseInt(e.key, 10) - 1;\n        if (index < this.parent.views.length) {\n            var view = this.parent.viewCollections[index].option;\n            this.parent.changeView(view, e, undefined, index);\n            if (this.parent.headerModule) {\n                this.parent.headerModule.element.querySelector('.e-active-view button').focus();\n            }\n        }\n    };\n    KeyboardInteraction.prototype.processUp = function (e, isMultiple) {\n        if ((isMultiple && (this.parent.activeView.isTimelineView() || this.parent.currentView === 'MonthAgenda'))) {\n            return;\n        }\n        var target = (e.target);\n        var selectedElements = this.parent.getSelectedElements();\n        var selectedEventElements = this.parent.eventBase.getSelectedAppointments();\n        var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n        var quickPopupWrapper = this.getQuickPopupElement();\n        if (selectedElements.length > 0 && !e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n            target = selectedElements[selectedElements.length - 1];\n        }\n        if (selectedEventElements.length > 0 && !moreEventWrapper.classList.contains(cls.POPUP_OPEN) &&\n            !quickPopupWrapper.classList.contains(cls.POPUP_OPEN) &&\n            ['Day', 'Week', 'WorkWeek', 'Month'].indexOf(this.parent.currentView) !== -1) {\n            target = this.getWorkCellFromAppointmentElement(selectedEventElements[selectedEventElements.length - 1]);\n            this.parent.eventBase.removeSelectedAppointmentClass();\n        }\n        if (!target) {\n            return;\n        }\n        if (target.classList.contains(cls.WORK_CELLS_CLASS) && !this.parent.element.querySelector('.' + cls.POPUP_OPEN)) {\n            var tableRows = this.parent.getTableRows();\n            var curRowIndex = tableRows.indexOf(target.parentElement);\n            if (curRowIndex > 0 && curRowIndex < tableRows.length) {\n                this.selectCells(isMultiple, (tableRows[curRowIndex - 1]).cells[target.cellIndex]);\n            }\n        }\n        else if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n            this.selectAppointment(true, target);\n        }\n    };\n    KeyboardInteraction.prototype.processDown = function (e, isMultiple) {\n        if ((isMultiple && (this.parent.activeView.isTimelineView() || this.parent.currentView === 'MonthAgenda'))) {\n            return;\n        }\n        var target = (e.target);\n        var selectedCells = this.parent.getSelectedElements();\n        var selectedElements = this.parent.eventBase.getSelectedAppointments();\n        var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n        var quickPopupWrapper = this.getQuickPopupElement();\n        if (selectedCells.length > 0 && !e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n            target = selectedCells[selectedCells.length - 1];\n        }\n        if (selectedElements.length > 0 && !moreEventWrapper.classList.contains(cls.POPUP_OPEN) &&\n            !quickPopupWrapper.classList.contains(cls.POPUP_OPEN) &&\n            ['Day', 'Week', 'WorkWeek', 'Month'].indexOf(this.parent.currentView) !== -1) {\n            target = this.getWorkCellFromAppointmentElement(selectedElements[selectedElements.length - 1]);\n            this.parent.eventBase.removeSelectedAppointmentClass();\n        }\n        var tableRows = this.parent.getTableRows();\n        if (!target) {\n            return;\n        }\n        if (target.classList.contains(cls.WORK_CELLS_CLASS) && !this.parent.element.querySelector('.' + cls.POPUP_OPEN)) {\n            var curRowIndex = tableRows.indexOf(target.parentElement);\n            if (curRowIndex >= 0 && curRowIndex < tableRows.length - 1) {\n                this.selectCells(isMultiple, (tableRows[curRowIndex + 1]).cells[target.cellIndex]);\n            }\n        }\n        else if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n            this.selectAppointment(false, target);\n        }\n    };\n    KeyboardInteraction.prototype.processLeftRight = function (target) {\n        var tableEle = this.parent.getContentTable();\n        var curRowIndex = target.parentNode.sectionRowIndex;\n        var key = {\n            element: tableEle,\n            rowIndex: curRowIndex,\n            columnIndex: target.cellIndex,\n            maxIndex: tableEle.rows[curRowIndex].cells.length\n        };\n        return key;\n    };\n    KeyboardInteraction.prototype.getQuickPopupElement = function () {\n        return (this.parent.isAdaptive ? document.body : this.parent.element).querySelector('.' + cls.POPUP_WRAPPER_CLASS);\n    };\n    KeyboardInteraction.prototype.isCancelLeftRightAction = function (e, isMultiple) {\n        if (this.parent.currentView === 'Agenda' || (isMultiple && this.parent.currentView === 'MonthAgenda')) {\n            return true;\n        }\n        if ((this.isPreventAction(e) && isMultiple)) {\n            return true;\n        }\n        var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n        var quickPopupWrapper = this.getQuickPopupElement();\n        if (moreEventWrapper.classList.contains(cls.POPUP_OPEN) || quickPopupWrapper.classList.contains(cls.POPUP_OPEN)) {\n            return true;\n        }\n        return false;\n    };\n    KeyboardInteraction.prototype.processRight = function (e, isMultiple) {\n        if (this.isCancelLeftRightAction(e, isMultiple)) {\n            return;\n        }\n        var selectedCells = this.parent.getSelectedElements();\n        var targetCell;\n        var selectedAppointments = this.parent.eventBase.getSelectedAppointments();\n        var target = (e.target);\n        if (selectedCells.length > 0 && !target.classList.contains(cls.WORK_CELLS_CLASS) &&\n            !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            target = selectedCells[selectedCells.length - 1];\n        }\n        if (selectedAppointments.length > 0) {\n            target = this.getWorkCellFromAppointmentElement(selectedAppointments[selectedAppointments.length - 1]);\n            this.parent.eventBase.removeSelectedAppointmentClass();\n            if (!target) {\n                return;\n            }\n        }\n        if (target.classList.contains(cls.WORK_CELLS_CLASS)) {\n            var key = this.processLeftRight(target);\n            if (key.columnIndex >= 0 && key.columnIndex < key.maxIndex - 1) {\n                targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex].cells[target.cellIndex + 1], 'right');\n                if (!isNullOrUndefined(targetCell)) {\n                    this.selectCells(isMultiple, targetCell);\n                }\n            }\n            else if (key.columnIndex === key.maxIndex - 1) {\n                if (!this.isInverseTableSelect() && key.rowIndex < key.element.rows.length - 1) {\n                    targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex + 1].cells[0], 'right');\n                    if (!isNullOrUndefined(targetCell)) {\n                        this.selectCells(isMultiple, targetCell);\n                    }\n                }\n                else if (!isMultiple) {\n                    var rowIndex = this.isInverseTableSelect() ? key.rowIndex : 0;\n                    this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n                    var tableEle = this.parent.getContentTable();\n                    this.selectCells(false, tableEle.rows[rowIndex].cells[0]);\n                }\n            }\n        }\n        else if (target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            var curColIndex = target.cellIndex;\n            var allDayRow = this.parent.getAllDayRow();\n            var maxColIndex = allDayRow.cells.length;\n            if (curColIndex >= 0 && curColIndex < maxColIndex - 1) {\n                this.selectCells(isMultiple, allDayRow.cells[curColIndex + 1]);\n            }\n            else if (curColIndex === maxColIndex - 1 && !isMultiple) {\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n                var allDayRow_1 = this.parent.getAllDayRow();\n                this.selectCells(false, allDayRow_1.cells[0]);\n            }\n        }\n    };\n    KeyboardInteraction.prototype.processLeft = function (e, isMultiple) {\n        if (this.isCancelLeftRightAction(e, isMultiple)) {\n            return;\n        }\n        var target = (e.target);\n        var selectedCells = this.parent.getSelectedElements();\n        var targetCell;\n        if (selectedCells.length > 0 && !target.classList.contains(cls.WORK_CELLS_CLASS) &&\n            !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            target = selectedCells[selectedCells.length - 1];\n        }\n        var selectedElements = this.parent.eventBase.getSelectedAppointments();\n        if (selectedElements.length > 0) {\n            target = this.getWorkCellFromAppointmentElement(selectedElements[selectedElements.length - 1]);\n            this.parent.eventBase.removeSelectedAppointmentClass();\n            if (!target) {\n                return;\n            }\n        }\n        if (target.classList.contains(cls.WORK_CELLS_CLASS)) {\n            var key = this.processLeftRight(target);\n            if (key.columnIndex > 0 && key.columnIndex < key.maxIndex) {\n                targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex].cells[target.cellIndex - 1], 'left');\n                if (!isNullOrUndefined(targetCell)) {\n                    this.selectCells(isMultiple, targetCell);\n                }\n            }\n            else if (key.columnIndex === 0) {\n                if (!this.isInverseTableSelect() && key.rowIndex > 0) {\n                    targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex - 1].cells[key.maxIndex - 1], 'left');\n                    if (!isNullOrUndefined(targetCell)) {\n                        this.selectCells(isMultiple, targetCell);\n                    }\n                }\n                else if (!isMultiple) {\n                    this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n                    var tableEle = this.parent.getContentTable();\n                    var rowIndex = this.isInverseTableSelect() ? key.rowIndex : tableEle.rows.length - 1;\n                    this.selectCells(false, tableEle.rows[rowIndex].cells[key.maxIndex - 1]);\n                }\n            }\n        }\n        else if (target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            var curColIndex = target.cellIndex;\n            var allDayRow = this.parent.getAllDayRow();\n            var maxColIndex = allDayRow.cells.length;\n            if (curColIndex > 0 && curColIndex < maxColIndex) {\n                this.selectCells(isMultiple, allDayRow.cells[curColIndex - 1]);\n            }\n            else if (curColIndex === 0 && !isMultiple) {\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n                var allDayRow_2 = this.parent.getAllDayRow();\n                this.selectCells(false, allDayRow_2.cells[maxColIndex - 1]);\n            }\n        }\n    };\n    KeyboardInteraction.prototype.calculateNextPrevDate = function (currentCell, target, type) {\n        var initialId = this.initialTarget.getAttribute('data-group-index');\n        if (this.parent.activeViewOptions.group.resources.length > 0 && this.parent.currentView === 'Month') {\n            if (currentCell && target && target.getAttribute('data-group-index') !== initialId) {\n                var currentDate = this.parent.getDateFromElement(currentCell);\n                var nextPrevDate = (type === 'right') ? new Date(currentDate.setDate(currentDate.getDate() + 1))\n                    : new Date(currentDate.setDate(currentDate.getDate() - 1));\n                target = [].slice.call(this.parent.element.querySelectorAll('td[data-date=\"'\n                    + this.parent.getMsFromDate(nextPrevDate).toString() + '\"]' + '[data-group-index=\"' + initialId + '\"]'))[0];\n            }\n        }\n        return target;\n    };\n    KeyboardInteraction.prototype.getFocusableElements = function (container) {\n        var queryString = 'a[href]:not([tabindex=\"-1\"]),input:not([disabled]):not([tabindex=\"-1\"]),' +\n            'textarea:not([disabled]):not([tabindex=\"-1\"]),button:not([disabled]):not([tabindex=\"-1\"]),' +\n            'select:not([disabled]):not([tabindex=\"-1\"]),[tabindex]:not([tabindex=\"-1\"]),[contentEditable=true]:not([tabindex=\"-1\"])';\n        return [].slice.call(container.querySelectorAll(queryString));\n    };\n    KeyboardInteraction.prototype.processTabOnPopup = function (e, popupElement) {\n        var _this = this;\n        var focusableElements = this.getFocusableElements(popupElement);\n        focusableElements = focusableElements.filter(function (element) {\n            var footerEle = _this.parent.element.querySelector('.' + cls.POPUP_FOOTER_CLASS);\n            if (footerEle && footerEle.offsetParent) {\n                return !(element.classList.contains(cls.EDIT_CLASS) || element.classList.contains(cls.DELETE_CLASS));\n            }\n            else {\n                return !(element.classList.contains(cls.EDIT_EVENT_CLASS) || element.classList.contains(cls.DELETE_EVENT_CLASS));\n            }\n        });\n        var firstEle = focusableElements[0];\n        var lastEle = focusableElements[focusableElements.length - 1];\n        if (!isNullOrUndefined(lastEle) && document.activeElement === lastEle && !e.shiftKey) {\n            e.preventDefault();\n            firstEle.focus();\n        }\n        if (!isNullOrUndefined(firstEle) && document.activeElement === firstEle && e.shiftKey) {\n            e.preventDefault();\n            lastEle.focus();\n        }\n    };\n    KeyboardInteraction.prototype.processTab = function (e, isReverse) {\n        var target = e.target;\n        var popupWrapper = closest(target, '.' + cls.POPUP_WRAPPER_CLASS + ',.' + cls.MORE_POPUP_WRAPPER_CLASS);\n        if (popupWrapper && popupWrapper.classList.contains(cls.POPUP_OPEN)) {\n            if (popupWrapper.classList.contains(cls.MORE_POPUP_WRAPPER_CLASS)) {\n                this.parent.eventBase.removeSelectedAppointmentClass();\n            }\n            this.processTabOnPopup(e, popupWrapper);\n            return;\n        }\n        if (target.classList.contains(cls.ROOT)) {\n            this.parent.eventBase.removeSelectedAppointmentClass();\n            return;\n        }\n        if (target.classList.contains(cls.APPOINTMENT_CLASS)) {\n            var appointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n            var selectedAppointments = this.parent.eventBase.getSelectedAppointments();\n            if (selectedAppointments.length > 0) {\n                target = selectedAppointments[selectedAppointments.length - 1];\n            }\n            this.parent.eventBase.removeSelectedAppointmentClass();\n            if (!isReverse && target.getAttribute('data-guid') === appointments[appointments.length - 1].getAttribute('data-guid') ||\n                isReverse && target.getAttribute('data-guid') === appointments[0].getAttribute('data-guid')) {\n                return;\n            }\n            if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n                this.selectAppointment(isReverse, target);\n                e.preventDefault();\n            }\n            return;\n        }\n        var selectedCells = this.parent.getSelectedElements();\n        if (selectedCells.length > 0 && !target.classList.contains(cls.APPOINTMENT_CLASS)) {\n            target = selectedCells[selectedCells.length - 1];\n            this.selectAppointmentElementFromWorkCell(isReverse, target);\n            e.preventDefault();\n            return;\n        }\n    };\n    KeyboardInteraction.prototype.processDelete = function (e) {\n        if (document.activeElement && document.activeElement.classList.contains(cls.APPOINTMENT_CLASS)) {\n            addClass([document.activeElement], cls.APPOINTMENT_BORDER);\n            this.parent.activeEventData = this.parent.eventBase.getSelectedEvents();\n            if (this.parent.activeViewOptions.readonly || document.activeElement.classList.contains('e-read-only')) {\n                return;\n            }\n            this.parent.quickPopup.deleteClick();\n        }\n    };\n    KeyboardInteraction.prototype.processEscape = function () {\n        this.parent.quickPopup.onClosePopup();\n        this.parent.quickPopup.morePopup.hide();\n        if (this.parent.headerModule) {\n            this.parent.headerModule.hideHeaderPopup();\n        }\n    };\n    KeyboardInteraction.prototype.isPreventAction = function (e) {\n        var target = closest(e.target, '.' + cls.RESOURCE_GROUP_CELLS_CLASS);\n        if (this.parent.activeView.isTimelineView() && !isNullOrUndefined(target)) {\n            return true;\n        }\n        return false;\n    };\n    /**\n     * Get module name.\n     */\n    KeyboardInteraction.prototype.getModuleName = function () {\n        return 'keyboard';\n    };\n    /**\n     * To destroy the keyboard module.\n     * @return {void}\n     * @private\n     */\n    KeyboardInteraction.prototype.destroy = function () {\n        this.removeEventListener();\n        this.keyboardModule.destroy();\n    };\n    return KeyboardInteraction;\n}());\nexport { KeyboardInteraction };\n"]},"metadata":{},"sourceType":"module"}