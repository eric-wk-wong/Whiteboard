{"ast":null,"code":"import { isNullOrUndefined, isBlazor } from '@syncfusion/ej2-base';\nimport { getRecurrenceStringFromDate, generate } from '../../recurrence-editor/date-generator';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\n/**\n * Schedule CRUD operations\n */\n\nvar Crud =\n/** @class */\nfunction () {\n  function Crud(parent) {\n    this.parent = parent;\n  }\n\n  Crud.prototype.getQuery = function () {\n    var start = this.parent.activeView.startDate();\n    var end = this.parent.activeView.endDate();\n    return this.parent.dataModule.generateQuery(start, end);\n  };\n\n  Crud.prototype.getTable = function () {\n    if (this.parent.eventSettings.query) {\n      var query = this.parent.eventSettings.query.clone();\n      return query.fromTable;\n    }\n\n    return null;\n  };\n\n  Crud.prototype.refreshData = function (args) {\n    var _this = this;\n\n    var actionArgs = {\n      requestType: args.requestType,\n      cancel: false,\n      data: args.data,\n      addedRecords: args.editParms.addedRecords,\n      changedRecords: args.editParms.changedRecords,\n      deletedRecords: args.editParms.deletedRecords\n    };\n\n    if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj && this.parent.dragAndDropModule.actionObj.element) {\n      this.parent.dragAndDropModule.actionObj.element.style.display = 'none';\n    }\n\n    if (this.parent.resizeModule && this.parent.resizeModule.actionObj && this.parent.resizeModule.actionObj.element) {\n      this.parent.resizeModule.actionObj.element.style.display = 'none';\n    }\n\n    if (this.parent.dataModule.dataManager.dataSource.offline) {\n      this.parent.trigger(events.actionComplete, actionArgs, function (offlineArgs) {\n        if (!offlineArgs.cancel) {\n          _this.parent.renderModule.refreshDataManager();\n        }\n      });\n    } else {\n      args.promise.then(function (e) {\n        if (_this.parent.isDestroyed) {\n          return;\n        }\n\n        _this.parent.trigger(events.actionComplete, actionArgs, function (onlineArgs) {\n          if (!onlineArgs.cancel) {\n            _this.parent.renderModule.refreshDataManager();\n          }\n        });\n      }).catch(function (e) {\n        if (_this.parent.isDestroyed) {\n          return;\n        }\n\n        _this.parent.trigger(events.actionFailure, {\n          error: e\n        });\n      });\n    }\n  };\n\n  Crud.prototype.addEvent = function (eventData) {\n    var _this = this;\n\n    if (this.parent.eventSettings.allowAdding) {\n      if (!this.isBlockEvent(eventData) && this.parent.eventBase.isBlockRange(eventData)) {\n        this.parent.quickPopup.openValidationError('blockAlert', eventData instanceof Array ? [eventData] : eventData);\n        return;\n      }\n\n      var addEvents = eventData instanceof Array ? eventData : [eventData];\n      var args = {\n        requestType: 'eventCreate',\n        cancel: false,\n        addedRecords: addEvents,\n        changedRecords: [],\n        deletedRecords: []\n      };\n\n      if (!isBlazor()) {\n        args.data = addEvents;\n      }\n\n      this.parent.trigger(events.actionBegin, args, function (addArgs) {\n        _this.serializeData(addArgs.addedRecords);\n\n        if (!addArgs.cancel) {\n          var fields = _this.parent.eventFields;\n          var editParms = {\n            addedRecords: [],\n            changedRecords: [],\n            deletedRecords: []\n          };\n          var promise = void 0;\n\n          if (addArgs.addedRecords instanceof Array) {\n            for (var _i = 0, _a = addArgs.addedRecords; _i < _a.length; _i++) {\n              var event_1 = _a[_i];\n              editParms.addedRecords.push(_this.parent.eventBase.processTimezone(event_1, true));\n            } // tslint:disable-next-line:max-line-length\n\n\n            promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields.id, _this.getTable(), _this.getQuery());\n          } else {\n            var event_2 = _this.parent.eventBase.processTimezone(addArgs.addedRecords, true);\n\n            editParms.addedRecords.push(event_2);\n            promise = _this.parent.dataModule.dataManager.insert(event_2, _this.getTable(), _this.getQuery());\n          }\n\n          var crudArgs = {\n            requestType: 'eventCreated',\n            cancel: false,\n            data: addArgs.addedRecords,\n            promise: promise,\n            editParms: editParms\n          };\n\n          _this.refreshData(crudArgs);\n        }\n      });\n    }\n  };\n\n  Crud.prototype.saveEvent = function (eventData, action) {\n    var _this = this;\n\n    if (this.parent.eventSettings.allowEditing) {\n      if (this.parent.currentAction !== 'EditFollowingEvents' && !this.isBlockEvent(eventData) && this.parent.eventBase.isBlockRange(eventData)) {\n        this.parent.quickPopup.openValidationError('blockAlert', eventData instanceof Array ? [eventData] : eventData);\n        return;\n      }\n\n      this.parent.currentAction = action;\n\n      if (action) {\n        switch (action) {\n          case 'EditOccurrence':\n            this.processOccurrences(eventData, action);\n            break;\n\n          case 'EditFollowingEvents':\n            this.processFollowSeries(eventData, action);\n            break;\n\n          case 'EditSeries':\n            this.processEntireSeries(eventData, action);\n            break;\n        }\n      } else {\n        var updateEvents = eventData instanceof Array ? eventData : [eventData];\n        var args = {\n          requestType: 'eventChange',\n          cancel: false,\n          addedRecords: [],\n          changedRecords: updateEvents,\n          deletedRecords: []\n        };\n\n        if (!isBlazor()) {\n          args.data = eventData;\n        }\n\n        this.parent.trigger(events.actionBegin, args, function (saveArgs) {\n          _this.serializeData(saveArgs.changedRecords);\n\n          if (!saveArgs.cancel) {\n            var promise = void 0;\n            var fields = _this.parent.eventFields;\n            var editParms = {\n              addedRecords: [],\n              changedRecords: [],\n              deletedRecords: []\n            };\n\n            if (saveArgs.changedRecords instanceof Array) {\n              for (var _i = 0, _a = saveArgs.changedRecords; _i < _a.length; _i++) {\n                var event_3 = _a[_i];\n                editParms.changedRecords.push(_this.parent.eventBase.processTimezone(event_3, true));\n              } // tslint:disable-next-line:max-line-length\n\n\n              promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields.id, _this.getTable(), _this.getQuery());\n            } else {\n              var event_4 = _this.parent.eventBase.processTimezone(saveArgs.changedRecords, true);\n\n              editParms.changedRecords.push(event_4); // tslint:disable-next-line:max-line-length\n\n              promise = _this.parent.dataModule.dataManager.update(fields.id, event_4, _this.getTable(), _this.getQuery());\n            }\n\n            var crudArgs = {\n              requestType: 'eventChanged',\n              cancel: false,\n              data: saveArgs.data,\n              promise: promise,\n              editParms: editParms\n            };\n\n            _this.refreshData(crudArgs);\n          }\n        });\n      }\n    }\n  };\n\n  Crud.prototype.deleteEvent = function (eventData, action) {\n    var _this = this;\n\n    if (this.parent.eventSettings.allowDeleting) {\n      this.parent.currentAction = action;\n      var deleteEvents = [];\n\n      if (typeof eventData === 'string' || typeof eventData === 'number') {\n        deleteEvents = this.parent.eventsData.filter(function (eventObj) {\n          return eventObj[_this.parent.eventFields.id] === eventData;\n        });\n      } else {\n        deleteEvents = eventData instanceof Array ? eventData : [eventData];\n      }\n\n      if (action) {\n        switch (action) {\n          case 'Delete':\n            this.processEventDelete(deleteEvents);\n            break;\n\n          case 'DeleteOccurrence':\n            this.processOccurrences(deleteEvents, action);\n            break;\n\n          case 'DeleteFollowingEvents':\n            this.processFollowSeries(deleteEvents, action);\n            break;\n\n          case 'DeleteSeries':\n            this.processEntireSeries(deleteEvents, action);\n            break;\n        }\n      } else {\n        var args = {\n          requestType: 'eventRemove',\n          cancel: false,\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: deleteEvents\n        };\n\n        if (!isBlazor()) {\n          args.data = eventData;\n        }\n\n        this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n          _this.serializeData(deleteArgs.deletedRecords);\n\n          if (!deleteArgs.cancel) {\n            var promise = void 0;\n            var fields = _this.parent.eventFields;\n            var editParms = {\n              addedRecords: [],\n              changedRecords: [],\n              deletedRecords: []\n            };\n\n            if (deleteArgs.deletedRecords.length > 1) {\n              for (var _i = 0, _a = deleteArgs.deletedRecords; _i < _a.length; _i++) {\n                var eventObj = _a[_i];\n                editParms.deletedRecords.push(eventObj);\n              } // tslint:disable-next-line:max-line-length\n\n\n              promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields.id, _this.getTable(), _this.getQuery());\n            } else {\n              editParms.deletedRecords.push(deleteArgs.deletedRecords[0]); // tslint:disable-next-line:max-line-length\n\n              promise = _this.parent.dataModule.dataManager.remove(fields.id, deleteArgs.deletedRecords[0], _this.getTable(), _this.getQuery());\n            }\n\n            _this.parent.eventBase.selectWorkCellByTime(deleteArgs.deletedRecords);\n\n            var crudArgs = {\n              requestType: 'eventRemoved',\n              cancel: false,\n              data: deleteArgs.data,\n              promise: promise,\n              editParms: editParms\n            };\n\n            _this.refreshData(crudArgs);\n          }\n        });\n      }\n    }\n  };\n\n  Crud.prototype.processOccurrences = function (eventData, action) {\n    var _this = this;\n\n    var occurenceData = [];\n\n    if (eventData instanceof Array) {\n      for (var _i = 0, eventData_1 = eventData; _i < eventData_1.length; _i++) {\n        var event_5 = eventData_1[_i];\n        occurenceData.push({\n          occurrence: event_5,\n          parent: this.getParentEvent(event_5)\n        });\n      }\n    } else {\n      occurenceData = {\n        occurrence: eventData,\n        parent: this.getParentEvent(eventData)\n      };\n    }\n\n    var updateEvents = eventData instanceof Array ? eventData : [eventData];\n    var args = {\n      requestType: action === 'EditOccurrence' ? 'eventChange' : 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: updateEvents,\n      deletedRecords: []\n    };\n\n    if (!isBlazor()) {\n      args.data = occurenceData;\n    }\n\n    this.parent.trigger(events.actionBegin, args, function (occurenceArgs) {\n      _this.serializeData(occurenceArgs.changedRecords);\n\n      if (!occurenceArgs.cancel) {\n        var fields = _this.parent.eventFields;\n        var editParms = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        var occurrenceEvents = occurenceData instanceof Array ? occurenceData : [occurenceData];\n\n        var _loop_1 = function (a, count) {\n          var childEvent = occurenceArgs.changedRecords[a];\n          var parentEvent = occurrenceEvents[a].parent;\n          var parentException = parentEvent[fields.recurrenceException];\n\n          switch (action) {\n            case 'EditOccurrence':\n              var editedData = _this.parent.eventsProcessed.filter(function (event) {\n                return event.Guid === childEvent.Guid;\n              })[0];\n\n              var exceptionDate = _this.excludeDateCheck(editedData[fields.startTime], parentException);\n\n              if (exceptionDate !== parentEvent[fields.recurrenceException]) {\n                parentEvent[fields.recurrenceException] = exceptionDate;\n                childEvent[fields.recurrenceException] = getRecurrenceStringFromDate(editedData[fields.startTime]);\n                childEvent[fields.recurrenceID] = parentEvent[fields.id];\n                childEvent[fields.followingID] = null;\n                editParms.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                editParms.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              } else {\n                editParms.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              }\n\n              break;\n\n            case 'DeleteOccurrence':\n              if (!childEvent[fields.recurrenceException]) {\n                parentEvent[fields.recurrenceException] = _this.excludeDateCheck(childEvent[fields.startTime], parentException);\n                editParms.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n              }\n\n              if (childEvent[fields.id] !== parentEvent[fields.id]) {\n                editParms.deletedRecords.push(childEvent);\n              }\n\n              break;\n          }\n        };\n\n        for (var a = 0, count = occurenceArgs.changedRecords.length; a < count; a++) {\n          _loop_1(a, count);\n        } // tslint:disable-next-line:max-line-length\n\n\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields.id, _this.getTable(), _this.getQuery());\n\n        _this.parent.eventBase.selectWorkCellByTime(occurenceArgs.changedRecords);\n\n        var crudArgs = {\n          requestType: action === 'EditOccurrence' ? 'eventChanged' : 'eventRemoved',\n          cancel: false,\n          data: occurenceArgs.data,\n          promise: promise,\n          editParms: editParms\n        };\n\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n\n  Crud.prototype.processFollowSeries = function (eventData, action) {\n    var _this = this;\n\n    var followData = [];\n\n    if (eventData instanceof Array) {\n      for (var _i = 0, eventData_2 = eventData; _i < eventData_2.length; _i++) {\n        var event_6 = eventData_2[_i];\n        followData.push({\n          occurrence: event_6,\n          parent: this.getParentEvent(event_6)\n        });\n      }\n    } else {\n      followData = {\n        occurrence: eventData,\n        parent: this.getParentEvent(eventData)\n      };\n    }\n\n    var updateFollowEvents = eventData instanceof Array ? eventData : [eventData];\n    var args = {\n      requestType: action === 'EditFollowingEvents' ? 'eventChange' : 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: updateFollowEvents,\n      deletedRecords: []\n    };\n\n    if (!isBlazor()) {\n      args.data = followData;\n    }\n\n    this.parent.trigger(events.actionBegin, args, function (followArgs) {\n      _this.serializeData(followArgs.changedRecords);\n\n      if (!followArgs.cancel) {\n        var fields_1 = _this.parent.eventFields;\n        var editParms = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        var followEvents = followData instanceof Array ? followData : [followData];\n\n        var _loop_2 = function (a, count) {\n          var childEvent = followArgs.changedRecords[a];\n          var parentEvent = followEvents[a].parent;\n\n          var followData_1 = _this.parent.eventBase.getEventCollections(parentEvent, childEvent);\n\n          switch (action) {\n            case 'EditFollowingEvents':\n              _this.processRecurrenceRule(parentEvent, childEvent);\n\n              var isSplitted = !_this.parent.eventBase.isFollowingEvent(parentEvent, childEvent);\n              childEvent[fields_1.followingID] = isSplitted ? null : parentEvent[fields_1.id];\n              childEvent[fields_1.recurrenceID] = null;\n              editParms.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              editParms.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n\n              if (!_this.parent.uiStateValues.isIgnoreOccurrence) {\n                childEvent[fields_1.recurrenceException] = null;\n\n                if (followData_1.occurrence.length > 0) {\n                  var rule = followData_1.occurrence.slice(-1)[0][fields_1.recurrenceRule];\n\n                  if (rule.indexOf('COUNT') === -1) {\n                    childEvent[fields_1.recurrenceRule] = rule;\n                  }\n                }\n\n                if (followData_1.follow.length > 0) {\n                  childEvent[fields_1.recurrenceRule] = followData_1.follow.slice(-1)[0][fields_1.recurrenceRule];\n                  editParms.deletedRecords = editParms.deletedRecords.concat(followData_1.follow);\n                }\n\n                if (isSplitted) {\n                  followData_1.occurrence = followData_1.occurrence.filter(function (eventObj) {\n                    return eventObj[fields_1.recurrenceID] === childEvent[fields_1.id];\n                  });\n                }\n\n                editParms.deletedRecords = editParms.deletedRecords.concat(followData_1.occurrence);\n              }\n\n              break;\n\n            case 'DeleteFollowingEvents':\n              _this.processRecurrenceRule(parentEvent, childEvent[fields_1.startTime]);\n\n              editParms.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n              editParms.deletedRecords = editParms.deletedRecords.concat(followData_1.occurrence).concat(followData_1.follow);\n              break;\n          }\n        };\n\n        for (var a = 0, count = followArgs.changedRecords.length; a < count; a++) {\n          _loop_2(a, count);\n        } // tslint:disable-next-line:max-line-length\n\n\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields_1.id, _this.getTable(), _this.getQuery());\n\n        _this.parent.eventBase.selectWorkCellByTime(followArgs.changedRecords);\n\n        var crudArgs = {\n          requestType: action === 'EditFollowingEvents' ? 'eventChanged' : 'eventRemoved',\n          cancel: false,\n          data: followArgs.data,\n          promise: promise,\n          editParms: editParms\n        };\n\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n\n  Crud.prototype.processEntireSeries = function (eventData, action) {\n    var _this = this;\n\n    var seriesData = [];\n\n    if (eventData instanceof Array) {\n      for (var _i = 0, eventData_3 = eventData; _i < eventData_3.length; _i++) {\n        var event_7 = eventData_3[_i];\n        seriesData.push(this.getParentEvent(event_7, true));\n      }\n    } else {\n      seriesData = this.getParentEvent(eventData, true);\n    }\n\n    var updateSeriesEvents = eventData instanceof Array ? eventData : [eventData];\n    var args = {\n      requestType: action === 'EditSeries' ? 'eventChange' : 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: updateSeriesEvents,\n      deletedRecords: []\n    };\n\n    if (!isBlazor()) {\n      args.data = seriesData;\n    }\n\n    this.parent.trigger(events.actionBegin, args, function (seriesArgs) {\n      _this.serializeData(seriesArgs.changedRecords);\n\n      if (!seriesArgs.cancel) {\n        var fields_2 = _this.parent.eventFields;\n        var editParms = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        var seriesEvents = seriesData instanceof Array ? seriesData : [seriesData];\n\n        var _loop_3 = function (a, count) {\n          var childEvent = seriesArgs.changedRecords[a];\n          var parentEvent = seriesEvents[a];\n\n          var eventCollections = _this.parent.eventBase.getEventCollections(parentEvent);\n\n          var deletedEvents = eventCollections.follow.concat(eventCollections.occurrence);\n\n          switch (action) {\n            case 'EditSeries':\n              if (childEvent[fields_2.startTime] > parentEvent[fields_2.startTime]) {\n                _this.processRecurrenceRule(parentEvent, childEvent);\n              }\n\n              childEvent[fields_2.id] = parentEvent[fields_2.id];\n              childEvent[fields_2.recurrenceID] = null;\n              childEvent[fields_2.followingID] = null;\n\n              if (_this.parent.uiStateValues.isIgnoreOccurrence && childEvent[fields_2.recurrenceException]) {\n                var originalParent = _this.parent.eventsData.filter(function (eventObj) {\n                  return eventObj[fields_2.id] === childEvent[fields_2.id];\n                });\n\n                if (originalParent.length > 0) {\n                  childEvent[fields_2.recurrenceRule] = originalParent[0][fields_2.recurrenceRule];\n                }\n              } else {\n                childEvent[fields_2.recurrenceException] = null;\n                editParms.deletedRecords = editParms.deletedRecords.concat(deletedEvents);\n              }\n\n              editParms.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              _this.parent.uiStateValues.isIgnoreOccurrence = false;\n              break;\n\n            case 'DeleteSeries':\n              editParms.deletedRecords = editParms.deletedRecords.concat(deletedEvents.concat(parentEvent));\n              break;\n          }\n        };\n\n        for (var a = 0, count = seriesArgs.changedRecords.length; a < count; a++) {\n          _loop_3(a, count);\n        } // tslint:disable-next-line:max-line-length\n\n\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields_2.id, _this.getTable(), _this.getQuery());\n\n        _this.parent.eventBase.selectWorkCellByTime(seriesArgs.changedRecords);\n\n        var crudArgs = {\n          requestType: action === 'EditSeries' ? 'eventChanged' : 'eventRemoved',\n          cancel: false,\n          data: seriesArgs.data,\n          promise: promise,\n          editParms: editParms\n        };\n\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n\n  Crud.prototype.processEventDelete = function (eventData) {\n    var _this = this;\n\n    var deleteData = [];\n\n    for (var _i = 0, eventData_4 = eventData; _i < eventData_4.length; _i++) {\n      var eventObj = eventData_4[_i];\n\n      if (eventObj[this.parent.eventFields.recurrenceRule]) {\n        deleteData.push({\n          occurrence: eventObj,\n          parent: this.getParentEvent(eventObj)\n        });\n      } else {\n        deleteData.push(eventObj);\n      }\n    }\n\n    var args = {\n      requestType: 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: [],\n      deletedRecords: eventData\n    };\n\n    if (!isBlazor()) {\n      args.data = deleteData;\n    }\n\n    this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n      _this.serializeData(deleteArgs.deletedRecords);\n\n      if (!deleteArgs.cancel) {\n        var fields_3 = _this.parent.eventFields;\n        var editParms = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n\n        var _loop_4 = function (a, count) {\n          var isDelete = isNullOrUndefined(deleteArgs.deletedRecords[a][_this.parent.eventFields.recurrenceRule]);\n\n          if (!isDelete) {\n            var parentEvent_1 = deleteData[a].parent;\n            var isEdited = editParms.changedRecords.filter(function (obj) {\n              return obj[fields_3.id] === parentEvent_1[fields_3.id];\n            });\n            var editedDate = deleteArgs.deletedRecords[a][fields_3.startTime];\n\n            if (isEdited.length > 0) {\n              var editedData = isEdited[0];\n              editedData[fields_3.recurrenceException] = _this.excludeDateCheck(editedDate, editedData[fields_3.recurrenceException]);\n            } else {\n              parentEvent_1[fields_3.recurrenceException] = _this.excludeDateCheck(editedDate, parentEvent_1[fields_3.recurrenceException]);\n            }\n\n            if (isEdited.length === 0) {\n              editParms.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent_1, true));\n            }\n\n            isDelete = deleteArgs.deletedRecords[a][fields_3.id] !== parentEvent_1[fields_3.id];\n          }\n\n          if (isDelete) {\n            editParms.deletedRecords.push(deleteArgs.deletedRecords[a]);\n          }\n        };\n\n        for (var a = 0, count = deleteArgs.deletedRecords.length; a < count; a++) {\n          _loop_4(a, count);\n        } // tslint:disable-next-line:max-line-length\n\n\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields_3.id, _this.getTable(), _this.getQuery());\n\n        var crudArgs = {\n          requestType: 'eventRemoved',\n          cancel: false,\n          data: deleteArgs.data,\n          promise: promise,\n          editParms: editParms\n        };\n\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n\n  Crud.prototype.serializeData = function (eventData) {\n    if (isBlazor()) {\n      var eventFields = this.parent.eventFields;\n\n      for (var _i = 0, _a = eventData; _i < _a.length; _i++) {\n        var event_8 = _a[_i];\n        event_8[eventFields.startTime] = this.parent.getDateTime(event_8[eventFields.startTime]);\n        event_8[eventFields.endTime] = this.parent.getDateTime(event_8[eventFields.endTime]);\n      }\n    }\n  };\n\n  Crud.prototype.getParentEvent = function (event, isParent) {\n    if (isParent === void 0) {\n      isParent = false;\n    }\n\n    var parentEvent = this.parent.eventBase.getParentEvent(event, isParent) || event;\n\n    if (parentEvent[this.parent.eventFields.startTimezone] || parentEvent[this.parent.eventFields.endTimezone]) {\n      this.parent.eventBase.timezoneConvert(parentEvent);\n    }\n\n    return parentEvent;\n  };\n\n  Crud.prototype.excludeDateCheck = function (eventStartTime, exceptionDateList) {\n    var exDate = getRecurrenceStringFromDate(eventStartTime);\n\n    if (!isNullOrUndefined(exceptionDateList)) {\n      if (exceptionDateList.indexOf(exDate) === -1) {\n        exceptionDateList = !isNullOrUndefined(exceptionDateList) ? exceptionDateList + ',' + exDate : exDate;\n      }\n    } else {\n      exceptionDateList = exDate;\n    }\n\n    return exceptionDateList;\n  };\n\n  Crud.prototype.processRecurrenceRule = function (parentEvent, followEvent) {\n    var fields = this.parent.eventFields;\n    var recurrenceRule = parentEvent[fields.recurrenceRule];\n    var endDate;\n\n    if (followEvent instanceof Date) {\n      endDate = new Date(+followEvent);\n    } else {\n      endDate = new Date(+followEvent[fields.startTime]);\n      var startDate = parentEvent[fields.startTime];\n      var ruleException = this.parent.currentAction === 'DeleteFollowingEvents' ? followEvent[fields.recurrenceException] : null;\n      var dateCollection = generate(startDate, recurrenceRule, ruleException, this.parent.activeViewOptions.firstDayOfWeek);\n      var untilDate = new Date(dateCollection.slice(-1)[0]);\n      untilDate.setHours(endDate.getHours(), endDate.getMinutes(), endDate.getSeconds());\n      endDate.setHours(startDate.getHours(), startDate.getMinutes(), startDate.getSeconds());\n      followEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(recurrenceRule, new Date(+untilDate), false);\n    }\n\n    parentEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(recurrenceRule, util.addDays(new Date(endDate.getTime()), -1), true);\n  };\n\n  Crud.prototype.getUpdatedRecurrenceRule = function (recurrenceRule, untilDate, isParent) {\n    var splitRule = recurrenceRule.split(';');\n    var updatedRule = '';\n\n    for (var _i = 0, splitRule_1 = splitRule; _i < splitRule_1.length; _i++) {\n      var rule = splitRule_1[_i];\n\n      if (rule !== '') {\n        var ruleKey = rule.split('=')[0];\n        var ruleValue = rule.split('=')[1];\n\n        if (ruleKey === 'COUNT' || ruleKey === 'UNTIL') {\n          ruleValue = getRecurrenceStringFromDate(untilDate);\n          rule = rule.replace(rule, 'UNTIL=' + ruleValue);\n        }\n\n        updatedRule += rule + ';';\n      }\n    }\n\n    if (isParent && updatedRule.indexOf('UNTIL') === -1) {\n      updatedRule += 'UNTIL=' + getRecurrenceStringFromDate(untilDate);\n    }\n\n    return updatedRule;\n  };\n\n  Crud.prototype.isBlockEvent = function (eventData) {\n    var _this = this;\n\n    var eventCollection = eventData instanceof Array ? eventData : [eventData];\n    var value = false;\n    eventCollection.forEach(function (event) {\n      value = event[_this.parent.eventFields.isBlock] || false;\n    });\n    return value;\n  };\n\n  return Crud;\n}();\n\nexport { Crud };","map":{"version":3,"sources":["D:/developing/projects/whiteboard/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/crud.js"],"names":["isNullOrUndefined","isBlazor","getRecurrenceStringFromDate","generate","events","util","Crud","parent","prototype","getQuery","start","activeView","startDate","end","endDate","dataModule","generateQuery","getTable","eventSettings","query","clone","fromTable","refreshData","args","_this","actionArgs","requestType","cancel","data","addedRecords","editParms","changedRecords","deletedRecords","dragAndDropModule","actionObj","element","style","display","resizeModule","dataManager","dataSource","offline","trigger","actionComplete","offlineArgs","renderModule","refreshDataManager","promise","then","e","isDestroyed","onlineArgs","catch","actionFailure","error","addEvent","eventData","allowAdding","isBlockEvent","eventBase","isBlockRange","quickPopup","openValidationError","Array","addEvents","actionBegin","addArgs","serializeData","fields","eventFields","_i","_a","length","event_1","push","processTimezone","saveChanges","id","event_2","insert","crudArgs","saveEvent","action","allowEditing","currentAction","processOccurrences","processFollowSeries","processEntireSeries","updateEvents","saveArgs","event_3","event_4","update","deleteEvent","allowDeleting","deleteEvents","eventsData","filter","eventObj","processEventDelete","deleteArgs","remove","selectWorkCellByTime","occurenceData","eventData_1","event_5","occurrence","getParentEvent","occurenceArgs","occurrenceEvents","_loop_1","a","count","childEvent","parentEvent","parentException","recurrenceException","editedData","eventsProcessed","event","Guid","exceptionDate","excludeDateCheck","startTime","recurrenceID","followingID","followData","eventData_2","event_6","updateFollowEvents","followArgs","fields_1","followEvents","_loop_2","followData_1","getEventCollections","processRecurrenceRule","isSplitted","isFollowingEvent","uiStateValues","isIgnoreOccurrence","rule","slice","recurrenceRule","indexOf","follow","concat","seriesData","eventData_3","event_7","updateSeriesEvents","seriesArgs","fields_2","seriesEvents","_loop_3","eventCollections","deletedEvents","originalParent","deleteData","eventData_4","fields_3","_loop_4","isDelete","parentEvent_1","isEdited","obj","editedDate","event_8","getDateTime","endTime","isParent","startTimezone","endTimezone","timezoneConvert","eventStartTime","exceptionDateList","exDate","followEvent","Date","ruleException","dateCollection","activeViewOptions","firstDayOfWeek","untilDate","setHours","getHours","getMinutes","getSeconds","getUpdatedRecurrenceRule","addDays","getTime","splitRule","split","updatedRule","splitRule_1","ruleKey","ruleValue","replace","eventCollection","value","forEach","isBlock"],"mappings":"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","sourcesContent":["import { isNullOrUndefined, isBlazor } from '@syncfusion/ej2-base';\nimport { getRecurrenceStringFromDate, generate } from '../../recurrence-editor/date-generator';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\n/**\n * Schedule CRUD operations\n */\nvar Crud = /** @class */ (function () {\n    function Crud(parent) {\n        this.parent = parent;\n    }\n    Crud.prototype.getQuery = function () {\n        var start = this.parent.activeView.startDate();\n        var end = this.parent.activeView.endDate();\n        return this.parent.dataModule.generateQuery(start, end);\n    };\n    Crud.prototype.getTable = function () {\n        if (this.parent.eventSettings.query) {\n            var query = this.parent.eventSettings.query.clone();\n            return query.fromTable;\n        }\n        return null;\n    };\n    Crud.prototype.refreshData = function (args) {\n        var _this = this;\n        var actionArgs = {\n            requestType: args.requestType, cancel: false, data: args.data,\n            addedRecords: args.editParms.addedRecords, changedRecords: args.editParms.changedRecords,\n            deletedRecords: args.editParms.deletedRecords\n        };\n        if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj && this.parent.dragAndDropModule.actionObj.element) {\n            this.parent.dragAndDropModule.actionObj.element.style.display = 'none';\n        }\n        if (this.parent.resizeModule && this.parent.resizeModule.actionObj && this.parent.resizeModule.actionObj.element) {\n            this.parent.resizeModule.actionObj.element.style.display = 'none';\n        }\n        if (this.parent.dataModule.dataManager.dataSource.offline) {\n            this.parent.trigger(events.actionComplete, actionArgs, function (offlineArgs) {\n                if (!offlineArgs.cancel) {\n                    _this.parent.renderModule.refreshDataManager();\n                }\n            });\n        }\n        else {\n            args.promise.then(function (e) {\n                if (_this.parent.isDestroyed) {\n                    return;\n                }\n                _this.parent.trigger(events.actionComplete, actionArgs, function (onlineArgs) {\n                    if (!onlineArgs.cancel) {\n                        _this.parent.renderModule.refreshDataManager();\n                    }\n                });\n            }).catch(function (e) {\n                if (_this.parent.isDestroyed) {\n                    return;\n                }\n                _this.parent.trigger(events.actionFailure, { error: e });\n            });\n        }\n    };\n    Crud.prototype.addEvent = function (eventData) {\n        var _this = this;\n        if (this.parent.eventSettings.allowAdding) {\n            if (!this.isBlockEvent(eventData) &&\n                this.parent.eventBase.isBlockRange(eventData)) {\n                this.parent.quickPopup.openValidationError('blockAlert', (eventData instanceof Array) ? [eventData] : eventData);\n                return;\n            }\n            var addEvents = (eventData instanceof Array) ? eventData : [eventData];\n            var args = {\n                requestType: 'eventCreate', cancel: false,\n                addedRecords: addEvents, changedRecords: [], deletedRecords: []\n            };\n            if (!isBlazor()) {\n                args.data = addEvents;\n            }\n            this.parent.trigger(events.actionBegin, args, function (addArgs) {\n                _this.serializeData(addArgs.addedRecords);\n                if (!addArgs.cancel) {\n                    var fields = _this.parent.eventFields;\n                    var editParms = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                    var promise = void 0;\n                    if (addArgs.addedRecords instanceof Array) {\n                        for (var _i = 0, _a = addArgs.addedRecords; _i < _a.length; _i++) {\n                            var event_1 = _a[_i];\n                            editParms.addedRecords.push(_this.parent.eventBase.processTimezone(event_1, true));\n                        }\n                        // tslint:disable-next-line:max-line-length\n                        promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields.id, _this.getTable(), _this.getQuery());\n                    }\n                    else {\n                        var event_2 = _this.parent.eventBase.processTimezone(addArgs.addedRecords, true);\n                        editParms.addedRecords.push(event_2);\n                        promise = _this.parent.dataModule.dataManager.insert(event_2, _this.getTable(), _this.getQuery());\n                    }\n                    var crudArgs = {\n                        requestType: 'eventCreated', cancel: false, data: addArgs.addedRecords, promise: promise, editParms: editParms\n                    };\n                    _this.refreshData(crudArgs);\n                }\n            });\n        }\n    };\n    Crud.prototype.saveEvent = function (eventData, action) {\n        var _this = this;\n        if (this.parent.eventSettings.allowEditing) {\n            if (this.parent.currentAction !== 'EditFollowingEvents' && !this.isBlockEvent(eventData)\n                && this.parent.eventBase.isBlockRange(eventData)) {\n                this.parent.quickPopup.openValidationError('blockAlert', (eventData instanceof Array) ? [eventData] : eventData);\n                return;\n            }\n            this.parent.currentAction = action;\n            if (action) {\n                switch (action) {\n                    case 'EditOccurrence':\n                        this.processOccurrences(eventData, action);\n                        break;\n                    case 'EditFollowingEvents':\n                        this.processFollowSeries(eventData, action);\n                        break;\n                    case 'EditSeries':\n                        this.processEntireSeries(eventData, action);\n                        break;\n                }\n            }\n            else {\n                var updateEvents = (eventData instanceof Array) ? eventData : [eventData];\n                var args = {\n                    requestType: 'eventChange', cancel: false,\n                    addedRecords: [], changedRecords: updateEvents, deletedRecords: []\n                };\n                if (!isBlazor()) {\n                    args.data = eventData;\n                }\n                this.parent.trigger(events.actionBegin, args, function (saveArgs) {\n                    _this.serializeData(saveArgs.changedRecords);\n                    if (!saveArgs.cancel) {\n                        var promise = void 0;\n                        var fields = _this.parent.eventFields;\n                        var editParms = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                        if (saveArgs.changedRecords instanceof Array) {\n                            for (var _i = 0, _a = saveArgs.changedRecords; _i < _a.length; _i++) {\n                                var event_3 = _a[_i];\n                                editParms.changedRecords.push(_this.parent.eventBase.processTimezone(event_3, true));\n                            }\n                            // tslint:disable-next-line:max-line-length\n                            promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields.id, _this.getTable(), _this.getQuery());\n                        }\n                        else {\n                            var event_4 = _this.parent.eventBase.processTimezone(saveArgs.changedRecords, true);\n                            editParms.changedRecords.push(event_4);\n                            // tslint:disable-next-line:max-line-length\n                            promise = _this.parent.dataModule.dataManager.update(fields.id, event_4, _this.getTable(), _this.getQuery());\n                        }\n                        var crudArgs = {\n                            requestType: 'eventChanged', cancel: false, data: saveArgs.data, promise: promise, editParms: editParms\n                        };\n                        _this.refreshData(crudArgs);\n                    }\n                });\n            }\n        }\n    };\n    Crud.prototype.deleteEvent = function (eventData, action) {\n        var _this = this;\n        if (this.parent.eventSettings.allowDeleting) {\n            this.parent.currentAction = action;\n            var deleteEvents = [];\n            if (typeof eventData === 'string' || typeof eventData === 'number') {\n                deleteEvents = this.parent.eventsData.filter(function (eventObj) {\n                    return eventObj[_this.parent.eventFields.id] === eventData;\n                });\n            }\n            else {\n                deleteEvents = (eventData instanceof Array ? eventData : [eventData]);\n            }\n            if (action) {\n                switch (action) {\n                    case 'Delete':\n                        this.processEventDelete(deleteEvents);\n                        break;\n                    case 'DeleteOccurrence':\n                        this.processOccurrences(deleteEvents, action);\n                        break;\n                    case 'DeleteFollowingEvents':\n                        this.processFollowSeries(deleteEvents, action);\n                        break;\n                    case 'DeleteSeries':\n                        this.processEntireSeries(deleteEvents, action);\n                        break;\n                }\n            }\n            else {\n                var args = {\n                    requestType: 'eventRemove', cancel: false,\n                    addedRecords: [], changedRecords: [], deletedRecords: deleteEvents\n                };\n                if (!isBlazor()) {\n                    args.data = eventData;\n                }\n                this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n                    _this.serializeData(deleteArgs.deletedRecords);\n                    if (!deleteArgs.cancel) {\n                        var promise = void 0;\n                        var fields = _this.parent.eventFields;\n                        var editParms = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                        if (deleteArgs.deletedRecords.length > 1) {\n                            for (var _i = 0, _a = deleteArgs.deletedRecords; _i < _a.length; _i++) {\n                                var eventObj = _a[_i];\n                                editParms.deletedRecords.push(eventObj);\n                            }\n                            // tslint:disable-next-line:max-line-length\n                            promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields.id, _this.getTable(), _this.getQuery());\n                        }\n                        else {\n                            editParms.deletedRecords.push(deleteArgs.deletedRecords[0]);\n                            // tslint:disable-next-line:max-line-length\n                            promise = _this.parent.dataModule.dataManager.remove(fields.id, deleteArgs.deletedRecords[0], _this.getTable(), _this.getQuery());\n                        }\n                        _this.parent.eventBase.selectWorkCellByTime(deleteArgs.deletedRecords);\n                        var crudArgs = {\n                            requestType: 'eventRemoved', cancel: false, data: deleteArgs.data, promise: promise, editParms: editParms\n                        };\n                        _this.refreshData(crudArgs);\n                    }\n                });\n            }\n        }\n    };\n    Crud.prototype.processOccurrences = function (eventData, action) {\n        var _this = this;\n        var occurenceData = [];\n        if (eventData instanceof Array) {\n            for (var _i = 0, eventData_1 = eventData; _i < eventData_1.length; _i++) {\n                var event_5 = eventData_1[_i];\n                occurenceData.push({ occurrence: event_5, parent: this.getParentEvent(event_5) });\n            }\n        }\n        else {\n            occurenceData = { occurrence: eventData, parent: this.getParentEvent(eventData) };\n        }\n        var updateEvents = (eventData instanceof Array) ? eventData : [eventData];\n        var args = {\n            requestType: action === 'EditOccurrence' ? 'eventChange' : 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: updateEvents, deletedRecords: []\n        };\n        if (!isBlazor()) {\n            args.data = occurenceData;\n        }\n        this.parent.trigger(events.actionBegin, args, function (occurenceArgs) {\n            _this.serializeData(occurenceArgs.changedRecords);\n            if (!occurenceArgs.cancel) {\n                var fields = _this.parent.eventFields;\n                var editParms = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var occurrenceEvents = (occurenceData instanceof Array ? occurenceData : [occurenceData]);\n                var _loop_1 = function (a, count) {\n                    var childEvent = occurenceArgs.changedRecords[a];\n                    var parentEvent = occurrenceEvents[a].parent;\n                    var parentException = parentEvent[fields.recurrenceException];\n                    switch (action) {\n                        case 'EditOccurrence':\n                            var editedData = _this.parent.eventsProcessed.filter(function (event) { return event.Guid === childEvent.Guid; })[0];\n                            var exceptionDate = _this.excludeDateCheck(editedData[fields.startTime], parentException);\n                            if (exceptionDate !== parentEvent[fields.recurrenceException]) {\n                                parentEvent[fields.recurrenceException] = exceptionDate;\n                                childEvent[fields.recurrenceException] = getRecurrenceStringFromDate(editedData[fields.startTime]);\n                                childEvent[fields.recurrenceID] = parentEvent[fields.id];\n                                childEvent[fields.followingID] = null;\n                                editParms.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                                editParms.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            }\n                            else {\n                                editParms.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            }\n                            break;\n                        case 'DeleteOccurrence':\n                            if (!childEvent[fields.recurrenceException]) {\n                                parentEvent[fields.recurrenceException] =\n                                    _this.excludeDateCheck(childEvent[fields.startTime], parentException);\n                                editParms.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                            }\n                            if (childEvent[fields.id] !== parentEvent[fields.id]) {\n                                editParms.deletedRecords.push(childEvent);\n                            }\n                            break;\n                    }\n                };\n                for (var a = 0, count = occurenceArgs.changedRecords.length; a < count; a++) {\n                    _loop_1(a, count);\n                }\n                // tslint:disable-next-line:max-line-length\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields.id, _this.getTable(), _this.getQuery());\n                _this.parent.eventBase.selectWorkCellByTime(occurenceArgs.changedRecords);\n                var crudArgs = {\n                    requestType: action === 'EditOccurrence' ? 'eventChanged' : 'eventRemoved',\n                    cancel: false, data: occurenceArgs.data, promise: promise, editParms: editParms\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processFollowSeries = function (eventData, action) {\n        var _this = this;\n        var followData = [];\n        if (eventData instanceof Array) {\n            for (var _i = 0, eventData_2 = eventData; _i < eventData_2.length; _i++) {\n                var event_6 = eventData_2[_i];\n                followData.push({ occurrence: event_6, parent: this.getParentEvent(event_6) });\n            }\n        }\n        else {\n            followData = { occurrence: eventData, parent: this.getParentEvent(eventData) };\n        }\n        var updateFollowEvents = (eventData instanceof Array) ? eventData : [eventData];\n        var args = {\n            requestType: action === 'EditFollowingEvents' ? 'eventChange' : 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: updateFollowEvents, deletedRecords: []\n        };\n        if (!isBlazor()) {\n            args.data = followData;\n        }\n        this.parent.trigger(events.actionBegin, args, function (followArgs) {\n            _this.serializeData(followArgs.changedRecords);\n            if (!followArgs.cancel) {\n                var fields_1 = _this.parent.eventFields;\n                var editParms = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var followEvents = (followData instanceof Array ? followData : [followData]);\n                var _loop_2 = function (a, count) {\n                    var childEvent = followArgs.changedRecords[a];\n                    var parentEvent = followEvents[a].parent;\n                    var followData_1 = _this.parent.eventBase.getEventCollections(parentEvent, childEvent);\n                    switch (action) {\n                        case 'EditFollowingEvents':\n                            _this.processRecurrenceRule(parentEvent, childEvent);\n                            var isSplitted = !_this.parent.eventBase.isFollowingEvent(parentEvent, childEvent);\n                            childEvent[fields_1.followingID] = isSplitted ? null : parentEvent[fields_1.id];\n                            childEvent[fields_1.recurrenceID] = null;\n                            editParms.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            editParms.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                            if (!_this.parent.uiStateValues.isIgnoreOccurrence) {\n                                childEvent[fields_1.recurrenceException] = null;\n                                if (followData_1.occurrence.length > 0) {\n                                    var rule = followData_1.occurrence.slice(-1)[0][fields_1.recurrenceRule];\n                                    if (rule.indexOf('COUNT') === -1) {\n                                        childEvent[fields_1.recurrenceRule] = rule;\n                                    }\n                                }\n                                if (followData_1.follow.length > 0) {\n                                    childEvent[fields_1.recurrenceRule] =\n                                        followData_1.follow.slice(-1)[0][fields_1.recurrenceRule];\n                                    editParms.deletedRecords = editParms.deletedRecords.concat(followData_1.follow);\n                                }\n                                if (isSplitted) {\n                                    followData_1.occurrence = followData_1.occurrence.filter(function (eventObj) {\n                                        return eventObj[fields_1.recurrenceID] === childEvent[fields_1.id];\n                                    });\n                                }\n                                editParms.deletedRecords = editParms.deletedRecords.concat(followData_1.occurrence);\n                            }\n                            break;\n                        case 'DeleteFollowingEvents':\n                            _this.processRecurrenceRule(parentEvent, childEvent[fields_1.startTime]);\n                            editParms.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                            editParms.deletedRecords =\n                                editParms.deletedRecords.concat(followData_1.occurrence).concat(followData_1.follow);\n                            break;\n                    }\n                };\n                for (var a = 0, count = followArgs.changedRecords.length; a < count; a++) {\n                    _loop_2(a, count);\n                }\n                // tslint:disable-next-line:max-line-length\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields_1.id, _this.getTable(), _this.getQuery());\n                _this.parent.eventBase.selectWorkCellByTime(followArgs.changedRecords);\n                var crudArgs = {\n                    requestType: action === 'EditFollowingEvents' ? 'eventChanged' : 'eventRemoved',\n                    cancel: false, data: followArgs.data, promise: promise, editParms: editParms\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processEntireSeries = function (eventData, action) {\n        var _this = this;\n        var seriesData = [];\n        if (eventData instanceof Array) {\n            for (var _i = 0, eventData_3 = eventData; _i < eventData_3.length; _i++) {\n                var event_7 = eventData_3[_i];\n                seriesData.push(this.getParentEvent(event_7, true));\n            }\n        }\n        else {\n            seriesData = this.getParentEvent(eventData, true);\n        }\n        var updateSeriesEvents = (eventData instanceof Array) ? eventData : [eventData];\n        var args = {\n            requestType: action === 'EditSeries' ? 'eventChange' : 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: updateSeriesEvents, deletedRecords: []\n        };\n        if (!isBlazor()) {\n            args.data = seriesData;\n        }\n        this.parent.trigger(events.actionBegin, args, function (seriesArgs) {\n            _this.serializeData(seriesArgs.changedRecords);\n            if (!seriesArgs.cancel) {\n                var fields_2 = _this.parent.eventFields;\n                var editParms = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var seriesEvents = (seriesData instanceof Array ? seriesData : [seriesData]);\n                var _loop_3 = function (a, count) {\n                    var childEvent = seriesArgs.changedRecords[a];\n                    var parentEvent = seriesEvents[a];\n                    var eventCollections = _this.parent.eventBase.getEventCollections(parentEvent);\n                    var deletedEvents = eventCollections.follow.concat(eventCollections.occurrence);\n                    switch (action) {\n                        case 'EditSeries':\n                            if (childEvent[fields_2.startTime] > parentEvent[fields_2.startTime]) {\n                                _this.processRecurrenceRule(parentEvent, childEvent);\n                            }\n                            childEvent[fields_2.id] = parentEvent[fields_2.id];\n                            childEvent[fields_2.recurrenceID] = null;\n                            childEvent[fields_2.followingID] = null;\n                            if (_this.parent.uiStateValues.isIgnoreOccurrence && childEvent[fields_2.recurrenceException]) {\n                                var originalParent = _this.parent.eventsData.filter(function (eventObj) {\n                                    return eventObj[fields_2.id] === childEvent[fields_2.id];\n                                });\n                                if (originalParent.length > 0) {\n                                    childEvent[fields_2.recurrenceRule] = originalParent[0][fields_2.recurrenceRule];\n                                }\n                            }\n                            else {\n                                childEvent[fields_2.recurrenceException] = null;\n                                editParms.deletedRecords = editParms.deletedRecords.concat(deletedEvents);\n                            }\n                            editParms.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            _this.parent.uiStateValues.isIgnoreOccurrence = false;\n                            break;\n                        case 'DeleteSeries':\n                            editParms.deletedRecords = editParms.deletedRecords.concat(deletedEvents.concat(parentEvent));\n                            break;\n                    }\n                };\n                for (var a = 0, count = seriesArgs.changedRecords.length; a < count; a++) {\n                    _loop_3(a, count);\n                }\n                // tslint:disable-next-line:max-line-length\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields_2.id, _this.getTable(), _this.getQuery());\n                _this.parent.eventBase.selectWorkCellByTime(seriesArgs.changedRecords);\n                var crudArgs = {\n                    requestType: action === 'EditSeries' ? 'eventChanged' : 'eventRemoved',\n                    cancel: false, data: seriesArgs.data, promise: promise, editParms: editParms\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processEventDelete = function (eventData) {\n        var _this = this;\n        var deleteData = [];\n        for (var _i = 0, eventData_4 = eventData; _i < eventData_4.length; _i++) {\n            var eventObj = eventData_4[_i];\n            if (eventObj[this.parent.eventFields.recurrenceRule]) {\n                deleteData.push({ occurrence: eventObj, parent: this.getParentEvent(eventObj) });\n            }\n            else {\n                deleteData.push(eventObj);\n            }\n        }\n        var args = {\n            requestType: 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: [], deletedRecords: eventData\n        };\n        if (!isBlazor()) {\n            args.data = deleteData;\n        }\n        this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n            _this.serializeData(deleteArgs.deletedRecords);\n            if (!deleteArgs.cancel) {\n                var fields_3 = _this.parent.eventFields;\n                var editParms = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var _loop_4 = function (a, count) {\n                    var isDelete = isNullOrUndefined(deleteArgs.deletedRecords[a][_this.parent.eventFields.recurrenceRule]);\n                    if (!isDelete) {\n                        var parentEvent_1 = deleteData[a].parent;\n                        var isEdited = editParms.changedRecords.filter(function (obj) {\n                            return obj[fields_3.id] === parentEvent_1[fields_3.id];\n                        });\n                        var editedDate = deleteArgs.deletedRecords[a][fields_3.startTime];\n                        if (isEdited.length > 0) {\n                            var editedData = isEdited[0];\n                            editedData[fields_3.recurrenceException] =\n                                _this.excludeDateCheck(editedDate, editedData[fields_3.recurrenceException]);\n                        }\n                        else {\n                            parentEvent_1[fields_3.recurrenceException] =\n                                _this.excludeDateCheck(editedDate, parentEvent_1[fields_3.recurrenceException]);\n                        }\n                        if (isEdited.length === 0) {\n                            editParms.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent_1, true));\n                        }\n                        isDelete = (deleteArgs.deletedRecords[a][fields_3.id] !== parentEvent_1[fields_3.id]);\n                    }\n                    if (isDelete) {\n                        editParms.deletedRecords.push(deleteArgs.deletedRecords[a]);\n                    }\n                };\n                for (var a = 0, count = deleteArgs.deletedRecords.length; a < count; a++) {\n                    _loop_4(a, count);\n                }\n                // tslint:disable-next-line:max-line-length\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParms, fields_3.id, _this.getTable(), _this.getQuery());\n                var crudArgs = {\n                    requestType: 'eventRemoved', cancel: false, data: deleteArgs.data, promise: promise, editParms: editParms\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.serializeData = function (eventData) {\n        if (isBlazor()) {\n            var eventFields = this.parent.eventFields;\n            for (var _i = 0, _a = eventData; _i < _a.length; _i++) {\n                var event_8 = _a[_i];\n                event_8[eventFields.startTime] = this.parent.getDateTime(event_8[eventFields.startTime]);\n                event_8[eventFields.endTime] = this.parent.getDateTime(event_8[eventFields.endTime]);\n            }\n        }\n    };\n    Crud.prototype.getParentEvent = function (event, isParent) {\n        if (isParent === void 0) { isParent = false; }\n        var parentEvent = this.parent.eventBase.getParentEvent(event, isParent) || event;\n        if (parentEvent[this.parent.eventFields.startTimezone] || parentEvent[this.parent.eventFields.endTimezone]) {\n            this.parent.eventBase.timezoneConvert(parentEvent);\n        }\n        return parentEvent;\n    };\n    Crud.prototype.excludeDateCheck = function (eventStartTime, exceptionDateList) {\n        var exDate = getRecurrenceStringFromDate(eventStartTime);\n        if (!isNullOrUndefined(exceptionDateList)) {\n            if (exceptionDateList.indexOf(exDate) === -1) {\n                exceptionDateList = !(isNullOrUndefined(exceptionDateList)) ? exceptionDateList + ',' + exDate : exDate;\n            }\n        }\n        else {\n            exceptionDateList = exDate;\n        }\n        return exceptionDateList;\n    };\n    Crud.prototype.processRecurrenceRule = function (parentEvent, followEvent) {\n        var fields = this.parent.eventFields;\n        var recurrenceRule = parentEvent[fields.recurrenceRule];\n        var endDate;\n        if (followEvent instanceof Date) {\n            endDate = new Date(+followEvent);\n        }\n        else {\n            endDate = new Date(+followEvent[fields.startTime]);\n            var startDate = parentEvent[fields.startTime];\n            var ruleException = (this.parent.currentAction === 'DeleteFollowingEvents') ? followEvent[fields.recurrenceException] : null;\n            var dateCollection = generate(startDate, recurrenceRule, ruleException, this.parent.activeViewOptions.firstDayOfWeek);\n            var untilDate = new Date(dateCollection.slice(-1)[0]);\n            untilDate.setHours(endDate.getHours(), endDate.getMinutes(), endDate.getSeconds());\n            endDate.setHours(startDate.getHours(), startDate.getMinutes(), startDate.getSeconds());\n            followEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(recurrenceRule, new Date(+untilDate), false);\n        }\n        parentEvent[fields.recurrenceRule] =\n            this.getUpdatedRecurrenceRule(recurrenceRule, util.addDays(new Date(endDate.getTime()), -1), true);\n    };\n    Crud.prototype.getUpdatedRecurrenceRule = function (recurrenceRule, untilDate, isParent) {\n        var splitRule = recurrenceRule.split(';');\n        var updatedRule = '';\n        for (var _i = 0, splitRule_1 = splitRule; _i < splitRule_1.length; _i++) {\n            var rule = splitRule_1[_i];\n            if (rule !== '') {\n                var ruleKey = rule.split('=')[0];\n                var ruleValue = rule.split('=')[1];\n                if (ruleKey === 'COUNT' || ruleKey === 'UNTIL') {\n                    ruleValue = getRecurrenceStringFromDate(untilDate);\n                    rule = rule.replace(rule, 'UNTIL=' + ruleValue);\n                }\n                updatedRule += rule + ';';\n            }\n        }\n        if (isParent && updatedRule.indexOf('UNTIL') === -1) {\n            updatedRule += 'UNTIL=' + getRecurrenceStringFromDate(untilDate);\n        }\n        return updatedRule;\n    };\n    Crud.prototype.isBlockEvent = function (eventData) {\n        var _this = this;\n        var eventCollection = (eventData instanceof Array) ? eventData : [eventData];\n        var value = false;\n        eventCollection.forEach(function (event) {\n            value = event[_this.parent.eventFields.isBlock] || false;\n        });\n        return value;\n    };\n    return Crud;\n}());\nexport { Crud };\n"]},"metadata":{},"sourceType":"module"}