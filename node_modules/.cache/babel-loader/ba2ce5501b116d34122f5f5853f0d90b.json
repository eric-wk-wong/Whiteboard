{"ast":null,"code":"import { append, addClass, remove, isNullOrUndefined, setStyleAttribute, createElement } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\nimport * as util from '../base/util';\n/**\n * Virtual Scroll\n */\n\nvar VirtualScroll =\n/** @class */\nfunction () {\n  function VirtualScroll(parent) {\n    this.translateY = 0;\n    this.itemSize = 60;\n    this.bufferCount = 3;\n    this.renderedLength = 0;\n    this.averageRowHeight = 0;\n    this.parent = parent;\n    this.addEventListener();\n  }\n\n  VirtualScroll.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.virtualScroll, this.virtualScrolling, this);\n  };\n\n  VirtualScroll.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.virtualScroll, this.virtualScrolling);\n  };\n\n  VirtualScroll.prototype.getRenderedCount = function () {\n    this.setItemSize();\n    return Math.ceil(this.parent.element.clientHeight / this.itemSize) + this.bufferCount;\n  };\n\n  VirtualScroll.prototype.renderVirtualTrack = function (contentWrap) {\n    var wrap = createElement('div', {\n      className: cls.VIRTUAL_TRACK_CLASS\n    });\n    wrap.style.height = this.parent.resourceBase.expandedResources.length * this.itemSize + 'px';\n    contentWrap.appendChild(wrap);\n  };\n\n  VirtualScroll.prototype.updateVirtualScrollHeight = function () {\n    var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n    var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n    var lastRenderIndex = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n\n    if (lastRenderIndex !== lastResourceIndex) {\n      var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n      this.renderedLength = conTable.querySelector('tbody').children.length;\n      virtual.style.height = conTable.offsetHeight + (this.parent.resourceBase.expandedResources.length - this.renderedLength) * conTable.offsetHeight / this.renderedLength + 'px';\n    } else {\n      virtual.style.height = '';\n    }\n\n    this.averageRowHeight = virtual.offsetHeight / this.parent.resourceBase.expandedResources.length;\n  };\n\n  VirtualScroll.prototype.updateVirtualTrackHeight = function (wrap) {\n    var resourceCount = this.parent.resourceBase.renderedResources.length;\n\n    if (resourceCount !== this.getRenderedCount()) {\n      wrap.style.height = this.parent.element.querySelector('.e-content-wrap').clientHeight + 'px';\n      var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n      var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n      var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n      this.translateY = 0;\n      this.setTranslate(resWrap, conWrap, eventWrap);\n    } else {\n      var lastRenderIndex = this.parent.resourceBase.renderedResources[resourceCount - 1].groupIndex;\n      var lastCollIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n      var renderedResConut = resourceCount + (lastCollIndex - lastRenderIndex);\n      renderedResConut = renderedResConut > this.parent.resourceBase.expandedResources.length ? this.parent.resourceBase.expandedResources.length : renderedResConut;\n      wrap.style.height = renderedResConut * this.itemSize + 'px';\n    }\n  };\n\n  VirtualScroll.prototype.setItemSize = function () {\n    this.itemSize = util.getElementHeightFromClass(this.parent.activeView.element, cls.WORK_CELLS_CLASS) || this.itemSize;\n  };\n\n  VirtualScroll.prototype.virtualScrolling = function () {\n    this.parent.quickPopup.quickPopupHide();\n    this.parent.quickPopup.morePopup.hide();\n    var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n    var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n    var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n    var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n    this.renderedLength = resWrap.querySelector('tbody').children.length;\n    var firstTDIndex = parseInt(resWrap.querySelector('tbody td').getAttribute('data-group-index'), 10);\n    var scrollHeight = this.parent.rowAutoHeight ? conTable.offsetHeight - conWrap.offsetHeight : this.bufferCount * this.itemSize;\n    addClass([conWrap], 'e-transition');\n    var resCollection = [];\n\n    if (conWrap.scrollTop - this.translateY < 0) {\n      resCollection = this.upScroll(conWrap, firstTDIndex);\n    } else if (conWrap.scrollTop - this.translateY > scrollHeight) {\n      resCollection = this.downScroll(conWrap, firstTDIndex);\n    }\n\n    if (!isNullOrUndefined(resCollection) && resCollection.length > 0) {\n      this.updateContent(resWrap, conWrap, eventWrap, resCollection);\n      this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n      this.parent.notify(events.dataReady, {});\n\n      if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj.action === 'drag') {\n        this.parent.dragAndDropModule.navigationWrapper();\n      }\n    }\n  };\n\n  VirtualScroll.prototype.upScroll = function (conWrap, firstTDIndex) {\n    var index = ~~(conWrap.scrollTop / this.itemSize) + Math.ceil(conWrap.clientHeight / this.itemSize) - this.renderedLength;\n\n    if (this.parent.rowAutoHeight) {\n      index = index > firstTDIndex ? firstTDIndex - this.bufferCount : index;\n    }\n\n    index = index > 0 ? index : 0;\n    var prevSetCollection = this.getBufferCollection(index, index + this.renderedLength);\n    this.parent.resourceBase.renderedResources = prevSetCollection;\n\n    if (firstTDIndex === 0) {\n      this.translateY = conWrap.scrollTop;\n    } else {\n      var height = this.parent.rowAutoHeight ? this.averageRowHeight : this.itemSize;\n      this.translateY = conWrap.scrollTop - this.bufferCount * height > 0 ? conWrap.scrollTop - this.bufferCount * height : 0;\n    }\n\n    return prevSetCollection;\n  };\n\n  VirtualScroll.prototype.downScroll = function (conWrap, firstTDIndex) {\n    var lastResource = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n    var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n\n    if (lastResource === lastResourceIndex) {\n      return null;\n    }\n\n    var nextSetResIndex = ~~(conWrap.scrollTop / this.itemSize);\n\n    if (this.parent.rowAutoHeight) {\n      nextSetResIndex = ~~((conWrap.scrollTop - this.translateY) / this.averageRowHeight) + firstTDIndex;\n      nextSetResIndex = nextSetResIndex > firstTDIndex + this.bufferCount ? nextSetResIndex : firstTDIndex + this.bufferCount;\n    }\n\n    var lastIndex = nextSetResIndex + this.renderedLength;\n    lastIndex = lastIndex > this.parent.resourceBase.expandedResources.length ? nextSetResIndex + (this.parent.resourceBase.expandedResources.length - nextSetResIndex) : lastIndex;\n    var nextSetCollection = this.getBufferCollection(lastIndex - this.renderedLength, lastIndex);\n    this.translateY = conWrap.scrollTop;\n    return nextSetCollection;\n  };\n\n  VirtualScroll.prototype.updateContent = function (resWrap, conWrap, eventWrap, resCollection) {\n    var renderedLenth = resWrap.querySelector('tbody').children.length;\n\n    for (var i = 0; i < renderedLenth; i++) {\n      remove(resWrap.querySelector('tbody tr'));\n      remove(conWrap.querySelector('tbody tr'));\n      remove(eventWrap.querySelector('div'));\n    }\n\n    this.parent.resourceBase.renderedResources = resCollection;\n    var resourceRows = this.parent.resourceBase.getContentRows(resCollection);\n    var contentRows = this.parent.activeView.getContentRows();\n    var eventRows = this.parent.activeView.getEventRows(resCollection.length);\n    append(resourceRows, resWrap.querySelector('tbody'));\n    append(contentRows, conWrap.querySelector('tbody'));\n    append(eventRows, eventWrap);\n  };\n\n  VirtualScroll.prototype.getBufferCollection = function (startIndex, endIndex) {\n    return this.parent.resourceBase.expandedResources.slice(startIndex, endIndex);\n  };\n\n  VirtualScroll.prototype.setTranslate = function (resWrap, conWrap, eventWrap, timeIndicator) {\n    setStyleAttribute(resWrap.querySelector('table'), {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n    setStyleAttribute(conWrap.querySelector('table'), {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n    setStyleAttribute(eventWrap, {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n\n    if (!isNullOrUndefined(timeIndicator)) {\n      setStyleAttribute(timeIndicator, {\n        transform: \"translateY(\" + this.translateY + \"px)\"\n      });\n    }\n  };\n\n  VirtualScroll.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  return VirtualScroll;\n}();\n\nexport { VirtualScroll };","map":{"version":3,"sources":["/Users/jay/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/virtual-scroll.js"],"names":["append","addClass","remove","isNullOrUndefined","setStyleAttribute","createElement","events","cls","util","VirtualScroll","parent","translateY","itemSize","bufferCount","renderedLength","averageRowHeight","addEventListener","prototype","isDestroyed","on","virtualScroll","virtualScrolling","removeEventListener","off","getRenderedCount","setItemSize","Math","ceil","element","clientHeight","renderVirtualTrack","contentWrap","wrap","className","VIRTUAL_TRACK_CLASS","style","height","resourceBase","expandedResources","length","appendChild","updateVirtualScrollHeight","virtual","querySelector","lastResourceIndex","groupIndex","lastRenderIndex","renderedResources","conTable","CONTENT_TABLE_CLASS","children","offsetHeight","updateVirtualTrackHeight","resourceCount","resWrap","RESOURCE_COLUMN_WRAP_CLASS","conWrap","CONTENT_WRAP_CLASS","eventWrap","EVENT_TABLE_CLASS","setTranslate","lastCollIndex","renderedResConut","getElementHeightFromClass","activeView","WORK_CELLS_CLASS","quickPopup","quickPopupHide","morePopup","hide","timeIndicator","CURRENT_TIMELINE_CLASS","firstTDIndex","parseInt","getAttribute","scrollHeight","rowAutoHeight","resCollection","scrollTop","upScroll","downScroll","updateContent","notify","dataReady","dragAndDropModule","actionObj","action","navigationWrapper","index","prevSetCollection","getBufferCollection","lastResource","nextSetResIndex","lastIndex","nextSetCollection","renderedLenth","i","resourceRows","getContentRows","contentRows","eventRows","getEventRows","startIndex","endIndex","slice","transform","destroy"],"mappings":"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","sourcesContent":["import { append, addClass, remove, isNullOrUndefined, setStyleAttribute, createElement } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\nimport * as util from '../base/util';\n/**\n * Virtual Scroll\n */\nvar VirtualScroll = /** @class */ (function () {\n    function VirtualScroll(parent) {\n        this.translateY = 0;\n        this.itemSize = 60;\n        this.bufferCount = 3;\n        this.renderedLength = 0;\n        this.averageRowHeight = 0;\n        this.parent = parent;\n        this.addEventListener();\n    }\n    VirtualScroll.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.virtualScroll, this.virtualScrolling, this);\n    };\n    VirtualScroll.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.virtualScroll, this.virtualScrolling);\n    };\n    VirtualScroll.prototype.getRenderedCount = function () {\n        this.setItemSize();\n        return Math.ceil(this.parent.element.clientHeight / this.itemSize) + this.bufferCount;\n    };\n    VirtualScroll.prototype.renderVirtualTrack = function (contentWrap) {\n        var wrap = createElement('div', { className: cls.VIRTUAL_TRACK_CLASS });\n        wrap.style.height = (this.parent.resourceBase.expandedResources.length * this.itemSize) + 'px';\n        contentWrap.appendChild(wrap);\n    };\n    VirtualScroll.prototype.updateVirtualScrollHeight = function () {\n        var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n        var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n        var lastRenderIndex = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n        if (lastRenderIndex !== lastResourceIndex) {\n            var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n            this.renderedLength = conTable.querySelector('tbody').children.length;\n            virtual.style.height = (conTable.offsetHeight + (this.parent.resourceBase.expandedResources.length - (this.renderedLength)) *\n                conTable.offsetHeight / this.renderedLength) + 'px';\n        }\n        else {\n            virtual.style.height = '';\n        }\n        this.averageRowHeight = virtual.offsetHeight / this.parent.resourceBase.expandedResources.length;\n    };\n    VirtualScroll.prototype.updateVirtualTrackHeight = function (wrap) {\n        var resourceCount = this.parent.resourceBase.renderedResources.length;\n        if (resourceCount !== this.getRenderedCount()) {\n            wrap.style.height = this.parent.element.querySelector('.e-content-wrap').clientHeight + 'px';\n            var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n            var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n            this.translateY = 0;\n            this.setTranslate(resWrap, conWrap, eventWrap);\n        }\n        else {\n            var lastRenderIndex = this.parent.resourceBase.renderedResources[resourceCount - 1].groupIndex;\n            var lastCollIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n            var renderedResConut = resourceCount + (lastCollIndex - lastRenderIndex);\n            renderedResConut = (renderedResConut > this.parent.resourceBase.expandedResources.length) ?\n                this.parent.resourceBase.expandedResources.length : renderedResConut;\n            wrap.style.height = (renderedResConut * this.itemSize) + 'px';\n        }\n    };\n    VirtualScroll.prototype.setItemSize = function () {\n        this.itemSize = util.getElementHeightFromClass(this.parent.activeView.element, cls.WORK_CELLS_CLASS) || this.itemSize;\n    };\n    VirtualScroll.prototype.virtualScrolling = function () {\n        this.parent.quickPopup.quickPopupHide();\n        this.parent.quickPopup.morePopup.hide();\n        var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n        var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n        var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n        var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n        this.renderedLength = resWrap.querySelector('tbody').children.length;\n        var firstTDIndex = parseInt(resWrap.querySelector('tbody td').getAttribute('data-group-index'), 10);\n        var scrollHeight = (this.parent.rowAutoHeight) ?\n            (conTable.offsetHeight - conWrap.offsetHeight) : this.bufferCount * this.itemSize;\n        addClass([conWrap], 'e-transition');\n        var resCollection = [];\n        if ((conWrap.scrollTop) - this.translateY < 0) {\n            resCollection = this.upScroll(conWrap, firstTDIndex);\n        }\n        else if (conWrap.scrollTop - this.translateY > scrollHeight) {\n            resCollection = this.downScroll(conWrap, firstTDIndex);\n        }\n        if (!isNullOrUndefined(resCollection) && resCollection.length > 0) {\n            this.updateContent(resWrap, conWrap, eventWrap, resCollection);\n            this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n            this.parent.notify(events.dataReady, {});\n            if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj.action === 'drag') {\n                this.parent.dragAndDropModule.navigationWrapper();\n            }\n        }\n    };\n    VirtualScroll.prototype.upScroll = function (conWrap, firstTDIndex) {\n        var index = (~~(conWrap.scrollTop / this.itemSize) + Math.ceil(conWrap.clientHeight / this.itemSize)) - this.renderedLength;\n        if (this.parent.rowAutoHeight) {\n            index = (index > firstTDIndex) ? firstTDIndex - this.bufferCount : index;\n        }\n        index = (index > 0) ? index : 0;\n        var prevSetCollection = this.getBufferCollection(index, index + this.renderedLength);\n        this.parent.resourceBase.renderedResources = prevSetCollection;\n        if (firstTDIndex === 0) {\n            this.translateY = conWrap.scrollTop;\n        }\n        else {\n            var height = (this.parent.rowAutoHeight) ? this.averageRowHeight : this.itemSize;\n            this.translateY = (conWrap.scrollTop - (this.bufferCount * height) > 0) ?\n                conWrap.scrollTop - (this.bufferCount * height) : 0;\n        }\n        return prevSetCollection;\n    };\n    VirtualScroll.prototype.downScroll = function (conWrap, firstTDIndex) {\n        var lastResource = this.parent.resourceBase.\n            renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n        var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n        if (lastResource === lastResourceIndex) {\n            return null;\n        }\n        var nextSetResIndex = ~~(conWrap.scrollTop / this.itemSize);\n        if (this.parent.rowAutoHeight) {\n            nextSetResIndex = ~~((conWrap.scrollTop - this.translateY) / this.averageRowHeight) + firstTDIndex;\n            nextSetResIndex = (nextSetResIndex > firstTDIndex + this.bufferCount) ? nextSetResIndex : firstTDIndex + this.bufferCount;\n        }\n        var lastIndex = nextSetResIndex + this.renderedLength;\n        lastIndex = (lastIndex > this.parent.resourceBase.expandedResources.length) ?\n            nextSetResIndex + (this.parent.resourceBase.expandedResources.length - nextSetResIndex) : lastIndex;\n        var nextSetCollection = this.getBufferCollection(lastIndex - this.renderedLength, lastIndex);\n        this.translateY = conWrap.scrollTop;\n        return nextSetCollection;\n    };\n    VirtualScroll.prototype.updateContent = function (resWrap, conWrap, eventWrap, resCollection) {\n        var renderedLenth = resWrap.querySelector('tbody').children.length;\n        for (var i = 0; i < renderedLenth; i++) {\n            remove(resWrap.querySelector('tbody tr'));\n            remove(conWrap.querySelector('tbody tr'));\n            remove(eventWrap.querySelector('div'));\n        }\n        this.parent.resourceBase.renderedResources = resCollection;\n        var resourceRows = this.parent.resourceBase.getContentRows(resCollection);\n        var contentRows = this.parent.activeView.getContentRows();\n        var eventRows = this.parent.activeView.getEventRows(resCollection.length);\n        append(resourceRows, resWrap.querySelector('tbody'));\n        append(contentRows, conWrap.querySelector('tbody'));\n        append(eventRows, eventWrap);\n    };\n    VirtualScroll.prototype.getBufferCollection = function (startIndex, endIndex) {\n        return this.parent.resourceBase.expandedResources.slice(startIndex, endIndex);\n    };\n    VirtualScroll.prototype.setTranslate = function (resWrap, conWrap, eventWrap, timeIndicator) {\n        setStyleAttribute(resWrap.querySelector('table'), {\n            transform: \"translateY(\" + this.translateY + \"px)\"\n        });\n        setStyleAttribute(conWrap.querySelector('table'), {\n            transform: \"translateY(\" + this.translateY + \"px)\"\n        });\n        setStyleAttribute(eventWrap, {\n            transform: \"translateY(\" + this.translateY + \"px)\"\n        });\n        if (!isNullOrUndefined(timeIndicator)) {\n            setStyleAttribute(timeIndicator, {\n                transform: \"translateY(\" + this.translateY + \"px)\"\n            });\n        }\n    };\n    VirtualScroll.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    return VirtualScroll;\n}());\nexport { VirtualScroll };\n"]},"metadata":{},"sourceType":"module"}