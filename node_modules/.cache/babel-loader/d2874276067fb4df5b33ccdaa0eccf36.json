{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { createElement, closest, Draggable, extend, formatUnit, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { addClass, remove, removeClass, setStyleAttribute, isBlazor, getElement } from '@syncfusion/ej2-base';\nimport { ActionBase } from '../actions/action-base';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport { MonthEvent } from '../event-renderer/month';\nimport { TimelineEvent } from '../event-renderer/timeline-view';\nimport { VerticalEvent } from '../event-renderer/vertical-view';\nvar MINUTES_PER_DAY = 1440;\n/**\n * Schedule events drag actions\n */\n\nvar DragAndDrop =\n/** @class */\nfunction (_super) {\n  __extends(DragAndDrop, _super);\n\n  function DragAndDrop() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.widthUptoCursorPoint = 0;\n    _this.heightUptoCursorPoint = 0;\n    _this.cursorPointIndex = 0;\n    _this.isHeaderRows = false;\n    _this.isTimelineDayProcess = false;\n    _this.widthPerMinute = 0;\n    _this.heightPerMinute = 0;\n    _this.minDiff = 0;\n    _this.isStepDragging = false;\n    _this.isMorePopupOpened = false;\n    _this.isAllDayDrag = false;\n    return _this;\n  }\n\n  DragAndDrop.prototype.wireDragEvent = function (element) {\n    new Draggable(element, {\n      abort: '.' + cls.EVENT_RESIZE_CLASS,\n      clone: true,\n      isDragScroll: true,\n      enableTapHold: this.parent.isAdaptive,\n      enableTailMode: this.parent.eventDragArea ? true : false,\n      cursorAt: this.parent.eventDragArea ? {\n        left: -20,\n        top: -20\n      } : {\n        left: 0,\n        top: 0\n      },\n      dragArea: this.parent.eventDragArea ? document.querySelector(this.parent.eventDragArea) : this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS),\n      dragStart: this.dragStart.bind(this),\n      drag: this.drag.bind(this),\n      dragStop: this.dragStop.bind(this),\n      enableAutoScroll: false,\n      helper: this.dragHelper.bind(this),\n      queryPositionInfo: this.dragPosition.bind(this)\n    });\n  };\n\n  DragAndDrop.prototype.dragHelper = function (e) {\n    this.setDragActionDefaultValues();\n    this.actionObj.element = e.element;\n    this.actionObj.action = 'drag';\n    this.actionObj.clone = this.createCloneElement(this.actionObj.element);\n\n    if (!this.parent.eventDragArea && this.parent.currentView !== 'Month' && this.parent.timeScale.enable && !this.parent.activeView.isTimelineView() && !this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n      setStyleAttribute(this.actionObj.clone, {\n        cursor: 'move',\n        left: '0%',\n        right: '0%',\n        width: '100%'\n      });\n    }\n\n    this.actionObj.clone.style.top = formatUnit(this.actionObj.element.offsetTop);\n    this.actionObj.cloneElement = [this.actionObj.clone];\n    this.actionObj.originalElement = [this.actionObj.element];\n    return this.actionObj.clone;\n  };\n\n  DragAndDrop.prototype.dragPosition = function (e) {\n    if (this.parent.eventDragArea) {\n      return {\n        left: e.left,\n        top: e.top\n      };\n    }\n\n    var cellHeight = this.actionObj.cellHeight / this.actionObj.slotInterval * this.actionObj.interval;\n    var leftValue = formatUnit(0);\n\n    if (this.parent.currentView === 'Month') {\n      leftValue = e.left;\n    }\n\n    if (this.parent.activeView.isTimelineView()) {\n      leftValue = formatUnit(this.actionObj.clone.offsetLeft);\n    }\n\n    var topValue;\n\n    if (this.parent.activeView.isTimelineView() || !this.parent.timeScale.enable || !isNullOrUndefined(this.actionObj.clone.offsetParent) && this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n      topValue = formatUnit(this.actionObj.clone.offsetTop);\n    } else if (this.parent.currentView === 'Month') {\n      topValue = formatUnit(0);\n    } else if (this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n      topValue = formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop);\n      setStyleAttribute(this.actionObj.clone, {\n        width: formatUnit(Math.ceil(this.actionObj.clone.offsetWidth / this.actionObj.cellWidth) * this.actionObj.cellWidth),\n        right: this.parent.enableRtl && formatUnit(0)\n      });\n    } else {\n      if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) && !this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n        setStyleAttribute(this.actionObj.clone, {\n          height: formatUnit(this.actionObj.cellHeight),\n          width: formatUnit(this.actionObj.cellWidth - 1),\n          pointerEvents: 'none'\n        });\n      }\n\n      var top_1 = parseInt(e.top, 10);\n      top_1 = top_1 < 0 ? 0 : top_1;\n      topValue = formatUnit(Math.ceil(top_1 / cellHeight) * cellHeight);\n      var scrollHeight = this.parent.element.querySelector('.e-content-wrap').scrollHeight;\n      var cloneBottom = parseInt(topValue, 10) + this.actionObj.clone.offsetHeight;\n\n      if (cloneBottom > scrollHeight) {\n        topValue = parseInt(topValue, 10) - (cloneBottom - scrollHeight) + 'px';\n      }\n    }\n\n    return {\n      left: leftValue,\n      top: topValue\n    };\n  };\n\n  DragAndDrop.prototype.setDragActionDefaultValues = function () {\n    this.actionObj.action = 'drag';\n    this.actionObj.isAllDay = null;\n    this.actionObj.slotInterval = this.parent.activeViewOptions.timeScale.interval / this.parent.activeViewOptions.timeScale.slotCount;\n    this.actionObj.interval = this.actionObj.slotInterval;\n    var workCell = this.parent.element.querySelector('.' + cls.WORK_CELLS_CLASS);\n    this.actionObj.cellWidth = workCell.offsetWidth;\n    this.actionObj.cellHeight = workCell.offsetHeight;\n  };\n\n  DragAndDrop.prototype.dragStart = function (e) {\n    var _this = this;\n\n    var eventGuid = this.actionObj.element.getAttribute('data-guid');\n    this.actionObj.event = this.parent.eventBase.getEventByGuid(eventGuid);\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var dragArgs = {\n      cancel: false,\n      data: eventObj,\n      event: e,\n      excludeSelectors: null,\n      element: this.actionObj.element,\n      interval: this.actionObj.interval,\n      navigation: {\n        enable: false,\n        timeDelay: 2000\n      },\n      scroll: {\n        enable: true,\n        scrollBy: 30,\n        timeDelay: 100\n      }\n    };\n    this.parent.trigger(events.dragStart, dragArgs, function (dragEventArgs) {\n      if (dragEventArgs.cancel || !isNullOrUndefined(_this.actionObj.element) && isNullOrUndefined(_this.actionObj.element.parentElement)) {\n        var dragObj = _this.actionObj.element.ej2_instances[0];\n\n        if (!isNullOrUndefined(dragObj)) {\n          dragObj.intDestroy(e.event);\n        }\n\n        _this.actionObj.action = '';\n\n        _this.removeCloneElementClasses();\n\n        _this.removeCloneElement();\n\n        return;\n      } else if (isBlazor()) {\n        e.bindEvents(e.dragElement);\n\n        if (dragEventArgs.element) {\n          dragEventArgs.element = getElement(dragEventArgs.element);\n        }\n\n        dragEventArgs.data[_this.parent.eventFields.startTime] = _this.parent.getDateTime(dragEventArgs.data[_this.parent.eventFields.startTime]);\n        dragEventArgs.data[_this.parent.eventFields.endTime] = _this.parent.getDateTime(dragEventArgs.data[_this.parent.eventFields.endTime]);\n      }\n\n      _this.actionClass('addClass');\n\n      _this.parent.uiStateValues.action = true;\n      _this.actionObj.start = eventObj[_this.parent.eventFields.startTime];\n      _this.actionObj.end = eventObj[_this.parent.eventFields.endTime];\n      _this.actionObj.groupIndex = parseInt(_this.actionObj.element.getAttribute('data-group-index') || '0', 10);\n      _this.actionObj.interval = dragEventArgs.interval;\n      _this.actionObj.navigation = dragEventArgs.navigation;\n      _this.actionObj.scroll = dragEventArgs.scroll;\n      _this.actionObj.excludeSelectors = dragEventArgs.excludeSelectors;\n\n      var viewElement = _this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n\n      _this.scrollArgs = {\n        element: viewElement,\n        width: viewElement.scrollWidth,\n        height: viewElement.scrollHeight\n      };\n      _this.widthPerMinute = _this.actionObj.cellWidth / _this.actionObj.slotInterval * _this.actionObj.interval;\n      _this.heightPerMinute = _this.actionObj.cellHeight / _this.actionObj.slotInterval * _this.actionObj.interval;\n      _this.widthUptoCursorPoint = 0;\n      _this.heightUptoCursorPoint = 0;\n      _this.cursorPointIndex = -1;\n      _this.isHeaderRows = false;\n      _this.isTimelineDayProcess = false;\n      _this.minDiff = 0;\n      _this.isMorePopupOpened = false;\n      _this.daysVariation = -1;\n\n      if (_this.parent.activeView.isTimelineView() || !_this.parent.timeScale.enable) {\n        if (!isNullOrUndefined(_this.actionObj.clone.offsetParent) && _this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n          _this.isMorePopupOpened = true;\n        }\n\n        var rows = _this.parent.activeViewOptions.headerRows;\n        _this.isHeaderRows = rows.length > 0 && rows[rows.length - 1].option !== 'Hour' && rows[rows.length - 1].option !== 'Date';\n        _this.isTimelineDayProcess = !_this.parent.activeViewOptions.timeScale.enable || _this.isHeaderRows || _this.parent.currentView === 'TimelineMonth' || rows.length > 0 && rows[rows.length - 1].option === 'Date';\n        _this.isStepDragging = !_this.isTimelineDayProcess && _this.actionObj.slotInterval !== _this.actionObj.interval;\n\n        if (_this.isTimelineDayProcess) {\n          _this.timelineEventModule = new TimelineEvent(_this.parent, 'day');\n        } else {\n          _this.timelineEventModule = new TimelineEvent(_this.parent, 'hour');\n        }\n      }\n\n      if (_this.parent.currentView === 'Month') {\n        _this.updateOriginalElement(_this.actionObj.clone);\n\n        _this.monthEvent = new MonthEvent(_this.parent);\n      }\n\n      if (_this.parent.currentView === 'Day' || _this.parent.currentView === 'Week' || _this.parent.currentView === 'WorkWeek') {\n        _this.verticalEvent = new VerticalEvent(_this.parent);\n      }\n    });\n  };\n\n  DragAndDrop.prototype.drag = function (e) {\n    this.parent.quickPopup.quickPopupHide(true);\n\n    if (!isNullOrUndefined(e.target) && e.target.classList.contains(cls.DISABLE_DATES)) {\n      return;\n    }\n\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventArgs = this.getPageCoordinates(e);\n    this.actionObj.Y = this.actionObj.pageY = eventArgs.pageY;\n    this.actionObj.X = this.actionObj.pageX = eventArgs.pageX;\n    this.actionObj.target = e.target;\n    this.widthUptoCursorPoint = this.widthUptoCursorPoint === 0 ? Math.ceil(Math.abs(this.actionObj.clone.getBoundingClientRect().left - this.actionObj.X) / this.widthPerMinute) * this.widthPerMinute : this.widthUptoCursorPoint;\n    this.widthUptoCursorPoint = this.isMorePopupOpened ? this.actionObj.cellWidth : this.widthUptoCursorPoint;\n    this.heightUptoCursorPoint = this.heightUptoCursorPoint === 0 ? Math.ceil(Math.abs(this.actionObj.clone.getBoundingClientRect().top - this.actionObj.Y) / this.heightPerMinute) * this.heightPerMinute : this.heightUptoCursorPoint;\n    this.isAllDayDrag = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS);\n\n    if (this.isStepDragging && this.minDiff === 0) {\n      this.calculateMinutesDiff(eventObj);\n    }\n\n    if ((this.parent.currentView === 'Month' || this.isAllDayDrag) && this.daysVariation < 0) {\n      var date = this.parent.getDateFromElement(this.actionObj.target);\n\n      if (!isNullOrUndefined(date)) {\n        var currentDate = util.resetTime(date);\n        var startDate = util.resetTime(new Date(eventObj[this.parent.eventFields.startTime].getTime()));\n        this.daysVariation = (currentDate.getTime() - startDate.getTime()) / util.MS_PER_DAY;\n      } else {\n        this.daysVariation = 0;\n      }\n    }\n\n    if (this.parent.eventDragArea) {\n      var targetElement = eventArgs.target;\n      this.actionObj.clone.style.top = formatUnit(targetElement.offsetTop);\n      this.actionObj.clone.style.left = formatUnit(targetElement.offsetLeft);\n      var currentTarget = closest(targetElement, '.' + cls.ROOT);\n\n      if (!currentTarget) {\n        this.actionObj.clone.style.height = '';\n        this.actionObj.clone.style.width = '';\n      } else {\n        if (!(this.parent.currentView === 'Week' || this.parent.currentView === 'WorkWeek' || this.parent.currentView === 'Day')) {\n          this.actionObj.clone.style.width = formatUnit(this.actionObj.element.offsetWidth);\n        }\n      }\n    }\n\n    this.updateScrollPosition(e);\n    this.updateNavigatingPosition(e);\n    this.updateDraggingDateTime(e);\n    var dragArgs = {\n      data: eventObj,\n      event: e,\n      element: this.actionObj.element,\n      startTime: this.actionObj.start,\n      endTime: this.actionObj.end\n    };\n\n    if (this.parent.group.resources.length > 0) {\n      dragArgs.groupIndex = this.actionObj.groupIndex;\n    }\n\n    this.parent.trigger(events.drag, dragArgs);\n  };\n\n  DragAndDrop.prototype.calculateMinutesDiff = function (eventObj) {\n    if (this.parent.enableRtl) {\n      this.minDiff = (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint) / this.widthPerMinute * this.actionObj.interval;\n    } else {\n      this.minDiff = this.widthUptoCursorPoint / this.widthPerMinute * this.actionObj.interval;\n    }\n\n    var startDate = eventObj[this.parent.eventFields.startTime];\n    var startTime = this.parent.activeView.renderDates[0];\n    var startEndHours = util.getStartEndHours(startTime, this.parent.activeView.getStartHour(), this.parent.activeView.getEndHour());\n\n    if (startEndHours.startHour.getTime() > startDate.getTime()) {\n      this.minDiff = this.minDiff + (startEndHours.startHour.getTime() - startDate.getTime()) / util.MS_PER_MINUTE;\n    }\n  };\n\n  DragAndDrop.prototype.dragStop = function (e) {\n    var _this = this;\n\n    this.removeCloneElementClasses();\n    this.removeCloneElement();\n    clearInterval(this.actionObj.navigationInterval);\n    this.actionObj.navigationInterval = null;\n    clearInterval(this.actionObj.scrollInterval);\n    this.actionObj.scrollInterval = null;\n    this.actionClass('removeClass');\n    this.parent.uiStateValues.action = false;\n    this.actionObj.action = null;\n\n    if (this.isAllowDrop(e)) {\n      return;\n    }\n\n    var dragArgs = {\n      cancel: false,\n      data: this.getChangedData(),\n      event: e,\n      element: this.actionObj.element,\n      target: e.target\n    };\n    this.parent.trigger(events.dragStop, dragArgs, function (dragEventArgs) {\n      if (dragEventArgs.cancel) {\n        return;\n      }\n\n      _this.saveChangedData(dragEventArgs);\n    });\n  };\n\n  DragAndDrop.prototype.updateNavigatingPosition = function (e) {\n    var _this = this;\n\n    if (this.actionObj.navigation.enable) {\n      var currentDate_1 = this.parent.getCurrentTime();\n\n      if (isNullOrUndefined(this.actionObj.navigationInterval)) {\n        this.actionObj.navigationInterval = window.setInterval(function () {\n          if (currentDate_1) {\n            var crtDate = _this.parent.getCurrentTime();\n\n            var end = crtDate.getSeconds();\n            var start = currentDate_1.getSeconds() + _this.actionObj.navigation.timeDelay / 1000;\n            start = start >= 60 ? start - 60 : start;\n\n            if (start === end) {\n              currentDate_1 = _this.parent.getCurrentTime();\n\n              _this.viewNavigation(e);\n\n              _this.updateDraggingDateTime(e);\n            }\n          }\n        }, this.actionObj.navigation.timeDelay);\n      }\n    }\n  };\n\n  DragAndDrop.prototype.updateDraggingDateTime = function (e) {\n    if (!isNullOrUndefined(this.actionObj.clone.offsetParent) && this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n      this.morePopupEventDragging(e);\n    } else if (this.parent.activeView.isTimelineView()) {\n      this.timelineEventModule.dateRender = this.parent.activeView.renderDates;\n      this.timelineEventModule.cellWidth = this.actionObj.cellWidth;\n      this.timelineEventModule.getSlotDates();\n      this.actionObj.cellWidth = this.isHeaderRows ? this.timelineEventModule.cellWidth : this.actionObj.cellWidth;\n      this.calculateTimelineTime(e);\n    } else {\n      if (this.parent.currentView === 'Month') {\n        this.calculateVerticalDate(e);\n      } else {\n        this.calculateVerticalTime(e);\n      }\n    }\n  };\n\n  DragAndDrop.prototype.navigationWrapper = function () {\n    if (!this.parent.activeView.isTimelineView()) {\n      if (this.parent.currentView === 'Month' || !this.parent.timeScale.enable) {\n        var outerWrapperCls = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n        this.actionObj.index = this.parent.activeView.renderDates.length < this.actionObj.index ? this.parent.activeView.renderDates.length - 1 : this.actionObj.index;\n        var targetWrapper = outerWrapperCls[this.actionObj.index].querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n        if (!targetWrapper) {\n          targetWrapper = createElement('div', {\n            className: cls.APPOINTMENT_WRAPPER_CLASS\n          });\n          outerWrapperCls[this.actionObj.index].appendChild(targetWrapper);\n        }\n\n        targetWrapper.appendChild(this.actionObj.clone);\n      } else {\n        var wrapperClass = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) ? '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n        this.parent.element.querySelectorAll(wrapperClass).item(this.actionObj.index).appendChild(this.actionObj.clone);\n\n        if (wrapperClass === '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS) {\n          var elementHeight_1 = this.getAllDayEventHeight();\n          var event_1 = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n\n          if (event_1[0].offsetHeight < elementHeight_1) {\n            event_1.forEach(function (element) {\n              return element.style.height = (elementHeight_1 + 2) / 12 + 'em';\n            });\n          }\n\n          this.actionObj.clone.style.height = formatUnit(elementHeight_1);\n        }\n\n        this.actionObj.height = parseInt(this.actionObj.clone.style.height, 0);\n      }\n    } else {\n      var outWrapper = void 0;\n\n      if (this.parent.activeViewOptions.group.resources.length > 0) {\n        outWrapper = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(this.actionObj.index);\n      } else {\n        outWrapper = this.parent.element.querySelector('.' + cls.APPOINTMENT_CONTAINER_CLASS);\n      }\n\n      var tarWrapper = outWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n      if (!tarWrapper) {\n        tarWrapper = createElement('div', {\n          className: cls.APPOINTMENT_WRAPPER_CLASS\n        });\n        outWrapper.appendChild(tarWrapper);\n      }\n\n      tarWrapper.appendChild(this.actionObj.clone);\n    }\n  };\n\n  DragAndDrop.prototype.viewNavigation = function (e) {\n    var navigationType;\n    var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n\n    if (dragArea && (!this.scrollEdges.top && !this.scrollEdges.bottom || closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS))) {\n      if (dragArea.scrollLeft === 0 && Math.round(this.actionObj.X) <= Math.round(dragArea.getBoundingClientRect().left + this.actionObj.cellWidth + window.pageXOffset)) {\n        navigationType = this.parent.enableRtl ? 'next' : 'previous';\n      } else if (Math.round(dragArea.scrollLeft) + dragArea.clientWidth === dragArea.scrollWidth && Math.round(this.actionObj.X) >= Math.round(dragArea.getBoundingClientRect().right - this.actionObj.cellWidth + window.pageXOffset)) {\n        navigationType = this.parent.enableRtl ? 'previous' : 'next';\n      }\n\n      if (navigationType) {\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate(navigationType));\n      }\n    }\n  };\n\n  DragAndDrop.prototype.morePopupEventDragging = function (e) {\n    if (isNullOrUndefined(e.target) || e.target && isNullOrUndefined(closest(e.target, 'td'))) {\n      return;\n    }\n\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() - eventObj[this.parent.eventFields.startTime].getTime();\n    var td = closest(e.target, 'td');\n    var dragStart = this.parent.getDateFromElement(td);\n    var dragEnd = new Date(dragStart.getTime());\n    dragEnd.setMilliseconds(eventDuration);\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n    }\n\n    this.actionObj.start = new Date(dragStart.getTime());\n    this.actionObj.end = new Date(dragEnd.getTime());\n    this.actionObj.clone.style.top = formatUnit(td.offsetParent.offsetTop);\n    this.actionObj.clone.style.left = formatUnit(td.offsetLeft);\n    this.actionObj.clone.style.width = formatUnit(td.offsetWidth);\n    var eventContainer = td;\n    var eventWrapper;\n\n    if (this.parent.activeView.isTimelineView()) {\n      var rowIndex = closest(td, 'tr').rowIndex;\n      eventContainer = this.parent.element.querySelectorAll('.e-appointment-container').item(rowIndex);\n    }\n\n    eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n    if (!eventWrapper) {\n      eventWrapper = createElement('div', {\n        className: cls.APPOINTMENT_WRAPPER_CLASS\n      });\n      eventContainer.appendChild(eventWrapper);\n    }\n\n    this.appendCloneElement(eventWrapper);\n  };\n\n  DragAndDrop.prototype.calculateVerticalTime = function (e) {\n    if (isNullOrUndefined(this.actionObj.target) || this.actionObj.target && isNullOrUndefined(closest(this.actionObj.target, 'tr')) || !closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS) && !closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      return;\n    }\n\n    if (this.parent.activeViewOptions.timeScale.enable) {\n      this.swapDragging(e);\n    }\n\n    var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventStart = eventObj[this.parent.eventFields.startTime];\n    var eventEnd = eventObj[this.parent.eventFields.endTime];\n    var eventDuration = eventEnd.getTime() - eventStart.getTime();\n    var offsetTop = Math.floor(parseInt(this.actionObj.clone.style.top, 10) / this.actionObj.cellHeight) * this.actionObj.cellHeight;\n    offsetTop = offsetTop < 0 ? 0 : offsetTop;\n\n    if (this.scrollEdges.top || this.scrollEdges.bottom) {\n      offsetTop = this.scrollEdges.top ? dragArea.scrollTop - this.heightUptoCursorPoint + this.actionObj.cellHeight : dragArea.scrollTop + dragArea.offsetHeight - this.actionObj.clone.offsetHeight + (this.actionObj.clone.offsetHeight - this.heightUptoCursorPoint);\n      offsetTop = Math.round(offsetTop / this.actionObj.cellHeight) * this.actionObj.cellHeight;\n      this.actionObj.clone.style.top = formatUnit(offsetTop);\n    }\n\n    var rowIndex = offsetTop / this.actionObj.cellHeight;\n    var heightPerMinute = this.actionObj.cellHeight / this.actionObj.slotInterval;\n    var diffInMinutes = parseInt(this.actionObj.clone.style.top, 10) - offsetTop;\n    var tr;\n\n    if (this.isAllDayDrag) {\n      tr = this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS);\n    } else {\n      var trCollections = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n      tr = trCollections[rowIndex];\n    }\n\n    var index;\n\n    if (closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS) || closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      index = closest(this.actionObj.target, 'td').cellIndex;\n    }\n\n    var colIndex = isNullOrUndefined(index) ? closest(this.actionObj.clone, 'td').cellIndex : index;\n    this.actionObj.index = colIndex;\n\n    if (isNullOrUndefined(tr)) {\n      return;\n    }\n\n    var td = tr.children[colIndex];\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n    }\n\n    var dragStart;\n    var dragEnd;\n\n    if (this.parent.activeViewOptions.timeScale.enable && !this.isAllDayDrag) {\n      this.appendCloneElement(this.getEventWrapper(colIndex));\n      dragStart = this.parent.getDateFromElement(td);\n      dragStart.setMinutes(dragStart.getMinutes() + diffInMinutes / heightPerMinute);\n      dragEnd = new Date(dragStart.getTime());\n\n      if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n        dragEnd.setMinutes(dragEnd.getMinutes() + this.actionObj.slotInterval);\n      } else {\n        dragEnd.setMilliseconds(eventDuration);\n      }\n    } else {\n      dragStart = this.parent.getDateFromElement(td);\n      dragStart.setDate(dragStart.getDate() - this.daysVariation);\n      dragStart.setHours(eventStart.getHours(), eventStart.getMinutes(), eventStart.getSeconds());\n      dragEnd = new Date(dragStart.getTime());\n      dragEnd.setMilliseconds(eventDuration);\n\n      if (!this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) && this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n        dragEnd = util.addDays(util.resetTime(dragEnd), 1);\n      }\n\n      this.updateAllDayEvents(dragStart, dragEnd, this.parent.activeViewOptions.group.byDate ? colIndex : undefined);\n    }\n\n    this.actionObj.start = new Date(+dragStart);\n    this.actionObj.end = new Date(+dragEnd);\n    var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n    this.updateEventHeight(event);\n    this.updateTimePosition(this.actionObj.start);\n  };\n\n  DragAndDrop.prototype.updateEventHeight = function (event) {\n    this.verticalEvent.initializeValues();\n    var datesCount = 0;\n\n    for (var i = 0; i < this.actionObj.groupIndex; i++) {\n      datesCount = datesCount + this.verticalEvent.dateRender[i].length;\n    }\n\n    var dayIndex = !this.parent.activeViewOptions.group.byDate ? this.actionObj.index - datesCount : this.parent.getIndexOfDate(this.verticalEvent.dateRender[this.actionObj.groupIndex], util.resetTime(this.parent.getDateFromElement(this.actionObj.target)));\n    var record = this.verticalEvent.isSpannedEvent(event, dayIndex, this.actionObj.groupIndex);\n    var eStart = record[this.verticalEvent.fields.startTime];\n    var eEnd = record[this.verticalEvent.fields.endTime];\n    var topValue = 0;\n    var appHeight = this.verticalEvent.getHeight(eStart, eEnd);\n    topValue = this.verticalEvent.getTopValue(eStart, dayIndex, this.actionObj.groupIndex);\n    this.actionObj.clone.style.top = formatUnit(topValue);\n    this.actionObj.clone.style.height = formatUnit(appHeight);\n  };\n\n  DragAndDrop.prototype.updateAllDayEvents = function (startDate, endDate, colIndex) {\n    var _this = this;\n\n    this.parent.eventBase.slots = [];\n    var event = this.getUpdatedEvent(startDate, endDate, this.actionObj.event);\n    var renderDates = this.parent.activeView.renderDates;\n    this.parent.eventBase.slots.push(this.parent.activeView.renderDates.map(function (date) {\n      return +date;\n    }));\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.parent.eventBase.slots = [];\n      var resources = this.parent.resourceBase.lastResourceLevel.filter(function (res) {\n        return res.groupIndex === _this.actionObj.groupIndex;\n      });\n      renderDates = resources[0].renderDates;\n      this.parent.eventBase.slots.push(renderDates.map(function (date) {\n        return +date;\n      }));\n    }\n\n    var events = this.parent.eventBase.splitEvent(event, renderDates);\n    var query = '.e-all-day-cells[data-date=\"' + this.parent.getMsFromDate(events[0][this.parent.eventFields.startTime]) + '\"]';\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      query = query.concat('[data-group-index = \"' + this.actionObj.groupIndex + '\"]');\n    }\n\n    var cell = [].slice.call(this.parent.element.querySelectorAll(query));\n\n    if (cell.length > 0 || !isNullOrUndefined(colIndex)) {\n      var cellIndex = !isNullOrUndefined(colIndex) ? colIndex : cell[0].cellIndex;\n      this.appendCloneElement(this.getEventWrapper(cellIndex));\n      this.actionObj.clone.style.width = formatUnit(events[0].data.count * this.actionObj.cellWidth);\n    }\n  };\n\n  DragAndDrop.prototype.swapDragging = function (e) {\n    var colIndex = closest(this.actionObj.target, 'td').cellIndex;\n\n    if (closest(this.actionObj.target, '.' + cls.DATE_HEADER_WRAP_CLASS) && !closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS)) {\n      addClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n      this.appendCloneElement(this.getEventWrapper(colIndex));\n      this.actionObj.isAllDay = true;\n      var eventHeight_1 = this.getAllDayEventHeight();\n      var allDayElement = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n\n      if (allDayElement[0].offsetHeight < eventHeight_1) {\n        allDayElement.forEach(function (element) {\n          return element.style.height = (eventHeight_1 + 2) / 12 + 'em';\n        });\n      }\n\n      setStyleAttribute(this.actionObj.clone, {\n        width: formatUnit(this.actionObj.cellWidth),\n        height: formatUnit(eventHeight_1),\n        top: formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop)\n      });\n    }\n\n    if (closest(this.actionObj.target, '.' + cls.WORK_CELLS_CLASS) && !closest(this.actionObj.clone, '.' + cls.DAY_WRAPPER_CLASS)) {\n      removeClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n      this.appendCloneElement(this.getEventWrapper(colIndex));\n      this.actionObj.isAllDay = false;\n      var height = this.actionObj.element.offsetHeight === 0 ? this.actionObj.height : this.actionObj.element.offsetHeight;\n      setStyleAttribute(this.actionObj.clone, {\n        left: formatUnit(0),\n        height: formatUnit(height),\n        width: formatUnit(this.actionObj.cellWidth)\n      });\n    }\n  };\n\n  DragAndDrop.prototype.calculateVerticalDate = function (e) {\n    if (isNullOrUndefined(e.target) || e.target && isNullOrUndefined(closest(e.target, 'tr')) || e.target && e.target.tagName === 'DIV') {\n      return;\n    }\n\n    this.removeCloneElement();\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() - eventObj[this.parent.eventFields.startTime].getTime();\n    var td = closest(this.actionObj.target, 'td');\n\n    if (!isNullOrUndefined(td)) {\n      var tr = td.parentElement;\n      this.actionObj.index = tr.rowIndex * tr.children.length + td.cellIndex;\n      var workCells = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n      td = workCells[this.actionObj.index];\n      var currentDate = this.parent.getDateFromElement(td);\n\n      if (!isNullOrUndefined(currentDate)) {\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n          this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n        }\n\n        var timeString = new Date(currentDate.setDate(currentDate.getDate() - this.daysVariation));\n        var dragStart = new Date(timeString.getTime());\n        var dragEnd = new Date(dragStart.getTime());\n        var startTimeDiff = eventObj[this.parent.eventFields.startTime].getTime() - util.resetTime(new Date(+eventObj[this.parent.eventFields.startTime])).getTime();\n        dragStart = new Date(dragStart.getTime() + startTimeDiff);\n        dragEnd = new Date(dragStart.getTime() + eventDuration);\n        this.actionObj.start = new Date(dragStart.getTime());\n        this.actionObj.end = new Date(dragEnd.getTime());\n      }\n    }\n\n    var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n    this.dynamicEventsRendering(event);\n  };\n\n  DragAndDrop.prototype.calculateTimelineTime = function (e) {\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() - eventObj[this.parent.eventFields.startTime].getTime();\n    var offsetLeft = this.parent.enableRtl ? Math.abs(this.actionObj.clone.offsetLeft) - this.actionObj.clone.offsetWidth : parseInt(this.actionObj.clone.style.left, 10);\n    offsetLeft = Math.floor(offsetLeft / this.actionObj.cellWidth) * this.actionObj.cellWidth;\n    var rightOffset;\n\n    if (this.parent.enableRtl) {\n      rightOffset = Math.abs(parseInt(this.actionObj.clone.style.right, 10));\n      this.actionObj.clone.style.right = formatUnit(rightOffset);\n    }\n\n    offsetLeft = this.getOffsetValue(offsetLeft, rightOffset);\n    var colIndex = this.getColumnIndex(offsetLeft);\n    var cloneIndex = Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().left) / this.actionObj.cellWidth);\n\n    if (this.parent.enableRtl) {\n      cloneIndex = Math.abs(Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().right) / this.actionObj.cellWidth)) - 1;\n    }\n\n    if (this.cursorPointIndex < 0) {\n      this.cursorIndex(e, eventObj, offsetLeft, cloneIndex);\n    }\n\n    var tr = this.parent.getContentTable().querySelector('tr');\n    var index = this.getCursorCurrentIndex(colIndex, cloneIndex, tr);\n    index = index < 0 ? 0 : index;\n    var eventStart = this.isHeaderRows ? new Date(this.timelineEventModule.dateRender[index].getTime()) : this.parent.getDateFromElement(tr.children[index]);\n\n    if (this.isStepDragging) {\n      var widthDiff = this.getWidthDiff(tr, index);\n\n      if (widthDiff !== 0) {\n        var timeDiff = Math.round(widthDiff / this.widthPerMinute);\n        eventStart.setMinutes(eventStart.getMinutes() + timeDiff * this.actionObj.interval);\n        eventStart.setMinutes(eventStart.getMinutes() - this.minDiff);\n      } else {\n        eventStart = this.actionObj.start;\n      }\n    } else {\n      eventStart.setMinutes(eventStart.getMinutes() - this.cursorPointIndex * (this.isTimelineDayProcess ? MINUTES_PER_DAY : this.actionObj.slotInterval));\n    }\n\n    eventStart = this.calculateIntervalTime(eventStart);\n\n    if (this.isTimelineDayProcess) {\n      var eventSrt = eventObj[this.parent.eventFields.startTime];\n      eventStart.setHours(eventSrt.getHours(), eventSrt.getMinutes(), eventSrt.getSeconds());\n    }\n\n    var eventEnd = new Date(eventStart.getTime());\n    eventEnd.setMilliseconds(eventDuration);\n    var event = this.getUpdatedEvent(eventStart, eventEnd, this.actionObj.event);\n    var events = this.timelineEventModule.splitEvent(event, this.timelineEventModule.dateRender);\n    var eventData = events[0].data;\n    var startTime = this.timelineEventModule.getStartTime(events[0], eventData);\n    var endTime = this.timelineEventModule.getEndTime(events[0], eventData);\n    var width = this.timelineEventModule.getEventWidth(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], eventData.count);\n    var day = this.parent.getIndexOfDate(this.timelineEventModule.dateRender, util.resetTime(new Date(startTime.getTime())));\n    day = day < 0 ? 0 : day;\n    var left = this.timelineEventModule.getPosition(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], day);\n\n    if (this.parent.enableRtl) {\n      this.actionObj.clone.style.right = formatUnit(left);\n    } else {\n      this.actionObj.clone.style.left = formatUnit(left);\n    }\n\n    if (!this.isMorePopupOpened) {\n      this.actionObj.clone.style.width = formatUnit(width);\n    }\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.calculateResourceGroupingPosition(e);\n    }\n\n    this.actionObj.start = new Date(eventStart.getTime());\n    this.actionObj.end = new Date(eventEnd.getTime());\n    this.updateTimePosition(this.actionObj.start);\n  };\n\n  DragAndDrop.prototype.getOffsetValue = function (offsetLeft, rightOffset) {\n    if (this.scrollEdges.left || this.scrollEdges.right) {\n      var viewEle = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n\n      if (this.parent.enableRtl) {\n        rightOffset = viewEle.offsetWidth - viewEle.scrollLeft;\n\n        if (this.scrollEdges.right) {\n          rightOffset = rightOffset - viewEle.offsetWidth + this.actionObj.clone.offsetWidth - (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n        } else {\n          rightOffset = rightOffset + this.widthUptoCursorPoint;\n\n          if (rightOffset - this.widthUptoCursorPoint >= viewEle.scrollWidth) {\n            this.actionObj.clone.style.width = formatUnit(this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint + this.actionObj.cellWidth);\n            rightOffset = viewEle.scrollLeft - viewEle.scrollWidth;\n          }\n        }\n\n        this.actionObj.clone.style.left = formatUnit(rightOffset);\n      } else {\n        if (this.scrollEdges.left) {\n          offsetLeft = viewEle.scrollLeft - this.widthUptoCursorPoint + this.actionObj.cellWidth;\n\n          if (viewEle.scrollLeft + viewEle.offsetWidth >= viewEle.offsetWidth) {\n            viewEle.scrollLeft = viewEle.scrollLeft - 1;\n          } else if (this.actionObj.clone.offsetLeft === 0) {\n            offsetLeft = viewEle.scrollLeft;\n          }\n        } else {\n          offsetLeft = viewEle.scrollLeft + viewEle.offsetWidth - this.actionObj.clone.offsetWidth + (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n        }\n\n        offsetLeft = offsetLeft < 0 ? 0 : offsetLeft;\n        this.actionObj.clone.style.left = formatUnit(offsetLeft);\n      }\n    }\n\n    return offsetLeft;\n  };\n\n  DragAndDrop.prototype.getWidthDiff = function (tr, index) {\n    var pages = this.scrollArgs.element.getBoundingClientRect();\n\n    if (pages.left <= this.actionObj.pageX && pages.right >= this.actionObj.pageX) {\n      var targetLeft = tr.children[index].offsetLeft;\n      var pageX = this.actionObj.pageX - pages.left;\n\n      if (this.parent.enableRtl) {\n        return targetLeft + this.actionObj.cellWidth - (this.scrollArgs.element.scrollLeft + pageX);\n      } else {\n        return this.scrollArgs.element.scrollLeft + pageX - targetLeft;\n      }\n    }\n\n    return 0;\n  };\n\n  DragAndDrop.prototype.getColumnIndex = function (offsetLeft) {\n    var index = Math.floor(offsetLeft / this.actionObj.cellWidth);\n\n    if (this.isHeaderRows) {\n      return index;\n    }\n\n    return this.getIndex(index);\n  };\n\n  DragAndDrop.prototype.getCursorCurrentIndex = function (colIndex, cloneIndex, tr) {\n    var index = colIndex + cloneIndex;\n\n    if (this.isHeaderRows) {\n      var dateLength = Math.floor(tr.offsetWidth / this.actionObj.cellWidth);\n      return index > dateLength - 1 ? dateLength - 1 : index;\n    }\n\n    return index > tr.children.length - 1 ? tr.children.length - 1 : index;\n  };\n\n  DragAndDrop.prototype.cursorIndex = function (e, event, left, index) {\n    var td = closest(e.target, '.e-work-cells');\n\n    if (!isNullOrUndefined(td) && !this.isMorePopupOpened) {\n      var targetDate = this.parent.getDateFromElement(td);\n\n      if (this.isHeaderRows) {\n        var currentIndex = Math.floor(left / this.actionObj.cellWidth);\n        targetDate = new Date(this.timelineEventModule.dateRender[currentIndex + index].getTime());\n      }\n\n      var timeDiff = targetDate.getTime() - event[this.parent.eventFields.startTime].getTime();\n\n      if (this.isTimelineDayProcess) {\n        this.cursorPointIndex = Math.abs(Math.ceil(timeDiff / util.MS_PER_DAY));\n      } else {\n        var widthDiff = Math.floor(timeDiff / util.MS_PER_MINUTE / (this.actionObj.slotInterval / this.actionObj.cellWidth));\n        this.cursorPointIndex = Math.floor(widthDiff / this.actionObj.cellWidth);\n        this.cursorPointIndex = this.cursorPointIndex < 0 ? 0 : this.cursorPointIndex;\n      }\n    } else {\n      this.cursorPointIndex = 0;\n    }\n  };\n\n  DragAndDrop.prototype.calculateResourceGroupingPosition = function (e) {\n    var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var trCollection = [].slice.call(this.parent.element.querySelectorAll('.e-content-wrap .e-content-table tr:not(.e-hidden)'));\n    var translateY = util.getTranslateY(dragArea.querySelector('table'));\n    translateY = isNullOrUndefined(translateY) ? 0 : translateY;\n    var rowHeight = this.parent.rowAutoHeight ? ~~(dragArea.querySelector('table').offsetHeight / trCollection.length) : this.actionObj.cellHeight;\n    var rowIndex = Math.floor(Math.floor(this.actionObj.Y + (dragArea.scrollTop - translateY - window.scrollY) - dragArea.getBoundingClientRect().top) / rowHeight);\n    rowIndex = rowIndex < 0 ? 0 : rowIndex > trCollection.length - 1 ? trCollection.length - 1 : rowIndex;\n    this.actionObj.index = rowIndex;\n    var eventContainer = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(rowIndex);\n    var eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n    if (!eventWrapper) {\n      eventWrapper = createElement('div', {\n        className: cls.APPOINTMENT_WRAPPER_CLASS\n      });\n      eventContainer.appendChild(eventWrapper);\n    }\n\n    this.appendCloneElement(eventWrapper);\n    var td = closest(e.target, 'td');\n    this.actionObj.groupIndex = td && !isNaN(parseInt(td.getAttribute('data-group-index'), 10)) ? parseInt(td.getAttribute('data-group-index'), 10) : this.actionObj.groupIndex;\n    var top = trCollection[rowIndex].offsetTop;\n\n    if (this.parent.rowAutoHeight) {\n      var cursorElement = this.getCursorElement(e);\n\n      if (cursorElement) {\n        top = cursorElement.classList.contains(cls.WORK_CELLS_CLASS) ? cursorElement.offsetTop : cursorElement.offsetParent.classList.contains(cls.APPOINTMENT_CLASS) ? cursorElement.offsetParent.offsetTop : top;\n      }\n    }\n\n    this.actionObj.clone.style.top = formatUnit(top);\n  };\n\n  DragAndDrop.prototype.appendCloneElement = function (element) {\n    if (this.parent.eventDragArea) {\n      document.querySelector(this.parent.eventDragArea).appendChild(this.actionObj.clone);\n    } else {\n      element.appendChild(this.actionObj.clone);\n    }\n  };\n\n  DragAndDrop.prototype.getEventWrapper = function (index) {\n    var eventWrapper;\n    var isAllDayDrag = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS);\n\n    if (this.parent.activeViewOptions.timeScale.enable) {\n      var wrapperClass = isAllDayDrag ? '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n      eventWrapper = this.parent.element.querySelectorAll(wrapperClass).item(index);\n    } else {\n      var targetWrapper = this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS).item(index);\n      eventWrapper = targetWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n      if (!eventWrapper) {\n        eventWrapper = createElement('div', {\n          className: cls.APPOINTMENT_WRAPPER_CLASS\n        });\n        targetWrapper.appendChild(eventWrapper);\n      }\n    }\n\n    return eventWrapper;\n  };\n\n  DragAndDrop.prototype.getAllDayEventHeight = function () {\n    var eventWrapper = createElement('div', {\n      className: cls.APPOINTMENT_CLASS\n    });\n    this.parent.element.querySelector('.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS).appendChild(eventWrapper);\n    var eventHeight = eventWrapper.offsetHeight;\n    remove(eventWrapper);\n    return eventHeight;\n  };\n\n  DragAndDrop.prototype.isAllowDrop = function (e) {\n    if (!this.actionObj.excludeSelectors) {\n      return false;\n    }\n\n    var dropSelectors = this.actionObj.excludeSelectors.split(',');\n    var isAllowDrop = false;\n\n    for (var _i = 0, dropSelectors_1 = dropSelectors; _i < dropSelectors_1.length; _i++) {\n      var selector = dropSelectors_1[_i];\n\n      if (e.target.classList.contains(selector)) {\n        isAllowDrop = true;\n        break;\n      }\n    }\n\n    return isAllowDrop;\n  };\n  /**\n   * Get module name.\n   */\n\n\n  DragAndDrop.prototype.getModuleName = function () {\n    return 'dragAndDrop';\n  };\n\n  return DragAndDrop;\n}(ActionBase);\n\nexport { DragAndDrop };","map":{"version":3,"sources":["/Users/jay/Whiteboard/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/drag.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","createElement","closest","Draggable","extend","formatUnit","isNullOrUndefined","addClass","remove","removeClass","setStyleAttribute","isBlazor","getElement","ActionBase","events","util","cls","MonthEvent","TimelineEvent","VerticalEvent","MINUTES_PER_DAY","DragAndDrop","_super","_this","apply","arguments","widthUptoCursorPoint","heightUptoCursorPoint","cursorPointIndex","isHeaderRows","isTimelineDayProcess","widthPerMinute","heightPerMinute","minDiff","isStepDragging","isMorePopupOpened","isAllDayDrag","wireDragEvent","element","abort","EVENT_RESIZE_CLASS","clone","isDragScroll","enableTapHold","parent","isAdaptive","enableTailMode","eventDragArea","cursorAt","left","top","dragArea","document","querySelector","CONTENT_TABLE_CLASS","dragStart","bind","drag","dragStop","enableAutoScroll","helper","dragHelper","queryPositionInfo","dragPosition","e","setDragActionDefaultValues","actionObj","action","createCloneElement","currentView","timeScale","enable","activeView","isTimelineView","classList","contains","ALLDAY_APPOINTMENT_CLASS","cursor","right","width","style","offsetTop","cloneElement","originalElement","cellHeight","slotInterval","interval","leftValue","offsetLeft","topValue","offsetParent","MORE_EVENT_POPUP_CLASS","ALLDAY_ROW_CLASS","Math","ceil","offsetWidth","cellWidth","enableRtl","height","pointerEvents","top_1","parseInt","scrollHeight","cloneBottom","offsetHeight","isAllDay","activeViewOptions","slotCount","workCell","WORK_CELLS_CLASS","eventGuid","getAttribute","event","eventBase","getEventByGuid","eventObj","dragArgs","cancel","data","excludeSelectors","navigation","timeDelay","scroll","scrollBy","trigger","dragEventArgs","parentElement","dragObj","ej2_instances","intDestroy","removeCloneElementClasses","removeCloneElement","bindEvents","dragElement","eventFields","startTime","getDateTime","endTime","actionClass","uiStateValues","start","end","groupIndex","viewElement","CONTENT_WRAP_CLASS","scrollArgs","scrollWidth","daysVariation","rows","headerRows","length","option","timelineEventModule","updateOriginalElement","monthEvent","verticalEvent","quickPopup","quickPopupHide","target","DISABLE_DATES","eventArgs","getPageCoordinates","Y","pageY","X","pageX","abs","getBoundingClientRect","calculateMinutesDiff","date","getDateFromElement","currentDate","resetTime","startDate","Date","getTime","MS_PER_DAY","targetElement","currentTarget","ROOT","updateScrollPosition","updateNavigatingPosition","updateDraggingDateTime","group","resources","renderDates","startEndHours","getStartEndHours","getStartHour","getEndHour","startHour","MS_PER_MINUTE","clearInterval","navigationInterval","scrollInterval","isAllowDrop","getChangedData","saveChangedData","currentDate_1","getCurrentTime","window","setInterval","crtDate","getSeconds","viewNavigation","morePopupEventDragging","dateRender","getSlotDates","calculateTimelineTime","calculateVerticalDate","calculateVerticalTime","navigationWrapper","outerWrapperCls","slice","call","querySelectorAll","index","targetWrapper","APPOINTMENT_WRAPPER_CLASS","className","appendChild","wrapperClass","ALLDAY_APPOINTMENT_WRAPPER_CLASS","item","elementHeight_1","getAllDayEventHeight","event_1","ALLDAY_CELLS_CLASS","forEach","outWrapper","APPOINTMENT_CONTAINER_CLASS","tarWrapper","navigationType","scrollEdges","bottom","scrollLeft","round","pageXOffset","clientWidth","changeDate","getNextPreviousDate","eventDuration","td","dragEnd","setMilliseconds","eventContainer","eventWrapper","rowIndex","appendCloneElement","swapDragging","eventStart","eventEnd","floor","scrollTop","diffInMinutes","tr","trCollections","getContentTable","cellIndex","colIndex","children","getEventWrapper","setMinutes","getMinutes","setDate","getDate","setHours","getHours","addDays","updateAllDayEvents","byDate","undefined","getUpdatedEvent","updateEventHeight","updateTimePosition","initializeValues","datesCount","i","dayIndex","getIndexOfDate","record","isSpannedEvent","eStart","fields","eEnd","appHeight","getHeight","getTopValue","endDate","slots","push","map","resourceBase","lastResourceLevel","filter","res","splitEvent","query","getMsFromDate","concat","cell","count","DATE_HEADER_WRAP_CLASS","eventHeight_1","allDayElement","DAY_WRAPPER_CLASS","tagName","workCells","timeString","startTimeDiff","dynamicEventsRendering","rightOffset","getOffsetValue","getColumnIndex","cloneIndex","cursorIndex","getCursorCurrentIndex","widthDiff","getWidthDiff","timeDiff","calculateIntervalTime","eventSrt","eventData","getStartTime","getEndTime","getEventWidth","day","getPosition","calculateResourceGroupingPosition","viewEle","pages","targetLeft","getIndex","dateLength","targetDate","currentIndex","trCollection","translateY","getTranslateY","rowHeight","rowAutoHeight","scrollY","isNaN","cursorElement","getCursorElement","APPOINTMENT_CLASS","eventHeight","dropSelectors","split","_i","dropSelectors_1","selector","getModuleName"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { createElement, closest, Draggable, extend, formatUnit, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { addClass, remove, removeClass, setStyleAttribute, isBlazor, getElement } from '@syncfusion/ej2-base';\nimport { ActionBase } from '../actions/action-base';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport { MonthEvent } from '../event-renderer/month';\nimport { TimelineEvent } from '../event-renderer/timeline-view';\nimport { VerticalEvent } from '../event-renderer/vertical-view';\nvar MINUTES_PER_DAY = 1440;\n/**\n * Schedule events drag actions\n */\nvar DragAndDrop = /** @class */ (function (_super) {\n    __extends(DragAndDrop, _super);\n    function DragAndDrop() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.widthUptoCursorPoint = 0;\n        _this.heightUptoCursorPoint = 0;\n        _this.cursorPointIndex = 0;\n        _this.isHeaderRows = false;\n        _this.isTimelineDayProcess = false;\n        _this.widthPerMinute = 0;\n        _this.heightPerMinute = 0;\n        _this.minDiff = 0;\n        _this.isStepDragging = false;\n        _this.isMorePopupOpened = false;\n        _this.isAllDayDrag = false;\n        return _this;\n    }\n    DragAndDrop.prototype.wireDragEvent = function (element) {\n        new Draggable(element, {\n            abort: '.' + cls.EVENT_RESIZE_CLASS,\n            clone: true,\n            isDragScroll: true,\n            enableTapHold: this.parent.isAdaptive,\n            enableTailMode: (this.parent.eventDragArea) ? true : false,\n            cursorAt: (this.parent.eventDragArea) ? { left: -20, top: -20 } : { left: 0, top: 0 },\n            dragArea: (this.parent.eventDragArea) ?\n                document.querySelector(this.parent.eventDragArea) :\n                this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS),\n            dragStart: this.dragStart.bind(this),\n            drag: this.drag.bind(this),\n            dragStop: this.dragStop.bind(this),\n            enableAutoScroll: false,\n            helper: this.dragHelper.bind(this),\n            queryPositionInfo: this.dragPosition.bind(this)\n        });\n    };\n    DragAndDrop.prototype.dragHelper = function (e) {\n        this.setDragActionDefaultValues();\n        this.actionObj.element = e.element;\n        this.actionObj.action = 'drag';\n        this.actionObj.clone = this.createCloneElement(this.actionObj.element);\n        if (!this.parent.eventDragArea && this.parent.currentView !== 'Month' &&\n            this.parent.timeScale.enable && !this.parent.activeView.isTimelineView() &&\n            !this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n            setStyleAttribute(this.actionObj.clone, { cursor: 'move', left: '0%', right: '0%', width: '100%' });\n        }\n        this.actionObj.clone.style.top = formatUnit(this.actionObj.element.offsetTop);\n        this.actionObj.cloneElement = [this.actionObj.clone];\n        this.actionObj.originalElement = [this.actionObj.element];\n        return this.actionObj.clone;\n    };\n    DragAndDrop.prototype.dragPosition = function (e) {\n        if (this.parent.eventDragArea) {\n            return { left: e.left, top: e.top };\n        }\n        var cellHeight = (this.actionObj.cellHeight / this.actionObj.slotInterval) * this.actionObj.interval;\n        var leftValue = formatUnit(0);\n        if (this.parent.currentView === 'Month') {\n            leftValue = e.left;\n        }\n        if (this.parent.activeView.isTimelineView()) {\n            leftValue = formatUnit(this.actionObj.clone.offsetLeft);\n        }\n        var topValue;\n        if ((this.parent.activeView.isTimelineView() || !this.parent.timeScale.enable ||\n            (!isNullOrUndefined(this.actionObj.clone.offsetParent) &&\n                this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)))) {\n            topValue = formatUnit(this.actionObj.clone.offsetTop);\n        }\n        else if (this.parent.currentView === 'Month') {\n            topValue = formatUnit(0);\n        }\n        else if (this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n            topValue = formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop);\n            setStyleAttribute(this.actionObj.clone, {\n                width: formatUnit(Math.ceil(this.actionObj.clone.offsetWidth / this.actionObj.cellWidth) * this.actionObj.cellWidth),\n                right: this.parent.enableRtl && formatUnit(0)\n            });\n        }\n        else {\n            if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) &&\n                !this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n                setStyleAttribute(this.actionObj.clone, {\n                    height: formatUnit(this.actionObj.cellHeight),\n                    width: formatUnit(this.actionObj.cellWidth - 1),\n                    pointerEvents: 'none'\n                });\n            }\n            var top_1 = parseInt(e.top, 10);\n            top_1 = top_1 < 0 ? 0 : top_1;\n            topValue = formatUnit(Math.ceil(top_1 / cellHeight) * cellHeight);\n            var scrollHeight = this.parent.element.querySelector('.e-content-wrap').scrollHeight;\n            var cloneBottom = parseInt(topValue, 10) + this.actionObj.clone.offsetHeight;\n            if (cloneBottom > scrollHeight) {\n                topValue = (parseInt(topValue, 10) - (cloneBottom - scrollHeight)) + 'px';\n            }\n        }\n        return { left: leftValue, top: topValue };\n    };\n    DragAndDrop.prototype.setDragActionDefaultValues = function () {\n        this.actionObj.action = 'drag';\n        this.actionObj.isAllDay = null;\n        this.actionObj.slotInterval = this.parent.activeViewOptions.timeScale.interval / this.parent.activeViewOptions.timeScale.slotCount;\n        this.actionObj.interval = this.actionObj.slotInterval;\n        var workCell = this.parent.element.querySelector('.' + cls.WORK_CELLS_CLASS);\n        this.actionObj.cellWidth = workCell.offsetWidth;\n        this.actionObj.cellHeight = workCell.offsetHeight;\n    };\n    DragAndDrop.prototype.dragStart = function (e) {\n        var _this = this;\n        var eventGuid = this.actionObj.element.getAttribute('data-guid');\n        this.actionObj.event = this.parent.eventBase.getEventByGuid(eventGuid);\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var dragArgs = {\n            cancel: false,\n            data: eventObj,\n            event: e,\n            excludeSelectors: null,\n            element: this.actionObj.element,\n            interval: this.actionObj.interval,\n            navigation: { enable: false, timeDelay: 2000 },\n            scroll: { enable: true, scrollBy: 30, timeDelay: 100 }\n        };\n        this.parent.trigger(events.dragStart, dragArgs, function (dragEventArgs) {\n            if (dragEventArgs.cancel || (!isNullOrUndefined(_this.actionObj.element) &&\n                isNullOrUndefined(_this.actionObj.element.parentElement))) {\n                var dragObj = _this.actionObj.element.ej2_instances[0];\n                if (!isNullOrUndefined(dragObj)) {\n                    dragObj.intDestroy(e.event);\n                }\n                _this.actionObj.action = '';\n                _this.removeCloneElementClasses();\n                _this.removeCloneElement();\n                return;\n            }\n            else if (isBlazor()) {\n                e.bindEvents(e.dragElement);\n                if (dragEventArgs.element) {\n                    dragEventArgs.element = getElement(dragEventArgs.element);\n                }\n                dragEventArgs.data[_this.parent.eventFields.startTime] = _this.parent.getDateTime(dragEventArgs.data[_this.parent.eventFields.startTime]);\n                dragEventArgs.data[_this.parent.eventFields.endTime] = _this.parent.getDateTime(dragEventArgs.data[_this.parent.eventFields.endTime]);\n            }\n            _this.actionClass('addClass');\n            _this.parent.uiStateValues.action = true;\n            _this.actionObj.start = eventObj[_this.parent.eventFields.startTime];\n            _this.actionObj.end = eventObj[_this.parent.eventFields.endTime];\n            _this.actionObj.groupIndex = parseInt(_this.actionObj.element.getAttribute('data-group-index') || '0', 10);\n            _this.actionObj.interval = dragEventArgs.interval;\n            _this.actionObj.navigation = dragEventArgs.navigation;\n            _this.actionObj.scroll = dragEventArgs.scroll;\n            _this.actionObj.excludeSelectors = dragEventArgs.excludeSelectors;\n            var viewElement = _this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            _this.scrollArgs = { element: viewElement, width: viewElement.scrollWidth, height: viewElement.scrollHeight };\n            _this.widthPerMinute = (_this.actionObj.cellWidth / _this.actionObj.slotInterval) * _this.actionObj.interval;\n            _this.heightPerMinute = (_this.actionObj.cellHeight / _this.actionObj.slotInterval) * _this.actionObj.interval;\n            _this.widthUptoCursorPoint = 0;\n            _this.heightUptoCursorPoint = 0;\n            _this.cursorPointIndex = -1;\n            _this.isHeaderRows = false;\n            _this.isTimelineDayProcess = false;\n            _this.minDiff = 0;\n            _this.isMorePopupOpened = false;\n            _this.daysVariation = -1;\n            if ((_this.parent.activeView.isTimelineView() || !_this.parent.timeScale.enable)) {\n                if (!isNullOrUndefined(_this.actionObj.clone.offsetParent) &&\n                    _this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n                    _this.isMorePopupOpened = true;\n                }\n                var rows = _this.parent.activeViewOptions.headerRows;\n                _this.isHeaderRows = rows.length > 0 && rows[rows.length - 1].option !== 'Hour' &&\n                    rows[rows.length - 1].option !== 'Date';\n                _this.isTimelineDayProcess = !_this.parent.activeViewOptions.timeScale.enable || _this.isHeaderRows ||\n                    _this.parent.currentView === 'TimelineMonth' || (rows.length > 0 && rows[rows.length - 1].option === 'Date');\n                _this.isStepDragging = !_this.isTimelineDayProcess && (_this.actionObj.slotInterval !== _this.actionObj.interval);\n                if (_this.isTimelineDayProcess) {\n                    _this.timelineEventModule = new TimelineEvent(_this.parent, 'day');\n                }\n                else {\n                    _this.timelineEventModule = new TimelineEvent(_this.parent, 'hour');\n                }\n            }\n            if (_this.parent.currentView === 'Month') {\n                _this.updateOriginalElement(_this.actionObj.clone);\n                _this.monthEvent = new MonthEvent(_this.parent);\n            }\n            if (_this.parent.currentView === 'Day' || _this.parent.currentView === 'Week' || _this.parent.currentView === 'WorkWeek') {\n                _this.verticalEvent = new VerticalEvent(_this.parent);\n            }\n        });\n    };\n    DragAndDrop.prototype.drag = function (e) {\n        this.parent.quickPopup.quickPopupHide(true);\n        if ((!isNullOrUndefined(e.target)) && e.target.classList.contains(cls.DISABLE_DATES)) {\n            return;\n        }\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventArgs = this.getPageCoordinates(e);\n        this.actionObj.Y = this.actionObj.pageY = eventArgs.pageY;\n        this.actionObj.X = this.actionObj.pageX = eventArgs.pageX;\n        this.actionObj.target = e.target;\n        this.widthUptoCursorPoint = (this.widthUptoCursorPoint === 0) ?\n            Math.ceil((Math.abs(this.actionObj.clone.getBoundingClientRect().left - this.actionObj.X) / this.widthPerMinute)) *\n                this.widthPerMinute : this.widthUptoCursorPoint;\n        this.widthUptoCursorPoint = this.isMorePopupOpened ? this.actionObj.cellWidth : this.widthUptoCursorPoint;\n        this.heightUptoCursorPoint = (this.heightUptoCursorPoint === 0) ?\n            Math.ceil((Math.abs(this.actionObj.clone.getBoundingClientRect().top - this.actionObj.Y) / this.heightPerMinute)) *\n                this.heightPerMinute : this.heightUptoCursorPoint;\n        this.isAllDayDrag = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS);\n        if (this.isStepDragging && this.minDiff === 0) {\n            this.calculateMinutesDiff(eventObj);\n        }\n        if ((this.parent.currentView === 'Month' || this.isAllDayDrag) && this.daysVariation < 0) {\n            var date = this.parent.getDateFromElement(this.actionObj.target);\n            if (!isNullOrUndefined(date)) {\n                var currentDate = util.resetTime(date);\n                var startDate = util.resetTime(new Date(eventObj[this.parent.eventFields.startTime].getTime()));\n                this.daysVariation = (currentDate.getTime() - startDate.getTime()) / util.MS_PER_DAY;\n            }\n            else {\n                this.daysVariation = 0;\n            }\n        }\n        if (this.parent.eventDragArea) {\n            var targetElement = eventArgs.target;\n            this.actionObj.clone.style.top = formatUnit(targetElement.offsetTop);\n            this.actionObj.clone.style.left = formatUnit(targetElement.offsetLeft);\n            var currentTarget = closest(targetElement, '.' + cls.ROOT);\n            if (!currentTarget) {\n                this.actionObj.clone.style.height = '';\n                this.actionObj.clone.style.width = '';\n            }\n            else {\n                if (!(this.parent.currentView === 'Week' || this.parent.currentView === 'WorkWeek'\n                    || this.parent.currentView === 'Day')) {\n                    this.actionObj.clone.style.width = formatUnit(this.actionObj.element.offsetWidth);\n                }\n            }\n        }\n        this.updateScrollPosition(e);\n        this.updateNavigatingPosition(e);\n        this.updateDraggingDateTime(e);\n        var dragArgs = {\n            data: eventObj, event: e, element: this.actionObj.element, startTime: this.actionObj.start,\n            endTime: this.actionObj.end\n        };\n        if (this.parent.group.resources.length > 0) {\n            dragArgs.groupIndex = this.actionObj.groupIndex;\n        }\n        this.parent.trigger(events.drag, dragArgs);\n    };\n    DragAndDrop.prototype.calculateMinutesDiff = function (eventObj) {\n        if (this.parent.enableRtl) {\n            this.minDiff =\n                ((this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint) / this.widthPerMinute) * this.actionObj.interval;\n        }\n        else {\n            this.minDiff = (this.widthUptoCursorPoint / this.widthPerMinute) * this.actionObj.interval;\n        }\n        var startDate = eventObj[this.parent.eventFields.startTime];\n        var startTime = this.parent.activeView.renderDates[0];\n        var startEndHours = util.getStartEndHours(startTime, this.parent.activeView.getStartHour(), this.parent.activeView.getEndHour());\n        if (startEndHours.startHour.getTime() > startDate.getTime()) {\n            this.minDiff = this.minDiff + ((startEndHours.startHour.getTime() - startDate.getTime()) / util.MS_PER_MINUTE);\n        }\n    };\n    DragAndDrop.prototype.dragStop = function (e) {\n        var _this = this;\n        this.removeCloneElementClasses();\n        this.removeCloneElement();\n        clearInterval(this.actionObj.navigationInterval);\n        this.actionObj.navigationInterval = null;\n        clearInterval(this.actionObj.scrollInterval);\n        this.actionObj.scrollInterval = null;\n        this.actionClass('removeClass');\n        this.parent.uiStateValues.action = false;\n        this.actionObj.action = null;\n        if (this.isAllowDrop(e)) {\n            return;\n        }\n        var dragArgs = { cancel: false, data: this.getChangedData(),\n            event: e, element: this.actionObj.element, target: e.target };\n        this.parent.trigger(events.dragStop, dragArgs, function (dragEventArgs) {\n            if (dragEventArgs.cancel) {\n                return;\n            }\n            _this.saveChangedData(dragEventArgs);\n        });\n    };\n    DragAndDrop.prototype.updateNavigatingPosition = function (e) {\n        var _this = this;\n        if (this.actionObj.navigation.enable) {\n            var currentDate_1 = this.parent.getCurrentTime();\n            if (isNullOrUndefined(this.actionObj.navigationInterval)) {\n                this.actionObj.navigationInterval = window.setInterval(function () {\n                    if (currentDate_1) {\n                        var crtDate = _this.parent.getCurrentTime();\n                        var end = crtDate.getSeconds();\n                        var start = currentDate_1.getSeconds() + (_this.actionObj.navigation.timeDelay / 1000);\n                        start = (start >= 60) ? start - 60 : start;\n                        if (start === end) {\n                            currentDate_1 = _this.parent.getCurrentTime();\n                            _this.viewNavigation(e);\n                            _this.updateDraggingDateTime(e);\n                        }\n                    }\n                }, this.actionObj.navigation.timeDelay);\n            }\n        }\n    };\n    DragAndDrop.prototype.updateDraggingDateTime = function (e) {\n        if (!isNullOrUndefined(this.actionObj.clone.offsetParent) &&\n            this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n            this.morePopupEventDragging(e);\n        }\n        else if (this.parent.activeView.isTimelineView()) {\n            this.timelineEventModule.dateRender = this.parent.activeView.renderDates;\n            this.timelineEventModule.cellWidth = this.actionObj.cellWidth;\n            this.timelineEventModule.getSlotDates();\n            this.actionObj.cellWidth = this.isHeaderRows ? this.timelineEventModule.cellWidth : this.actionObj.cellWidth;\n            this.calculateTimelineTime(e);\n        }\n        else {\n            if (this.parent.currentView === 'Month') {\n                this.calculateVerticalDate(e);\n            }\n            else {\n                this.calculateVerticalTime(e);\n            }\n        }\n    };\n    DragAndDrop.prototype.navigationWrapper = function () {\n        if (!this.parent.activeView.isTimelineView()) {\n            if (this.parent.currentView === 'Month' || !this.parent.timeScale.enable) {\n                var outerWrapperCls = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n                this.actionObj.index = (this.parent.activeView.renderDates.length < this.actionObj.index) ?\n                    this.parent.activeView.renderDates.length - 1 : this.actionObj.index;\n                var targetWrapper = outerWrapperCls[this.actionObj.index].querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n                if (!targetWrapper) {\n                    targetWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n                    outerWrapperCls[this.actionObj.index].appendChild(targetWrapper);\n                }\n                targetWrapper.appendChild(this.actionObj.clone);\n            }\n            else {\n                var wrapperClass = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) ?\n                    '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n                this.parent.element.querySelectorAll(wrapperClass)\n                    .item(this.actionObj.index).appendChild(this.actionObj.clone);\n                if (wrapperClass === '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS) {\n                    var elementHeight_1 = this.getAllDayEventHeight();\n                    var event_1 = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n                    if (event_1[0].offsetHeight < elementHeight_1) {\n                        event_1.forEach(function (element) { return element.style.height = ((elementHeight_1 + 2) / 12) + 'em'; });\n                    }\n                    this.actionObj.clone.style.height = formatUnit(elementHeight_1);\n                }\n                this.actionObj.height = parseInt(this.actionObj.clone.style.height, 0);\n            }\n        }\n        else {\n            var outWrapper = void 0;\n            if (this.parent.activeViewOptions.group.resources.length > 0) {\n                outWrapper = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(this.actionObj.index);\n            }\n            else {\n                outWrapper = this.parent.element.querySelector('.' + cls.APPOINTMENT_CONTAINER_CLASS);\n            }\n            var tarWrapper = outWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n            if (!tarWrapper) {\n                tarWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n                outWrapper.appendChild(tarWrapper);\n            }\n            tarWrapper.appendChild(this.actionObj.clone);\n        }\n    };\n    DragAndDrop.prototype.viewNavigation = function (e) {\n        var navigationType;\n        var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        if (dragArea && ((!this.scrollEdges.top && !this.scrollEdges.bottom) ||\n            closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS))) {\n            if ((dragArea.scrollLeft === 0) &&\n                (Math.round(this.actionObj.X) <=\n                    Math.round(dragArea.getBoundingClientRect().left + this.actionObj.cellWidth + window.pageXOffset))) {\n                navigationType = this.parent.enableRtl ? 'next' : 'previous';\n            }\n            else if ((Math.round(dragArea.scrollLeft) + dragArea.clientWidth === dragArea.scrollWidth) &&\n                (Math.round(this.actionObj.X) >=\n                    Math.round(dragArea.getBoundingClientRect().right - this.actionObj.cellWidth + window.pageXOffset))) {\n                navigationType = this.parent.enableRtl ? 'previous' : 'next';\n            }\n            if (navigationType) {\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate(navigationType));\n            }\n        }\n    };\n    DragAndDrop.prototype.morePopupEventDragging = function (e) {\n        if (isNullOrUndefined(e.target) || (e.target && isNullOrUndefined(closest(e.target, 'td')))) {\n            return;\n        }\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() -\n            eventObj[this.parent.eventFields.startTime].getTime();\n        var td = closest(e.target, 'td');\n        var dragStart = this.parent.getDateFromElement(td);\n        var dragEnd = new Date(dragStart.getTime());\n        dragEnd.setMilliseconds(eventDuration);\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n        }\n        this.actionObj.start = new Date(dragStart.getTime());\n        this.actionObj.end = new Date(dragEnd.getTime());\n        this.actionObj.clone.style.top = formatUnit(td.offsetParent.offsetTop);\n        this.actionObj.clone.style.left = formatUnit(td.offsetLeft);\n        this.actionObj.clone.style.width = formatUnit(td.offsetWidth);\n        var eventContainer = td;\n        var eventWrapper;\n        if (this.parent.activeView.isTimelineView()) {\n            var rowIndex = closest(td, 'tr').rowIndex;\n            eventContainer = this.parent.element.querySelectorAll('.e-appointment-container').item(rowIndex);\n        }\n        eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n        if (!eventWrapper) {\n            eventWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n            eventContainer.appendChild(eventWrapper);\n        }\n        this.appendCloneElement(eventWrapper);\n    };\n    DragAndDrop.prototype.calculateVerticalTime = function (e) {\n        if (isNullOrUndefined(this.actionObj.target) ||\n            (this.actionObj.target && isNullOrUndefined(closest(this.actionObj.target, 'tr'))) ||\n            (!(closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS)) &&\n                !(closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)))) {\n            return;\n        }\n        if (this.parent.activeViewOptions.timeScale.enable) {\n            this.swapDragging(e);\n        }\n        var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventStart = eventObj[this.parent.eventFields.startTime];\n        var eventEnd = eventObj[this.parent.eventFields.endTime];\n        var eventDuration = eventEnd.getTime() - eventStart.getTime();\n        var offsetTop = Math.floor(parseInt(this.actionObj.clone.style.top, 10) / this.actionObj.cellHeight)\n            * this.actionObj.cellHeight;\n        offsetTop = offsetTop < 0 ? 0 : offsetTop;\n        if (this.scrollEdges.top || this.scrollEdges.bottom) {\n            offsetTop = this.scrollEdges.top ? dragArea.scrollTop - this.heightUptoCursorPoint + this.actionObj.cellHeight :\n                (dragArea.scrollTop + dragArea.offsetHeight - this.actionObj.clone.offsetHeight) +\n                    (this.actionObj.clone.offsetHeight - this.heightUptoCursorPoint);\n            offsetTop = Math.round(offsetTop / this.actionObj.cellHeight) * this.actionObj.cellHeight;\n            this.actionObj.clone.style.top = formatUnit(offsetTop);\n        }\n        var rowIndex = offsetTop / this.actionObj.cellHeight;\n        var heightPerMinute = this.actionObj.cellHeight / this.actionObj.slotInterval;\n        var diffInMinutes = parseInt(this.actionObj.clone.style.top, 10) - offsetTop;\n        var tr;\n        if (this.isAllDayDrag) {\n            tr = this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS);\n        }\n        else {\n            var trCollections = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n            tr = trCollections[rowIndex];\n        }\n        var index;\n        if (closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS) ||\n            closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            index = closest(this.actionObj.target, 'td').cellIndex;\n        }\n        var colIndex = isNullOrUndefined(index) ? closest(this.actionObj.clone, 'td').cellIndex : index;\n        this.actionObj.index = colIndex;\n        if (isNullOrUndefined(tr)) {\n            return;\n        }\n        var td = tr.children[colIndex];\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n        }\n        var dragStart;\n        var dragEnd;\n        if (this.parent.activeViewOptions.timeScale.enable && !this.isAllDayDrag) {\n            this.appendCloneElement(this.getEventWrapper(colIndex));\n            dragStart = this.parent.getDateFromElement(td);\n            dragStart.setMinutes(dragStart.getMinutes() + (diffInMinutes / heightPerMinute));\n            dragEnd = new Date(dragStart.getTime());\n            if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n                dragEnd.setMinutes(dragEnd.getMinutes() + this.actionObj.slotInterval);\n            }\n            else {\n                dragEnd.setMilliseconds(eventDuration);\n            }\n        }\n        else {\n            dragStart = this.parent.getDateFromElement(td);\n            dragStart.setDate(dragStart.getDate() - this.daysVariation);\n            dragStart.setHours(eventStart.getHours(), eventStart.getMinutes(), eventStart.getSeconds());\n            dragEnd = new Date(dragStart.getTime());\n            dragEnd.setMilliseconds(eventDuration);\n            if (!this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) &&\n                this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n                dragEnd = util.addDays(util.resetTime(dragEnd), 1);\n            }\n            this.updateAllDayEvents(dragStart, dragEnd, this.parent.activeViewOptions.group.byDate ? colIndex : undefined);\n        }\n        this.actionObj.start = new Date(+dragStart);\n        this.actionObj.end = new Date(+dragEnd);\n        var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n        this.updateEventHeight(event);\n        this.updateTimePosition(this.actionObj.start);\n    };\n    DragAndDrop.prototype.updateEventHeight = function (event) {\n        this.verticalEvent.initializeValues();\n        var datesCount = 0;\n        for (var i = 0; i < this.actionObj.groupIndex; i++) {\n            datesCount = datesCount + this.verticalEvent.dateRender[i].length;\n        }\n        var dayIndex = !this.parent.activeViewOptions.group.byDate ? this.actionObj.index - datesCount\n            : this.parent.getIndexOfDate(this.verticalEvent.dateRender[this.actionObj.groupIndex], util.resetTime(this.parent.getDateFromElement(this.actionObj.target)));\n        var record = this.verticalEvent.isSpannedEvent(event, dayIndex, this.actionObj.groupIndex);\n        var eStart = record[this.verticalEvent.fields.startTime];\n        var eEnd = record[this.verticalEvent.fields.endTime];\n        var topValue = 0;\n        var appHeight = this.verticalEvent.getHeight(eStart, eEnd);\n        topValue = this.verticalEvent.getTopValue(eStart, dayIndex, this.actionObj.groupIndex);\n        this.actionObj.clone.style.top = formatUnit(topValue);\n        this.actionObj.clone.style.height = formatUnit(appHeight);\n    };\n    DragAndDrop.prototype.updateAllDayEvents = function (startDate, endDate, colIndex) {\n        var _this = this;\n        this.parent.eventBase.slots = [];\n        var event = this.getUpdatedEvent(startDate, endDate, this.actionObj.event);\n        var renderDates = this.parent.activeView.renderDates;\n        this.parent.eventBase.slots.push(this.parent.activeView.renderDates.map(function (date) { return +date; }));\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.parent.eventBase.slots = [];\n            var resources = this.parent.resourceBase.lastResourceLevel.\n                filter(function (res) { return res.groupIndex === _this.actionObj.groupIndex; });\n            renderDates = resources[0].renderDates;\n            this.parent.eventBase.slots.push(renderDates.map(function (date) { return +date; }));\n        }\n        var events = this.parent.eventBase.splitEvent(event, renderDates);\n        var query = '.e-all-day-cells[data-date=\"' +\n            this.parent.getMsFromDate(events[0][this.parent.eventFields.startTime]) + '\"]';\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            query = query.concat('[data-group-index = \"' + this.actionObj.groupIndex + '\"]');\n        }\n        var cell = [].slice.call(this.parent.element.querySelectorAll(query));\n        if (cell.length > 0 || !isNullOrUndefined(colIndex)) {\n            var cellIndex = !isNullOrUndefined(colIndex) ? colIndex : cell[0].cellIndex;\n            this.appendCloneElement(this.getEventWrapper(cellIndex));\n            this.actionObj.clone.style.width =\n                formatUnit(events[0].data.count * this.actionObj.cellWidth);\n        }\n    };\n    DragAndDrop.prototype.swapDragging = function (e) {\n        var colIndex = closest(this.actionObj.target, 'td').cellIndex;\n        if (closest(this.actionObj.target, '.' + cls.DATE_HEADER_WRAP_CLASS) &&\n            !closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS)) {\n            addClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n            this.appendCloneElement(this.getEventWrapper(colIndex));\n            this.actionObj.isAllDay = true;\n            var eventHeight_1 = this.getAllDayEventHeight();\n            var allDayElement = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n            if (allDayElement[0].offsetHeight < eventHeight_1) {\n                allDayElement.forEach(function (element) { return element.style.height = ((eventHeight_1 + 2) / 12) + 'em'; });\n            }\n            setStyleAttribute(this.actionObj.clone, {\n                width: formatUnit(this.actionObj.cellWidth),\n                height: formatUnit(eventHeight_1),\n                top: formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop)\n            });\n        }\n        if (closest(this.actionObj.target, '.' + cls.WORK_CELLS_CLASS) &&\n            !closest(this.actionObj.clone, '.' + cls.DAY_WRAPPER_CLASS)) {\n            removeClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n            this.appendCloneElement(this.getEventWrapper(colIndex));\n            this.actionObj.isAllDay = false;\n            var height = (this.actionObj.element.offsetHeight === 0) ? this.actionObj.height : this.actionObj.element.offsetHeight;\n            setStyleAttribute(this.actionObj.clone, {\n                left: formatUnit(0),\n                height: formatUnit(height),\n                width: formatUnit(this.actionObj.cellWidth)\n            });\n        }\n    };\n    DragAndDrop.prototype.calculateVerticalDate = function (e) {\n        if (isNullOrUndefined(e.target) || (e.target && isNullOrUndefined(closest(e.target, 'tr'))) ||\n            (e.target && e.target.tagName === 'DIV')) {\n            return;\n        }\n        this.removeCloneElement();\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() -\n            eventObj[this.parent.eventFields.startTime].getTime();\n        var td = closest(this.actionObj.target, 'td');\n        if (!isNullOrUndefined(td)) {\n            var tr = td.parentElement;\n            this.actionObj.index = (tr.rowIndex * tr.children.length) + td.cellIndex;\n            var workCells = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n            td = workCells[this.actionObj.index];\n            var currentDate = this.parent.getDateFromElement(td);\n            if (!isNullOrUndefined(currentDate)) {\n                if (this.parent.activeViewOptions.group.resources.length > 0) {\n                    this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n                }\n                var timeString = new Date(currentDate.setDate(currentDate.getDate() - this.daysVariation));\n                var dragStart = new Date(timeString.getTime());\n                var dragEnd = new Date(dragStart.getTime());\n                var startTimeDiff = eventObj[this.parent.eventFields.startTime].getTime() -\n                    (util.resetTime(new Date(+eventObj[this.parent.eventFields.startTime]))).getTime();\n                dragStart = new Date(dragStart.getTime() + startTimeDiff);\n                dragEnd = new Date(dragStart.getTime() + eventDuration);\n                this.actionObj.start = new Date(dragStart.getTime());\n                this.actionObj.end = new Date(dragEnd.getTime());\n            }\n        }\n        var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n        this.dynamicEventsRendering(event);\n    };\n    DragAndDrop.prototype.calculateTimelineTime = function (e) {\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() -\n            eventObj[this.parent.eventFields.startTime].getTime();\n        var offsetLeft = this.parent.enableRtl ? Math.abs(this.actionObj.clone.offsetLeft) - this.actionObj.clone.offsetWidth :\n            parseInt(this.actionObj.clone.style.left, 10);\n        offsetLeft = Math.floor(offsetLeft / this.actionObj.cellWidth) * this.actionObj.cellWidth;\n        var rightOffset;\n        if (this.parent.enableRtl) {\n            rightOffset = Math.abs(parseInt(this.actionObj.clone.style.right, 10));\n            this.actionObj.clone.style.right = formatUnit(rightOffset);\n        }\n        offsetLeft = this.getOffsetValue(offsetLeft, rightOffset);\n        var colIndex = this.getColumnIndex(offsetLeft);\n        var cloneIndex = Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().left) / this.actionObj.cellWidth);\n        if (this.parent.enableRtl) {\n            cloneIndex = Math.abs(Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().right) /\n                this.actionObj.cellWidth)) - 1;\n        }\n        if (this.cursorPointIndex < 0) {\n            this.cursorIndex(e, eventObj, offsetLeft, cloneIndex);\n        }\n        var tr = this.parent.getContentTable().querySelector('tr');\n        var index = this.getCursorCurrentIndex(colIndex, cloneIndex, tr);\n        index = index < 0 ? 0 : index;\n        var eventStart = this.isHeaderRows ? new Date(this.timelineEventModule.dateRender[index].getTime()) :\n            this.parent.getDateFromElement(tr.children[index]);\n        if (this.isStepDragging) {\n            var widthDiff = this.getWidthDiff(tr, index);\n            if (widthDiff !== 0) {\n                var timeDiff = Math.round(widthDiff / this.widthPerMinute);\n                eventStart.setMinutes(eventStart.getMinutes() + (timeDiff * this.actionObj.interval));\n                eventStart.setMinutes(eventStart.getMinutes() - this.minDiff);\n            }\n            else {\n                eventStart = this.actionObj.start;\n            }\n        }\n        else {\n            eventStart.setMinutes(eventStart.getMinutes() -\n                (this.cursorPointIndex * (this.isTimelineDayProcess ? MINUTES_PER_DAY : this.actionObj.slotInterval)));\n        }\n        eventStart = this.calculateIntervalTime(eventStart);\n        if (this.isTimelineDayProcess) {\n            var eventSrt = eventObj[this.parent.eventFields.startTime];\n            eventStart.setHours(eventSrt.getHours(), eventSrt.getMinutes(), eventSrt.getSeconds());\n        }\n        var eventEnd = new Date(eventStart.getTime());\n        eventEnd.setMilliseconds(eventDuration);\n        var event = this.getUpdatedEvent(eventStart, eventEnd, this.actionObj.event);\n        var events = this.timelineEventModule.splitEvent(event, this.timelineEventModule.dateRender);\n        var eventData = events[0].data;\n        var startTime = this.timelineEventModule.getStartTime(events[0], eventData);\n        var endTime = this.timelineEventModule.getEndTime(events[0], eventData);\n        var width = this.timelineEventModule.\n            getEventWidth(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], eventData.count);\n        var day = this.parent.getIndexOfDate(this.timelineEventModule.dateRender, util.resetTime(new Date(startTime.getTime())));\n        day = day < 0 ? 0 : day;\n        var left = this.timelineEventModule.getPosition(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], day);\n        if (this.parent.enableRtl) {\n            this.actionObj.clone.style.right = formatUnit(left);\n        }\n        else {\n            this.actionObj.clone.style.left = formatUnit(left);\n        }\n        if (!this.isMorePopupOpened) {\n            this.actionObj.clone.style.width = formatUnit(width);\n        }\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.calculateResourceGroupingPosition(e);\n        }\n        this.actionObj.start = new Date(eventStart.getTime());\n        this.actionObj.end = new Date(eventEnd.getTime());\n        this.updateTimePosition(this.actionObj.start);\n    };\n    DragAndDrop.prototype.getOffsetValue = function (offsetLeft, rightOffset) {\n        if (this.scrollEdges.left || this.scrollEdges.right) {\n            var viewEle = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            if (this.parent.enableRtl) {\n                rightOffset = viewEle.offsetWidth - viewEle.scrollLeft;\n                if (this.scrollEdges.right) {\n                    rightOffset = (rightOffset - viewEle.offsetWidth + this.actionObj.clone.offsetWidth) -\n                        (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n                }\n                else {\n                    rightOffset = rightOffset + this.widthUptoCursorPoint;\n                    if (rightOffset - this.widthUptoCursorPoint >= viewEle.scrollWidth) {\n                        this.actionObj.clone.style.width =\n                            formatUnit(this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint + this.actionObj.cellWidth);\n                        rightOffset = (viewEle.scrollLeft - viewEle.scrollWidth);\n                    }\n                }\n                this.actionObj.clone.style.left = formatUnit(rightOffset);\n            }\n            else {\n                if (this.scrollEdges.left) {\n                    offsetLeft = viewEle.scrollLeft - this.widthUptoCursorPoint + this.actionObj.cellWidth;\n                    if (viewEle.scrollLeft + viewEle.offsetWidth >= viewEle.offsetWidth) {\n                        viewEle.scrollLeft = viewEle.scrollLeft - 1;\n                    }\n                    else if (this.actionObj.clone.offsetLeft === 0) {\n                        offsetLeft = viewEle.scrollLeft;\n                    }\n                }\n                else {\n                    offsetLeft = (viewEle.scrollLeft + viewEle.offsetWidth -\n                        this.actionObj.clone.offsetWidth) + (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n                }\n                offsetLeft = offsetLeft < 0 ? 0 : offsetLeft;\n                this.actionObj.clone.style.left = formatUnit(offsetLeft);\n            }\n        }\n        return offsetLeft;\n    };\n    DragAndDrop.prototype.getWidthDiff = function (tr, index) {\n        var pages = this.scrollArgs.element.getBoundingClientRect();\n        if (pages.left <= this.actionObj.pageX && pages.right >= this.actionObj.pageX) {\n            var targetLeft = tr.children[index].offsetLeft;\n            var pageX = this.actionObj.pageX - pages.left;\n            if (this.parent.enableRtl) {\n                return (targetLeft + this.actionObj.cellWidth) - (this.scrollArgs.element.scrollLeft + pageX);\n            }\n            else {\n                return (this.scrollArgs.element.scrollLeft + pageX) - targetLeft;\n            }\n        }\n        return 0;\n    };\n    DragAndDrop.prototype.getColumnIndex = function (offsetLeft) {\n        var index = Math.floor(offsetLeft / this.actionObj.cellWidth);\n        if (this.isHeaderRows) {\n            return index;\n        }\n        return this.getIndex(index);\n    };\n    DragAndDrop.prototype.getCursorCurrentIndex = function (colIndex, cloneIndex, tr) {\n        var index = colIndex + cloneIndex;\n        if (this.isHeaderRows) {\n            var dateLength = Math.floor(tr.offsetWidth / this.actionObj.cellWidth);\n            return (index > dateLength - 1) ? dateLength - 1 : index;\n        }\n        return (index > tr.children.length - 1) ? tr.children.length - 1 : index;\n    };\n    DragAndDrop.prototype.cursorIndex = function (e, event, left, index) {\n        var td = closest(e.target, '.e-work-cells');\n        if (!isNullOrUndefined(td) && !this.isMorePopupOpened) {\n            var targetDate = this.parent.getDateFromElement(td);\n            if (this.isHeaderRows) {\n                var currentIndex = Math.floor(left / this.actionObj.cellWidth);\n                targetDate = new Date(this.timelineEventModule.dateRender[currentIndex + index].getTime());\n            }\n            var timeDiff = targetDate.getTime() - event[this.parent.eventFields.startTime].getTime();\n            if (this.isTimelineDayProcess) {\n                this.cursorPointIndex = Math.abs(Math.ceil(timeDiff / (util.MS_PER_DAY)));\n            }\n            else {\n                var widthDiff = Math.floor((timeDiff / util.MS_PER_MINUTE) / (this.actionObj.slotInterval / this.actionObj.cellWidth));\n                this.cursorPointIndex = Math.floor(widthDiff / this.actionObj.cellWidth);\n                this.cursorPointIndex = this.cursorPointIndex < 0 ? 0 : this.cursorPointIndex;\n            }\n        }\n        else {\n            this.cursorPointIndex = 0;\n        }\n    };\n    DragAndDrop.prototype.calculateResourceGroupingPosition = function (e) {\n        var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var trCollection = [].slice.call(this.parent.element.querySelectorAll('.e-content-wrap .e-content-table tr:not(.e-hidden)'));\n        var translateY = util.getTranslateY(dragArea.querySelector('table'));\n        translateY = (isNullOrUndefined(translateY)) ? 0 : translateY;\n        var rowHeight = (this.parent.rowAutoHeight) ?\n            ~~(dragArea.querySelector('table').offsetHeight / trCollection.length) : this.actionObj.cellHeight;\n        var rowIndex = Math.floor(Math.floor((this.actionObj.Y + (dragArea.scrollTop - translateY - window.scrollY)) -\n            dragArea.getBoundingClientRect().top) / rowHeight);\n        rowIndex = (rowIndex < 0) ? 0 : (rowIndex > trCollection.length - 1) ? trCollection.length - 1 : rowIndex;\n        this.actionObj.index = rowIndex;\n        var eventContainer = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(rowIndex);\n        var eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n        if (!eventWrapper) {\n            eventWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n            eventContainer.appendChild(eventWrapper);\n        }\n        this.appendCloneElement(eventWrapper);\n        var td = closest(e.target, 'td');\n        this.actionObj.groupIndex = (td && !isNaN(parseInt(td.getAttribute('data-group-index'), 10)))\n            ? parseInt(td.getAttribute('data-group-index'), 10) : this.actionObj.groupIndex;\n        var top = trCollection[rowIndex].offsetTop;\n        if (this.parent.rowAutoHeight) {\n            var cursorElement = this.getCursorElement(e);\n            if (cursorElement) {\n                top = cursorElement.classList.contains(cls.WORK_CELLS_CLASS) ? cursorElement.offsetTop :\n                    cursorElement.offsetParent.classList.contains(cls.APPOINTMENT_CLASS) ?\n                        cursorElement.offsetParent.offsetTop : top;\n            }\n        }\n        this.actionObj.clone.style.top = formatUnit(top);\n    };\n    DragAndDrop.prototype.appendCloneElement = function (element) {\n        if (this.parent.eventDragArea) {\n            document.querySelector(this.parent.eventDragArea).appendChild(this.actionObj.clone);\n        }\n        else {\n            element.appendChild(this.actionObj.clone);\n        }\n    };\n    DragAndDrop.prototype.getEventWrapper = function (index) {\n        var eventWrapper;\n        var isAllDayDrag = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS);\n        if (this.parent.activeViewOptions.timeScale.enable) {\n            var wrapperClass = isAllDayDrag ? '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n            eventWrapper = this.parent.element.querySelectorAll(wrapperClass).item(index);\n        }\n        else {\n            var targetWrapper = this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS).item(index);\n            eventWrapper = targetWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n            if (!eventWrapper) {\n                eventWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n                targetWrapper.appendChild(eventWrapper);\n            }\n        }\n        return eventWrapper;\n    };\n    DragAndDrop.prototype.getAllDayEventHeight = function () {\n        var eventWrapper = createElement('div', { className: cls.APPOINTMENT_CLASS });\n        this.parent.element.querySelector('.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS).appendChild(eventWrapper);\n        var eventHeight = eventWrapper.offsetHeight;\n        remove(eventWrapper);\n        return eventHeight;\n    };\n    DragAndDrop.prototype.isAllowDrop = function (e) {\n        if (!this.actionObj.excludeSelectors) {\n            return false;\n        }\n        var dropSelectors = this.actionObj.excludeSelectors.split(',');\n        var isAllowDrop = false;\n        for (var _i = 0, dropSelectors_1 = dropSelectors; _i < dropSelectors_1.length; _i++) {\n            var selector = dropSelectors_1[_i];\n            if (e.target.classList.contains(selector)) {\n                isAllowDrop = true;\n                break;\n            }\n        }\n        return isAllowDrop;\n    };\n    /**\n     * Get module name.\n     */\n    DragAndDrop.prototype.getModuleName = function () {\n        return 'dragAndDrop';\n    };\n    return DragAndDrop;\n}(ActionBase));\nexport { DragAndDrop };\n"]},"metadata":{},"sourceType":"module"}