{"ast":null,"code":"import { isNullOrUndefined, closest, Browser, extend, EventHandler, isBlazor } from '@syncfusion/ej2-base';\nimport { createElement, prepend, append, addClass, removeClass, getElement } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Predicate } from '@syncfusion/ej2-data';\nimport { generate, getDateFromRecurrenceDateString } from '../../recurrence-editor/date-generator';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport * as event from '../base/constant';\n/**\n * EventBase for appointment rendering\n */\n\nvar EventBase =\n/** @class */\nfunction () {\n  /**\n   * Constructor for EventBase\n   */\n  function EventBase(parent) {\n    this.slots = [];\n    this.isDoubleTapped = false;\n    this.parent = parent;\n  }\n\n  EventBase.prototype.processData = function (events, timeZonePropChanged, oldTimezone) {\n    var _this = this;\n\n    var start = this.parent.activeView.startDate();\n    var end = this.parent.activeView.endDate();\n    var fields = this.parent.eventFields;\n    this.parent.eventsProcessed = [];\n    var processed = [];\n    var temp = 1;\n    var generateID = false;\n    var resourceCollection = this.parent.resourceBase ? this.parent.resourceBase.resourceCollection : [];\n\n    if (events.length > 0 && isNullOrUndefined(events[0][fields.id])) {\n      generateID = true;\n    }\n\n    for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\n      var event_1 = events_1[_i];\n\n      if (generateID) {\n        event_1[fields.id] = temp++;\n      }\n\n      if (typeof event_1[fields.startTime] === 'string') {\n        event_1[fields.startTime] = util.getDateFromString(event_1[fields.startTime]);\n      }\n\n      if (typeof event_1[fields.endTime] === 'string') {\n        event_1[fields.endTime] = util.getDateFromString(event_1[fields.endTime]);\n      }\n\n      if (timeZonePropChanged) {\n        this.processTimezoneChange(event_1, oldTimezone);\n      } else {\n        event_1 = this.processTimezone(event_1);\n      }\n\n      for (var level = 0; level < resourceCollection.length; level++) {\n        if (event_1[resourceCollection[level].field] === null || event_1[resourceCollection[level].field] === 0) {\n          event_1[resourceCollection[level].field] = undefined;\n        }\n      }\n\n      if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && event_1[fields.recurrenceRule] === '') {\n        event_1[fields.recurrenceRule] = null;\n      }\n\n      if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID])) {\n        processed = processed.concat(this.generateOccurrence(event_1, null, oldTimezone, true));\n      } else {\n        event_1.Guid = this.generateGuid();\n        processed.push(event_1);\n      }\n    }\n\n    var eventData = processed.filter(function (data) {\n      return !data[_this.parent.eventFields.isBlock];\n    });\n    this.parent.eventsProcessed = this.filterEvents(start, end, eventData);\n    var blockData = processed.filter(function (data) {\n      return data[_this.parent.eventFields.isBlock];\n    });\n    blockData.forEach(function (eventObj) {\n      if (eventObj[fields.isAllDay]) {\n        eventObj[fields.startTime] = util.resetTime(eventObj[fields.startTime]);\n        eventObj[fields.endTime] = util.addDays(util.resetTime(eventObj[fields.endTime]), 1);\n      }\n    });\n    this.parent.blockProcessed = blockData;\n    return eventData;\n  };\n\n  EventBase.prototype.getProcessedEvents = function (eventCollection) {\n    if (eventCollection === void 0) {\n      eventCollection = this.parent.eventsData;\n    }\n\n    var processed = [];\n\n    for (var _i = 0, _a = eventCollection; _i < _a.length; _i++) {\n      var event_2 = _a[_i];\n\n      if (!isNullOrUndefined(event_2[this.parent.eventFields.recurrenceRule]) && isNullOrUndefined(event_2[this.parent.eventFields.recurrenceID])) {\n        processed = processed.concat(this.generateOccurrence(event_2));\n      } else {\n        processed.push(event_2);\n      }\n    }\n\n    return processed;\n  };\n\n  EventBase.prototype.timezonePropertyChange = function (oldTimezone) {\n    var processed = this.processData(this.parent.eventsData, true, oldTimezone);\n    this.parent.notify(event.dataReady, {\n      processedData: processed\n    });\n  };\n  /** @private */\n\n\n  EventBase.prototype.timezoneConvert = function (eventData) {\n    var fields = this.parent.eventFields;\n    eventData[fields.startTimezone] = eventData[fields.startTimezone] || eventData[fields.endTimezone];\n    eventData[fields.endTimezone] = eventData[fields.endTimezone] || eventData[fields.startTimezone];\n\n    if (this.parent.timezone) {\n      var startTz = eventData[fields.startTimezone];\n      var endTz = eventData[fields.endTimezone];\n      eventData[fields.startTime] = this.parent.tzModule.convert(eventData[fields.startTime], this.parent.timezone, startTz);\n      eventData[fields.endTime] = this.parent.tzModule.convert(eventData[fields.endTime], this.parent.timezone, endTz);\n    }\n  };\n\n  EventBase.prototype.processTimezoneChange = function (event, oldTimezone) {\n    var fields = this.parent.eventFields;\n\n    if (event[fields.isAllDay]) {\n      return;\n    }\n\n    if (oldTimezone && this.parent.timezone) {\n      event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], oldTimezone, this.parent.timezone);\n      event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], oldTimezone, this.parent.timezone);\n    } else if (!oldTimezone && this.parent.timezone) {\n      event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\n      event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\n    } else if (oldTimezone && !this.parent.timezone) {\n      event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], oldTimezone);\n      event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], oldTimezone);\n    }\n  };\n\n  EventBase.prototype.processTimezone = function (event, isReverse) {\n    if (isReverse === void 0) {\n      isReverse = false;\n    }\n\n    var fields = this.parent.eventFields;\n\n    if (event[fields.startTimezone] || event[fields.endTimezone]) {\n      var startTimezone = event[fields.startTimezone] || event[fields.endTimezone];\n      var endTimezone = event[fields.endTimezone] || event[fields.startTimezone];\n      var zone = this.parent.timezone;\n\n      if (isReverse) {\n        if (this.parent.timezone) {\n          event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], startTimezone, zone);\n          event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, zone);\n          event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], zone);\n          event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], zone);\n        } else {\n          event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], startTimezone);\n          event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], endTimezone);\n        }\n      } else {\n        event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], startTimezone);\n        event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], endTimezone);\n\n        if (this.parent.timezone) {\n          event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], startTimezone, zone);\n          event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, zone);\n        }\n      }\n    } else if (this.parent.timezone) {\n      if (isReverse) {\n        event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], this.parent.timezone);\n        event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], this.parent.timezone);\n      } else {\n        event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\n        event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\n      }\n    }\n\n    return event;\n  };\n\n  EventBase.prototype.filterBlockEvents = function (eventObj) {\n    var eStart = eventObj[this.parent.eventFields.startTime];\n    var eEnd = eventObj[this.parent.eventFields.endTime];\n    var resourceData;\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      var data = this.getGroupIndexFromEvent(eventObj);\n      resourceData = this.parent.resourceBase.lastResourceLevel[data];\n    }\n\n    return this.filterEvents(eStart, eEnd, this.parent.blockProcessed, resourceData);\n  };\n\n  EventBase.prototype.filterEvents = function (startDate, endDate, appointments, resourceTdData) {\n    if (appointments === void 0) {\n      appointments = this.parent.eventsProcessed;\n    }\n\n    var fieldMapping = this.parent.eventFields;\n    var predicate = new Predicate(fieldMapping.startTime, 'greaterthanorequal', startDate).and(new Predicate(fieldMapping.endTime, 'greaterthanorequal', startDate)).and(new Predicate(fieldMapping.startTime, 'lessthan', endDate)).or(new Predicate(fieldMapping.startTime, 'lessthanorequal', startDate).and(new Predicate(fieldMapping.endTime, 'greaterthan', startDate)));\n    var filter = new DataManager({\n      json: appointments\n    }).executeLocal(new Query().where(predicate));\n\n    if (resourceTdData) {\n      filter = this.filterEventsByResource(resourceTdData, filter);\n    }\n\n    return this.sortByTime(filter);\n  };\n\n  EventBase.prototype.filterEventsByRange = function (eventCollection, startDate, endDate) {\n    var _this = this;\n\n    var filteredEvents = [];\n\n    if (startDate && endDate) {\n      filteredEvents = this.filterEvents(startDate, endDate, eventCollection);\n    } else if (startDate && !endDate) {\n      filteredEvents = eventCollection.filter(function (e) {\n        return e[_this.parent.eventFields.startTime] >= startDate;\n      });\n    } else if (!startDate && endDate) {\n      filteredEvents = eventCollection.filter(function (e) {\n        return e[_this.parent.eventFields.endTime] <= endDate;\n      });\n    } else {\n      filteredEvents = eventCollection;\n    }\n\n    return this.sortByTime(filteredEvents);\n  };\n\n  EventBase.prototype.filterEventsByResource = function (resourceTdData, appointments) {\n    if (appointments === void 0) {\n      appointments = this.parent.eventsProcessed;\n    }\n\n    var predicate = {};\n    var resourceCollection = this.parent.resourceBase.resourceCollection;\n\n    for (var level = 0; level < resourceCollection.length; level++) {\n      predicate[resourceCollection[level].field] = resourceTdData.groupOrder[level];\n    }\n\n    var keys = Object.keys(predicate);\n    var filteredCollection = appointments.filter(function (eventObj) {\n      return keys.every(function (key) {\n        if (eventObj[key] instanceof Array) {\n          return eventObj[key].indexOf(predicate[key]) > -1;\n        } else {\n          return eventObj[key] === predicate[key];\n        }\n      });\n    });\n    return filteredCollection;\n  };\n\n  EventBase.prototype.sortByTime = function (appointments) {\n    var fieldMapping = this.parent.eventFields;\n    appointments.sort(function (a, b) {\n      var d1 = a[fieldMapping.startTime];\n      var d2 = b[fieldMapping.startTime];\n      return d1.getTime() - d2.getTime();\n    });\n    return appointments;\n  };\n\n  EventBase.prototype.sortByDateTime = function (appointments) {\n    var fieldMapping = this.parent.eventFields;\n    appointments.sort(function (object1, object2) {\n      var d3 = object1[fieldMapping.startTime];\n      var d4 = object2[fieldMapping.startTime];\n      var d5 = object1[fieldMapping.endTime];\n      var d6 = object2[fieldMapping.endTime];\n      var d1 = d5.getTime() - d3.getTime();\n      var d2 = d6.getTime() - d4.getTime();\n      return d3.getTime() - d4.getTime() || d2 - d1;\n    });\n    return appointments;\n  };\n\n  EventBase.prototype.getSmallestMissingNumber = function (array) {\n    var large = Math.max.apply(Math, array);\n\n    for (var i = 0; i < large; i++) {\n      if (array.indexOf(i) === -1) {\n        return i;\n      }\n    }\n\n    return large + 1;\n  };\n\n  EventBase.prototype.splitEventByDay = function (event) {\n    var eventFields = this.parent.eventFields;\n    var data = [];\n    var eventStartTime = event[eventFields.startTime];\n    var eventEndTime = event[eventFields.endTime];\n    var isDifferentDate = util.resetTime(new Date(eventStartTime.getTime())) < util.resetTime(new Date(eventEndTime.getTime()));\n\n    if (isDifferentDate) {\n      var start = new Date(eventStartTime.getTime());\n      var end = util.addDays(util.resetTime(new Date(eventStartTime.getTime())), 1);\n      var endDate = eventEndTime.getHours() === 0 && eventEndTime.getMinutes() === 0 ? eventEndTime : util.addDays(eventEndTime, 1);\n      var index = 1;\n      var eventLength = util.getDaysCount(eventStartTime.getTime(), endDate.getTime());\n\n      while (end <= eventEndTime) {\n        var app = extend({}, event);\n        app[eventFields.startTime] = start;\n        app[eventFields.endTime] = end;\n        app.data = {\n          index: index,\n          count: eventLength\n        };\n        app.Guid = this.generateGuid();\n        app.isSpanned = true;\n        data.push(app);\n        start = end;\n\n        if (util.resetTime(new Date(start.getTime())).getTime() === util.resetTime(new Date(eventEndTime.getTime())).getTime() && !(end.getTime() === eventEndTime.getTime())) {\n          end = new Date(start.getTime());\n          end = new Date(end.setHours(eventEndTime.getHours(), eventEndTime.getMinutes(), eventEndTime.getSeconds()));\n        } else {\n          end = util.addDays(util.resetTime(new Date(start.getTime())), 1);\n        }\n\n        index++;\n      }\n    } else {\n      data.push(event);\n    }\n\n    return data;\n  };\n\n  EventBase.prototype.splitEvent = function (event, dateRender) {\n    var fields = this.parent.eventFields;\n    var start = util.resetTime(new Date(event[fields.startTime] + '')).getTime();\n    var end = util.resetTime(new Date(event[fields.endTime] + '')).getTime();\n\n    if (util.getDateInMs(event[fields.endTime]) <= 0) {\n      var temp = util.addDays(util.resetTime(new Date(event[fields.endTime] + '')), -1).getTime();\n      end = start > temp ? start : temp;\n    }\n\n    var orgStart = start;\n    var orgEnd = end;\n    var ranges = [];\n\n    if (start !== end) {\n      if (start < dateRender[0].getTime()) {\n        start = dateRender[0].getTime();\n      }\n\n      if (end > dateRender[dateRender.length - 1].getTime()) {\n        end = dateRender[dateRender.length - 1].getTime();\n      }\n\n      var cStart = start;\n\n      var _loop_1 = function (level) {\n        var slot = this_1.slots[level];\n\n        if (this_1.parent.currentView === 'WorkWeek' || this_1.parent.currentView === 'TimelineWorkWeek' || this_1.parent.activeViewOptions.group.byDate || this_1.parent.activeViewOptions.showWeekend) {\n          var slotDates_1 = [];\n          slot.forEach(function (x) {\n            return slotDates_1.push(new Date(x));\n          });\n          var renderedDates = this_1.getRenderedDates(slotDates_1);\n\n          if (!isNullOrUndefined(renderedDates) && renderedDates.length > 0) {\n            slot = [];\n            renderedDates.forEach(function (date) {\n              return slot.push(date.getTime());\n            });\n          }\n        }\n\n        var firstSlot = slot[0];\n        cStart = cStart <= firstSlot && end >= firstSlot ? firstSlot : cStart;\n\n        if (cStart > end || firstSlot > end) {\n          return \"break\";\n        }\n\n        if (!this_1.parent.activeViewOptions.group.byDate && this_1.parent.activeViewOptions.showWeekend && this_1.parent.currentView !== 'WorkWeek' && this_1.parent.currentView !== 'TimelineWorkWeek') {\n          var startIndex = slot.indexOf(cStart);\n\n          if (startIndex !== -1) {\n            var endIndex = slot.indexOf(end);\n            var hasBreak = endIndex !== -1;\n            endIndex = hasBreak ? endIndex : slot.length - 1;\n            var count = endIndex - startIndex + 1;\n            var isLeft = slot[startIndex] !== orgStart;\n            var isRight = slot[endIndex] !== orgEnd;\n            ranges.push(this_1.cloneEventObject(event, slot[startIndex], slot[endIndex], count, isLeft, isRight));\n\n            if (hasBreak) {\n              return \"break\";\n            }\n          }\n        } else {\n          if (this_1.dateInRange(cStart, slot[0], slot[slot.length - 1])) {\n            var availSlot = [];\n\n            for (var i = 0; i < slot.length; i++) {\n              if (this_1.dateInRange(slot[i], orgStart, orgEnd)) {\n                availSlot.push(slot[i]);\n              }\n            }\n\n            if (availSlot.length > 0) {\n              if (!this_1.parent.activeViewOptions.group.byDate) {\n                var isLeft = availSlot[0] !== orgStart;\n                var isRight = availSlot[availSlot.length - 1] !== orgEnd;\n                ranges.push(this_1.cloneEventObject(event, availSlot[0], availSlot[availSlot.length - 1], availSlot.length, isLeft, isRight));\n              } else {\n                for (var _i = 0, availSlot_1 = availSlot; _i < availSlot_1.length; _i++) {\n                  var slot_1 = availSlot_1[_i];\n                  ranges.push(this_1.cloneEventObject(event, slot_1, slot_1, 1, slot_1 !== orgStart, slot_1 !== orgEnd));\n                }\n              }\n            }\n          }\n        }\n      };\n\n      var this_1 = this;\n\n      for (var level = 0; level < this.slots.length; level++) {\n        var state_1 = _loop_1(level);\n\n        if (state_1 === \"break\") break;\n      }\n    } else {\n      ranges.push(this.cloneEventObject(event, start, end, 1, false, false));\n    }\n\n    return ranges;\n  };\n\n  EventBase.prototype.cloneEventObject = function (event, start, end, count, isLeft, isRight) {\n    var fields = this.parent.eventFields;\n    var e = extend({}, event, null, true);\n    var data = {\n      count: count,\n      isLeft: isLeft,\n      isRight: isRight\n    };\n    data[fields.startTime] = event[fields.startTime];\n    data[fields.endTime] = event[fields.endTime];\n    e.data = data;\n    e[fields.startTime] = new Date(start);\n    e[fields.endTime] = new Date(end);\n    return e;\n  };\n\n  EventBase.prototype.dateInRange = function (date, start, end) {\n    return start <= date && date <= end;\n  };\n\n  EventBase.prototype.getSelectedEventElements = function (target) {\n    this.removeSelectedAppointmentClass();\n\n    if (this.parent.selectedElements.length <= 0) {\n      this.parent.selectedElements.push(target);\n    } else {\n      var isAlreadySelected = this.parent.selectedElements.filter(function (element) {\n        return element.getAttribute('data-guid') === target.getAttribute('data-guid');\n      });\n\n      if (isAlreadySelected.length <= 0) {\n        var focusElements = [].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + target.getAttribute('data-guid') + '\"]'));\n\n        for (var _i = 0, focusElements_1 = focusElements; _i < focusElements_1.length; _i++) {\n          var element = focusElements_1[_i];\n          this.parent.selectedElements.push(element);\n        }\n      } else {\n        var selectedElements = this.parent.selectedElements.filter(function (element) {\n          return element.getAttribute('data-guid') !== target.getAttribute('data-guid');\n        });\n        this.parent.selectedElements = selectedElements;\n      }\n    }\n\n    if (target && this.parent.selectedElements.length > 0) {\n      this.addSelectedAppointments(this.parent.selectedElements);\n    }\n\n    return this.parent.selectedElements;\n  };\n\n  EventBase.prototype.getSelectedEvents = function () {\n    var _this = this;\n\n    var eventSelect = [];\n    var elementSelect = [];\n    var selectAppointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n    selectAppointments.filter(function (element) {\n      var isAlreadyAdded = eventSelect.filter(function (event) {\n        return event.Guid === element.getAttribute('data-guid');\n      });\n\n      if (isAlreadyAdded.length === 0) {\n        eventSelect.push(_this.getEventByGuid(element.getAttribute('data-guid')));\n      }\n\n      elementSelect.push(element);\n    });\n    return {\n      event: eventSelect.length > 1 ? eventSelect : eventSelect[0],\n      element: elementSelect.length > 1 ? elementSelect : elementSelect[0]\n    };\n  };\n\n  EventBase.prototype.removeSelectedAppointmentClass = function () {\n    var selectedAppointments = this.getSelectedAppointments();\n\n    for (var _i = 0, selectedAppointments_1 = selectedAppointments; _i < selectedAppointments_1.length; _i++) {\n      var appointment = selectedAppointments_1[_i];\n      appointment.setAttribute('aria-selected', 'false');\n    }\n\n    removeClass(selectedAppointments, cls.APPOINTMENT_BORDER);\n\n    if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      removeClass(selectedAppointments, cls.AGENDA_SELECTED_CELL);\n    }\n  };\n\n  EventBase.prototype.addSelectedAppointments = function (cells) {\n    for (var _i = 0, cells_1 = cells; _i < cells_1.length; _i++) {\n      var cell = cells_1[_i];\n      cell.setAttribute('aria-selected', 'true');\n    }\n\n    if (this.parent.currentView !== 'MonthAgenda') {\n      this.parent.removeSelectedClass();\n    }\n\n    addClass(cells, cls.APPOINTMENT_BORDER);\n  };\n\n  EventBase.prototype.getSelectedAppointments = function () {\n    return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER + ',.' + cls.APPOINTMENT_CLASS + ':focus'));\n  };\n\n  EventBase.prototype.focusElement = function () {\n    var selectedCell = this.parent.getSelectedElements();\n\n    if (selectedCell.length > 0) {\n      if (this.parent.keyboardInteractionModule) {\n        var target = !isNullOrUndefined(this.parent.activeCellsData) && this.parent.activeCellsData.element || selectedCell[selectedCell.length - 1];\n        this.parent.keyboardInteractionModule.selectCells(target instanceof Array, target);\n      }\n\n      return;\n    }\n\n    var selectedAppointments = this.getSelectedAppointments();\n\n    if (selectedAppointments.length > 0) {\n      selectedAppointments[selectedAppointments.length - 1].focus();\n      return;\n    }\n  };\n\n  EventBase.prototype.selectWorkCellByTime = function (eventsData) {\n    var target;\n\n    if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      return target;\n    }\n\n    if (eventsData.length > 0) {\n      var selectedObject = eventsData[eventsData.length - 1];\n      var eventStartTime = selectedObject[this.parent.eventFields.startTime];\n      var nearestTime = new Date(+eventStartTime).setMinutes(0, 0, 0);\n      var isAllDay = this.isAllDayAppointment(selectedObject);\n\n      if (this.parent.currentView === 'Month' || isAllDay) {\n        nearestTime = new Date(+eventStartTime).setHours(0, 0, 0, 0);\n      }\n\n      var targetArea = void 0;\n\n      if (isAllDay && ['Day', 'Week', 'WorkWeek'].indexOf(this.parent.currentView) !== -1) {\n        targetArea = this.parent.getAllDayRow();\n      } else {\n        targetArea = this.parent.getContentTable();\n      }\n\n      var queryString = '[data-date=\"' + this.parent.getMsFromDate(new Date(nearestTime)) + '\"]';\n\n      if (this.parent.activeViewOptions.group.resources.length > 0) {\n        queryString += '[data-group-index=\"' + this.getGroupIndexFromEvent(selectedObject) + '\"]';\n      }\n\n      target = targetArea.querySelector(queryString);\n\n      if (target) {\n        this.parent.activeCellsData = this.parent.getCellDetails(target);\n\n        if (this.parent.keyboardInteractionModule) {\n          this.parent.keyboardInteractionModule.selectCells(false, target);\n        }\n\n        return target;\n      }\n    }\n\n    return target;\n  };\n\n  EventBase.prototype.getGroupIndexFromEvent = function (eventData) {\n    var levelName = name || this.parent.resourceCollection.slice(-1)[0].name;\n    var levelIndex = this.parent.resourceCollection.length - 1;\n    var idField = this.parent.resourceCollection.slice(-1)[0].field;\n    var id = eventData[idField] instanceof Array ? eventData[idField][0] : eventData[idField];\n    var resource = this.parent.resourceCollection.filter(function (e, index) {\n      if (e.name === levelName) {\n        levelIndex = index;\n        return e;\n      }\n\n      return null;\n    })[0];\n    return this.parent.resourceBase.getIndexFromResourceId(id, levelName, resource);\n  };\n\n  EventBase.prototype.isAllDayAppointment = function (event) {\n    var fieldMapping = this.parent.eventFields;\n    var isAllDay = event[fieldMapping.isAllDay];\n    var isFullDay = (event[fieldMapping.endTime].getTime() - event[fieldMapping.startTime].getTime()) / util.MS_PER_DAY >= 1;\n    return isAllDay || isFullDay ? true : false;\n  };\n\n  EventBase.prototype.addEventListener = function () {\n    this.parent.on(event.documentClick, this.appointmentBorderRemove, this);\n  };\n\n  EventBase.prototype.appointmentBorderRemove = function (event) {\n    var element = event.event.target;\n\n    if (closest(element, '.' + cls.APPOINTMENT_CLASS)) {\n      if (this.parent.currentView !== 'MonthAgenda') {\n        this.parent.removeSelectedClass();\n      }\n    } else if (!closest(element, '.' + cls.POPUP_OPEN)) {\n      this.removeSelectedAppointmentClass();\n    }\n  };\n\n  EventBase.prototype.wireAppointmentEvents = function (element, event, isPreventCrud) {\n    if (isPreventCrud === void 0) {\n      isPreventCrud = false;\n    }\n\n    var isReadOnly = !isNullOrUndefined(event) ? event[this.parent.eventFields.isReadonly] : false;\n\n    if (Browser.isTouch && !this.parent.isAdaptive) {\n      EventHandler.add(element, 'touchstart', this.eventTouch, this);\n    } else {\n      EventHandler.add(element, 'click', this.eventClick, this);\n    }\n\n    if (!this.parent.isAdaptive && !this.parent.activeViewOptions.readonly && !isReadOnly) {\n      EventHandler.add(element, 'dblclick', this.eventDoubleClick, this);\n    }\n\n    if (!this.parent.activeViewOptions.readonly && !isReadOnly && !isPreventCrud) {\n      if (this.parent.resizeModule) {\n        this.parent.resizeModule.wireResizeEvent(element);\n      }\n\n      if (this.parent.dragAndDropModule) {\n        this.parent.dragAndDropModule.wireDragEvent(element);\n      }\n    }\n  };\n\n  EventBase.prototype.eventTouch = function (eventData) {\n    var _this = this;\n\n    setTimeout(function () {\n      return _this.isDoubleTapped = false;\n    }, 250);\n\n    if (this.isDoubleTapped) {\n      eventData.preventDefault();\n      this.eventDoubleClick(eventData);\n    } else {\n      this.isDoubleTapped = true;\n      this.eventClick(eventData);\n    }\n  };\n\n  EventBase.prototype.renderResizeHandler = function (element, spanEvent, isReadOnly) {\n    if (!this.parent.resizeModule || !this.parent.allowResizing || this.parent.activeViewOptions.readonly || isReadOnly) {\n      return;\n    }\n\n    for (var _i = 0, _a = Object.keys(spanEvent); _i < _a.length; _i++) {\n      var resizeEdge = _a[_i];\n      var resizeHandler = createElement('div', {\n        className: cls.EVENT_RESIZE_CLASS\n      });\n\n      switch (resizeEdge) {\n        case 'isLeft':\n          if (!spanEvent.isLeft) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-left-right-resize'\n            }));\n            addClass([resizeHandler], this.parent.enableRtl ? cls.RIGHT_RESIZE_HANDLER : cls.LEFT_RESIZE_HANDLER);\n            prepend([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isRight':\n          if (!spanEvent.isRight) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-left-right-resize'\n            }));\n            addClass([resizeHandler], this.parent.enableRtl ? cls.LEFT_RESIZE_HANDLER : cls.RIGHT_RESIZE_HANDLER);\n            append([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isTop':\n          if (!spanEvent.isTop) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-top-bottom-resize'\n            }));\n            addClass([resizeHandler], cls.TOP_RESIZE_HANDLER);\n            prepend([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isBottom':\n          if (!spanEvent.isBottom) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-top-bottom-resize'\n            }));\n            addClass([resizeHandler], cls.BOTTOM_RESIZE_HANDLER);\n            append([resizeHandler], element);\n          }\n\n          break;\n      }\n    }\n  };\n\n  EventBase.prototype.eventClick = function (eventData) {\n    var _this = this;\n\n    var target = eventData.target;\n\n    if (target.classList.contains(cls.DRAG_CLONE_CLASS) || target.classList.contains(cls.RESIZE_CLONE_CLASS)) {\n      return;\n    }\n\n    if (eventData.ctrlKey && eventData.which === 1 && this.parent.keyboardInteractionModule) {\n      this.parent.quickPopup.quickPopup.hide();\n      this.parent.selectedElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n      var target_1 = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n      this.getSelectedEventElements(target_1);\n      this.activeEventData(eventData, false);\n      var selectArgs = {\n        data: this.parent.activeEventData.event,\n        element: this.parent.activeEventData.element,\n        event: eventData,\n        requestType: 'eventSelect'\n      };\n      this.parent.trigger(event.select, selectArgs);\n      var args = extend(this.parent.activeEventData, {\n        cancel: false,\n        originalEvent: eventData\n      });\n      this.parent.trigger(event.eventClick, args);\n    } else {\n      this.removeSelectedAppointmentClass();\n      this.activeEventData(eventData, true);\n      var selectEventArgs = {\n        data: this.parent.activeEventData.event,\n        element: this.parent.activeEventData.element,\n        event: eventData,\n        requestType: 'eventSelect'\n      };\n      this.parent.trigger(event.select, selectEventArgs);\n      var args = extend(this.parent.activeEventData, {\n        cancel: false,\n        originalEvent: eventData\n      });\n      this.parent.trigger(event.eventClick, args, function (eventClickArgs) {\n        if (isBlazor()) {\n          var eventFields = _this.parent.eventFields;\n          var eventObj = eventClickArgs.event;\n          eventObj[eventFields.startTime] = _this.parent.getDateTime(eventObj[eventFields.startTime]);\n          eventObj[eventFields.endTime] = _this.parent.getDateTime(eventObj[eventFields.endTime]);\n\n          if (eventClickArgs.element) {\n            eventClickArgs.element = getElement(eventClickArgs.element);\n          }\n        }\n\n        if (eventClickArgs.cancel) {\n          _this.removeSelectedAppointmentClass();\n\n          if (_this.parent.quickPopup) {\n            _this.parent.quickPopup.quickPopupHide();\n          }\n        } else {\n          if (_this.parent.currentView === 'Agenda' || _this.parent.currentView === 'MonthAgenda') {\n            addClass([_this.parent.activeEventData.element], cls.AGENDA_SELECTED_CELL);\n          }\n\n          _this.parent.notify(event.eventClick, eventClickArgs);\n        }\n      });\n    }\n  };\n\n  EventBase.prototype.eventDoubleClick = function (e) {\n    this.parent.quickPopup.quickPopupHide(true);\n\n    if (e.type === 'touchstart') {\n      this.activeEventData(e, true);\n    }\n\n    this.removeSelectedAppointmentClass();\n\n    if (!isNullOrUndefined(this.parent.activeEventData.event) && isNullOrUndefined(this.parent.activeEventData.event[this.parent.eventFields.recurrenceID])) {\n      this.parent.eventWindow.openEditor(this.parent.activeEventData.event, 'Save');\n    } else {\n      this.parent.currentAction = 'EditOccurrence';\n      this.parent.quickPopup.openRecurrenceAlert();\n    }\n  };\n\n  EventBase.prototype.getEventByGuid = function (guid) {\n    return this.parent.eventsProcessed.filter(function (data) {\n      return data.Guid === guid;\n    })[0];\n  };\n\n  EventBase.prototype.getEventById = function (id) {\n    var _this = this;\n\n    return this.parent.eventsData.filter(function (data) {\n      return data[_this.parent.eventFields.id] === id;\n    })[0];\n  };\n\n  EventBase.prototype.generateGuid = function () {\n    return 'xyxxxxyx-xxxy-yxxx-xyxx-xxyxxxxyyxxx'.replace(/[xy]/g, function (c) {\n      var r = Math.random() * 16 | 0;\n      var v = c === 'x' ? r : r & 0x3 | 0x8;\n      return v.toString(16);\n    });\n  };\n\n  EventBase.prototype.getEventIDType = function () {\n    if (this.parent.eventsData.length !== 0) {\n      return typeof this.parent.eventsData[0][this.parent.eventFields.id];\n    }\n\n    if (this.parent.blockData.length !== 0) {\n      return typeof this.parent.blockData[0][this.parent.eventFields.id];\n    }\n\n    return 'string';\n  };\n\n  EventBase.prototype.getEventMaxID = function (resourceId) {\n    var _this = this;\n\n    if (this.parent.eventsData.length < 1 && this.parent.blockData.length < 1) {\n      return 1;\n    }\n\n    var eventId;\n    var idType = this.getEventIDType();\n\n    if (idType === 'string') {\n      eventId = this.generateGuid();\n    }\n\n    if (idType === 'number') {\n      var datas = this.parent.eventsData.concat(this.parent.blockData);\n      var maxId = Math.max.apply(Math, datas.map(function (event) {\n        return event[_this.parent.eventFields.id];\n      }));\n      maxId = isNullOrUndefined(resourceId) ? maxId : maxId + resourceId;\n      eventId = maxId + 1;\n    }\n\n    return eventId;\n  };\n\n  EventBase.prototype.activeEventData = function (eventData, isMultiple) {\n    var _this = this;\n\n    var target = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n    var guid = target.getAttribute('data-guid');\n\n    if (isMultiple) {\n      this.addSelectedAppointments([].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]')));\n      target.focus();\n    }\n\n    var eventObject = this.getEventByGuid(guid);\n\n    if (eventObject && eventObject.isSpanned) {\n      eventObject = this.parent.eventsData.filter(function (obj) {\n        return obj[_this.parent.eventFields.id] === eventObject[_this.parent.eventFields.id];\n      })[0];\n    }\n\n    this.parent.activeEventData = {\n      event: eventObject,\n      element: target\n    };\n  };\n\n  EventBase.prototype.generateOccurrence = function (event, viewDate, oldTimezone, isMaxCount) {\n    var startDate = event[this.parent.eventFields.startTime];\n    var endDate = event[this.parent.eventFields.endTime];\n    var eventRule = event[this.parent.eventFields.recurrenceRule];\n    var duration = endDate.getTime() - startDate.getTime();\n    viewDate = new Date((viewDate || this.parent.activeView.startDate()).getTime() - duration);\n    var exception = event[this.parent.eventFields.recurrenceException];\n    var maxCount;\n\n    if (this.parent.currentView !== 'Agenda' && isMaxCount) {\n      maxCount = util.getDateCount(this.parent.activeView.startDate(), this.parent.activeView.endDate()) + 1;\n    }\n\n    var newTimezone = this.parent.timezone || this.parent.tzModule.getLocalTimezoneName();\n    var firstDay = this.parent.activeViewOptions.firstDayOfWeek;\n    var calendarMode = this.parent.calendarMode;\n    var dates = generate(startDate, eventRule, exception, firstDay, maxCount, viewDate, calendarMode, oldTimezone, newTimezone);\n\n    if (this.parent.currentView === 'Agenda' && eventRule.indexOf('COUNT') === -1 && eventRule.indexOf('UNTIL') === -1) {\n      if (isNullOrUndefined(event.generatedDates)) {\n        event.generatedDates = {\n          start: new Date(dates[0]),\n          end: new Date(dates[dates.length - 1])\n        };\n      } else {\n        if (dates[0] < event.generatedDates.start.getTime()) {\n          event.generatedDates.start = new Date(dates[0]);\n        }\n\n        if (dates[dates.length - 1] > event.generatedDates.end.getTime()) {\n          event.generatedDates.end = new Date(dates[dates.length - 1]);\n        }\n      }\n    }\n\n    var occurrenceCollection = [];\n\n    for (var _i = 0, dates_1 = dates; _i < dates_1.length; _i++) {\n      var date = dates_1[_i];\n      var clonedObject = extend({}, event, null, true);\n      clonedObject[this.parent.eventFields.startTime] = new Date(date);\n      clonedObject[this.parent.eventFields.endTime] = new Date(new Date(date).setMilliseconds(duration));\n      clonedObject[this.parent.eventFields.recurrenceID] = clonedObject[this.parent.eventFields.id];\n      delete clonedObject[this.parent.eventFields.recurrenceException];\n      delete clonedObject[this.parent.eventFields.followingID];\n      clonedObject.Guid = this.generateGuid();\n      occurrenceCollection.push(clonedObject);\n    }\n\n    return occurrenceCollection;\n  };\n\n  EventBase.prototype.getParentEvent = function (eventObj, isParent) {\n    if (isParent === void 0) {\n      isParent = false;\n    }\n\n    var parentEvent;\n\n    do {\n      eventObj = this.getFollowingEvent(eventObj);\n\n      if (eventObj) {\n        parentEvent = extend({}, eventObj, null, true);\n      }\n    } while (eventObj && isParent);\n\n    if (isParent && parentEvent) {\n      var collection = this.getEventCollections(parentEvent);\n      var followObj = collection.follow.slice(-1)[0];\n\n      if (collection.occurrence.length > 0 && !parentEvent[this.parent.eventFields.recurrenceException]) {\n        followObj = collection.occurrence.slice(-1)[0];\n      }\n\n      if (followObj) {\n        parentEvent[this.parent.eventFields.recurrenceRule] = followObj[this.parent.eventFields.recurrenceRule];\n      }\n    }\n\n    return parentEvent;\n  };\n\n  EventBase.prototype.getEventCollections = function (parentObj, childObj) {\n    var followingCollection = [];\n    var occurrenceCollection = [];\n    var followingEvent = parentObj;\n\n    do {\n      followingEvent = this.getFollowingEvent(followingEvent, true);\n\n      if (followingEvent) {\n        followingCollection.push(followingEvent);\n      }\n\n      occurrenceCollection = occurrenceCollection.concat(this.getOccurrenceEvent(followingEvent || parentObj));\n    } while (followingEvent);\n\n    var collections = {};\n\n    if (childObj) {\n      var fields_1 = this.parent.eventFields;\n      collections = {\n        follow: followingCollection.filter(function (eventData) {\n          return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\n        }),\n        occurrence: occurrenceCollection.filter(function (eventData) {\n          return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\n        })\n      };\n    } else {\n      collections = {\n        follow: followingCollection,\n        occurrence: occurrenceCollection\n      };\n    }\n\n    return collections;\n  };\n\n  EventBase.prototype.getFollowingEvent = function (parentObj, isReverse) {\n    var fields = this.parent.eventFields;\n    var fieldValue;\n\n    if (isReverse) {\n      fieldValue = parentObj[fields.id];\n    } else {\n      fieldValue = parentObj[fields.recurrenceID] || parentObj[fields.followingID];\n    }\n\n    var parentApp = this.parent.eventsData.filter(function (data) {\n      return data[isReverse ? fields.followingID : fields.id] === fieldValue;\n    });\n    return parentApp.shift();\n  };\n\n  EventBase.prototype.isFollowingEvent = function (parentObj, childObj) {\n    var parentStart = parentObj[this.parent.eventFields.startTime];\n    var childStart = childObj[this.parent.eventFields.startTime];\n    return parentStart.getHours() === childStart.getHours() && parentStart.getMinutes() === childStart.getMinutes() && parentStart.getSeconds() === childStart.getSeconds();\n  };\n\n  EventBase.prototype.getOccurrenceEvent = function (eventObj, isGuid, isFollowing) {\n    if (isGuid === void 0) {\n      isGuid = false;\n    }\n\n    if (isFollowing === void 0) {\n      isFollowing = false;\n    }\n\n    var idField = isGuid ? 'Guid' : isFollowing ? this.parent.eventFields.followingID : this.parent.eventFields.recurrenceID;\n    var fieldKey = isGuid ? 'Guid' : this.parent.eventFields.id;\n    var dataSource = isGuid ? this.parent.eventsProcessed : this.parent.eventsData;\n    return dataSource.filter(function (data) {\n      return data[idField] === eventObj[fieldKey];\n    });\n  };\n\n  EventBase.prototype.getOccurrencesByID = function (id) {\n    var fields = this.parent.eventFields;\n    var occurrenceCollection = [];\n    var parentObject = this.parent.eventsData.filter(function (obj) {\n      return obj[fields.id] === id;\n    });\n\n    for (var _i = 0, _a = parentObject; _i < _a.length; _i++) {\n      var event_3 = _a[_i];\n\n      if (!isNullOrUndefined(event_3[fields.recurrenceRule])) {\n        occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_3));\n      }\n    }\n\n    return occurrenceCollection;\n  };\n\n  EventBase.prototype.getOccurrencesByRange = function (startTime, endTime) {\n    var fields = this.parent.eventFields;\n    var occurrenceCollection = [];\n\n    for (var _i = 0, _a = this.parent.eventsData; _i < _a.length; _i++) {\n      var event_4 = _a[_i];\n\n      if (!isNullOrUndefined(event_4[fields.recurrenceRule])) {\n        occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_4));\n      }\n    }\n\n    var filter = occurrenceCollection.filter(function (obj) {\n      return obj[fields.startTime] >= startTime && obj[fields.endTime] <= endTime && !isNullOrUndefined(obj[fields.recurrenceID]);\n    });\n    return filter;\n  };\n\n  EventBase.prototype.getDeletedOccurrences = function (recurrenceData) {\n    var _this = this;\n\n    var fields = this.parent.eventFields;\n    var parentObject;\n    var deletedOccurrences = [];\n\n    if (typeof recurrenceData === 'string' || typeof recurrenceData === 'number') {\n      parentObject = this.parent.eventsData.filter(function (obj) {\n        return obj[fields.id] === recurrenceData;\n      })[0];\n    } else {\n      parentObject = extend({}, recurrenceData, null, true);\n    }\n\n    if (parentObject[fields.recurrenceException]) {\n      var exDateString = parentObject[fields.recurrenceException].split(',');\n      exDateString.forEach(function (date) {\n        var edited = _this.parent.eventsData.filter(function (eventObj) {\n          return eventObj[fields.recurrenceID] === parentObject[fields.id] && eventObj[fields.recurrenceException] === date;\n        });\n\n        if (edited.length === 0) {\n          var exDate = getDateFromRecurrenceDateString(date);\n          var childObject = extend({}, recurrenceData, null, true);\n          childObject[fields.recurrenceID] = parentObject[fields.id];\n          delete childObject[fields.followingID];\n          childObject[fields.recurrenceException] = date;\n          var startDate = new Date(exDate.getTime());\n          var time = parentObject[fields.endTime].getTime() - parentObject[fields.startTime].getTime();\n          var endDate = new Date(startDate.getTime());\n          endDate.setMilliseconds(time);\n          childObject[fields.startTime] = new Date(startDate.getTime());\n          childObject[fields.endTime] = new Date(endDate.getTime());\n          deletedOccurrences.push(childObject);\n        }\n      });\n    }\n\n    return deletedOccurrences;\n  };\n\n  EventBase.prototype.applyResourceColor = function (element, data, type, index, alpha) {\n    if (!this.parent.resourceBase) {\n      return;\n    }\n\n    var alphaColor = function (color, alpha) {\n      color = color.replace('#', '');\n      var r = parseInt(color.substring(0, color.length / 3), 16);\n      var g = parseInt(color.substring(color.length / 3, 2 * color.length / 3), 16);\n      var b = parseInt(color.substring(2 * color.length / 3, 3 * color.length / 3), 16);\n      return \"rgba(\" + r + \", \" + g + \", \" + b + \", \" + alpha + \")\";\n    }; // index refers groupOrder\n\n\n    var color = this.parent.resourceBase.getResourceColor(data, index);\n\n    if (color) {\n      // tslint:disable-next-line:no-any\n      element.style[type] = !isNullOrUndefined(alpha) ? alphaColor(color, alpha) : color;\n    }\n  };\n\n  EventBase.prototype.createBlockAppointmentElement = function (record, resIndex) {\n    var eventSubject = record[this.parent.eventFields.subject] || this.parent.eventSettings.fields.subject.default;\n    var appointmentWrapper = createElement('div', {\n      className: cls.BLOCK_APPOINTMENT_CLASS,\n      attrs: {\n        'data-id': 'Appointment_' + record[this.parent.eventFields.id],\n        'aria-readonly': 'true',\n        'aria-selected': 'false'\n      }\n    });\n    var templateElement;\n\n    if (!isNullOrUndefined(this.parent.activeViewOptions.eventTemplate)) {\n      var scheduleId = this.parent.element.id + '_';\n      var viewName = this.parent.activeViewOptions.eventTemplateName;\n      var templateId = scheduleId + viewName + 'eventTemplate';\n      var templateArgs = util.addLocalOffsetToEvent(record, this.parent.eventFields);\n      templateElement = this.parent.getAppointmentTemplate()(templateArgs, this.parent, 'eventTemplate', templateId, false);\n    } else {\n      var appointmentSubject = createElement('div', {\n        className: cls.SUBJECT_CLASS,\n        innerHTML: eventSubject\n      });\n      templateElement = [appointmentSubject];\n    }\n\n    append(templateElement, appointmentWrapper);\n    this.setWrapperAttributes(appointmentWrapper, resIndex);\n    return appointmentWrapper;\n  };\n\n  EventBase.prototype.setWrapperAttributes = function (appointmentWrapper, resIndex) {\n    if (!isNullOrUndefined(this.cssClass)) {\n      addClass([appointmentWrapper], this.cssClass);\n    }\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      appointmentWrapper.setAttribute('data-group-index', resIndex.toString());\n    }\n  };\n\n  EventBase.prototype.getReadonlyAttribute = function (event) {\n    return event[this.parent.eventFields.isReadonly] ? event[this.parent.eventFields.isReadonly] : 'false';\n  };\n\n  EventBase.prototype.isBlockRange = function (eventData) {\n    var _this = this;\n\n    var eventCollection = eventData instanceof Array ? eventData : [eventData];\n    var isBlockAlert = false;\n    var fields = this.parent.eventFields;\n    eventCollection.forEach(function (event) {\n      var dataCol = [];\n\n      if (!isNullOrUndefined(event[fields.recurrenceRule]) && (isNullOrUndefined(event[fields.recurrenceID]) || event[fields.id] === event[fields.recurrenceID])) {\n        dataCol = _this.generateOccurrence(event);\n      } else {\n        dataCol.push(event);\n      }\n\n      for (var _i = 0, dataCol_1 = dataCol; _i < dataCol_1.length; _i++) {\n        var data = dataCol_1[_i];\n\n        var filterBlockEvents = _this.filterBlockEvents(data);\n\n        if (filterBlockEvents.length > 0) {\n          isBlockAlert = true;\n          break;\n        }\n      }\n    });\n    this.parent.uiStateValues.isBlock = isBlockAlert;\n    return isBlockAlert;\n  };\n\n  EventBase.prototype.getFilterEventsList = function (dataSource, query) {\n    return new DataManager(dataSource).executeLocal(new Query().where(query));\n  };\n\n  EventBase.prototype.getSeriesEvents = function (parentEvent, startTime) {\n    var fields = this.parent.eventFields;\n    startTime = isNullOrUndefined(startTime) ? parentEvent[fields.startTime] : startTime;\n    var deleteFutureEditEvents;\n    var futureEvents;\n    var deleteFutureEditEventList = [];\n    var delId = parentEvent[fields.id];\n    var followingId = parentEvent[fields.followingID];\n    var deleteFutureEvent;\n    var startTimeQuery = this.parent.currentAction === 'EditSeries' ? 'greaterthan' : 'greaterthanorequal';\n\n    do {\n      deleteFutureEvent = new Predicate(fields.followingID, 'equal', delId).and(new Predicate(fields.startTime, startTimeQuery, startTime));\n      futureEvents = this.getFilterEventsList(this.parent.eventsData, deleteFutureEvent);\n      deleteFutureEditEvents = futureEvents.slice(-1)[0];\n\n      if (!isNullOrUndefined(deleteFutureEditEvents) && deleteFutureEditEvents[fields.id] !== followingId) {\n        deleteFutureEditEventList.push(deleteFutureEditEvents);\n        delId = deleteFutureEditEvents[fields.id];\n        followingId = deleteFutureEditEvents[fields.followingID];\n      } else {\n        followingId = null;\n      }\n    } while (futureEvents.length === 1 && !isNullOrUndefined(deleteFutureEditEvents[fields.followingID]));\n\n    return deleteFutureEditEventList;\n  };\n\n  EventBase.prototype.getEditedOccurrences = function (deleteFutureEditEventList, startTime) {\n    var fields = this.parent.eventFields;\n    var deleteRecurrenceEventList = [];\n    var delEditedEvents;\n\n    for (var _i = 0, deleteFutureEditEventList_1 = deleteFutureEditEventList; _i < deleteFutureEditEventList_1.length; _i++) {\n      var event_5 = deleteFutureEditEventList_1[_i];\n      var delEventQuery = new Predicate(fields.recurrenceID, 'equal', event_5[fields.id]).or(new Predicate(fields.recurrenceID, 'equal', event_5[fields.followingID]).and(new Predicate(fields.recurrenceID, 'notequal', undefined)));\n\n      if (this.parent.currentAction === 'EditFollowingEvents' || this.parent.currentAction === 'DeleteFollowingEvents') {\n        delEventQuery = delEventQuery.and(new Predicate(fields.startTime, 'greaterthanorequal', startTime));\n      }\n\n      delEditedEvents = this.getFilterEventsList(this.parent.eventsData, delEventQuery);\n      deleteRecurrenceEventList = deleteRecurrenceEventList.concat(delEditedEvents);\n    }\n\n    return deleteRecurrenceEventList;\n  };\n\n  EventBase.prototype.getRenderedDates = function (dateRender) {\n    var firstDate = 0;\n    var lastDate = dateRender.length;\n    var filteredDates;\n\n    if (dateRender[0] < this.parent.minDate && dateRender[dateRender.length - 1] > this.parent.maxDate) {\n      for (var i = 0; i < dateRender.length; i++) {\n        if (dateRender[i].getTime() === this.parent.minDate.getTime()) {\n          firstDate = i;\n        }\n\n        if (dateRender[i].getTime() === this.parent.maxDate.getTime()) {\n          lastDate = i;\n        }\n      }\n\n      filteredDates = dateRender.filter(function (date) {\n        return date >= dateRender[firstDate] && date <= dateRender[lastDate];\n      });\n    }\n\n    return filteredDates;\n  };\n\n  EventBase.prototype.isValidEvent = function (eventObj, start, end, schedule) {\n    var isHourRange = end.getTime() > schedule.startHour.getTime() && start.getTime() < schedule.endHour.getTime();\n    var isSameRange = schedule.startHour.getTime() <= start.getTime() && eventObj[this.parent.eventFields.startTime].getTime() >= schedule.startHour.getTime() && eventObj[this.parent.eventFields.endTime].getTime() < schedule.endHour.getTime() && start.getTime() === end.getTime();\n    return isHourRange || isSameRange;\n  };\n\n  return EventBase;\n}();\n\nexport { EventBase };","map":{"version":3,"sources":["/Users/ewong/Development/Whiteboard/node_modules/@syncfusion/ej2-schedule/src/schedule/event-renderer/event-base.js"],"names":["isNullOrUndefined","closest","Browser","extend","EventHandler","isBlazor","createElement","prepend","append","addClass","removeClass","getElement","DataManager","Query","Predicate","generate","getDateFromRecurrenceDateString","util","cls","event","EventBase","parent","slots","isDoubleTapped","prototype","processData","events","timeZonePropChanged","oldTimezone","_this","start","activeView","startDate","end","endDate","fields","eventFields","eventsProcessed","processed","temp","generateID","resourceCollection","resourceBase","length","id","_i","events_1","event_1","startTime","getDateFromString","endTime","processTimezoneChange","processTimezone","level","field","undefined","recurrenceRule","recurrenceID","concat","generateOccurrence","Guid","generateGuid","push","eventData","filter","data","isBlock","filterEvents","blockData","forEach","eventObj","isAllDay","resetTime","addDays","blockProcessed","getProcessedEvents","eventCollection","eventsData","_a","event_2","timezonePropertyChange","notify","dataReady","processedData","timezoneConvert","startTimezone","endTimezone","timezone","startTz","endTz","tzModule","convert","add","remove","isReverse","zone","filterBlockEvents","eStart","eEnd","resourceData","activeViewOptions","group","resources","getGroupIndexFromEvent","lastResourceLevel","appointments","resourceTdData","fieldMapping","predicate","and","or","json","executeLocal","where","filterEventsByResource","sortByTime","filterEventsByRange","filteredEvents","e","groupOrder","keys","Object","filteredCollection","every","key","Array","indexOf","sort","a","b","d1","d2","getTime","sortByDateTime","object1","object2","d3","d4","d5","d6","getSmallestMissingNumber","array","large","Math","max","apply","i","splitEventByDay","eventStartTime","eventEndTime","isDifferentDate","Date","getHours","getMinutes","index","eventLength","getDaysCount","app","count","isSpanned","setHours","getSeconds","splitEvent","dateRender","getDateInMs","orgStart","orgEnd","ranges","cStart","_loop_1","slot","this_1","currentView","byDate","showWeekend","slotDates_1","x","renderedDates","getRenderedDates","date","firstSlot","startIndex","endIndex","hasBreak","isLeft","isRight","cloneEventObject","dateInRange","availSlot","availSlot_1","slot_1","state_1","getSelectedEventElements","target","removeSelectedAppointmentClass","selectedElements","isAlreadySelected","element","getAttribute","focusElements","slice","call","querySelectorAll","focusElements_1","addSelectedAppointments","getSelectedEvents","eventSelect","elementSelect","selectAppointments","APPOINTMENT_BORDER","isAlreadyAdded","getEventByGuid","selectedAppointments","getSelectedAppointments","selectedAppointments_1","appointment","setAttribute","AGENDA_SELECTED_CELL","cells","cells_1","cell","removeSelectedClass","APPOINTMENT_CLASS","focusElement","selectedCell","getSelectedElements","keyboardInteractionModule","activeCellsData","selectCells","focus","selectWorkCellByTime","selectedObject","nearestTime","setMinutes","isAllDayAppointment","targetArea","getAllDayRow","getContentTable","queryString","getMsFromDate","querySelector","getCellDetails","levelName","name","levelIndex","idField","resource","getIndexFromResourceId","isFullDay","MS_PER_DAY","addEventListener","on","documentClick","appointmentBorderRemove","POPUP_OPEN","wireAppointmentEvents","isPreventCrud","isReadOnly","isReadonly","isTouch","isAdaptive","eventTouch","eventClick","readonly","eventDoubleClick","resizeModule","wireResizeEvent","dragAndDropModule","wireDragEvent","setTimeout","preventDefault","renderResizeHandler","spanEvent","allowResizing","resizeEdge","resizeHandler","className","EVENT_RESIZE_CLASS","appendChild","enableRtl","RIGHT_RESIZE_HANDLER","LEFT_RESIZE_HANDLER","isTop","TOP_RESIZE_HANDLER","isBottom","BOTTOM_RESIZE_HANDLER","classList","contains","DRAG_CLONE_CLASS","RESIZE_CLONE_CLASS","ctrlKey","which","quickPopup","hide","target_1","activeEventData","selectArgs","requestType","trigger","select","args","cancel","originalEvent","selectEventArgs","eventClickArgs","getDateTime","quickPopupHide","type","eventWindow","openEditor","currentAction","openRecurrenceAlert","guid","getEventById","replace","c","r","random","v","toString","getEventIDType","getEventMaxID","resourceId","eventId","idType","datas","maxId","map","isMultiple","eventObject","obj","viewDate","isMaxCount","eventRule","duration","exception","recurrenceException","maxCount","getDateCount","newTimezone","getLocalTimezoneName","firstDay","firstDayOfWeek","calendarMode","dates","generatedDates","occurrenceCollection","dates_1","clonedObject","setMilliseconds","followingID","getParentEvent","isParent","parentEvent","getFollowingEvent","collection","getEventCollections","followObj","follow","occurrence","parentObj","childObj","followingCollection","followingEvent","getOccurrenceEvent","collections","fields_1","fieldValue","parentApp","shift","isFollowingEvent","parentStart","childStart","isGuid","isFollowing","fieldKey","dataSource","getOccurrencesByID","parentObject","event_3","getOccurrencesByRange","event_4","getDeletedOccurrences","recurrenceData","deletedOccurrences","exDateString","split","edited","exDate","childObject","time","applyResourceColor","alpha","alphaColor","color","parseInt","substring","g","getResourceColor","style","createBlockAppointmentElement","record","resIndex","eventSubject","subject","eventSettings","default","appointmentWrapper","BLOCK_APPOINTMENT_CLASS","attrs","templateElement","eventTemplate","scheduleId","viewName","eventTemplateName","templateId","templateArgs","addLocalOffsetToEvent","getAppointmentTemplate","appointmentSubject","SUBJECT_CLASS","innerHTML","setWrapperAttributes","cssClass","getReadonlyAttribute","isBlockRange","isBlockAlert","dataCol","dataCol_1","uiStateValues","getFilterEventsList","query","getSeriesEvents","deleteFutureEditEvents","futureEvents","deleteFutureEditEventList","delId","followingId","deleteFutureEvent","startTimeQuery","getEditedOccurrences","deleteRecurrenceEventList","delEditedEvents","deleteFutureEditEventList_1","event_5","delEventQuery","firstDate","lastDate","filteredDates","minDate","maxDate","isValidEvent","schedule","isHourRange","startHour","endHour","isSameRange"],"mappings":"AAAA,SAASA,iBAAT,EAA4BC,OAA5B,EAAqCC,OAArC,EAA8CC,MAA9C,EAAsDC,YAAtD,EAAoEC,QAApE,QAAoF,sBAApF;AACA,SAASC,aAAT,EAAwBC,OAAxB,EAAiCC,MAAjC,EAAyCC,QAAzC,EAAmDC,WAAnD,EAAgEC,UAAhE,QAAkF,sBAAlF;AACA,SAASC,WAAT,EAAsBC,KAAtB,EAA6BC,SAA7B,QAA8C,sBAA9C;AACA,SAASC,QAAT,EAAmBC,+BAAnB,QAA0D,wCAA1D;AACA,OAAO,KAAKC,IAAZ,MAAsB,cAAtB;AACA,OAAO,KAAKC,GAAZ,MAAqB,sBAArB;AACA,OAAO,KAAKC,KAAZ,MAAuB,kBAAvB;AACA;;;;AAGA,IAAIC,SAAS;AAAG;AAAe,YAAY;AACvC;;;AAGA,WAASA,SAAT,CAAmBC,MAAnB,EAA2B;AACvB,SAAKC,KAAL,GAAa,EAAb;AACA,SAAKC,cAAL,GAAsB,KAAtB;AACA,SAAKF,MAAL,GAAcA,MAAd;AACH;;AACDD,EAAAA,SAAS,CAACI,SAAV,CAAoBC,WAApB,GAAkC,UAAUC,MAAV,EAAkBC,mBAAlB,EAAuCC,WAAvC,EAAoD;AAClF,QAAIC,KAAK,GAAG,IAAZ;;AACA,QAAIC,KAAK,GAAG,KAAKT,MAAL,CAAYU,UAAZ,CAAuBC,SAAvB,EAAZ;AACA,QAAIC,GAAG,GAAG,KAAKZ,MAAL,CAAYU,UAAZ,CAAuBG,OAAvB,EAAV;AACA,QAAIC,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACA,SAAKf,MAAL,CAAYgB,eAAZ,GAA8B,EAA9B;AACA,QAAIC,SAAS,GAAG,EAAhB;AACA,QAAIC,IAAI,GAAG,CAAX;AACA,QAAIC,UAAU,GAAG,KAAjB;AACA,QAAIC,kBAAkB,GAAG,KAAKpB,MAAL,CAAYqB,YAAZ,GAA2B,KAAKrB,MAAL,CAAYqB,YAAZ,CAAyBD,kBAApD,GAAyE,EAAlG;;AACA,QAAIf,MAAM,CAACiB,MAAP,GAAgB,CAAhB,IAAqB3C,iBAAiB,CAAC0B,MAAM,CAAC,CAAD,CAAN,CAAUS,MAAM,CAACS,EAAjB,CAAD,CAA1C,EAAkE;AAC9DJ,MAAAA,UAAU,GAAG,IAAb;AACH;;AACD,SAAK,IAAIK,EAAE,GAAG,CAAT,EAAYC,QAAQ,GAAGpB,MAA5B,EAAoCmB,EAAE,GAAGC,QAAQ,CAACH,MAAlD,EAA0DE,EAAE,EAA5D,EAAgE;AAC5D,UAAIE,OAAO,GAAGD,QAAQ,CAACD,EAAD,CAAtB;;AACA,UAAIL,UAAJ,EAAgB;AACZO,QAAAA,OAAO,CAACZ,MAAM,CAACS,EAAR,CAAP,GAAqBL,IAAI,EAAzB;AACH;;AACD,UAAI,OAAOQ,OAAO,CAACZ,MAAM,CAACa,SAAR,CAAd,KAAqC,QAAzC,EAAmD;AAC/CD,QAAAA,OAAO,CAACZ,MAAM,CAACa,SAAR,CAAP,GAA4B/B,IAAI,CAACgC,iBAAL,CAAuBF,OAAO,CAACZ,MAAM,CAACa,SAAR,CAA9B,CAA5B;AACH;;AACD,UAAI,OAAOD,OAAO,CAACZ,MAAM,CAACe,OAAR,CAAd,KAAmC,QAAvC,EAAiD;AAC7CH,QAAAA,OAAO,CAACZ,MAAM,CAACe,OAAR,CAAP,GAA0BjC,IAAI,CAACgC,iBAAL,CAAuBF,OAAO,CAACZ,MAAM,CAACe,OAAR,CAA9B,CAA1B;AACH;;AACD,UAAIvB,mBAAJ,EAAyB;AACrB,aAAKwB,qBAAL,CAA2BJ,OAA3B,EAAoCnB,WAApC;AACH,OAFD,MAGK;AACDmB,QAAAA,OAAO,GAAG,KAAKK,eAAL,CAAqBL,OAArB,CAAV;AACH;;AACD,WAAK,IAAIM,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGZ,kBAAkB,CAACE,MAA/C,EAAuDU,KAAK,EAA5D,EAAgE;AAC5D,YAAIN,OAAO,CAACN,kBAAkB,CAACY,KAAD,CAAlB,CAA0BC,KAA3B,CAAP,KAA6C,IAA7C,IAAqDP,OAAO,CAACN,kBAAkB,CAACY,KAAD,CAAlB,CAA0BC,KAA3B,CAAP,KAA6C,CAAtG,EAAyG;AACrGP,UAAAA,OAAO,CAACN,kBAAkB,CAACY,KAAD,CAAlB,CAA0BC,KAA3B,CAAP,GAA2CC,SAA3C;AACH;AACJ;;AACD,UAAI,CAACvD,iBAAiB,CAAC+C,OAAO,CAACZ,MAAM,CAACqB,cAAR,CAAR,CAAlB,IAAsDT,OAAO,CAACZ,MAAM,CAACqB,cAAR,CAAP,KAAmC,EAA7F,EAAiG;AAC7FT,QAAAA,OAAO,CAACZ,MAAM,CAACqB,cAAR,CAAP,GAAiC,IAAjC;AACH;;AACD,UAAI,CAACxD,iBAAiB,CAAC+C,OAAO,CAACZ,MAAM,CAACqB,cAAR,CAAR,CAAlB,IAAsDxD,iBAAiB,CAAC+C,OAAO,CAACZ,MAAM,CAACsB,YAAR,CAAR,CAA3E,EAA2G;AACvGnB,QAAAA,SAAS,GAAGA,SAAS,CAACoB,MAAV,CAAiB,KAAKC,kBAAL,CAAwBZ,OAAxB,EAAiC,IAAjC,EAAuCnB,WAAvC,EAAoD,IAApD,CAAjB,CAAZ;AACH,OAFD,MAGK;AACDmB,QAAAA,OAAO,CAACa,IAAR,GAAe,KAAKC,YAAL,EAAf;AACAvB,QAAAA,SAAS,CAACwB,IAAV,CAAef,OAAf;AACH;AACJ;;AACD,QAAIgB,SAAS,GAAGzB,SAAS,CAAC0B,MAAV,CAAiB,UAAUC,IAAV,EAAgB;AAAE,aAAO,CAACA,IAAI,CAACpC,KAAK,CAACR,MAAN,CAAae,WAAb,CAAyB8B,OAA1B,CAAZ;AAAiD,KAApF,CAAhB;AACA,SAAK7C,MAAL,CAAYgB,eAAZ,GAA8B,KAAK8B,YAAL,CAAkBrC,KAAlB,EAAyBG,GAAzB,EAA8B8B,SAA9B,CAA9B;AACA,QAAIK,SAAS,GAAG9B,SAAS,CAAC0B,MAAV,CAAiB,UAAUC,IAAV,EAAgB;AAAE,aAAOA,IAAI,CAACpC,KAAK,CAACR,MAAN,CAAae,WAAb,CAAyB8B,OAA1B,CAAX;AAAgD,KAAnF,CAAhB;AACAE,IAAAA,SAAS,CAACC,OAAV,CAAkB,UAAUC,QAAV,EAAoB;AAClC,UAAIA,QAAQ,CAACnC,MAAM,CAACoC,QAAR,CAAZ,EAA+B;AAC3BD,QAAAA,QAAQ,CAACnC,MAAM,CAACa,SAAR,CAAR,GAA6B/B,IAAI,CAACuD,SAAL,CAAeF,QAAQ,CAACnC,MAAM,CAACa,SAAR,CAAvB,CAA7B;AACAsB,QAAAA,QAAQ,CAACnC,MAAM,CAACe,OAAR,CAAR,GAA2BjC,IAAI,CAACwD,OAAL,CAAaxD,IAAI,CAACuD,SAAL,CAAeF,QAAQ,CAACnC,MAAM,CAACe,OAAR,CAAvB,CAAb,EAAuD,CAAvD,CAA3B;AACH;AACJ,KALD;AAMA,SAAK7B,MAAL,CAAYqD,cAAZ,GAA6BN,SAA7B;AACA,WAAOL,SAAP;AACH,GAzDD;;AA0DA3C,EAAAA,SAAS,CAACI,SAAV,CAAoBmD,kBAApB,GAAyC,UAAUC,eAAV,EAA2B;AAChE,QAAIA,eAAe,KAAK,KAAK,CAA7B,EAAgC;AAAEA,MAAAA,eAAe,GAAG,KAAKvD,MAAL,CAAYwD,UAA9B;AAA2C;;AAC7E,QAAIvC,SAAS,GAAG,EAAhB;;AACA,SAAK,IAAIO,EAAE,GAAG,CAAT,EAAYiC,EAAE,GAAGF,eAAtB,EAAuC/B,EAAE,GAAGiC,EAAE,CAACnC,MAA/C,EAAuDE,EAAE,EAAzD,EAA6D;AACzD,UAAIkC,OAAO,GAAGD,EAAE,CAACjC,EAAD,CAAhB;;AACA,UAAI,CAAC7C,iBAAiB,CAAC+E,OAAO,CAAC,KAAK1D,MAAL,CAAYe,WAAZ,CAAwBoB,cAAzB,CAAR,CAAlB,IACAxD,iBAAiB,CAAC+E,OAAO,CAAC,KAAK1D,MAAL,CAAYe,WAAZ,CAAwBqB,YAAzB,CAAR,CADrB,EACsE;AAClEnB,QAAAA,SAAS,GAAGA,SAAS,CAACoB,MAAV,CAAiB,KAAKC,kBAAL,CAAwBoB,OAAxB,CAAjB,CAAZ;AACH,OAHD,MAIK;AACDzC,QAAAA,SAAS,CAACwB,IAAV,CAAeiB,OAAf;AACH;AACJ;;AACD,WAAOzC,SAAP;AACH,GAdD;;AAeAlB,EAAAA,SAAS,CAACI,SAAV,CAAoBwD,sBAApB,GAA6C,UAAUpD,WAAV,EAAuB;AAChE,QAAIU,SAAS,GAAG,KAAKb,WAAL,CAAiB,KAAKJ,MAAL,CAAYwD,UAA7B,EAAyC,IAAzC,EAA+CjD,WAA/C,CAAhB;AACA,SAAKP,MAAL,CAAY4D,MAAZ,CAAmB9D,KAAK,CAAC+D,SAAzB,EAAoC;AAAEC,MAAAA,aAAa,EAAE7C;AAAjB,KAApC;AACH,GAHD;AAIA;;;AACAlB,EAAAA,SAAS,CAACI,SAAV,CAAoB4D,eAApB,GAAsC,UAAUrB,SAAV,EAAqB;AACvD,QAAI5B,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACA2B,IAAAA,SAAS,CAAC5B,MAAM,CAACkD,aAAR,CAAT,GAAkCtB,SAAS,CAAC5B,MAAM,CAACkD,aAAR,CAAT,IAAmCtB,SAAS,CAAC5B,MAAM,CAACmD,WAAR,CAA9E;AACAvB,IAAAA,SAAS,CAAC5B,MAAM,CAACmD,WAAR,CAAT,GAAgCvB,SAAS,CAAC5B,MAAM,CAACmD,WAAR,CAAT,IAAiCvB,SAAS,CAAC5B,MAAM,CAACkD,aAAR,CAA1E;;AACA,QAAI,KAAKhE,MAAL,CAAYkE,QAAhB,EAA0B;AACtB,UAAIC,OAAO,GAAGzB,SAAS,CAAC5B,MAAM,CAACkD,aAAR,CAAvB;AACA,UAAII,KAAK,GAAG1B,SAAS,CAAC5B,MAAM,CAACmD,WAAR,CAArB;AACAvB,MAAAA,SAAS,CAAC5B,MAAM,CAACa,SAAR,CAAT,GACI,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBC,OAArB,CAA6B5B,SAAS,CAAC5B,MAAM,CAACa,SAAR,CAAtC,EAA0D,KAAK3B,MAAL,CAAYkE,QAAtE,EAAgFC,OAAhF,CADJ;AAEAzB,MAAAA,SAAS,CAAC5B,MAAM,CAACe,OAAR,CAAT,GACI,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBC,OAArB,CAA6B5B,SAAS,CAAC5B,MAAM,CAACe,OAAR,CAAtC,EAAwD,KAAK7B,MAAL,CAAYkE,QAApE,EAA8EE,KAA9E,CADJ;AAEH;AACJ,GAZD;;AAaArE,EAAAA,SAAS,CAACI,SAAV,CAAoB2B,qBAApB,GAA4C,UAAUhC,KAAV,EAAiBS,WAAjB,EAA8B;AACtE,QAAIO,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;;AACA,QAAIjB,KAAK,CAACgB,MAAM,CAACoC,QAAR,CAAT,EAA4B;AACxB;AACH;;AACD,QAAI3C,WAAW,IAAI,KAAKP,MAAL,CAAYkE,QAA/B,EAAyC;AACrCpE,MAAAA,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GAA0B,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBC,OAArB,CAA6BxE,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAlC,EAAsDpB,WAAtD,EAAmE,KAAKP,MAAL,CAAYkE,QAA/E,CAA1B;AACApE,MAAAA,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBC,OAArB,CAA6BxE,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAlC,EAAoDtB,WAApD,EAAiE,KAAKP,MAAL,CAAYkE,QAA7E,CAAxB;AACH,KAHD,MAIK,IAAI,CAAC3D,WAAD,IAAgB,KAAKP,MAAL,CAAYkE,QAAhC,EAA0C;AAC3CpE,MAAAA,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GAA0B,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBE,GAArB,CAAyBzE,KAAK,CAACgB,MAAM,CAACa,SAAR,CAA9B,EAAkD,KAAK3B,MAAL,CAAYkE,QAA9D,CAA1B;AACApE,MAAAA,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBE,GAArB,CAAyBzE,KAAK,CAACgB,MAAM,CAACe,OAAR,CAA9B,EAAgD,KAAK7B,MAAL,CAAYkE,QAA5D,CAAxB;AACH,KAHI,MAIA,IAAI3D,WAAW,IAAI,CAAC,KAAKP,MAAL,CAAYkE,QAAhC,EAA0C;AAC3CpE,MAAAA,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GAA0B,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBG,MAArB,CAA4B1E,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAjC,EAAqDpB,WAArD,CAA1B;AACAT,MAAAA,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBG,MAArB,CAA4B1E,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAjC,EAAmDtB,WAAnD,CAAxB;AACH;AACJ,GAjBD;;AAkBAR,EAAAA,SAAS,CAACI,SAAV,CAAoB4B,eAApB,GAAsC,UAAUjC,KAAV,EAAiB2E,SAAjB,EAA4B;AAC9D,QAAIA,SAAS,KAAK,KAAK,CAAvB,EAA0B;AAAEA,MAAAA,SAAS,GAAG,KAAZ;AAAoB;;AAChD,QAAI3D,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;;AACA,QAAIjB,KAAK,CAACgB,MAAM,CAACkD,aAAR,CAAL,IAA+BlE,KAAK,CAACgB,MAAM,CAACmD,WAAR,CAAxC,EAA8D;AAC1D,UAAID,aAAa,GAAGlE,KAAK,CAACgB,MAAM,CAACkD,aAAR,CAAL,IAA+BlE,KAAK,CAACgB,MAAM,CAACmD,WAAR,CAAxD;AACA,UAAIA,WAAW,GAAGnE,KAAK,CAACgB,MAAM,CAACmD,WAAR,CAAL,IAA6BnE,KAAK,CAACgB,MAAM,CAACkD,aAAR,CAApD;AACA,UAAIU,IAAI,GAAG,KAAK1E,MAAL,CAAYkE,QAAvB;;AACA,UAAIO,SAAJ,EAAe;AACX,YAAI,KAAKzE,MAAL,CAAYkE,QAAhB,EAA0B;AACtBpE,UAAAA,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GACI,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBC,OAArB,CAA6BxE,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAlC,EAAsDqC,aAAtD,EAAqEU,IAArE,CADJ;AAEA5E,UAAAA,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBC,OAArB,CAA6BxE,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAlC,EAAoDoC,WAApD,EAAiES,IAAjE,CAAxB;AACA5E,UAAAA,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GAA0B,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBG,MAArB,CAA4B1E,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAjC,EAAqD+C,IAArD,CAA1B;AACA5E,UAAAA,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBG,MAArB,CAA4B1E,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAjC,EAAmD6C,IAAnD,CAAxB;AACH,SAND,MAOK;AACD5E,UAAAA,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GAA0B,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBG,MAArB,CAA4B1E,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAjC,EAAqDqC,aAArD,CAA1B;AACAlE,UAAAA,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBG,MAArB,CAA4B1E,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAjC,EAAmDoC,WAAnD,CAAxB;AACH;AACJ,OAZD,MAaK;AACDnE,QAAAA,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GAA0B,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBE,GAArB,CAAyBzE,KAAK,CAACgB,MAAM,CAACa,SAAR,CAA9B,EAAkDqC,aAAlD,CAA1B;AACAlE,QAAAA,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBE,GAArB,CAAyBzE,KAAK,CAACgB,MAAM,CAACe,OAAR,CAA9B,EAAgDoC,WAAhD,CAAxB;;AACA,YAAI,KAAKjE,MAAL,CAAYkE,QAAhB,EAA0B;AACtBpE,UAAAA,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GACI,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBC,OAArB,CAA6BxE,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAlC,EAAsDqC,aAAtD,EAAqEU,IAArE,CADJ;AAEA5E,UAAAA,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBC,OAArB,CAA6BxE,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAlC,EAAoDoC,WAApD,EAAiES,IAAjE,CAAxB;AACH;AACJ;AACJ,KA1BD,MA2BK,IAAI,KAAK1E,MAAL,CAAYkE,QAAhB,EAA0B;AAC3B,UAAIO,SAAJ,EAAe;AACX3E,QAAAA,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GAA0B,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBG,MAArB,CAA4B1E,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAjC,EAAqD,KAAK3B,MAAL,CAAYkE,QAAjE,CAA1B;AACApE,QAAAA,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBG,MAArB,CAA4B1E,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAjC,EAAmD,KAAK7B,MAAL,CAAYkE,QAA/D,CAAxB;AACH,OAHD,MAIK;AACDpE,QAAAA,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GAA0B,KAAK3B,MAAL,CAAYqE,QAAZ,CAAqBE,GAArB,CAAyBzE,KAAK,CAACgB,MAAM,CAACa,SAAR,CAA9B,EAAkD,KAAK3B,MAAL,CAAYkE,QAA9D,CAA1B;AACApE,QAAAA,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,KAAK7B,MAAL,CAAYqE,QAAZ,CAAqBE,GAArB,CAAyBzE,KAAK,CAACgB,MAAM,CAACe,OAAR,CAA9B,EAAgD,KAAK7B,MAAL,CAAYkE,QAA5D,CAAxB;AACH;AACJ;;AACD,WAAOpE,KAAP;AACH,GAzCD;;AA0CAC,EAAAA,SAAS,CAACI,SAAV,CAAoBwE,iBAApB,GAAwC,UAAU1B,QAAV,EAAoB;AACxD,QAAI2B,MAAM,GAAG3B,QAAQ,CAAC,KAAKjD,MAAL,CAAYe,WAAZ,CAAwBY,SAAzB,CAArB;AACA,QAAIkD,IAAI,GAAG5B,QAAQ,CAAC,KAAKjD,MAAL,CAAYe,WAAZ,CAAwBc,OAAzB,CAAnB;AACA,QAAIiD,YAAJ;;AACA,QAAI,KAAK9E,MAAL,CAAY+E,iBAAZ,CAA8BC,KAA9B,CAAoCC,SAApC,CAA8C3D,MAA9C,GAAuD,CAA3D,EAA8D;AAC1D,UAAIsB,IAAI,GAAG,KAAKsC,sBAAL,CAA4BjC,QAA5B,CAAX;AACA6B,MAAAA,YAAY,GAAG,KAAK9E,MAAL,CAAYqB,YAAZ,CAAyB8D,iBAAzB,CAA2CvC,IAA3C,CAAf;AACH;;AACD,WAAO,KAAKE,YAAL,CAAkB8B,MAAlB,EAA0BC,IAA1B,EAAgC,KAAK7E,MAAL,CAAYqD,cAA5C,EAA4DyB,YAA5D,CAAP;AACH,GATD;;AAUA/E,EAAAA,SAAS,CAACI,SAAV,CAAoB2C,YAApB,GAAmC,UAAUnC,SAAV,EAAqBE,OAArB,EAA8BuE,YAA9B,EAA4CC,cAA5C,EAA4D;AAC3F,QAAID,YAAY,KAAK,KAAK,CAA1B,EAA6B;AAAEA,MAAAA,YAAY,GAAG,KAAKpF,MAAL,CAAYgB,eAA3B;AAA6C;;AAC5E,QAAIsE,YAAY,GAAG,KAAKtF,MAAL,CAAYe,WAA/B;AACA,QAAIwE,SAAS,GAAG,IAAI9F,SAAJ,CAAc6F,YAAY,CAAC3D,SAA3B,EAAsC,oBAAtC,EAA4DhB,SAA5D,EACZ6E,GADY,CACR,IAAI/F,SAAJ,CAAc6F,YAAY,CAACzD,OAA3B,EAAoC,oBAApC,EAA0DlB,SAA1D,CADQ,EAEZ6E,GAFY,CAER,IAAI/F,SAAJ,CAAc6F,YAAY,CAAC3D,SAA3B,EAAsC,UAAtC,EAAkDd,OAAlD,CAFQ,EAGZ4E,EAHY,CAGT,IAAIhG,SAAJ,CAAc6F,YAAY,CAAC3D,SAA3B,EAAsC,iBAAtC,EAAyDhB,SAAzD,EACH6E,GADG,CACC,IAAI/F,SAAJ,CAAc6F,YAAY,CAACzD,OAA3B,EAAoC,aAApC,EAAmDlB,SAAnD,CADD,CAHS,CAAhB;AAKA,QAAIgC,MAAM,GAAG,IAAIpD,WAAJ,CAAgB;AAAEmG,MAAAA,IAAI,EAAEN;AAAR,KAAhB,EAAwCO,YAAxC,CAAqD,IAAInG,KAAJ,GAAYoG,KAAZ,CAAkBL,SAAlB,CAArD,CAAb;;AACA,QAAIF,cAAJ,EAAoB;AAChB1C,MAAAA,MAAM,GAAG,KAAKkD,sBAAL,CAA4BR,cAA5B,EAA4C1C,MAA5C,CAAT;AACH;;AACD,WAAO,KAAKmD,UAAL,CAAgBnD,MAAhB,CAAP;AACH,GAbD;;AAcA5C,EAAAA,SAAS,CAACI,SAAV,CAAoB4F,mBAApB,GAA0C,UAAUxC,eAAV,EAA2B5C,SAA3B,EAAsCE,OAAtC,EAA+C;AACrF,QAAIL,KAAK,GAAG,IAAZ;;AACA,QAAIwF,cAAc,GAAG,EAArB;;AACA,QAAIrF,SAAS,IAAIE,OAAjB,EAA0B;AACtBmF,MAAAA,cAAc,GAAG,KAAKlD,YAAL,CAAkBnC,SAAlB,EAA6BE,OAA7B,EAAsC0C,eAAtC,CAAjB;AACH,KAFD,MAGK,IAAI5C,SAAS,IAAI,CAACE,OAAlB,EAA2B;AAC5BmF,MAAAA,cAAc,GAAGzC,eAAe,CAACZ,MAAhB,CAAuB,UAAUsD,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACzF,KAAK,CAACR,MAAN,CAAae,WAAb,CAAyBY,SAA1B,CAAD,IAAyChB,SAAhD;AAA4D,OAAlG,CAAjB;AACH,KAFI,MAGA,IAAI,CAACA,SAAD,IAAcE,OAAlB,EAA2B;AAC5BmF,MAAAA,cAAc,GAAGzC,eAAe,CAACZ,MAAhB,CAAuB,UAAUsD,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACzF,KAAK,CAACR,MAAN,CAAae,WAAb,CAAyBc,OAA1B,CAAD,IAAuChB,OAA9C;AAAwD,OAA9F,CAAjB;AACH,KAFI,MAGA;AACDmF,MAAAA,cAAc,GAAGzC,eAAjB;AACH;;AACD,WAAO,KAAKuC,UAAL,CAAgBE,cAAhB,CAAP;AACH,GAhBD;;AAiBAjG,EAAAA,SAAS,CAACI,SAAV,CAAoB0F,sBAApB,GAA6C,UAAUR,cAAV,EAA0BD,YAA1B,EAAwC;AACjF,QAAIA,YAAY,KAAK,KAAK,CAA1B,EAA6B;AAAEA,MAAAA,YAAY,GAAG,KAAKpF,MAAL,CAAYgB,eAA3B;AAA6C;;AAC5E,QAAIuE,SAAS,GAAG,EAAhB;AACA,QAAInE,kBAAkB,GAAG,KAAKpB,MAAL,CAAYqB,YAAZ,CAAyBD,kBAAlD;;AACA,SAAK,IAAIY,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGZ,kBAAkB,CAACE,MAA/C,EAAuDU,KAAK,EAA5D,EAAgE;AAC5DuD,MAAAA,SAAS,CAACnE,kBAAkB,CAACY,KAAD,CAAlB,CAA0BC,KAA3B,CAAT,GAA6CoD,cAAc,CAACa,UAAf,CAA0BlE,KAA1B,CAA7C;AACH;;AACD,QAAImE,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYZ,SAAZ,CAAX;AACA,QAAIc,kBAAkB,GAAGjB,YAAY,CAACzC,MAAb,CAAoB,UAAUM,QAAV,EAAoB;AAAE,aAAOkD,IAAI,CAACG,KAAL,CAAW,UAAUC,GAAV,EAAe;AAChG,YAAItD,QAAQ,CAACsD,GAAD,CAAR,YAAyBC,KAA7B,EAAoC;AAChC,iBAAOvD,QAAQ,CAACsD,GAAD,CAAR,CAAcE,OAAd,CAAsBlB,SAAS,CAACgB,GAAD,CAA/B,IAAwC,CAAC,CAAhD;AACH,SAFD,MAGK;AACD,iBAAOtD,QAAQ,CAACsD,GAAD,CAAR,KAAkBhB,SAAS,CAACgB,GAAD,CAAlC;AACH;AACJ,OAPyE,CAAP;AAO9D,KAPoB,CAAzB;AAQA,WAAOF,kBAAP;AACH,GAjBD;;AAkBAtG,EAAAA,SAAS,CAACI,SAAV,CAAoB2F,UAApB,GAAiC,UAAUV,YAAV,EAAwB;AACrD,QAAIE,YAAY,GAAG,KAAKtF,MAAL,CAAYe,WAA/B;AACAqE,IAAAA,YAAY,CAACsB,IAAb,CAAkB,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAC9B,UAAIC,EAAE,GAAGF,CAAC,CAACrB,YAAY,CAAC3D,SAAd,CAAV;AACA,UAAImF,EAAE,GAAGF,CAAC,CAACtB,YAAY,CAAC3D,SAAd,CAAV;AACA,aAAOkF,EAAE,CAACE,OAAH,KAAeD,EAAE,CAACC,OAAH,EAAtB;AACH,KAJD;AAKA,WAAO3B,YAAP;AACH,GARD;;AASArF,EAAAA,SAAS,CAACI,SAAV,CAAoB6G,cAApB,GAAqC,UAAU5B,YAAV,EAAwB;AACzD,QAAIE,YAAY,GAAG,KAAKtF,MAAL,CAAYe,WAA/B;AACAqE,IAAAA,YAAY,CAACsB,IAAb,CAAkB,UAAUO,OAAV,EAAmBC,OAAnB,EAA4B;AAC1C,UAAIC,EAAE,GAAGF,OAAO,CAAC3B,YAAY,CAAC3D,SAAd,CAAhB;AACA,UAAIyF,EAAE,GAAGF,OAAO,CAAC5B,YAAY,CAAC3D,SAAd,CAAhB;AACA,UAAI0F,EAAE,GAAGJ,OAAO,CAAC3B,YAAY,CAACzD,OAAd,CAAhB;AACA,UAAIyF,EAAE,GAAGJ,OAAO,CAAC5B,YAAY,CAACzD,OAAd,CAAhB;AACA,UAAIgF,EAAE,GAAGQ,EAAE,CAACN,OAAH,KAAeI,EAAE,CAACJ,OAAH,EAAxB;AACA,UAAID,EAAE,GAAGQ,EAAE,CAACP,OAAH,KAAeK,EAAE,CAACL,OAAH,EAAxB;AACA,aAAQI,EAAE,CAACJ,OAAH,KAAeK,EAAE,CAACL,OAAH,EAAf,IAA+BD,EAAE,GAAGD,EAA5C;AACH,KARD;AASA,WAAOzB,YAAP;AACH,GAZD;;AAaArF,EAAAA,SAAS,CAACI,SAAV,CAAoBoH,wBAApB,GAA+C,UAAUC,KAAV,EAAiB;AAC5D,QAAIC,KAAK,GAAGC,IAAI,CAACC,GAAL,CAASC,KAAT,CAAeF,IAAf,EAAqBF,KAArB,CAAZ;;AACA,SAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,KAApB,EAA2BI,CAAC,EAA5B,EAAgC;AAC5B,UAAIL,KAAK,CAACf,OAAN,CAAcoB,CAAd,MAAqB,CAAC,CAA1B,EAA6B;AACzB,eAAOA,CAAP;AACH;AACJ;;AACD,WAAOJ,KAAK,GAAG,CAAf;AACH,GARD;;AASA1H,EAAAA,SAAS,CAACI,SAAV,CAAoB2H,eAApB,GAAsC,UAAUhI,KAAV,EAAiB;AACnD,QAAIiB,WAAW,GAAG,KAAKf,MAAL,CAAYe,WAA9B;AACA,QAAI6B,IAAI,GAAG,EAAX;AACA,QAAImF,cAAc,GAAGjI,KAAK,CAACiB,WAAW,CAACY,SAAb,CAA1B;AACA,QAAIqG,YAAY,GAAGlI,KAAK,CAACiB,WAAW,CAACc,OAAb,CAAxB;AACA,QAAIoG,eAAe,GAAGrI,IAAI,CAACuD,SAAL,CAAe,IAAI+E,IAAJ,CAASH,cAAc,CAAChB,OAAf,EAAT,CAAf,IAClBnH,IAAI,CAACuD,SAAL,CAAe,IAAI+E,IAAJ,CAASF,YAAY,CAACjB,OAAb,EAAT,CAAf,CADJ;;AAEA,QAAIkB,eAAJ,EAAqB;AACjB,UAAIxH,KAAK,GAAG,IAAIyH,IAAJ,CAASH,cAAc,CAAChB,OAAf,EAAT,CAAZ;AACA,UAAInG,GAAG,GAAGhB,IAAI,CAACwD,OAAL,CAAaxD,IAAI,CAACuD,SAAL,CAAe,IAAI+E,IAAJ,CAASH,cAAc,CAAChB,OAAf,EAAT,CAAf,CAAb,EAAiE,CAAjE,CAAV;AACA,UAAIlG,OAAO,GAAImH,YAAY,CAACG,QAAb,OAA4B,CAA5B,IAAiCH,YAAY,CAACI,UAAb,OAA8B,CAAhE,GACVJ,YADU,GACKpI,IAAI,CAACwD,OAAL,CAAa4E,YAAb,EAA2B,CAA3B,CADnB;AAEA,UAAIK,KAAK,GAAG,CAAZ;AACA,UAAIC,WAAW,GAAG1I,IAAI,CAAC2I,YAAL,CAAkBR,cAAc,CAAChB,OAAf,EAAlB,EAA4ClG,OAAO,CAACkG,OAAR,EAA5C,CAAlB;;AACA,aAAOnG,GAAG,IAAIoH,YAAd,EAA4B;AACxB,YAAIQ,GAAG,GAAG1J,MAAM,CAAC,EAAD,EAAKgB,KAAL,CAAhB;AACA0I,QAAAA,GAAG,CAACzH,WAAW,CAACY,SAAb,CAAH,GAA6BlB,KAA7B;AACA+H,QAAAA,GAAG,CAACzH,WAAW,CAACc,OAAb,CAAH,GAA2BjB,GAA3B;AACA4H,QAAAA,GAAG,CAAC5F,IAAJ,GAAW;AAAEyF,UAAAA,KAAK,EAAEA,KAAT;AAAgBI,UAAAA,KAAK,EAAEH;AAAvB,SAAX;AACAE,QAAAA,GAAG,CAACjG,IAAJ,GAAW,KAAKC,YAAL,EAAX;AACAgG,QAAAA,GAAG,CAACE,SAAJ,GAAgB,IAAhB;AACA9F,QAAAA,IAAI,CAACH,IAAL,CAAU+F,GAAV;AACA/H,QAAAA,KAAK,GAAGG,GAAR;;AACA,YAAKhB,IAAI,CAACuD,SAAL,CAAe,IAAI+E,IAAJ,CAASzH,KAAK,CAACsG,OAAN,EAAT,CAAf,EAA0CA,OAA1C,OAAwDnH,IAAI,CAACuD,SAAL,CAAe,IAAI+E,IAAJ,CAASF,YAAY,CAACjB,OAAb,EAAT,CAAf,EAAiDA,OAAjD,EAAzD,IACG,EAAEnG,GAAG,CAACmG,OAAJ,OAAkBiB,YAAY,CAACjB,OAAb,EAApB,CADP,EACoD;AAChDnG,UAAAA,GAAG,GAAG,IAAIsH,IAAJ,CAASzH,KAAK,CAACsG,OAAN,EAAT,CAAN;AACAnG,UAAAA,GAAG,GAAG,IAAIsH,IAAJ,CAAStH,GAAG,CAAC+H,QAAJ,CAAaX,YAAY,CAACG,QAAb,EAAb,EAAsCH,YAAY,CAACI,UAAb,EAAtC,EAAiEJ,YAAY,CAACY,UAAb,EAAjE,CAAT,CAAN;AACH,SAJD,MAKK;AACDhI,UAAAA,GAAG,GAAGhB,IAAI,CAACwD,OAAL,CAAaxD,IAAI,CAACuD,SAAL,CAAe,IAAI+E,IAAJ,CAASzH,KAAK,CAACsG,OAAN,EAAT,CAAf,CAAb,EAAwD,CAAxD,CAAN;AACH;;AACDsB,QAAAA,KAAK;AACR;AACJ,KA1BD,MA2BK;AACDzF,MAAAA,IAAI,CAACH,IAAL,CAAU3C,KAAV;AACH;;AACD,WAAO8C,IAAP;AACH,GAtCD;;AAuCA7C,EAAAA,SAAS,CAACI,SAAV,CAAoB0I,UAApB,GAAiC,UAAU/I,KAAV,EAAiBgJ,UAAjB,EAA6B;AAC1D,QAAIhI,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACA,QAAIN,KAAK,GAAGb,IAAI,CAACuD,SAAL,CAAe,IAAI+E,IAAJ,CAASpI,KAAK,CAACgB,MAAM,CAACa,SAAR,CAAL,GAA0B,EAAnC,CAAf,EAAuDoF,OAAvD,EAAZ;AACA,QAAInG,GAAG,GAAGhB,IAAI,CAACuD,SAAL,CAAe,IAAI+E,IAAJ,CAASpI,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,EAAjC,CAAf,EAAqDkF,OAArD,EAAV;;AACA,QAAInH,IAAI,CAACmJ,WAAL,CAAiBjJ,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAtB,KAA2C,CAA/C,EAAkD;AAC9C,UAAIX,IAAI,GAAGtB,IAAI,CAACwD,OAAL,CAAaxD,IAAI,CAACuD,SAAL,CAAe,IAAI+E,IAAJ,CAASpI,KAAK,CAACgB,MAAM,CAACe,OAAR,CAAL,GAAwB,EAAjC,CAAf,CAAb,EAAmE,CAAC,CAApE,EAAuEkF,OAAvE,EAAX;AACAnG,MAAAA,GAAG,GAAGH,KAAK,GAAGS,IAAR,GAAeT,KAAf,GAAuBS,IAA7B;AACH;;AACD,QAAI8H,QAAQ,GAAGvI,KAAf;AACA,QAAIwI,MAAM,GAAGrI,GAAb;AACA,QAAIsI,MAAM,GAAG,EAAb;;AACA,QAAIzI,KAAK,KAAKG,GAAd,EAAmB;AACf,UAAIH,KAAK,GAAGqI,UAAU,CAAC,CAAD,CAAV,CAAc/B,OAAd,EAAZ,EAAqC;AACjCtG,QAAAA,KAAK,GAAGqI,UAAU,CAAC,CAAD,CAAV,CAAc/B,OAAd,EAAR;AACH;;AACD,UAAInG,GAAG,GAAGkI,UAAU,CAACA,UAAU,CAACxH,MAAX,GAAoB,CAArB,CAAV,CAAkCyF,OAAlC,EAAV,EAAuD;AACnDnG,QAAAA,GAAG,GAAGkI,UAAU,CAACA,UAAU,CAACxH,MAAX,GAAoB,CAArB,CAAV,CAAkCyF,OAAlC,EAAN;AACH;;AACD,UAAIoC,MAAM,GAAG1I,KAAb;;AACA,UAAI2I,OAAO,GAAG,UAAUpH,KAAV,EAAiB;AAC3B,YAAIqH,IAAI,GAAGC,MAAM,CAACrJ,KAAP,CAAa+B,KAAb,CAAX;;AACA,YAAIsH,MAAM,CAACtJ,MAAP,CAAcuJ,WAAd,KAA8B,UAA9B,IAA4CD,MAAM,CAACtJ,MAAP,CAAcuJ,WAAd,KAA8B,kBAA1E,IACGD,MAAM,CAACtJ,MAAP,CAAc+E,iBAAd,CAAgCC,KAAhC,CAAsCwE,MADzC,IACmDF,MAAM,CAACtJ,MAAP,CAAc+E,iBAAd,CAAgC0E,WADvF,EACoG;AAChG,cAAIC,WAAW,GAAG,EAAlB;AACAL,UAAAA,IAAI,CAACrG,OAAL,CAAa,UAAU2G,CAAV,EAAa;AAAE,mBAAOD,WAAW,CAACjH,IAAZ,CAAiB,IAAIyF,IAAJ,CAASyB,CAAT,CAAjB,CAAP;AAAuC,WAAnE;AACA,cAAIC,aAAa,GAAGN,MAAM,CAACO,gBAAP,CAAwBH,WAAxB,CAApB;;AACA,cAAI,CAAC/K,iBAAiB,CAACiL,aAAD,CAAlB,IAAqCA,aAAa,CAACtI,MAAd,GAAuB,CAAhE,EAAmE;AAC/D+H,YAAAA,IAAI,GAAG,EAAP;AACAO,YAAAA,aAAa,CAAC5G,OAAd,CAAsB,UAAU8G,IAAV,EAAgB;AAAE,qBAAOT,IAAI,CAAC5G,IAAL,CAAUqH,IAAI,CAAC/C,OAAL,EAAV,CAAP;AAAmC,aAA3E;AACH;AACJ;;AACD,YAAIgD,SAAS,GAAGV,IAAI,CAAC,CAAD,CAApB;AACAF,QAAAA,MAAM,GAAIA,MAAM,IAAIY,SAAV,IAAuBnJ,GAAG,IAAImJ,SAA/B,GAA4CA,SAA5C,GAAwDZ,MAAjE;;AACA,YAAIA,MAAM,GAAGvI,GAAT,IAAgBmJ,SAAS,GAAGnJ,GAAhC,EAAqC;AACjC,iBAAO,OAAP;AACH;;AACD,YAAI,CAAC0I,MAAM,CAACtJ,MAAP,CAAc+E,iBAAd,CAAgCC,KAAhC,CAAsCwE,MAAvC,IAAiDF,MAAM,CAACtJ,MAAP,CAAc+E,iBAAd,CAAgC0E,WAAjF,IACAH,MAAM,CAACtJ,MAAP,CAAcuJ,WAAd,KAA8B,UAD9B,IAC4CD,MAAM,CAACtJ,MAAP,CAAcuJ,WAAd,KAA8B,kBAD9E,EACkG;AAC9F,cAAIS,UAAU,GAAGX,IAAI,CAAC5C,OAAL,CAAa0C,MAAb,CAAjB;;AACA,cAAIa,UAAU,KAAK,CAAC,CAApB,EAAuB;AACnB,gBAAIC,QAAQ,GAAGZ,IAAI,CAAC5C,OAAL,CAAa7F,GAAb,CAAf;AACA,gBAAIsJ,QAAQ,GAAGD,QAAQ,KAAK,CAAC,CAA7B;AACAA,YAAAA,QAAQ,GAAGC,QAAQ,GAAGD,QAAH,GAAcZ,IAAI,CAAC/H,MAAL,GAAc,CAA/C;AACA,gBAAImH,KAAK,GAAKwB,QAAQ,GAAGD,UAAZ,GAA0B,CAAvC;AACA,gBAAIG,MAAM,GAAId,IAAI,CAACW,UAAD,CAAJ,KAAqBhB,QAAnC;AACA,gBAAIoB,OAAO,GAAIf,IAAI,CAACY,QAAD,CAAJ,KAAmBhB,MAAlC;AACAC,YAAAA,MAAM,CAACzG,IAAP,CAAY6G,MAAM,CAACe,gBAAP,CAAwBvK,KAAxB,EAA+BuJ,IAAI,CAACW,UAAD,CAAnC,EAAiDX,IAAI,CAACY,QAAD,CAArD,EAAiExB,KAAjE,EAAwE0B,MAAxE,EAAgFC,OAAhF,CAAZ;;AACA,gBAAIF,QAAJ,EAAc;AACV,qBAAO,OAAP;AACH;AACJ;AACJ,SAfD,MAgBK;AACD,cAAIZ,MAAM,CAACgB,WAAP,CAAmBnB,MAAnB,EAA2BE,IAAI,CAAC,CAAD,CAA/B,EAAoCA,IAAI,CAACA,IAAI,CAAC/H,MAAL,GAAc,CAAf,CAAxC,CAAJ,EAAgE;AAC5D,gBAAIiJ,SAAS,GAAG,EAAhB;;AACA,iBAAK,IAAI1C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwB,IAAI,CAAC/H,MAAzB,EAAiCuG,CAAC,EAAlC,EAAsC;AAClC,kBAAIyB,MAAM,CAACgB,WAAP,CAAmBjB,IAAI,CAACxB,CAAD,CAAvB,EAA4BmB,QAA5B,EAAsCC,MAAtC,CAAJ,EAAmD;AAC/CsB,gBAAAA,SAAS,CAAC9H,IAAV,CAAe4G,IAAI,CAACxB,CAAD,CAAnB;AACH;AACJ;;AACD,gBAAI0C,SAAS,CAACjJ,MAAV,GAAmB,CAAvB,EAA0B;AACtB,kBAAI,CAACgI,MAAM,CAACtJ,MAAP,CAAc+E,iBAAd,CAAgCC,KAAhC,CAAsCwE,MAA3C,EAAmD;AAC/C,oBAAIW,MAAM,GAAII,SAAS,CAAC,CAAD,CAAT,KAAiBvB,QAA/B;AACA,oBAAIoB,OAAO,GAAIG,SAAS,CAACA,SAAS,CAACjJ,MAAV,GAAmB,CAApB,CAAT,KAAoC2H,MAAnD;AACAC,gBAAAA,MAAM,CAACzG,IAAP,CAAY6G,MAAM,CAACe,gBAAP,CAAwBvK,KAAxB,EAA+ByK,SAAS,CAAC,CAAD,CAAxC,EAA6CA,SAAS,CAACA,SAAS,CAACjJ,MAAV,GAAmB,CAApB,CAAtD,EAA8EiJ,SAAS,CAACjJ,MAAxF,EAAgG6I,MAAhG,EAAwGC,OAAxG,CAAZ;AACH,eAJD,MAKK;AACD,qBAAK,IAAI5I,EAAE,GAAG,CAAT,EAAYgJ,WAAW,GAAGD,SAA/B,EAA0C/I,EAAE,GAAGgJ,WAAW,CAAClJ,MAA3D,EAAmEE,EAAE,EAArE,EAAyE;AACrE,sBAAIiJ,MAAM,GAAGD,WAAW,CAAChJ,EAAD,CAAxB;AACA0H,kBAAAA,MAAM,CAACzG,IAAP,CAAY6G,MAAM,CAACe,gBAAP,CAAwBvK,KAAxB,EAA+B2K,MAA/B,EAAuCA,MAAvC,EAA+C,CAA/C,EAAmDA,MAAM,KAAKzB,QAA9D,EAA0EyB,MAAM,KAAKxB,MAArF,CAAZ;AACH;AACJ;AACJ;AACJ;AACJ;AACJ,OAxDD;;AAyDA,UAAIK,MAAM,GAAG,IAAb;;AACA,WAAK,IAAItH,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG,KAAK/B,KAAL,CAAWqB,MAAvC,EAA+CU,KAAK,EAApD,EAAwD;AACpD,YAAI0I,OAAO,GAAGtB,OAAO,CAACpH,KAAD,CAArB;;AACA,YAAI0I,OAAO,KAAK,OAAhB,EACI;AACP;AACJ,KAvED,MAwEK;AACDxB,MAAAA,MAAM,CAACzG,IAAP,CAAY,KAAK4H,gBAAL,CAAsBvK,KAAtB,EAA6BW,KAA7B,EAAoCG,GAApC,EAAyC,CAAzC,EAA4C,KAA5C,EAAmD,KAAnD,CAAZ;AACH;;AACD,WAAOsI,MAAP;AACH,GAvFD;;AAwFAnJ,EAAAA,SAAS,CAACI,SAAV,CAAoBkK,gBAApB,GAAuC,UAAUvK,KAAV,EAAiBW,KAAjB,EAAwBG,GAAxB,EAA6B6H,KAA7B,EAAoC0B,MAApC,EAA4CC,OAA5C,EAAqD;AACxF,QAAItJ,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACA,QAAIkF,CAAC,GAAGnH,MAAM,CAAC,EAAD,EAAKgB,KAAL,EAAY,IAAZ,EAAkB,IAAlB,CAAd;AACA,QAAI8C,IAAI,GAAG;AAAE6F,MAAAA,KAAK,EAAEA,KAAT;AAAgB0B,MAAAA,MAAM,EAAEA,MAAxB;AAAgCC,MAAAA,OAAO,EAAEA;AAAzC,KAAX;AACAxH,IAAAA,IAAI,CAAC9B,MAAM,CAACa,SAAR,CAAJ,GAAyB7B,KAAK,CAACgB,MAAM,CAACa,SAAR,CAA9B;AACAiB,IAAAA,IAAI,CAAC9B,MAAM,CAACe,OAAR,CAAJ,GAAuB/B,KAAK,CAACgB,MAAM,CAACe,OAAR,CAA5B;AACAoE,IAAAA,CAAC,CAACrD,IAAF,GAASA,IAAT;AACAqD,IAAAA,CAAC,CAACnF,MAAM,CAACa,SAAR,CAAD,GAAsB,IAAIuG,IAAJ,CAASzH,KAAT,CAAtB;AACAwF,IAAAA,CAAC,CAACnF,MAAM,CAACe,OAAR,CAAD,GAAoB,IAAIqG,IAAJ,CAAStH,GAAT,CAApB;AACA,WAAOqF,CAAP;AACH,GAVD;;AAWAlG,EAAAA,SAAS,CAACI,SAAV,CAAoBmK,WAApB,GAAkC,UAAUR,IAAV,EAAgBrJ,KAAhB,EAAuBG,GAAvB,EAA4B;AAC1D,WAAOH,KAAK,IAAIqJ,IAAT,IAAiBA,IAAI,IAAIlJ,GAAhC;AACH,GAFD;;AAGAb,EAAAA,SAAS,CAACI,SAAV,CAAoBwK,wBAApB,GAA+C,UAAUC,MAAV,EAAkB;AAC7D,SAAKC,8BAAL;;AACA,QAAI,KAAK7K,MAAL,CAAY8K,gBAAZ,CAA6BxJ,MAA7B,IAAuC,CAA3C,EAA8C;AAC1C,WAAKtB,MAAL,CAAY8K,gBAAZ,CAA6BrI,IAA7B,CAAkCmI,MAAlC;AACH,KAFD,MAGK;AACD,UAAIG,iBAAiB,GAAG,KAAK/K,MAAL,CAAY8K,gBAAZ,CAA6BnI,MAA7B,CAAoC,UAAUqI,OAAV,EAAmB;AAC3E,eAAOA,OAAO,CAACC,YAAR,CAAqB,WAArB,MAAsCL,MAAM,CAACK,YAAP,CAAoB,WAApB,CAA7C;AACH,OAFuB,CAAxB;;AAGA,UAAIF,iBAAiB,CAACzJ,MAAlB,IAA4B,CAAhC,EAAmC;AAC/B,YAAI4J,aAAa,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAc,KAAKpL,MAAL,CAAYgL,OAAZ,CAC9BK,gBAD8B,CACb,oBAAoBT,MAAM,CAACK,YAAP,CAAoB,WAApB,CAApB,GAAuD,IAD1C,CAAd,CAApB;;AAEA,aAAK,IAAIzJ,EAAE,GAAG,CAAT,EAAY8J,eAAe,GAAGJ,aAAnC,EAAkD1J,EAAE,GAAG8J,eAAe,CAAChK,MAAvE,EAA+EE,EAAE,EAAjF,EAAqF;AACjF,cAAIwJ,OAAO,GAAGM,eAAe,CAAC9J,EAAD,CAA7B;AACA,eAAKxB,MAAL,CAAY8K,gBAAZ,CAA6BrI,IAA7B,CAAkCuI,OAAlC;AACH;AACJ,OAPD,MAQK;AACD,YAAIF,gBAAgB,GAAG,KAAK9K,MAAL,CAAY8K,gBAAZ,CAA6BnI,MAA7B,CAAoC,UAAUqI,OAAV,EAAmB;AAC1E,iBAAOA,OAAO,CAACC,YAAR,CAAqB,WAArB,MAAsCL,MAAM,CAACK,YAAP,CAAoB,WAApB,CAA7C;AACH,SAFsB,CAAvB;AAGA,aAAKjL,MAAL,CAAY8K,gBAAZ,GAA+BA,gBAA/B;AACH;AACJ;;AACD,QAAIF,MAAM,IAAI,KAAK5K,MAAL,CAAY8K,gBAAZ,CAA6BxJ,MAA7B,GAAsC,CAApD,EAAuD;AACnD,WAAKiK,uBAAL,CAA6B,KAAKvL,MAAL,CAAY8K,gBAAzC;AACH;;AACD,WAAO,KAAK9K,MAAL,CAAY8K,gBAAnB;AACH,GA5BD;;AA6BA/K,EAAAA,SAAS,CAACI,SAAV,CAAoBqL,iBAApB,GAAwC,YAAY;AAChD,QAAIhL,KAAK,GAAG,IAAZ;;AACA,QAAIiL,WAAW,GAAG,EAAlB;AACA,QAAIC,aAAa,GAAG,EAApB;AACA,QAAIC,kBAAkB,GAAG,GAAGR,KAAH,CAASC,IAAT,CAAc,KAAKpL,MAAL,CAAYgL,OAAZ,CAAoBK,gBAApB,CAAqC,MAAMxL,GAAG,CAAC+L,kBAA/C,CAAd,CAAzB;AACAD,IAAAA,kBAAkB,CAAChJ,MAAnB,CAA0B,UAAUqI,OAAV,EAAmB;AACzC,UAAIa,cAAc,GAAGJ,WAAW,CAAC9I,MAAZ,CAAmB,UAAU7C,KAAV,EAAiB;AACrD,eAAOA,KAAK,CAACyC,IAAN,KAAeyI,OAAO,CAACC,YAAR,CAAqB,WAArB,CAAtB;AACH,OAFoB,CAArB;;AAGA,UAAIY,cAAc,CAACvK,MAAf,KAA0B,CAA9B,EAAiC;AAC7BmK,QAAAA,WAAW,CAAChJ,IAAZ,CAAiBjC,KAAK,CAACsL,cAAN,CAAqBd,OAAO,CAACC,YAAR,CAAqB,WAArB,CAArB,CAAjB;AACH;;AACDS,MAAAA,aAAa,CAACjJ,IAAd,CAAmBuI,OAAnB;AACH,KARD;AASA,WAAO;AACHlL,MAAAA,KAAK,EAAE2L,WAAW,CAACnK,MAAZ,GAAqB,CAArB,GAAyBmK,WAAzB,GAAuCA,WAAW,CAAC,CAAD,CADtD;AAEHT,MAAAA,OAAO,EAAEU,aAAa,CAACpK,MAAd,GAAuB,CAAvB,GAA2BoK,aAA3B,GAA2CA,aAAa,CAAC,CAAD;AAF9D,KAAP;AAIH,GAlBD;;AAmBA3L,EAAAA,SAAS,CAACI,SAAV,CAAoB0K,8BAApB,GAAqD,YAAY;AAC7D,QAAIkB,oBAAoB,GAAG,KAAKC,uBAAL,EAA3B;;AACA,SAAK,IAAIxK,EAAE,GAAG,CAAT,EAAYyK,sBAAsB,GAAGF,oBAA1C,EAAgEvK,EAAE,GAAGyK,sBAAsB,CAAC3K,MAA5F,EAAoGE,EAAE,EAAtG,EAA0G;AACtG,UAAI0K,WAAW,GAAGD,sBAAsB,CAACzK,EAAD,CAAxC;AACA0K,MAAAA,WAAW,CAACC,YAAZ,CAAyB,eAAzB,EAA0C,OAA1C;AACH;;AACD9M,IAAAA,WAAW,CAAC0M,oBAAD,EAAuBlM,GAAG,CAAC+L,kBAA3B,CAAX;;AACA,QAAI,KAAK5L,MAAL,CAAYuJ,WAAZ,KAA4B,QAA5B,IAAwC,KAAKvJ,MAAL,CAAYuJ,WAAZ,KAA4B,aAAxE,EAAuF;AACnFlK,MAAAA,WAAW,CAAC0M,oBAAD,EAAuBlM,GAAG,CAACuM,oBAA3B,CAAX;AACH;AACJ,GAVD;;AAWArM,EAAAA,SAAS,CAACI,SAAV,CAAoBoL,uBAApB,GAA8C,UAAUc,KAAV,EAAiB;AAC3D,SAAK,IAAI7K,EAAE,GAAG,CAAT,EAAY8K,OAAO,GAAGD,KAA3B,EAAkC7K,EAAE,GAAG8K,OAAO,CAAChL,MAA/C,EAAuDE,EAAE,EAAzD,EAA6D;AACzD,UAAI+K,IAAI,GAAGD,OAAO,CAAC9K,EAAD,CAAlB;AACA+K,MAAAA,IAAI,CAACJ,YAAL,CAAkB,eAAlB,EAAmC,MAAnC;AACH;;AACD,QAAI,KAAKnM,MAAL,CAAYuJ,WAAZ,KAA4B,aAAhC,EAA+C;AAC3C,WAAKvJ,MAAL,CAAYwM,mBAAZ;AACH;;AACDpN,IAAAA,QAAQ,CAACiN,KAAD,EAAQxM,GAAG,CAAC+L,kBAAZ,CAAR;AACH,GATD;;AAUA7L,EAAAA,SAAS,CAACI,SAAV,CAAoB6L,uBAApB,GAA8C,YAAY;AACtD,WAAO,GAAGb,KAAH,CAASC,IAAT,CAAc,KAAKpL,MAAL,CAAYgL,OAAZ,CAAoBK,gBAApB,CAAqC,MAAMxL,GAAG,CAAC+L,kBAAV,GAA+B,IAA/B,GAAsC/L,GAAG,CAAC4M,iBAA1C,GAA8D,QAAnG,CAAd,CAAP;AACH,GAFD;;AAGA1M,EAAAA,SAAS,CAACI,SAAV,CAAoBuM,YAApB,GAAmC,YAAY;AAC3C,QAAIC,YAAY,GAAG,KAAK3M,MAAL,CAAY4M,mBAAZ,EAAnB;;AACA,QAAID,YAAY,CAACrL,MAAb,GAAsB,CAA1B,EAA6B;AACzB,UAAI,KAAKtB,MAAL,CAAY6M,yBAAhB,EAA2C;AACvC,YAAIjC,MAAM,GAAK,CAACjM,iBAAiB,CAAC,KAAKqB,MAAL,CAAY8M,eAAb,CAAlB,IACX,KAAK9M,MAAL,CAAY8M,eAAZ,CAA4B9B,OADlB,IAC8B2B,YAAY,CAACA,YAAY,CAACrL,MAAb,GAAsB,CAAvB,CADxD;AAEA,aAAKtB,MAAL,CAAY6M,yBAAZ,CAAsCE,WAAtC,CAAkDnC,MAAM,YAAYpE,KAApE,EAA2EoE,MAA3E;AACH;;AACD;AACH;;AACD,QAAImB,oBAAoB,GAAG,KAAKC,uBAAL,EAA3B;;AACA,QAAID,oBAAoB,CAACzK,MAArB,GAA8B,CAAlC,EAAqC;AACjCyK,MAAAA,oBAAoB,CAACA,oBAAoB,CAACzK,MAArB,GAA8B,CAA/B,CAApB,CAAsD0L,KAAtD;AACA;AACH;AACJ,GAfD;;AAgBAjN,EAAAA,SAAS,CAACI,SAAV,CAAoB8M,oBAApB,GAA2C,UAAUzJ,UAAV,EAAsB;AAC7D,QAAIoH,MAAJ;;AACA,QAAI,KAAK5K,MAAL,CAAYuJ,WAAZ,KAA4B,QAA5B,IAAwC,KAAKvJ,MAAL,CAAYuJ,WAAZ,KAA4B,aAAxE,EAAuF;AACnF,aAAOqB,MAAP;AACH;;AACD,QAAIpH,UAAU,CAAClC,MAAX,GAAoB,CAAxB,EAA2B;AACvB,UAAI4L,cAAc,GAAG1J,UAAU,CAACA,UAAU,CAAClC,MAAX,GAAoB,CAArB,CAA/B;AACA,UAAIyG,cAAc,GAAGmF,cAAc,CAAC,KAAKlN,MAAL,CAAYe,WAAZ,CAAwBY,SAAzB,CAAnC;AACA,UAAIwL,WAAW,GAAG,IAAIjF,IAAJ,CAAS,CAACH,cAAV,EAA0BqF,UAA1B,CAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,CAAlB;AACA,UAAIlK,QAAQ,GAAG,KAAKmK,mBAAL,CAAyBH,cAAzB,CAAf;;AACA,UAAI,KAAKlN,MAAL,CAAYuJ,WAAZ,KAA4B,OAA5B,IAAuCrG,QAA3C,EAAqD;AACjDiK,QAAAA,WAAW,GAAG,IAAIjF,IAAJ,CAAS,CAACH,cAAV,EAA0BY,QAA1B,CAAmC,CAAnC,EAAsC,CAAtC,EAAyC,CAAzC,EAA4C,CAA5C,CAAd;AACH;;AACD,UAAI2E,UAAU,GAAG,KAAK,CAAtB;;AACA,UAAIpK,QAAQ,IAAI,CAAC,KAAD,EAAQ,MAAR,EAAgB,UAAhB,EAA4BuD,OAA5B,CAAoC,KAAKzG,MAAL,CAAYuJ,WAAhD,MAAiE,CAAC,CAAlF,EAAqF;AACjF+D,QAAAA,UAAU,GAAG,KAAKtN,MAAL,CAAYuN,YAAZ,EAAb;AACH,OAFD,MAGK;AACDD,QAAAA,UAAU,GAAG,KAAKtN,MAAL,CAAYwN,eAAZ,EAAb;AACH;;AACD,UAAIC,WAAW,GAAG,iBAAiB,KAAKzN,MAAL,CAAY0N,aAAZ,CAA0B,IAAIxF,IAAJ,CAASiF,WAAT,CAA1B,CAAjB,GAAoE,IAAtF;;AACA,UAAI,KAAKnN,MAAL,CAAY+E,iBAAZ,CAA8BC,KAA9B,CAAoCC,SAApC,CAA8C3D,MAA9C,GAAuD,CAA3D,EAA8D;AAC1DmM,QAAAA,WAAW,IAAI,wBAAwB,KAAKvI,sBAAL,CAA4BgI,cAA5B,CAAxB,GAAsE,IAArF;AACH;;AACDtC,MAAAA,MAAM,GAAG0C,UAAU,CAACK,aAAX,CAAyBF,WAAzB,CAAT;;AACA,UAAI7C,MAAJ,EAAY;AACR,aAAK5K,MAAL,CAAY8M,eAAZ,GAA8B,KAAK9M,MAAL,CAAY4N,cAAZ,CAA2BhD,MAA3B,CAA9B;;AACA,YAAI,KAAK5K,MAAL,CAAY6M,yBAAhB,EAA2C;AACvC,eAAK7M,MAAL,CAAY6M,yBAAZ,CAAsCE,WAAtC,CAAkD,KAAlD,EAAyDnC,MAAzD;AACH;;AACD,eAAOA,MAAP;AACH;AACJ;;AACD,WAAOA,MAAP;AACH,GAlCD;;AAmCA7K,EAAAA,SAAS,CAACI,SAAV,CAAoB+E,sBAApB,GAA6C,UAAUxC,SAAV,EAAqB;AAC9D,QAAImL,SAAS,GAAGC,IAAI,IAAI,KAAK9N,MAAL,CAAYoB,kBAAZ,CAA+B+J,KAA/B,CAAqC,CAAC,CAAtC,EAAyC,CAAzC,EAA4C2C,IAApE;AACA,QAAIC,UAAU,GAAG,KAAK/N,MAAL,CAAYoB,kBAAZ,CAA+BE,MAA/B,GAAwC,CAAzD;AACA,QAAI0M,OAAO,GAAG,KAAKhO,MAAL,CAAYoB,kBAAZ,CAA+B+J,KAA/B,CAAqC,CAAC,CAAtC,EAAyC,CAAzC,EAA4ClJ,KAA1D;AACA,QAAIV,EAAE,GAAKmB,SAAS,CAACsL,OAAD,CAAT,YAA8BxH,KAA/B,GACN9D,SAAS,CAACsL,OAAD,CAAT,CAAmB,CAAnB,CADM,GACkBtL,SAAS,CAACsL,OAAD,CADrC;AAEA,QAAIC,QAAQ,GAAG,KAAKjO,MAAL,CAAYoB,kBAAZ,CAA+BuB,MAA/B,CAAsC,UAAUsD,CAAV,EAAaoC,KAAb,EAAoB;AACrE,UAAIpC,CAAC,CAAC6H,IAAF,KAAWD,SAAf,EAA0B;AACtBE,QAAAA,UAAU,GAAG1F,KAAb;AACA,eAAOpC,CAAP;AACH;;AACD,aAAO,IAAP;AACH,KANc,EAMZ,CANY,CAAf;AAOA,WAAO,KAAKjG,MAAL,CAAYqB,YAAZ,CAAyB6M,sBAAzB,CAAgD3M,EAAhD,EAAoDsM,SAApD,EAA+DI,QAA/D,CAAP;AACH,GAdD;;AAeAlO,EAAAA,SAAS,CAACI,SAAV,CAAoBkN,mBAApB,GAA0C,UAAUvN,KAAV,EAAiB;AACvD,QAAIwF,YAAY,GAAG,KAAKtF,MAAL,CAAYe,WAA/B;AACA,QAAImC,QAAQ,GAAGpD,KAAK,CAACwF,YAAY,CAACpC,QAAd,CAApB;AACA,QAAIiL,SAAS,GAAI,CAACrO,KAAK,CAACwF,YAAY,CAACzD,OAAd,CAAL,CAA4BkF,OAA5B,KAAwCjH,KAAK,CAACwF,YAAY,CAAC3D,SAAd,CAAL,CAA8BoF,OAA9B,EAAzC,IACXnH,IAAI,CAACwO,UADK,IACU,CAD1B;AAEA,WAAQlL,QAAQ,IAAIiL,SAAb,GAA0B,IAA1B,GAAiC,KAAxC;AACH,GAND;;AAOApO,EAAAA,SAAS,CAACI,SAAV,CAAoBkO,gBAApB,GAAuC,YAAY;AAC/C,SAAKrO,MAAL,CAAYsO,EAAZ,CAAexO,KAAK,CAACyO,aAArB,EAAoC,KAAKC,uBAAzC,EAAkE,IAAlE;AACH,GAFD;;AAGAzO,EAAAA,SAAS,CAACI,SAAV,CAAoBqO,uBAApB,GAA8C,UAAU1O,KAAV,EAAiB;AAC3D,QAAIkL,OAAO,GAAGlL,KAAK,CAACA,KAAN,CAAY8K,MAA1B;;AACA,QAAIhM,OAAO,CAACoM,OAAD,EAAU,MAAMnL,GAAG,CAAC4M,iBAApB,CAAX,EAAmD;AAC/C,UAAI,KAAKzM,MAAL,CAAYuJ,WAAZ,KAA4B,aAAhC,EAA+C;AAC3C,aAAKvJ,MAAL,CAAYwM,mBAAZ;AACH;AACJ,KAJD,MAKK,IAAI,CAAC5N,OAAO,CAACoM,OAAD,EAAU,MAAMnL,GAAG,CAAC4O,UAApB,CAAZ,EAA6C;AAC9C,WAAK5D,8BAAL;AACH;AACJ,GAVD;;AAWA9K,EAAAA,SAAS,CAACI,SAAV,CAAoBuO,qBAApB,GAA4C,UAAU1D,OAAV,EAAmBlL,KAAnB,EAA0B6O,aAA1B,EAAyC;AACjF,QAAIA,aAAa,KAAK,KAAK,CAA3B,EAA8B;AAAEA,MAAAA,aAAa,GAAG,KAAhB;AAAwB;;AACxD,QAAIC,UAAU,GAAI,CAACjQ,iBAAiB,CAACmB,KAAD,CAAnB,GAA8BA,KAAK,CAAC,KAAKE,MAAL,CAAYe,WAAZ,CAAwB8N,UAAzB,CAAnC,GAA0E,KAA3F;;AACA,QAAIhQ,OAAO,CAACiQ,OAAR,IAAmB,CAAC,KAAK9O,MAAL,CAAY+O,UAApC,EAAgD;AAC5ChQ,MAAAA,YAAY,CAACwF,GAAb,CAAiByG,OAAjB,EAA0B,YAA1B,EAAwC,KAAKgE,UAA7C,EAAyD,IAAzD;AACH,KAFD,MAGK;AACDjQ,MAAAA,YAAY,CAACwF,GAAb,CAAiByG,OAAjB,EAA0B,OAA1B,EAAmC,KAAKiE,UAAxC,EAAoD,IAApD;AACH;;AACD,QAAI,CAAC,KAAKjP,MAAL,CAAY+O,UAAb,IAA2B,CAAC,KAAK/O,MAAL,CAAY+E,iBAAZ,CAA8BmK,QAA1D,IAAsE,CAACN,UAA3E,EAAuF;AACnF7P,MAAAA,YAAY,CAACwF,GAAb,CAAiByG,OAAjB,EAA0B,UAA1B,EAAsC,KAAKmE,gBAA3C,EAA6D,IAA7D;AACH;;AACD,QAAI,CAAC,KAAKnP,MAAL,CAAY+E,iBAAZ,CAA8BmK,QAA/B,IAA2C,CAACN,UAA5C,IAA0D,CAACD,aAA/D,EAA8E;AAC1E,UAAI,KAAK3O,MAAL,CAAYoP,YAAhB,EAA8B;AAC1B,aAAKpP,MAAL,CAAYoP,YAAZ,CAAyBC,eAAzB,CAAyCrE,OAAzC;AACH;;AACD,UAAI,KAAKhL,MAAL,CAAYsP,iBAAhB,EAAmC;AAC/B,aAAKtP,MAAL,CAAYsP,iBAAZ,CAA8BC,aAA9B,CAA4CvE,OAA5C;AACH;AACJ;AACJ,GApBD;;AAqBAjL,EAAAA,SAAS,CAACI,SAAV,CAAoB6O,UAApB,GAAiC,UAAUtM,SAAV,EAAqB;AAClD,QAAIlC,KAAK,GAAG,IAAZ;;AACAgP,IAAAA,UAAU,CAAC,YAAY;AAAE,aAAOhP,KAAK,CAACN,cAAN,GAAuB,KAA9B;AAAsC,KAArD,EAAuD,GAAvD,CAAV;;AACA,QAAI,KAAKA,cAAT,EAAyB;AACrBwC,MAAAA,SAAS,CAAC+M,cAAV;AACA,WAAKN,gBAAL,CAAsBzM,SAAtB;AACH,KAHD,MAIK;AACD,WAAKxC,cAAL,GAAsB,IAAtB;AACA,WAAK+O,UAAL,CAAgBvM,SAAhB;AACH;AACJ,GAXD;;AAYA3C,EAAAA,SAAS,CAACI,SAAV,CAAoBuP,mBAApB,GAA0C,UAAU1E,OAAV,EAAmB2E,SAAnB,EAA8Bf,UAA9B,EAA0C;AAChF,QAAI,CAAC,KAAK5O,MAAL,CAAYoP,YAAb,IAA6B,CAAC,KAAKpP,MAAL,CAAY4P,aAA1C,IAA2D,KAAK5P,MAAL,CAAY+E,iBAAZ,CAA8BmK,QAAzF,IAAqGN,UAAzG,EAAqH;AACjH;AACH;;AACD,SAAK,IAAIpN,EAAE,GAAG,CAAT,EAAYiC,EAAE,GAAG2C,MAAM,CAACD,IAAP,CAAYwJ,SAAZ,CAAtB,EAA8CnO,EAAE,GAAGiC,EAAE,CAACnC,MAAtD,EAA8DE,EAAE,EAAhE,EAAoE;AAChE,UAAIqO,UAAU,GAAGpM,EAAE,CAACjC,EAAD,CAAnB;AACA,UAAIsO,aAAa,GAAG7Q,aAAa,CAAC,KAAD,EAAQ;AAAE8Q,QAAAA,SAAS,EAAElQ,GAAG,CAACmQ;AAAjB,OAAR,CAAjC;;AACA,cAAQH,UAAR;AACI,aAAK,QAAL;AACI,cAAI,CAACF,SAAS,CAACxF,MAAf,EAAuB;AACnB2F,YAAAA,aAAa,CAACG,WAAd,CAA0BhR,aAAa,CAAC,KAAD,EAAQ;AAAE8Q,cAAAA,SAAS,EAAE;AAAb,aAAR,CAAvC;AACA3Q,YAAAA,QAAQ,CAAC,CAAC0Q,aAAD,CAAD,EAAkB,KAAK9P,MAAL,CAAYkQ,SAAZ,GAAwBrQ,GAAG,CAACsQ,oBAA5B,GAAmDtQ,GAAG,CAACuQ,mBAAzE,CAAR;AACAlR,YAAAA,OAAO,CAAC,CAAC4Q,aAAD,CAAD,EAAkB9E,OAAlB,CAAP;AACH;;AACD;;AACJ,aAAK,SAAL;AACI,cAAI,CAAC2E,SAAS,CAACvF,OAAf,EAAwB;AACpB0F,YAAAA,aAAa,CAACG,WAAd,CAA0BhR,aAAa,CAAC,KAAD,EAAQ;AAAE8Q,cAAAA,SAAS,EAAE;AAAb,aAAR,CAAvC;AACA3Q,YAAAA,QAAQ,CAAC,CAAC0Q,aAAD,CAAD,EAAkB,KAAK9P,MAAL,CAAYkQ,SAAZ,GAAwBrQ,GAAG,CAACuQ,mBAA5B,GAAkDvQ,GAAG,CAACsQ,oBAAxE,CAAR;AACAhR,YAAAA,MAAM,CAAC,CAAC2Q,aAAD,CAAD,EAAkB9E,OAAlB,CAAN;AACH;;AACD;;AACJ,aAAK,OAAL;AACI,cAAI,CAAC2E,SAAS,CAACU,KAAf,EAAsB;AAClBP,YAAAA,aAAa,CAACG,WAAd,CAA0BhR,aAAa,CAAC,KAAD,EAAQ;AAAE8Q,cAAAA,SAAS,EAAE;AAAb,aAAR,CAAvC;AACA3Q,YAAAA,QAAQ,CAAC,CAAC0Q,aAAD,CAAD,EAAkBjQ,GAAG,CAACyQ,kBAAtB,CAAR;AACApR,YAAAA,OAAO,CAAC,CAAC4Q,aAAD,CAAD,EAAkB9E,OAAlB,CAAP;AACH;;AACD;;AACJ,aAAK,UAAL;AACI,cAAI,CAAC2E,SAAS,CAACY,QAAf,EAAyB;AACrBT,YAAAA,aAAa,CAACG,WAAd,CAA0BhR,aAAa,CAAC,KAAD,EAAQ;AAAE8Q,cAAAA,SAAS,EAAE;AAAb,aAAR,CAAvC;AACA3Q,YAAAA,QAAQ,CAAC,CAAC0Q,aAAD,CAAD,EAAkBjQ,GAAG,CAAC2Q,qBAAtB,CAAR;AACArR,YAAAA,MAAM,CAAC,CAAC2Q,aAAD,CAAD,EAAkB9E,OAAlB,CAAN;AACH;;AACD;AA5BR;AA8BH;AACJ,GAtCD;;AAuCAjL,EAAAA,SAAS,CAACI,SAAV,CAAoB8O,UAApB,GAAiC,UAAUvM,SAAV,EAAqB;AAClD,QAAIlC,KAAK,GAAG,IAAZ;;AACA,QAAIoK,MAAM,GAAGlI,SAAS,CAACkI,MAAvB;;AACA,QAAIA,MAAM,CAAC6F,SAAP,CAAiBC,QAAjB,CAA0B7Q,GAAG,CAAC8Q,gBAA9B,KAAmD/F,MAAM,CAAC6F,SAAP,CAAiBC,QAAjB,CAA0B7Q,GAAG,CAAC+Q,kBAA9B,CAAvD,EAA0G;AACtG;AACH;;AACD,QAAIlO,SAAS,CAACmO,OAAV,IAAqBnO,SAAS,CAACoO,KAAV,KAAoB,CAAzC,IAA8C,KAAK9Q,MAAL,CAAY6M,yBAA9D,EAAyF;AACrF,WAAK7M,MAAL,CAAY+Q,UAAZ,CAAuBA,UAAvB,CAAkCC,IAAlC;AACA,WAAKhR,MAAL,CAAY8K,gBAAZ,GAA+B,GAAGK,KAAH,CAASC,IAAT,CAAc,KAAKpL,MAAL,CAAYgL,OAAZ,CAAoBK,gBAApB,CAAqC,MAAMxL,GAAG,CAAC+L,kBAA/C,CAAd,CAA/B;AACA,UAAIqF,QAAQ,GAAGrS,OAAO,CAAC8D,SAAS,CAACkI,MAAX,EAAmB,MAAM/K,GAAG,CAAC4M,iBAA7B,CAAtB;AACA,WAAK9B,wBAAL,CAA8BsG,QAA9B;AACA,WAAKC,eAAL,CAAqBxO,SAArB,EAAgC,KAAhC;AACA,UAAIyO,UAAU,GAAG;AACbvO,QAAAA,IAAI,EAAE,KAAK5C,MAAL,CAAYkR,eAAZ,CAA4BpR,KADrB;AAEbkL,QAAAA,OAAO,EAAE,KAAKhL,MAAL,CAAYkR,eAAZ,CAA4BlG,OAFxB;AAGblL,QAAAA,KAAK,EAAE4C,SAHM;AAGK0O,QAAAA,WAAW,EAAE;AAHlB,OAAjB;AAKA,WAAKpR,MAAL,CAAYqR,OAAZ,CAAoBvR,KAAK,CAACwR,MAA1B,EAAkCH,UAAlC;AACA,UAAII,IAAI,GAAGzS,MAAM,CAAC,KAAKkB,MAAL,CAAYkR,eAAb,EAA8B;AAAEM,QAAAA,MAAM,EAAE,KAAV;AAAiBC,QAAAA,aAAa,EAAE/O;AAAhC,OAA9B,CAAjB;AACA,WAAK1C,MAAL,CAAYqR,OAAZ,CAAoBvR,KAAK,CAACmP,UAA1B,EAAsCsC,IAAtC;AACH,KAdD,MAeK;AACD,WAAK1G,8BAAL;AACA,WAAKqG,eAAL,CAAqBxO,SAArB,EAAgC,IAAhC;AACA,UAAIgP,eAAe,GAAG;AAClB9O,QAAAA,IAAI,EAAE,KAAK5C,MAAL,CAAYkR,eAAZ,CAA4BpR,KADhB;AAElBkL,QAAAA,OAAO,EAAE,KAAKhL,MAAL,CAAYkR,eAAZ,CAA4BlG,OAFnB;AAGlBlL,QAAAA,KAAK,EAAE4C,SAHW;AAGA0O,QAAAA,WAAW,EAAE;AAHb,OAAtB;AAKA,WAAKpR,MAAL,CAAYqR,OAAZ,CAAoBvR,KAAK,CAACwR,MAA1B,EAAkCI,eAAlC;AACA,UAAIH,IAAI,GAAGzS,MAAM,CAAC,KAAKkB,MAAL,CAAYkR,eAAb,EAA8B;AAAEM,QAAAA,MAAM,EAAE,KAAV;AAAiBC,QAAAA,aAAa,EAAE/O;AAAhC,OAA9B,CAAjB;AACA,WAAK1C,MAAL,CAAYqR,OAAZ,CAAoBvR,KAAK,CAACmP,UAA1B,EAAsCsC,IAAtC,EAA4C,UAAUI,cAAV,EAA0B;AAClE,YAAI3S,QAAQ,EAAZ,EAAgB;AACZ,cAAI+B,WAAW,GAAGP,KAAK,CAACR,MAAN,CAAae,WAA/B;AACA,cAAIkC,QAAQ,GAAG0O,cAAc,CAAC7R,KAA9B;AACAmD,UAAAA,QAAQ,CAAClC,WAAW,CAACY,SAAb,CAAR,GAAkCnB,KAAK,CAACR,MAAN,CAAa4R,WAAb,CAAyB3O,QAAQ,CAAClC,WAAW,CAACY,SAAb,CAAjC,CAAlC;AACAsB,UAAAA,QAAQ,CAAClC,WAAW,CAACc,OAAb,CAAR,GAAgCrB,KAAK,CAACR,MAAN,CAAa4R,WAAb,CAAyB3O,QAAQ,CAAClC,WAAW,CAACc,OAAb,CAAjC,CAAhC;;AACA,cAAI8P,cAAc,CAAC3G,OAAnB,EAA4B;AACxB2G,YAAAA,cAAc,CAAC3G,OAAf,GAAyB1L,UAAU,CAACqS,cAAc,CAAC3G,OAAhB,CAAnC;AACH;AACJ;;AACD,YAAI2G,cAAc,CAACH,MAAnB,EAA2B;AACvBhR,UAAAA,KAAK,CAACqK,8BAAN;;AACA,cAAIrK,KAAK,CAACR,MAAN,CAAa+Q,UAAjB,EAA6B;AACzBvQ,YAAAA,KAAK,CAACR,MAAN,CAAa+Q,UAAb,CAAwBc,cAAxB;AACH;AACJ,SALD,MAMK;AACD,cAAIrR,KAAK,CAACR,MAAN,CAAauJ,WAAb,KAA6B,QAA7B,IAAyC/I,KAAK,CAACR,MAAN,CAAauJ,WAAb,KAA6B,aAA1E,EAAyF;AACrFnK,YAAAA,QAAQ,CAAC,CAACoB,KAAK,CAACR,MAAN,CAAakR,eAAb,CAA6BlG,OAA9B,CAAD,EAAyCnL,GAAG,CAACuM,oBAA7C,CAAR;AACH;;AACD5L,UAAAA,KAAK,CAACR,MAAN,CAAa4D,MAAb,CAAoB9D,KAAK,CAACmP,UAA1B,EAAsC0C,cAAtC;AACH;AACJ,OAtBD;AAuBH;AACJ,GAvDD;;AAwDA5R,EAAAA,SAAS,CAACI,SAAV,CAAoBgP,gBAApB,GAAuC,UAAUlJ,CAAV,EAAa;AAChD,SAAKjG,MAAL,CAAY+Q,UAAZ,CAAuBc,cAAvB,CAAsC,IAAtC;;AACA,QAAI5L,CAAC,CAAC6L,IAAF,KAAW,YAAf,EAA6B;AACzB,WAAKZ,eAAL,CAAqBjL,CAArB,EAAwB,IAAxB;AACH;;AACD,SAAK4E,8BAAL;;AACA,QAAI,CAAClM,iBAAiB,CAAC,KAAKqB,MAAL,CAAYkR,eAAZ,CAA4BpR,KAA7B,CAAlB,IACAnB,iBAAiB,CAAC,KAAKqB,MAAL,CAAYkR,eAAZ,CAA4BpR,KAA5B,CAAkC,KAAKE,MAAL,CAAYe,WAAZ,CAAwBqB,YAA1D,CAAD,CADrB,EACgG;AAC5F,WAAKpC,MAAL,CAAY+R,WAAZ,CAAwBC,UAAxB,CAAmC,KAAKhS,MAAL,CAAYkR,eAAZ,CAA4BpR,KAA/D,EAAsE,MAAtE;AACH,KAHD,MAIK;AACD,WAAKE,MAAL,CAAYiS,aAAZ,GAA4B,gBAA5B;AACA,WAAKjS,MAAL,CAAY+Q,UAAZ,CAAuBmB,mBAAvB;AACH;AACJ,GAdD;;AAeAnS,EAAAA,SAAS,CAACI,SAAV,CAAoB2L,cAApB,GAAqC,UAAUqG,IAAV,EAAgB;AACjD,WAAO,KAAKnS,MAAL,CAAYgB,eAAZ,CAA4B2B,MAA5B,CAAmC,UAAUC,IAAV,EAAgB;AAAE,aAAOA,IAAI,CAACL,IAAL,KAAc4P,IAArB;AAA4B,KAAjF,EAAmF,CAAnF,CAAP;AACH,GAFD;;AAGApS,EAAAA,SAAS,CAACI,SAAV,CAAoBiS,YAApB,GAAmC,UAAU7Q,EAAV,EAAc;AAC7C,QAAIf,KAAK,GAAG,IAAZ;;AACA,WAAO,KAAKR,MAAL,CAAYwD,UAAZ,CAAuBb,MAAvB,CAA8B,UAAUC,IAAV,EAAgB;AACjD,aAAOA,IAAI,CAACpC,KAAK,CAACR,MAAN,CAAae,WAAb,CAAyBQ,EAA1B,CAAJ,KAAsCA,EAA7C;AACH,KAFM,EAEJ,CAFI,CAAP;AAGH,GALD;;AAMAxB,EAAAA,SAAS,CAACI,SAAV,CAAoBqC,YAApB,GAAmC,YAAY;AAC3C,WAAO,uCAAuC6P,OAAvC,CAA+C,OAA/C,EAAwD,UAAUC,CAAV,EAAa;AACxE,UAAIC,CAAC,GAAG7K,IAAI,CAAC8K,MAAL,KAAgB,EAAhB,GAAqB,CAA7B;AACA,UAAIC,CAAC,GAAIH,CAAC,KAAK,GAAP,GAAcC,CAAd,GAAmBA,CAAC,GAAG,GAAJ,GAAU,GAArC;AACA,aAAOE,CAAC,CAACC,QAAF,CAAW,EAAX,CAAP;AACH,KAJM,CAAP;AAKH,GAND;;AAOA3S,EAAAA,SAAS,CAACI,SAAV,CAAoBwS,cAApB,GAAqC,YAAY;AAC7C,QAAI,KAAK3S,MAAL,CAAYwD,UAAZ,CAAuBlC,MAAvB,KAAkC,CAAtC,EAAyC;AACrC,aAAO,OAAQ,KAAKtB,MAAL,CAAYwD,UAAZ,CAAuB,CAAvB,EAA0B,KAAKxD,MAAL,CAAYe,WAAZ,CAAwBQ,EAAlD,CAAf;AACH;;AACD,QAAI,KAAKvB,MAAL,CAAY+C,SAAZ,CAAsBzB,MAAtB,KAAiC,CAArC,EAAwC;AACpC,aAAO,OAAQ,KAAKtB,MAAL,CAAY+C,SAAZ,CAAsB,CAAtB,EAAyB,KAAK/C,MAAL,CAAYe,WAAZ,CAAwBQ,EAAjD,CAAf;AACH;;AACD,WAAO,QAAP;AACH,GARD;;AASAxB,EAAAA,SAAS,CAACI,SAAV,CAAoByS,aAApB,GAAoC,UAAUC,UAAV,EAAsB;AACtD,QAAIrS,KAAK,GAAG,IAAZ;;AACA,QAAI,KAAKR,MAAL,CAAYwD,UAAZ,CAAuBlC,MAAvB,GAAgC,CAAhC,IAAqC,KAAKtB,MAAL,CAAY+C,SAAZ,CAAsBzB,MAAtB,GAA+B,CAAxE,EAA2E;AACvE,aAAO,CAAP;AACH;;AACD,QAAIwR,OAAJ;AACA,QAAIC,MAAM,GAAG,KAAKJ,cAAL,EAAb;;AACA,QAAII,MAAM,KAAK,QAAf,EAAyB;AACrBD,MAAAA,OAAO,GAAG,KAAKtQ,YAAL,EAAV;AACH;;AACD,QAAIuQ,MAAM,KAAK,QAAf,EAAyB;AACrB,UAAIC,KAAK,GAAG,KAAKhT,MAAL,CAAYwD,UAAZ,CAAuBnB,MAAvB,CAA8B,KAAKrC,MAAL,CAAY+C,SAA1C,CAAZ;AACA,UAAIkQ,KAAK,GAAGvL,IAAI,CAACC,GAAL,CAASC,KAAT,CAAeF,IAAf,EAAqBsL,KAAK,CAACE,GAAN,CAAU,UAAUpT,KAAV,EAAiB;AAAE,eAAOA,KAAK,CAACU,KAAK,CAACR,MAAN,CAAae,WAAb,CAAyBQ,EAA1B,CAAZ;AAA4C,OAAzE,CAArB,CAAZ;AACA0R,MAAAA,KAAK,GAAGtU,iBAAiB,CAACkU,UAAD,CAAjB,GAAgCI,KAAhC,GAAwCA,KAAK,GAAGJ,UAAxD;AACAC,MAAAA,OAAO,GAAGG,KAAK,GAAG,CAAlB;AACH;;AACD,WAAOH,OAAP;AACH,GAjBD;;AAkBA/S,EAAAA,SAAS,CAACI,SAAV,CAAoB+Q,eAApB,GAAsC,UAAUxO,SAAV,EAAqByQ,UAArB,EAAiC;AACnE,QAAI3S,KAAK,GAAG,IAAZ;;AACA,QAAIoK,MAAM,GAAGhM,OAAO,CAAC8D,SAAS,CAACkI,MAAX,EAAmB,MAAM/K,GAAG,CAAC4M,iBAA7B,CAApB;AACA,QAAI0F,IAAI,GAAGvH,MAAM,CAACK,YAAP,CAAoB,WAApB,CAAX;;AACA,QAAIkI,UAAJ,EAAgB;AACZ,WAAK5H,uBAAL,CAA6B,GAAGJ,KAAH,CAASC,IAAT,CAAc,KAAKpL,MAAL,CAAYgL,OAAZ,CAAoBK,gBAApB,CAAqC,oBAAoB8G,IAApB,GAA2B,IAAhE,CAAd,CAA7B;AACAvH,MAAAA,MAAM,CAACoC,KAAP;AACH;;AACD,QAAIoG,WAAW,GAAG,KAAKtH,cAAL,CAAoBqG,IAApB,CAAlB;;AACA,QAAIiB,WAAW,IAAIA,WAAW,CAAC1K,SAA/B,EAA0C;AACtC0K,MAAAA,WAAW,GAAG,KAAKpT,MAAL,CAAYwD,UAAZ,CAAuBb,MAAvB,CAA8B,UAAU0Q,GAAV,EAAe;AACvD,eAAOA,GAAG,CAAC7S,KAAK,CAACR,MAAN,CAAae,WAAb,CAAyBQ,EAA1B,CAAH,KAAqC6R,WAAW,CAAC5S,KAAK,CAACR,MAAN,CAAae,WAAb,CAAyBQ,EAA1B,CAAvD;AACH,OAFa,EAEX,CAFW,CAAd;AAGH;;AACD,SAAKvB,MAAL,CAAYkR,eAAZ,GAA8B;AAAEpR,MAAAA,KAAK,EAAEsT,WAAT;AAAsBpI,MAAAA,OAAO,EAAEJ;AAA/B,KAA9B;AACH,GAfD;;AAgBA7K,EAAAA,SAAS,CAACI,SAAV,CAAoBmC,kBAApB,GAAyC,UAAUxC,KAAV,EAAiBwT,QAAjB,EAA2B/S,WAA3B,EAAwCgT,UAAxC,EAAoD;AACzF,QAAI5S,SAAS,GAAGb,KAAK,CAAC,KAAKE,MAAL,CAAYe,WAAZ,CAAwBY,SAAzB,CAArB;AACA,QAAId,OAAO,GAAGf,KAAK,CAAC,KAAKE,MAAL,CAAYe,WAAZ,CAAwBc,OAAzB,CAAnB;AACA,QAAI2R,SAAS,GAAG1T,KAAK,CAAC,KAAKE,MAAL,CAAYe,WAAZ,CAAwBoB,cAAzB,CAArB;AACA,QAAIsR,QAAQ,GAAG5S,OAAO,CAACkG,OAAR,KAAoBpG,SAAS,CAACoG,OAAV,EAAnC;AACAuM,IAAAA,QAAQ,GAAG,IAAIpL,IAAJ,CAAS,CAACoL,QAAQ,IAAI,KAAKtT,MAAL,CAAYU,UAAZ,CAAuBC,SAAvB,EAAb,EAAiDoG,OAAjD,KAA6D0M,QAAtE,CAAX;AACA,QAAIC,SAAS,GAAG5T,KAAK,CAAC,KAAKE,MAAL,CAAYe,WAAZ,CAAwB4S,mBAAzB,CAArB;AACA,QAAIC,QAAJ;;AACA,QAAI,KAAK5T,MAAL,CAAYuJ,WAAZ,KAA4B,QAA5B,IAAwCgK,UAA5C,EAAwD;AACpDK,MAAAA,QAAQ,GAAGhU,IAAI,CAACiU,YAAL,CAAkB,KAAK7T,MAAL,CAAYU,UAAZ,CAAuBC,SAAvB,EAAlB,EAAsD,KAAKX,MAAL,CAAYU,UAAZ,CAAuBG,OAAvB,EAAtD,IAA0F,CAArG;AACH;;AACD,QAAIiT,WAAW,GAAG,KAAK9T,MAAL,CAAYkE,QAAZ,IAAwB,KAAKlE,MAAL,CAAYqE,QAAZ,CAAqB0P,oBAArB,EAA1C;AACA,QAAIC,QAAQ,GAAG,KAAKhU,MAAL,CAAY+E,iBAAZ,CAA8BkP,cAA7C;AACA,QAAIC,YAAY,GAAG,KAAKlU,MAAL,CAAYkU,YAA/B;AACA,QAAIC,KAAK,GAAGzU,QAAQ,CAACiB,SAAD,EAAY6S,SAAZ,EAAuBE,SAAvB,EAAkCM,QAAlC,EAA4CJ,QAA5C,EAAsDN,QAAtD,EAAgEY,YAAhE,EAA8E3T,WAA9E,EAA2FuT,WAA3F,CAApB;;AACA,QAAI,KAAK9T,MAAL,CAAYuJ,WAAZ,KAA4B,QAA5B,IAAwCiK,SAAS,CAAC/M,OAAV,CAAkB,OAAlB,MAA+B,CAAC,CAAxE,IAA6E+M,SAAS,CAAC/M,OAAV,CAAkB,OAAlB,MAA+B,CAAC,CAAjH,EAAoH;AAChH,UAAI9H,iBAAiB,CAACmB,KAAK,CAACsU,cAAP,CAArB,EAA6C;AACzCtU,QAAAA,KAAK,CAACsU,cAAN,GAAuB;AAAE3T,UAAAA,KAAK,EAAE,IAAIyH,IAAJ,CAASiM,KAAK,CAAC,CAAD,CAAd,CAAT;AAA6BvT,UAAAA,GAAG,EAAE,IAAIsH,IAAJ,CAASiM,KAAK,CAACA,KAAK,CAAC7S,MAAN,GAAe,CAAhB,CAAd;AAAlC,SAAvB;AACH,OAFD,MAGK;AACD,YAAI6S,KAAK,CAAC,CAAD,CAAL,GAAWrU,KAAK,CAACsU,cAAN,CAAqB3T,KAArB,CAA2BsG,OAA3B,EAAf,EAAqD;AACjDjH,UAAAA,KAAK,CAACsU,cAAN,CAAqB3T,KAArB,GAA6B,IAAIyH,IAAJ,CAASiM,KAAK,CAAC,CAAD,CAAd,CAA7B;AACH;;AACD,YAAIA,KAAK,CAACA,KAAK,CAAC7S,MAAN,GAAe,CAAhB,CAAL,GAA0BxB,KAAK,CAACsU,cAAN,CAAqBxT,GAArB,CAAyBmG,OAAzB,EAA9B,EAAkE;AAC9DjH,UAAAA,KAAK,CAACsU,cAAN,CAAqBxT,GAArB,GAA2B,IAAIsH,IAAJ,CAASiM,KAAK,CAACA,KAAK,CAAC7S,MAAN,GAAe,CAAhB,CAAd,CAA3B;AACH;AACJ;AACJ;;AACD,QAAI+S,oBAAoB,GAAG,EAA3B;;AACA,SAAK,IAAI7S,EAAE,GAAG,CAAT,EAAY8S,OAAO,GAAGH,KAA3B,EAAkC3S,EAAE,GAAG8S,OAAO,CAAChT,MAA/C,EAAuDE,EAAE,EAAzD,EAA6D;AACzD,UAAIsI,IAAI,GAAGwK,OAAO,CAAC9S,EAAD,CAAlB;AACA,UAAI+S,YAAY,GAAGzV,MAAM,CAAC,EAAD,EAAKgB,KAAL,EAAY,IAAZ,EAAkB,IAAlB,CAAzB;AACAyU,MAAAA,YAAY,CAAC,KAAKvU,MAAL,CAAYe,WAAZ,CAAwBY,SAAzB,CAAZ,GAAkD,IAAIuG,IAAJ,CAAS4B,IAAT,CAAlD;AACAyK,MAAAA,YAAY,CAAC,KAAKvU,MAAL,CAAYe,WAAZ,CAAwBc,OAAzB,CAAZ,GAAgD,IAAIqG,IAAJ,CAAS,IAAIA,IAAJ,CAAS4B,IAAT,EAAe0K,eAAf,CAA+Bf,QAA/B,CAAT,CAAhD;AACAc,MAAAA,YAAY,CAAC,KAAKvU,MAAL,CAAYe,WAAZ,CAAwBqB,YAAzB,CAAZ,GAAqDmS,YAAY,CAAC,KAAKvU,MAAL,CAAYe,WAAZ,CAAwBQ,EAAzB,CAAjE;AACA,aAAOgT,YAAY,CAAC,KAAKvU,MAAL,CAAYe,WAAZ,CAAwB4S,mBAAzB,CAAnB;AACA,aAAOY,YAAY,CAAC,KAAKvU,MAAL,CAAYe,WAAZ,CAAwB0T,WAAzB,CAAnB;AACAF,MAAAA,YAAY,CAAChS,IAAb,GAAoB,KAAKC,YAAL,EAApB;AACA6R,MAAAA,oBAAoB,CAAC5R,IAArB,CAA0B8R,YAA1B;AACH;;AACD,WAAOF,oBAAP;AACH,GAzCD;;AA0CAtU,EAAAA,SAAS,CAACI,SAAV,CAAoBuU,cAApB,GAAqC,UAAUzR,QAAV,EAAoB0R,QAApB,EAA8B;AAC/D,QAAIA,QAAQ,KAAK,KAAK,CAAtB,EAAyB;AAAEA,MAAAA,QAAQ,GAAG,KAAX;AAAmB;;AAC9C,QAAIC,WAAJ;;AACA,OAAG;AACC3R,MAAAA,QAAQ,GAAG,KAAK4R,iBAAL,CAAuB5R,QAAvB,CAAX;;AACA,UAAIA,QAAJ,EAAc;AACV2R,QAAAA,WAAW,GAAG9V,MAAM,CAAC,EAAD,EAAKmE,QAAL,EAAe,IAAf,EAAqB,IAArB,CAApB;AACH;AACJ,KALD,QAKSA,QAAQ,IAAI0R,QALrB;;AAMA,QAAIA,QAAQ,IAAIC,WAAhB,EAA6B;AACzB,UAAIE,UAAU,GAAG,KAAKC,mBAAL,CAAyBH,WAAzB,CAAjB;AACA,UAAII,SAAS,GAAGF,UAAU,CAACG,MAAX,CAAkB9J,KAAlB,CAAwB,CAAC,CAAzB,EAA4B,CAA5B,CAAhB;;AACA,UAAI2J,UAAU,CAACI,UAAX,CAAsB5T,MAAtB,GAA+B,CAA/B,IAAoC,CAACsT,WAAW,CAAC,KAAK5U,MAAL,CAAYe,WAAZ,CAAwB4S,mBAAzB,CAApD,EAAmG;AAC/FqB,QAAAA,SAAS,GAAGF,UAAU,CAACI,UAAX,CAAsB/J,KAAtB,CAA4B,CAAC,CAA7B,EAAgC,CAAhC,CAAZ;AACH;;AACD,UAAI6J,SAAJ,EAAe;AACXJ,QAAAA,WAAW,CAAC,KAAK5U,MAAL,CAAYe,WAAZ,CAAwBoB,cAAzB,CAAX,GAAsD6S,SAAS,CAAC,KAAKhV,MAAL,CAAYe,WAAZ,CAAwBoB,cAAzB,CAA/D;AACH;AACJ;;AACD,WAAOyS,WAAP;AACH,GApBD;;AAqBA7U,EAAAA,SAAS,CAACI,SAAV,CAAoB4U,mBAApB,GAA0C,UAAUI,SAAV,EAAqBC,QAArB,EAA+B;AACrE,QAAIC,mBAAmB,GAAG,EAA1B;AACA,QAAIhB,oBAAoB,GAAG,EAA3B;AACA,QAAIiB,cAAc,GAAGH,SAArB;;AACA,OAAG;AACCG,MAAAA,cAAc,GAAG,KAAKT,iBAAL,CAAuBS,cAAvB,EAAuC,IAAvC,CAAjB;;AACA,UAAIA,cAAJ,EAAoB;AAChBD,QAAAA,mBAAmB,CAAC5S,IAApB,CAAyB6S,cAAzB;AACH;;AACDjB,MAAAA,oBAAoB,GAAGA,oBAAoB,CAAChS,MAArB,CAA4B,KAAKkT,kBAAL,CAAwBD,cAAc,IAAIH,SAA1C,CAA5B,CAAvB;AACH,KAND,QAMSG,cANT;;AAOA,QAAIE,WAAW,GAAG,EAAlB;;AACA,QAAIJ,QAAJ,EAAc;AACV,UAAIK,QAAQ,GAAG,KAAKzV,MAAL,CAAYe,WAA3B;AACAyU,MAAAA,WAAW,GAAG;AACVP,QAAAA,MAAM,EAAEI,mBAAmB,CAAC1S,MAApB,CAA2B,UAAUD,SAAV,EAAqB;AACpD,iBAAOA,SAAS,CAAC+S,QAAQ,CAAC9T,SAAV,CAAT,IAAiCyT,QAAQ,CAACK,QAAQ,CAAC9T,SAAV,CAAhD;AACH,SAFO,CADE;AAIVuT,QAAAA,UAAU,EAAEb,oBAAoB,CAAC1R,MAArB,CAA4B,UAAUD,SAAV,EAAqB;AACzD,iBAAOA,SAAS,CAAC+S,QAAQ,CAAC9T,SAAV,CAAT,IAAiCyT,QAAQ,CAACK,QAAQ,CAAC9T,SAAV,CAAhD;AACH,SAFW;AAJF,OAAd;AAQH,KAVD,MAWK;AACD6T,MAAAA,WAAW,GAAG;AAAEP,QAAAA,MAAM,EAAEI,mBAAV;AAA+BH,QAAAA,UAAU,EAAEb;AAA3C,OAAd;AACH;;AACD,WAAOmB,WAAP;AACH,GA3BD;;AA4BAzV,EAAAA,SAAS,CAACI,SAAV,CAAoB0U,iBAApB,GAAwC,UAAUM,SAAV,EAAqB1Q,SAArB,EAAgC;AACpE,QAAI3D,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACA,QAAI2U,UAAJ;;AACA,QAAIjR,SAAJ,EAAe;AACXiR,MAAAA,UAAU,GAAGP,SAAS,CAACrU,MAAM,CAACS,EAAR,CAAtB;AACH,KAFD,MAGK;AACDmU,MAAAA,UAAU,GAAIP,SAAS,CAACrU,MAAM,CAACsB,YAAR,CAAT,IAAkC+S,SAAS,CAACrU,MAAM,CAAC2T,WAAR,CAAzD;AACH;;AACD,QAAIkB,SAAS,GAAG,KAAK3V,MAAL,CAAYwD,UAAZ,CAAuBb,MAAvB,CAA8B,UAAUC,IAAV,EAAgB;AAC1D,aAAOA,IAAI,CAAC6B,SAAS,GAAG3D,MAAM,CAAC2T,WAAV,GAAwB3T,MAAM,CAACS,EAAzC,CAAJ,KAAqDmU,UAA5D;AACH,KAFe,CAAhB;AAGA,WAAOC,SAAS,CAACC,KAAV,EAAP;AACH,GAbD;;AAcA7V,EAAAA,SAAS,CAACI,SAAV,CAAoB0V,gBAApB,GAAuC,UAAUV,SAAV,EAAqBC,QAArB,EAA+B;AAClE,QAAIU,WAAW,GAAGX,SAAS,CAAC,KAAKnV,MAAL,CAAYe,WAAZ,CAAwBY,SAAzB,CAA3B;AACA,QAAIoU,UAAU,GAAGX,QAAQ,CAAC,KAAKpV,MAAL,CAAYe,WAAZ,CAAwBY,SAAzB,CAAzB;AACA,WAAOmU,WAAW,CAAC3N,QAAZ,OAA2B4N,UAAU,CAAC5N,QAAX,EAA3B,IAAoD2N,WAAW,CAAC1N,UAAZ,OAA6B2N,UAAU,CAAC3N,UAAX,EAAjF,IACH0N,WAAW,CAAClN,UAAZ,OAA6BmN,UAAU,CAACnN,UAAX,EADjC;AAEH,GALD;;AAMA7I,EAAAA,SAAS,CAACI,SAAV,CAAoBoV,kBAApB,GAAyC,UAAUtS,QAAV,EAAoB+S,MAApB,EAA4BC,WAA5B,EAAyC;AAC9E,QAAID,MAAM,KAAK,KAAK,CAApB,EAAuB;AAAEA,MAAAA,MAAM,GAAG,KAAT;AAAiB;;AAC1C,QAAIC,WAAW,KAAK,KAAK,CAAzB,EAA4B;AAAEA,MAAAA,WAAW,GAAG,KAAd;AAAsB;;AACpD,QAAIjI,OAAO,GAAGgI,MAAM,GAAG,MAAH,GAAaC,WAAD,GAAgB,KAAKjW,MAAL,CAAYe,WAAZ,CAAwB0T,WAAxC,GAAsD,KAAKzU,MAAL,CAAYe,WAAZ,CAAwBqB,YAA9G;AACA,QAAI8T,QAAQ,GAAGF,MAAM,GAAG,MAAH,GAAY,KAAKhW,MAAL,CAAYe,WAAZ,CAAwBQ,EAAzD;AACA,QAAI4U,UAAU,GAAGH,MAAM,GAAG,KAAKhW,MAAL,CAAYgB,eAAf,GAAiC,KAAKhB,MAAL,CAAYwD,UAApE;AACA,WAAO2S,UAAU,CAACxT,MAAX,CAAkB,UAAUC,IAAV,EAAgB;AAAE,aAAOA,IAAI,CAACoL,OAAD,CAAJ,KAAkB/K,QAAQ,CAACiT,QAAD,CAAjC;AAA8C,KAAlF,CAAP;AACH,GAPD;;AAQAnW,EAAAA,SAAS,CAACI,SAAV,CAAoBiW,kBAApB,GAAyC,UAAU7U,EAAV,EAAc;AACnD,QAAIT,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACA,QAAIsT,oBAAoB,GAAG,EAA3B;AACA,QAAIgC,YAAY,GAAG,KAAKrW,MAAL,CAAYwD,UAAZ,CAAuBb,MAAvB,CAA8B,UAAU0Q,GAAV,EAAe;AAAE,aAAOA,GAAG,CAACvS,MAAM,CAACS,EAAR,CAAH,KAAmBA,EAA1B;AAA+B,KAA9E,CAAnB;;AACA,SAAK,IAAIC,EAAE,GAAG,CAAT,EAAYiC,EAAE,GAAG4S,YAAtB,EAAoC7U,EAAE,GAAGiC,EAAE,CAACnC,MAA5C,EAAoDE,EAAE,EAAtD,EAA0D;AACtD,UAAI8U,OAAO,GAAG7S,EAAE,CAACjC,EAAD,CAAhB;;AACA,UAAI,CAAC7C,iBAAiB,CAAC2X,OAAO,CAACxV,MAAM,CAACqB,cAAR,CAAR,CAAtB,EAAwD;AACpDkS,QAAAA,oBAAoB,GAAGA,oBAAoB,CAAChS,MAArB,CAA4B,KAAKC,kBAAL,CAAwBgU,OAAxB,CAA5B,CAAvB;AACH;AACJ;;AACD,WAAOjC,oBAAP;AACH,GAXD;;AAYAtU,EAAAA,SAAS,CAACI,SAAV,CAAoBoW,qBAApB,GAA4C,UAAU5U,SAAV,EAAqBE,OAArB,EAA8B;AACtE,QAAIf,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACA,QAAIsT,oBAAoB,GAAG,EAA3B;;AACA,SAAK,IAAI7S,EAAE,GAAG,CAAT,EAAYiC,EAAE,GAAG,KAAKzD,MAAL,CAAYwD,UAAlC,EAA8ChC,EAAE,GAAGiC,EAAE,CAACnC,MAAtD,EAA8DE,EAAE,EAAhE,EAAoE;AAChE,UAAIgV,OAAO,GAAG/S,EAAE,CAACjC,EAAD,CAAhB;;AACA,UAAI,CAAC7C,iBAAiB,CAAC6X,OAAO,CAAC1V,MAAM,CAACqB,cAAR,CAAR,CAAtB,EAAwD;AACpDkS,QAAAA,oBAAoB,GAAGA,oBAAoB,CAAChS,MAArB,CAA4B,KAAKC,kBAAL,CAAwBkU,OAAxB,CAA5B,CAAvB;AACH;AACJ;;AACD,QAAI7T,MAAM,GAAG0R,oBAAoB,CAAC1R,MAArB,CAA4B,UAAU0Q,GAAV,EAAe;AACpD,aAAOA,GAAG,CAACvS,MAAM,CAACa,SAAR,CAAH,IAAyBA,SAAzB,IAAsC0R,GAAG,CAACvS,MAAM,CAACe,OAAR,CAAH,IAAuBA,OAA7D,IAAwE,CAAClD,iBAAiB,CAAC0U,GAAG,CAACvS,MAAM,CAACsB,YAAR,CAAJ,CAAjG;AACH,KAFY,CAAb;AAGA,WAAOO,MAAP;AACH,GAbD;;AAcA5C,EAAAA,SAAS,CAACI,SAAV,CAAoBsW,qBAApB,GAA4C,UAAUC,cAAV,EAA0B;AAClE,QAAIlW,KAAK,GAAG,IAAZ;;AACA,QAAIM,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACA,QAAIsV,YAAJ;AACA,QAAIM,kBAAkB,GAAG,EAAzB;;AACA,QAAI,OAAOD,cAAP,KAA0B,QAA1B,IAAsC,OAAOA,cAAP,KAA0B,QAApE,EAA8E;AAC1EL,MAAAA,YAAY,GAAG,KAAKrW,MAAL,CAAYwD,UAAZ,CAAuBb,MAAvB,CAA8B,UAAU0Q,GAAV,EAAe;AACxD,eAAOA,GAAG,CAACvS,MAAM,CAACS,EAAR,CAAH,KAAmBmV,cAA1B;AACH,OAFc,EAEZ,CAFY,CAAf;AAGH,KAJD,MAKK;AACDL,MAAAA,YAAY,GAAGvX,MAAM,CAAC,EAAD,EAAK4X,cAAL,EAAqB,IAArB,EAA2B,IAA3B,CAArB;AACH;;AACD,QAAIL,YAAY,CAACvV,MAAM,CAAC6S,mBAAR,CAAhB,EAA8C;AAC1C,UAAIiD,YAAY,GAAGP,YAAY,CAACvV,MAAM,CAAC6S,mBAAR,CAAZ,CAAyCkD,KAAzC,CAA+C,GAA/C,CAAnB;AACAD,MAAAA,YAAY,CAAC5T,OAAb,CAAqB,UAAU8G,IAAV,EAAgB;AACjC,YAAIgN,MAAM,GAAGtW,KAAK,CAACR,MAAN,CAAawD,UAAb,CAAwBb,MAAxB,CAA+B,UAAUM,QAAV,EAAoB;AAC5D,iBAAOA,QAAQ,CAACnC,MAAM,CAACsB,YAAR,CAAR,KAAkCiU,YAAY,CAACvV,MAAM,CAACS,EAAR,CAA9C,IAA6D0B,QAAQ,CAACnC,MAAM,CAAC6S,mBAAR,CAAR,KAAyC7J,IAA7G;AACH,SAFY,CAAb;;AAGA,YAAIgN,MAAM,CAACxV,MAAP,KAAkB,CAAtB,EAAyB;AACrB,cAAIyV,MAAM,GAAGpX,+BAA+B,CAACmK,IAAD,CAA5C;AACA,cAAIkN,WAAW,GAAGlY,MAAM,CAAC,EAAD,EAAK4X,cAAL,EAAqB,IAArB,EAA2B,IAA3B,CAAxB;AACAM,UAAAA,WAAW,CAAClW,MAAM,CAACsB,YAAR,CAAX,GAAmCiU,YAAY,CAACvV,MAAM,CAACS,EAAR,CAA/C;AACA,iBAAOyV,WAAW,CAAClW,MAAM,CAAC2T,WAAR,CAAlB;AACAuC,UAAAA,WAAW,CAAClW,MAAM,CAAC6S,mBAAR,CAAX,GAA0C7J,IAA1C;AACA,cAAInJ,SAAS,GAAG,IAAIuH,IAAJ,CAAS6O,MAAM,CAAChQ,OAAP,EAAT,CAAhB;AACA,cAAIkQ,IAAI,GAAGZ,YAAY,CAACvV,MAAM,CAACe,OAAR,CAAZ,CAA6BkF,OAA7B,KAAyCsP,YAAY,CAACvV,MAAM,CAACa,SAAR,CAAZ,CAA+BoF,OAA/B,EAApD;AACA,cAAIlG,OAAO,GAAG,IAAIqH,IAAJ,CAASvH,SAAS,CAACoG,OAAV,EAAT,CAAd;AACAlG,UAAAA,OAAO,CAAC2T,eAAR,CAAwByC,IAAxB;AACAD,UAAAA,WAAW,CAAClW,MAAM,CAACa,SAAR,CAAX,GAAgC,IAAIuG,IAAJ,CAASvH,SAAS,CAACoG,OAAV,EAAT,CAAhC;AACAiQ,UAAAA,WAAW,CAAClW,MAAM,CAACe,OAAR,CAAX,GAA8B,IAAIqG,IAAJ,CAASrH,OAAO,CAACkG,OAAR,EAAT,CAA9B;AACA4P,UAAAA,kBAAkB,CAAClU,IAAnB,CAAwBuU,WAAxB;AACH;AACJ,OAlBD;AAmBH;;AACD,WAAOL,kBAAP;AACH,GApCD;;AAqCA5W,EAAAA,SAAS,CAACI,SAAV,CAAoB+W,kBAApB,GAAyC,UAAUlM,OAAV,EAAmBpI,IAAnB,EAAyBkP,IAAzB,EAA+BzJ,KAA/B,EAAsC8O,KAAtC,EAA6C;AAClF,QAAI,CAAC,KAAKnX,MAAL,CAAYqB,YAAjB,EAA+B;AAC3B;AACH;;AACD,QAAI+V,UAAU,GAAG,UAAUC,KAAV,EAAiBF,KAAjB,EAAwB;AACrCE,MAAAA,KAAK,GAAGA,KAAK,CAAChF,OAAN,CAAc,GAAd,EAAmB,EAAnB,CAAR;AACA,UAAIE,CAAC,GAAG+E,QAAQ,CAACD,KAAK,CAACE,SAAN,CAAgB,CAAhB,EAAmBF,KAAK,CAAC/V,MAAN,GAAe,CAAlC,CAAD,EAAuC,EAAvC,CAAhB;AACA,UAAIkW,CAAC,GAAGF,QAAQ,CAACD,KAAK,CAACE,SAAN,CAAgBF,KAAK,CAAC/V,MAAN,GAAe,CAA/B,EAAkC,IAAI+V,KAAK,CAAC/V,MAAV,GAAmB,CAArD,CAAD,EAA0D,EAA1D,CAAhB;AACA,UAAIsF,CAAC,GAAG0Q,QAAQ,CAACD,KAAK,CAACE,SAAN,CAAgB,IAAIF,KAAK,CAAC/V,MAAV,GAAmB,CAAnC,EAAsC,IAAI+V,KAAK,CAAC/V,MAAV,GAAmB,CAAzD,CAAD,EAA8D,EAA9D,CAAhB;AACA,aAAO,UAAUiR,CAAV,GAAc,IAAd,GAAqBiF,CAArB,GAAyB,IAAzB,GAAgC5Q,CAAhC,GAAoC,IAApC,GAA2CuQ,KAA3C,GAAmD,GAA1D;AACH,KAND,CAJkF,CAWlF;;;AACA,QAAIE,KAAK,GAAG,KAAKrX,MAAL,CAAYqB,YAAZ,CAAyBoW,gBAAzB,CAA0C7U,IAA1C,EAAgDyF,KAAhD,CAAZ;;AACA,QAAIgP,KAAJ,EAAW;AACP;AACArM,MAAAA,OAAO,CAAC0M,KAAR,CAAc5F,IAAd,IAAsB,CAACnT,iBAAiB,CAACwY,KAAD,CAAlB,GAA4BC,UAAU,CAACC,KAAD,EAAQF,KAAR,CAAtC,GAAuDE,KAA7E;AACH;AACJ,GAjBD;;AAkBAtX,EAAAA,SAAS,CAACI,SAAV,CAAoBwX,6BAApB,GAAoD,UAAUC,MAAV,EAAkBC,QAAlB,EAA4B;AAC5E,QAAIC,YAAY,GAAIF,MAAM,CAAC,KAAK5X,MAAL,CAAYe,WAAZ,CAAwBgX,OAAzB,CAAN,IAA2C,KAAK/X,MAAL,CAAYgY,aAAZ,CAA0BlX,MAA1B,CAAiCiX,OAAjC,CAAyCE,OAAxG;AACA,QAAIC,kBAAkB,GAAGjZ,aAAa,CAAC,KAAD,EAAQ;AAC1C8Q,MAAAA,SAAS,EAAElQ,GAAG,CAACsY,uBAD2B;AAE1CC,MAAAA,KAAK,EAAE;AACH,mBAAW,iBAAiBR,MAAM,CAAC,KAAK5X,MAAL,CAAYe,WAAZ,CAAwBQ,EAAzB,CAD/B;AAEH,yBAAiB,MAFd;AAEsB,yBAAiB;AAFvC;AAFmC,KAAR,CAAtC;AAOA,QAAI8W,eAAJ;;AACA,QAAI,CAAC1Z,iBAAiB,CAAC,KAAKqB,MAAL,CAAY+E,iBAAZ,CAA8BuT,aAA/B,CAAtB,EAAqE;AACjE,UAAIC,UAAU,GAAG,KAAKvY,MAAL,CAAYgL,OAAZ,CAAoBzJ,EAApB,GAAyB,GAA1C;AACA,UAAIiX,QAAQ,GAAG,KAAKxY,MAAL,CAAY+E,iBAAZ,CAA8B0T,iBAA7C;AACA,UAAIC,UAAU,GAAGH,UAAU,GAAGC,QAAb,GAAwB,eAAzC;AACA,UAAIG,YAAY,GAAG/Y,IAAI,CAACgZ,qBAAL,CAA2BhB,MAA3B,EAAmC,KAAK5X,MAAL,CAAYe,WAA/C,CAAnB;AACAsX,MAAAA,eAAe,GAAG,KAAKrY,MAAL,CAAY6Y,sBAAZ,GAAqCF,YAArC,EAAmD,KAAK3Y,MAAxD,EAAgE,eAAhE,EAAiF0Y,UAAjF,EAA6F,KAA7F,CAAlB;AACH,KAND,MAOK;AACD,UAAII,kBAAkB,GAAG7Z,aAAa,CAAC,KAAD,EAAQ;AAC1C8Q,QAAAA,SAAS,EAAElQ,GAAG,CAACkZ,aAD2B;AACZC,QAAAA,SAAS,EAAElB;AADC,OAAR,CAAtC;AAGAO,MAAAA,eAAe,GAAG,CAACS,kBAAD,CAAlB;AACH;;AACD3Z,IAAAA,MAAM,CAACkZ,eAAD,EAAkBH,kBAAlB,CAAN;AACA,SAAKe,oBAAL,CAA0Bf,kBAA1B,EAA8CL,QAA9C;AACA,WAAOK,kBAAP;AACH,GA1BD;;AA2BAnY,EAAAA,SAAS,CAACI,SAAV,CAAoB8Y,oBAApB,GAA2C,UAAUf,kBAAV,EAA8BL,QAA9B,EAAwC;AAC/E,QAAI,CAAClZ,iBAAiB,CAAC,KAAKua,QAAN,CAAtB,EAAuC;AACnC9Z,MAAAA,QAAQ,CAAC,CAAC8Y,kBAAD,CAAD,EAAuB,KAAKgB,QAA5B,CAAR;AACH;;AACD,QAAI,KAAKlZ,MAAL,CAAY+E,iBAAZ,CAA8BC,KAA9B,CAAoCC,SAApC,CAA8C3D,MAA9C,GAAuD,CAA3D,EAA8D;AAC1D4W,MAAAA,kBAAkB,CAAC/L,YAAnB,CAAgC,kBAAhC,EAAoD0L,QAAQ,CAACnF,QAAT,EAApD;AACH;AACJ,GAPD;;AAQA3S,EAAAA,SAAS,CAACI,SAAV,CAAoBgZ,oBAApB,GAA2C,UAAUrZ,KAAV,EAAiB;AACxD,WAAQA,KAAK,CAAC,KAAKE,MAAL,CAAYe,WAAZ,CAAwB8N,UAAzB,CAAN,GACH/O,KAAK,CAAC,KAAKE,MAAL,CAAYe,WAAZ,CAAwB8N,UAAzB,CADF,GACyC,OADhD;AAEH,GAHD;;AAIA9O,EAAAA,SAAS,CAACI,SAAV,CAAoBiZ,YAApB,GAAmC,UAAU1W,SAAV,EAAqB;AACpD,QAAIlC,KAAK,GAAG,IAAZ;;AACA,QAAI+C,eAAe,GAAIb,SAAS,YAAY8D,KAAtB,GAA+B9D,SAA/B,GAA2C,CAACA,SAAD,CAAjE;AACA,QAAI2W,YAAY,GAAG,KAAnB;AACA,QAAIvY,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACAwC,IAAAA,eAAe,CAACP,OAAhB,CAAwB,UAAUlD,KAAV,EAAiB;AACrC,UAAIwZ,OAAO,GAAG,EAAd;;AACA,UAAI,CAAC3a,iBAAiB,CAACmB,KAAK,CAACgB,MAAM,CAACqB,cAAR,CAAN,CAAlB,KACCxD,iBAAiB,CAACmB,KAAK,CAACgB,MAAM,CAACsB,YAAR,CAAN,CAAjB,IAAiDtC,KAAK,CAACgB,MAAM,CAACS,EAAR,CAAL,KAAqBzB,KAAK,CAACgB,MAAM,CAACsB,YAAR,CAD5E,CAAJ,EACwG;AACpGkX,QAAAA,OAAO,GAAG9Y,KAAK,CAAC8B,kBAAN,CAAyBxC,KAAzB,CAAV;AACH,OAHD,MAIK;AACDwZ,QAAAA,OAAO,CAAC7W,IAAR,CAAa3C,KAAb;AACH;;AACD,WAAK,IAAI0B,EAAE,GAAG,CAAT,EAAY+X,SAAS,GAAGD,OAA7B,EAAsC9X,EAAE,GAAG+X,SAAS,CAACjY,MAArD,EAA6DE,EAAE,EAA/D,EAAmE;AAC/D,YAAIoB,IAAI,GAAG2W,SAAS,CAAC/X,EAAD,CAApB;;AACA,YAAImD,iBAAiB,GAAGnE,KAAK,CAACmE,iBAAN,CAAwB/B,IAAxB,CAAxB;;AACA,YAAI+B,iBAAiB,CAACrD,MAAlB,GAA2B,CAA/B,EAAkC;AAC9B+X,UAAAA,YAAY,GAAG,IAAf;AACA;AACH;AACJ;AACJ,KAjBD;AAkBA,SAAKrZ,MAAL,CAAYwZ,aAAZ,CAA0B3W,OAA1B,GAAoCwW,YAApC;AACA,WAAOA,YAAP;AACH,GAzBD;;AA0BAtZ,EAAAA,SAAS,CAACI,SAAV,CAAoBsZ,mBAApB,GAA0C,UAAUtD,UAAV,EAAsBuD,KAAtB,EAA6B;AACnE,WAAO,IAAIna,WAAJ,CAAgB4W,UAAhB,EAA4BxQ,YAA5B,CAAyC,IAAInG,KAAJ,GAAYoG,KAAZ,CAAkB8T,KAAlB,CAAzC,CAAP;AACH,GAFD;;AAGA3Z,EAAAA,SAAS,CAACI,SAAV,CAAoBwZ,eAApB,GAAsC,UAAU/E,WAAV,EAAuBjT,SAAvB,EAAkC;AACpE,QAAIb,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACAY,IAAAA,SAAS,GAAGhD,iBAAiB,CAACgD,SAAD,CAAjB,GAA+BiT,WAAW,CAAC9T,MAAM,CAACa,SAAR,CAA1C,GAA+DA,SAA3E;AACA,QAAIiY,sBAAJ;AACA,QAAIC,YAAJ;AACA,QAAIC,yBAAyB,GAAG,EAAhC;AACA,QAAIC,KAAK,GAAGnF,WAAW,CAAC9T,MAAM,CAACS,EAAR,CAAvB;AACA,QAAIyY,WAAW,GAAGpF,WAAW,CAAC9T,MAAM,CAAC2T,WAAR,CAA7B;AACA,QAAIwF,iBAAJ;AACA,QAAIC,cAAc,GAAG,KAAKla,MAAL,CAAYiS,aAAZ,KAA8B,YAA9B,GAA6C,aAA7C,GAA6D,oBAAlF;;AACA,OAAG;AACCgI,MAAAA,iBAAiB,GAAK,IAAIxa,SAAJ,CAAcqB,MAAM,CAAC2T,WAArB,EAAkC,OAAlC,EAA2CsF,KAA3C,CAAF,CAChBvU,GADgB,CACZ,IAAI/F,SAAJ,CAAcqB,MAAM,CAACa,SAArB,EAAgCuY,cAAhC,EAAgDvY,SAAhD,CADY,CAApB;AAEAkY,MAAAA,YAAY,GAAG,KAAKJ,mBAAL,CAAyB,KAAKzZ,MAAL,CAAYwD,UAArC,EAAiDyW,iBAAjD,CAAf;AACAL,MAAAA,sBAAsB,GAAGC,YAAY,CAAC1O,KAAb,CAAmB,CAAC,CAApB,EAAuB,CAAvB,CAAzB;;AACA,UAAI,CAACxM,iBAAiB,CAACib,sBAAD,CAAlB,IAA8CA,sBAAsB,CAAC9Y,MAAM,CAACS,EAAR,CAAtB,KAAsCyY,WAAxF,EAAqG;AACjGF,QAAAA,yBAAyB,CAACrX,IAA1B,CAA+BmX,sBAA/B;AACAG,QAAAA,KAAK,GAAGH,sBAAsB,CAAC9Y,MAAM,CAACS,EAAR,CAA9B;AACAyY,QAAAA,WAAW,GAAGJ,sBAAsB,CAAC9Y,MAAM,CAAC2T,WAAR,CAApC;AACH,OAJD,MAKK;AACDuF,QAAAA,WAAW,GAAG,IAAd;AACH;AACJ,KAbD,QAaSH,YAAY,CAACvY,MAAb,KAAwB,CAAxB,IAA6B,CAAC3C,iBAAiB,CAACib,sBAAsB,CAAC9Y,MAAM,CAAC2T,WAAR,CAAvB,CAbxD;;AAcA,WAAOqF,yBAAP;AACH,GAzBD;;AA0BA/Z,EAAAA,SAAS,CAACI,SAAV,CAAoBga,oBAApB,GAA2C,UAAUL,yBAAV,EAAqCnY,SAArC,EAAgD;AACvF,QAAIb,MAAM,GAAG,KAAKd,MAAL,CAAYe,WAAzB;AACA,QAAIqZ,yBAAyB,GAAG,EAAhC;AACA,QAAIC,eAAJ;;AACA,SAAK,IAAI7Y,EAAE,GAAG,CAAT,EAAY8Y,2BAA2B,GAAGR,yBAA/C,EAA0EtY,EAAE,GAAG8Y,2BAA2B,CAAChZ,MAA3G,EAAmHE,EAAE,EAArH,EAAyH;AACrH,UAAI+Y,OAAO,GAAGD,2BAA2B,CAAC9Y,EAAD,CAAzC;AACA,UAAIgZ,aAAa,GAAG,IAAI/a,SAAJ,CAAcqB,MAAM,CAACsB,YAArB,EAAmC,OAAnC,EAA4CmY,OAAO,CAACzZ,MAAM,CAACS,EAAR,CAAnD,EAChBkE,EADgB,CACb,IAAIhG,SAAJ,CAAcqB,MAAM,CAACsB,YAArB,EAAmC,OAAnC,EAA4CmY,OAAO,CAACzZ,MAAM,CAAC2T,WAAR,CAAnD,EACHjP,GADG,CACC,IAAI/F,SAAJ,CAAcqB,MAAM,CAACsB,YAArB,EAAmC,UAAnC,EAA+CF,SAA/C,CADD,CADa,CAApB;;AAGA,UAAI,KAAKlC,MAAL,CAAYiS,aAAZ,KAA8B,qBAA9B,IAAuD,KAAKjS,MAAL,CAAYiS,aAAZ,KAA8B,uBAAzF,EAAkH;AAC9GuI,QAAAA,aAAa,GAAGA,aAAa,CAAChV,GAAd,CAAkB,IAAI/F,SAAJ,CAAcqB,MAAM,CAACa,SAArB,EAAgC,oBAAhC,EAAsDA,SAAtD,CAAlB,CAAhB;AACH;;AACD0Y,MAAAA,eAAe,GAAG,KAAKZ,mBAAL,CAAyB,KAAKzZ,MAAL,CAAYwD,UAArC,EAAiDgX,aAAjD,CAAlB;AACAJ,MAAAA,yBAAyB,GAAGA,yBAAyB,CAAC/X,MAA1B,CAAiCgY,eAAjC,CAA5B;AACH;;AACD,WAAOD,yBAAP;AACH,GAhBD;;AAiBAra,EAAAA,SAAS,CAACI,SAAV,CAAoB0J,gBAApB,GAAuC,UAAUf,UAAV,EAAsB;AACzD,QAAI2R,SAAS,GAAG,CAAhB;AACA,QAAIC,QAAQ,GAAG5R,UAAU,CAACxH,MAA1B;AACA,QAAIqZ,aAAJ;;AACA,QAAK7R,UAAU,CAAC,CAAD,CAAV,GAAgB,KAAK9I,MAAL,CAAY4a,OAA7B,IAAyC9R,UAAU,CAACA,UAAU,CAACxH,MAAX,GAAoB,CAArB,CAAV,GAAoC,KAAKtB,MAAL,CAAY6a,OAA7F,EAAsG;AAClG,WAAK,IAAIhT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiB,UAAU,CAACxH,MAA/B,EAAuCuG,CAAC,EAAxC,EAA4C;AACxC,YAAIiB,UAAU,CAACjB,CAAD,CAAV,CAAcd,OAAd,OAA4B,KAAK/G,MAAL,CAAY4a,OAAZ,CAAoB7T,OAApB,EAAhC,EAA+D;AAC3D0T,UAAAA,SAAS,GAAG5S,CAAZ;AACH;;AACD,YAAIiB,UAAU,CAACjB,CAAD,CAAV,CAAcd,OAAd,OAA4B,KAAK/G,MAAL,CAAY6a,OAAZ,CAAoB9T,OAApB,EAAhC,EAA+D;AAC3D2T,UAAAA,QAAQ,GAAG7S,CAAX;AACH;AACJ;;AACD8S,MAAAA,aAAa,GAAG7R,UAAU,CAACnG,MAAX,CAAkB,UAAUmH,IAAV,EAAgB;AAC9C,eAASA,IAAI,IAAIhB,UAAU,CAAC2R,SAAD,CAAnB,IAAoC3Q,IAAI,IAAIhB,UAAU,CAAC4R,QAAD,CAA9D;AACH,OAFe,CAAhB;AAGH;;AACD,WAAOC,aAAP;AACH,GAlBD;;AAmBA5a,EAAAA,SAAS,CAACI,SAAV,CAAoB2a,YAApB,GAAmC,UAAU7X,QAAV,EAAoBxC,KAApB,EAA2BG,GAA3B,EAAgCma,QAAhC,EAA0C;AACzE,QAAIC,WAAW,GAAGpa,GAAG,CAACmG,OAAJ,KAAgBgU,QAAQ,CAACE,SAAT,CAAmBlU,OAAnB,EAAhB,IAAgDtG,KAAK,CAACsG,OAAN,KAAkBgU,QAAQ,CAACG,OAAT,CAAiBnU,OAAjB,EAApF;AACA,QAAIoU,WAAW,GAAGJ,QAAQ,CAACE,SAAT,CAAmBlU,OAAnB,MAAgCtG,KAAK,CAACsG,OAAN,EAAhC,IACd9D,QAAQ,CAAC,KAAKjD,MAAL,CAAYe,WAAZ,CAAwBY,SAAzB,CAAR,CAA4CoF,OAA5C,MAAyDgU,QAAQ,CAACE,SAAT,CAAmBlU,OAAnB,EAD3C,IAEd9D,QAAQ,CAAC,KAAKjD,MAAL,CAAYe,WAAZ,CAAwBc,OAAzB,CAAR,CAA0CkF,OAA1C,KAAsDgU,QAAQ,CAACG,OAAT,CAAiBnU,OAAjB,EAFxC,IAEsEtG,KAAK,CAACsG,OAAN,OAAoBnG,GAAG,CAACmG,OAAJ,EAF5G;AAGA,WAAOiU,WAAW,IAAIG,WAAtB;AACH,GAND;;AAOA,SAAOpb,SAAP;AACH,CAlkC8B,EAA/B;;AAmkCA,SAASA,SAAT","sourcesContent":["import { isNullOrUndefined, closest, Browser, extend, EventHandler, isBlazor } from '@syncfusion/ej2-base';\nimport { createElement, prepend, append, addClass, removeClass, getElement } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Predicate } from '@syncfusion/ej2-data';\nimport { generate, getDateFromRecurrenceDateString } from '../../recurrence-editor/date-generator';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport * as event from '../base/constant';\n/**\n * EventBase for appointment rendering\n */\nvar EventBase = /** @class */ (function () {\n    /**\n     * Constructor for EventBase\n     */\n    function EventBase(parent) {\n        this.slots = [];\n        this.isDoubleTapped = false;\n        this.parent = parent;\n    }\n    EventBase.prototype.processData = function (events, timeZonePropChanged, oldTimezone) {\n        var _this = this;\n        var start = this.parent.activeView.startDate();\n        var end = this.parent.activeView.endDate();\n        var fields = this.parent.eventFields;\n        this.parent.eventsProcessed = [];\n        var processed = [];\n        var temp = 1;\n        var generateID = false;\n        var resourceCollection = this.parent.resourceBase ? this.parent.resourceBase.resourceCollection : [];\n        if (events.length > 0 && isNullOrUndefined(events[0][fields.id])) {\n            generateID = true;\n        }\n        for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\n            var event_1 = events_1[_i];\n            if (generateID) {\n                event_1[fields.id] = temp++;\n            }\n            if (typeof event_1[fields.startTime] === 'string') {\n                event_1[fields.startTime] = util.getDateFromString(event_1[fields.startTime]);\n            }\n            if (typeof event_1[fields.endTime] === 'string') {\n                event_1[fields.endTime] = util.getDateFromString(event_1[fields.endTime]);\n            }\n            if (timeZonePropChanged) {\n                this.processTimezoneChange(event_1, oldTimezone);\n            }\n            else {\n                event_1 = this.processTimezone(event_1);\n            }\n            for (var level = 0; level < resourceCollection.length; level++) {\n                if (event_1[resourceCollection[level].field] === null || event_1[resourceCollection[level].field] === 0) {\n                    event_1[resourceCollection[level].field] = undefined;\n                }\n            }\n            if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && event_1[fields.recurrenceRule] === '') {\n                event_1[fields.recurrenceRule] = null;\n            }\n            if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID])) {\n                processed = processed.concat(this.generateOccurrence(event_1, null, oldTimezone, true));\n            }\n            else {\n                event_1.Guid = this.generateGuid();\n                processed.push(event_1);\n            }\n        }\n        var eventData = processed.filter(function (data) { return !data[_this.parent.eventFields.isBlock]; });\n        this.parent.eventsProcessed = this.filterEvents(start, end, eventData);\n        var blockData = processed.filter(function (data) { return data[_this.parent.eventFields.isBlock]; });\n        blockData.forEach(function (eventObj) {\n            if (eventObj[fields.isAllDay]) {\n                eventObj[fields.startTime] = util.resetTime(eventObj[fields.startTime]);\n                eventObj[fields.endTime] = util.addDays(util.resetTime(eventObj[fields.endTime]), 1);\n            }\n        });\n        this.parent.blockProcessed = blockData;\n        return eventData;\n    };\n    EventBase.prototype.getProcessedEvents = function (eventCollection) {\n        if (eventCollection === void 0) { eventCollection = this.parent.eventsData; }\n        var processed = [];\n        for (var _i = 0, _a = eventCollection; _i < _a.length; _i++) {\n            var event_2 = _a[_i];\n            if (!isNullOrUndefined(event_2[this.parent.eventFields.recurrenceRule]) &&\n                isNullOrUndefined(event_2[this.parent.eventFields.recurrenceID])) {\n                processed = processed.concat(this.generateOccurrence(event_2));\n            }\n            else {\n                processed.push(event_2);\n            }\n        }\n        return processed;\n    };\n    EventBase.prototype.timezonePropertyChange = function (oldTimezone) {\n        var processed = this.processData(this.parent.eventsData, true, oldTimezone);\n        this.parent.notify(event.dataReady, { processedData: processed });\n    };\n    /** @private */\n    EventBase.prototype.timezoneConvert = function (eventData) {\n        var fields = this.parent.eventFields;\n        eventData[fields.startTimezone] = eventData[fields.startTimezone] || eventData[fields.endTimezone];\n        eventData[fields.endTimezone] = eventData[fields.endTimezone] || eventData[fields.startTimezone];\n        if (this.parent.timezone) {\n            var startTz = eventData[fields.startTimezone];\n            var endTz = eventData[fields.endTimezone];\n            eventData[fields.startTime] =\n                this.parent.tzModule.convert(eventData[fields.startTime], this.parent.timezone, startTz);\n            eventData[fields.endTime] =\n                this.parent.tzModule.convert(eventData[fields.endTime], this.parent.timezone, endTz);\n        }\n    };\n    EventBase.prototype.processTimezoneChange = function (event, oldTimezone) {\n        var fields = this.parent.eventFields;\n        if (event[fields.isAllDay]) {\n            return;\n        }\n        if (oldTimezone && this.parent.timezone) {\n            event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], oldTimezone, this.parent.timezone);\n            event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], oldTimezone, this.parent.timezone);\n        }\n        else if (!oldTimezone && this.parent.timezone) {\n            event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\n            event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\n        }\n        else if (oldTimezone && !this.parent.timezone) {\n            event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], oldTimezone);\n            event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], oldTimezone);\n        }\n    };\n    EventBase.prototype.processTimezone = function (event, isReverse) {\n        if (isReverse === void 0) { isReverse = false; }\n        var fields = this.parent.eventFields;\n        if (event[fields.startTimezone] || event[fields.endTimezone]) {\n            var startTimezone = event[fields.startTimezone] || event[fields.endTimezone];\n            var endTimezone = event[fields.endTimezone] || event[fields.startTimezone];\n            var zone = this.parent.timezone;\n            if (isReverse) {\n                if (this.parent.timezone) {\n                    event[fields.startTime] =\n                        this.parent.tzModule.convert(event[fields.startTime], startTimezone, zone);\n                    event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, zone);\n                    event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], zone);\n                    event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], zone);\n                }\n                else {\n                    event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], startTimezone);\n                    event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], endTimezone);\n                }\n            }\n            else {\n                event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], startTimezone);\n                event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], endTimezone);\n                if (this.parent.timezone) {\n                    event[fields.startTime] =\n                        this.parent.tzModule.convert(event[fields.startTime], startTimezone, zone);\n                    event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, zone);\n                }\n            }\n        }\n        else if (this.parent.timezone) {\n            if (isReverse) {\n                event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], this.parent.timezone);\n                event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], this.parent.timezone);\n            }\n            else {\n                event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\n                event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\n            }\n        }\n        return event;\n    };\n    EventBase.prototype.filterBlockEvents = function (eventObj) {\n        var eStart = eventObj[this.parent.eventFields.startTime];\n        var eEnd = eventObj[this.parent.eventFields.endTime];\n        var resourceData;\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            var data = this.getGroupIndexFromEvent(eventObj);\n            resourceData = this.parent.resourceBase.lastResourceLevel[data];\n        }\n        return this.filterEvents(eStart, eEnd, this.parent.blockProcessed, resourceData);\n    };\n    EventBase.prototype.filterEvents = function (startDate, endDate, appointments, resourceTdData) {\n        if (appointments === void 0) { appointments = this.parent.eventsProcessed; }\n        var fieldMapping = this.parent.eventFields;\n        var predicate = new Predicate(fieldMapping.startTime, 'greaterthanorequal', startDate).\n            and(new Predicate(fieldMapping.endTime, 'greaterthanorequal', startDate)).\n            and(new Predicate(fieldMapping.startTime, 'lessthan', endDate)).\n            or(new Predicate(fieldMapping.startTime, 'lessthanorequal', startDate).\n            and(new Predicate(fieldMapping.endTime, 'greaterthan', startDate)));\n        var filter = new DataManager({ json: appointments }).executeLocal(new Query().where(predicate));\n        if (resourceTdData) {\n            filter = this.filterEventsByResource(resourceTdData, filter);\n        }\n        return this.sortByTime(filter);\n    };\n    EventBase.prototype.filterEventsByRange = function (eventCollection, startDate, endDate) {\n        var _this = this;\n        var filteredEvents = [];\n        if (startDate && endDate) {\n            filteredEvents = this.filterEvents(startDate, endDate, eventCollection);\n        }\n        else if (startDate && !endDate) {\n            filteredEvents = eventCollection.filter(function (e) { return e[_this.parent.eventFields.startTime] >= startDate; });\n        }\n        else if (!startDate && endDate) {\n            filteredEvents = eventCollection.filter(function (e) { return e[_this.parent.eventFields.endTime] <= endDate; });\n        }\n        else {\n            filteredEvents = eventCollection;\n        }\n        return this.sortByTime(filteredEvents);\n    };\n    EventBase.prototype.filterEventsByResource = function (resourceTdData, appointments) {\n        if (appointments === void 0) { appointments = this.parent.eventsProcessed; }\n        var predicate = {};\n        var resourceCollection = this.parent.resourceBase.resourceCollection;\n        for (var level = 0; level < resourceCollection.length; level++) {\n            predicate[resourceCollection[level].field] = resourceTdData.groupOrder[level];\n        }\n        var keys = Object.keys(predicate);\n        var filteredCollection = appointments.filter(function (eventObj) { return keys.every(function (key) {\n            if (eventObj[key] instanceof Array) {\n                return eventObj[key].indexOf(predicate[key]) > -1;\n            }\n            else {\n                return eventObj[key] === predicate[key];\n            }\n        }); });\n        return filteredCollection;\n    };\n    EventBase.prototype.sortByTime = function (appointments) {\n        var fieldMapping = this.parent.eventFields;\n        appointments.sort(function (a, b) {\n            var d1 = a[fieldMapping.startTime];\n            var d2 = b[fieldMapping.startTime];\n            return d1.getTime() - d2.getTime();\n        });\n        return appointments;\n    };\n    EventBase.prototype.sortByDateTime = function (appointments) {\n        var fieldMapping = this.parent.eventFields;\n        appointments.sort(function (object1, object2) {\n            var d3 = object1[fieldMapping.startTime];\n            var d4 = object2[fieldMapping.startTime];\n            var d5 = object1[fieldMapping.endTime];\n            var d6 = object2[fieldMapping.endTime];\n            var d1 = d5.getTime() - d3.getTime();\n            var d2 = d6.getTime() - d4.getTime();\n            return (d3.getTime() - d4.getTime() || d2 - d1);\n        });\n        return appointments;\n    };\n    EventBase.prototype.getSmallestMissingNumber = function (array) {\n        var large = Math.max.apply(Math, array);\n        for (var i = 0; i < large; i++) {\n            if (array.indexOf(i) === -1) {\n                return i;\n            }\n        }\n        return large + 1;\n    };\n    EventBase.prototype.splitEventByDay = function (event) {\n        var eventFields = this.parent.eventFields;\n        var data = [];\n        var eventStartTime = event[eventFields.startTime];\n        var eventEndTime = event[eventFields.endTime];\n        var isDifferentDate = util.resetTime(new Date(eventStartTime.getTime())) <\n            util.resetTime(new Date(eventEndTime.getTime()));\n        if (isDifferentDate) {\n            var start = new Date(eventStartTime.getTime());\n            var end = util.addDays(util.resetTime(new Date(eventStartTime.getTime())), 1);\n            var endDate = (eventEndTime.getHours() === 0 && eventEndTime.getMinutes() === 0) ?\n                eventEndTime : util.addDays(eventEndTime, 1);\n            var index = 1;\n            var eventLength = util.getDaysCount(eventStartTime.getTime(), endDate.getTime());\n            while (end <= eventEndTime) {\n                var app = extend({}, event);\n                app[eventFields.startTime] = start;\n                app[eventFields.endTime] = end;\n                app.data = { index: index, count: eventLength };\n                app.Guid = this.generateGuid();\n                app.isSpanned = true;\n                data.push(app);\n                start = end;\n                if ((util.resetTime(new Date(start.getTime())).getTime() === util.resetTime(new Date(eventEndTime.getTime())).getTime())\n                    && !(end.getTime() === eventEndTime.getTime())) {\n                    end = new Date(start.getTime());\n                    end = new Date(end.setHours(eventEndTime.getHours(), eventEndTime.getMinutes(), eventEndTime.getSeconds()));\n                }\n                else {\n                    end = util.addDays(util.resetTime(new Date(start.getTime())), 1);\n                }\n                index++;\n            }\n        }\n        else {\n            data.push(event);\n        }\n        return data;\n    };\n    EventBase.prototype.splitEvent = function (event, dateRender) {\n        var fields = this.parent.eventFields;\n        var start = util.resetTime(new Date(event[fields.startTime] + '')).getTime();\n        var end = util.resetTime(new Date(event[fields.endTime] + '')).getTime();\n        if (util.getDateInMs(event[fields.endTime]) <= 0) {\n            var temp = util.addDays(util.resetTime(new Date(event[fields.endTime] + '')), -1).getTime();\n            end = start > temp ? start : temp;\n        }\n        var orgStart = start;\n        var orgEnd = end;\n        var ranges = [];\n        if (start !== end) {\n            if (start < dateRender[0].getTime()) {\n                start = dateRender[0].getTime();\n            }\n            if (end > dateRender[dateRender.length - 1].getTime()) {\n                end = dateRender[dateRender.length - 1].getTime();\n            }\n            var cStart = start;\n            var _loop_1 = function (level) {\n                var slot = this_1.slots[level];\n                if (this_1.parent.currentView === 'WorkWeek' || this_1.parent.currentView === 'TimelineWorkWeek'\n                    || this_1.parent.activeViewOptions.group.byDate || this_1.parent.activeViewOptions.showWeekend) {\n                    var slotDates_1 = [];\n                    slot.forEach(function (x) { return slotDates_1.push(new Date(x)); });\n                    var renderedDates = this_1.getRenderedDates(slotDates_1);\n                    if (!isNullOrUndefined(renderedDates) && renderedDates.length > 0) {\n                        slot = [];\n                        renderedDates.forEach(function (date) { return slot.push(date.getTime()); });\n                    }\n                }\n                var firstSlot = slot[0];\n                cStart = (cStart <= firstSlot && end >= firstSlot) ? firstSlot : cStart;\n                if (cStart > end || firstSlot > end) {\n                    return \"break\";\n                }\n                if (!this_1.parent.activeViewOptions.group.byDate && this_1.parent.activeViewOptions.showWeekend &&\n                    this_1.parent.currentView !== 'WorkWeek' && this_1.parent.currentView !== 'TimelineWorkWeek') {\n                    var startIndex = slot.indexOf(cStart);\n                    if (startIndex !== -1) {\n                        var endIndex = slot.indexOf(end);\n                        var hasBreak = endIndex !== -1;\n                        endIndex = hasBreak ? endIndex : slot.length - 1;\n                        var count = ((endIndex - startIndex) + 1);\n                        var isLeft = (slot[startIndex] !== orgStart);\n                        var isRight = (slot[endIndex] !== orgEnd);\n                        ranges.push(this_1.cloneEventObject(event, slot[startIndex], slot[endIndex], count, isLeft, isRight));\n                        if (hasBreak) {\n                            return \"break\";\n                        }\n                    }\n                }\n                else {\n                    if (this_1.dateInRange(cStart, slot[0], slot[slot.length - 1])) {\n                        var availSlot = [];\n                        for (var i = 0; i < slot.length; i++) {\n                            if (this_1.dateInRange(slot[i], orgStart, orgEnd)) {\n                                availSlot.push(slot[i]);\n                            }\n                        }\n                        if (availSlot.length > 0) {\n                            if (!this_1.parent.activeViewOptions.group.byDate) {\n                                var isLeft = (availSlot[0] !== orgStart);\n                                var isRight = (availSlot[availSlot.length - 1] !== orgEnd);\n                                ranges.push(this_1.cloneEventObject(event, availSlot[0], availSlot[availSlot.length - 1], availSlot.length, isLeft, isRight));\n                            }\n                            else {\n                                for (var _i = 0, availSlot_1 = availSlot; _i < availSlot_1.length; _i++) {\n                                    var slot_1 = availSlot_1[_i];\n                                    ranges.push(this_1.cloneEventObject(event, slot_1, slot_1, 1, (slot_1 !== orgStart), (slot_1 !== orgEnd)));\n                                }\n                            }\n                        }\n                    }\n                }\n            };\n            var this_1 = this;\n            for (var level = 0; level < this.slots.length; level++) {\n                var state_1 = _loop_1(level);\n                if (state_1 === \"break\")\n                    break;\n            }\n        }\n        else {\n            ranges.push(this.cloneEventObject(event, start, end, 1, false, false));\n        }\n        return ranges;\n    };\n    EventBase.prototype.cloneEventObject = function (event, start, end, count, isLeft, isRight) {\n        var fields = this.parent.eventFields;\n        var e = extend({}, event, null, true);\n        var data = { count: count, isLeft: isLeft, isRight: isRight };\n        data[fields.startTime] = event[fields.startTime];\n        data[fields.endTime] = event[fields.endTime];\n        e.data = data;\n        e[fields.startTime] = new Date(start);\n        e[fields.endTime] = new Date(end);\n        return e;\n    };\n    EventBase.prototype.dateInRange = function (date, start, end) {\n        return start <= date && date <= end;\n    };\n    EventBase.prototype.getSelectedEventElements = function (target) {\n        this.removeSelectedAppointmentClass();\n        if (this.parent.selectedElements.length <= 0) {\n            this.parent.selectedElements.push(target);\n        }\n        else {\n            var isAlreadySelected = this.parent.selectedElements.filter(function (element) {\n                return element.getAttribute('data-guid') === target.getAttribute('data-guid');\n            });\n            if (isAlreadySelected.length <= 0) {\n                var focusElements = [].slice.call(this.parent.element.\n                    querySelectorAll('div[data-guid=\"' + target.getAttribute('data-guid') + '\"]'));\n                for (var _i = 0, focusElements_1 = focusElements; _i < focusElements_1.length; _i++) {\n                    var element = focusElements_1[_i];\n                    this.parent.selectedElements.push(element);\n                }\n            }\n            else {\n                var selectedElements = this.parent.selectedElements.filter(function (element) {\n                    return element.getAttribute('data-guid') !== target.getAttribute('data-guid');\n                });\n                this.parent.selectedElements = selectedElements;\n            }\n        }\n        if (target && this.parent.selectedElements.length > 0) {\n            this.addSelectedAppointments(this.parent.selectedElements);\n        }\n        return this.parent.selectedElements;\n    };\n    EventBase.prototype.getSelectedEvents = function () {\n        var _this = this;\n        var eventSelect = [];\n        var elementSelect = [];\n        var selectAppointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n        selectAppointments.filter(function (element) {\n            var isAlreadyAdded = eventSelect.filter(function (event) {\n                return event.Guid === element.getAttribute('data-guid');\n            });\n            if (isAlreadyAdded.length === 0) {\n                eventSelect.push(_this.getEventByGuid(element.getAttribute('data-guid')));\n            }\n            elementSelect.push(element);\n        });\n        return {\n            event: eventSelect.length > 1 ? eventSelect : eventSelect[0],\n            element: elementSelect.length > 1 ? elementSelect : elementSelect[0]\n        };\n    };\n    EventBase.prototype.removeSelectedAppointmentClass = function () {\n        var selectedAppointments = this.getSelectedAppointments();\n        for (var _i = 0, selectedAppointments_1 = selectedAppointments; _i < selectedAppointments_1.length; _i++) {\n            var appointment = selectedAppointments_1[_i];\n            appointment.setAttribute('aria-selected', 'false');\n        }\n        removeClass(selectedAppointments, cls.APPOINTMENT_BORDER);\n        if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n            removeClass(selectedAppointments, cls.AGENDA_SELECTED_CELL);\n        }\n    };\n    EventBase.prototype.addSelectedAppointments = function (cells) {\n        for (var _i = 0, cells_1 = cells; _i < cells_1.length; _i++) {\n            var cell = cells_1[_i];\n            cell.setAttribute('aria-selected', 'true');\n        }\n        if (this.parent.currentView !== 'MonthAgenda') {\n            this.parent.removeSelectedClass();\n        }\n        addClass(cells, cls.APPOINTMENT_BORDER);\n    };\n    EventBase.prototype.getSelectedAppointments = function () {\n        return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER + ',.' + cls.APPOINTMENT_CLASS + ':focus'));\n    };\n    EventBase.prototype.focusElement = function () {\n        var selectedCell = this.parent.getSelectedElements();\n        if (selectedCell.length > 0) {\n            if (this.parent.keyboardInteractionModule) {\n                var target = ((!isNullOrUndefined(this.parent.activeCellsData) &&\n                    this.parent.activeCellsData.element) || selectedCell[selectedCell.length - 1]);\n                this.parent.keyboardInteractionModule.selectCells(target instanceof Array, target);\n            }\n            return;\n        }\n        var selectedAppointments = this.getSelectedAppointments();\n        if (selectedAppointments.length > 0) {\n            selectedAppointments[selectedAppointments.length - 1].focus();\n            return;\n        }\n    };\n    EventBase.prototype.selectWorkCellByTime = function (eventsData) {\n        var target;\n        if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n            return target;\n        }\n        if (eventsData.length > 0) {\n            var selectedObject = eventsData[eventsData.length - 1];\n            var eventStartTime = selectedObject[this.parent.eventFields.startTime];\n            var nearestTime = new Date(+eventStartTime).setMinutes(0, 0, 0);\n            var isAllDay = this.isAllDayAppointment(selectedObject);\n            if (this.parent.currentView === 'Month' || isAllDay) {\n                nearestTime = new Date(+eventStartTime).setHours(0, 0, 0, 0);\n            }\n            var targetArea = void 0;\n            if (isAllDay && ['Day', 'Week', 'WorkWeek'].indexOf(this.parent.currentView) !== -1) {\n                targetArea = this.parent.getAllDayRow();\n            }\n            else {\n                targetArea = this.parent.getContentTable();\n            }\n            var queryString = '[data-date=\"' + this.parent.getMsFromDate(new Date(nearestTime)) + '\"]';\n            if (this.parent.activeViewOptions.group.resources.length > 0) {\n                queryString += '[data-group-index=\"' + this.getGroupIndexFromEvent(selectedObject) + '\"]';\n            }\n            target = targetArea.querySelector(queryString);\n            if (target) {\n                this.parent.activeCellsData = this.parent.getCellDetails(target);\n                if (this.parent.keyboardInteractionModule) {\n                    this.parent.keyboardInteractionModule.selectCells(false, target);\n                }\n                return target;\n            }\n        }\n        return target;\n    };\n    EventBase.prototype.getGroupIndexFromEvent = function (eventData) {\n        var levelName = name || this.parent.resourceCollection.slice(-1)[0].name;\n        var levelIndex = this.parent.resourceCollection.length - 1;\n        var idField = this.parent.resourceCollection.slice(-1)[0].field;\n        var id = ((eventData[idField] instanceof Array) ?\n            eventData[idField][0] : eventData[idField]);\n        var resource = this.parent.resourceCollection.filter(function (e, index) {\n            if (e.name === levelName) {\n                levelIndex = index;\n                return e;\n            }\n            return null;\n        })[0];\n        return this.parent.resourceBase.getIndexFromResourceId(id, levelName, resource);\n    };\n    EventBase.prototype.isAllDayAppointment = function (event) {\n        var fieldMapping = this.parent.eventFields;\n        var isAllDay = event[fieldMapping.isAllDay];\n        var isFullDay = ((event[fieldMapping.endTime].getTime() - event[fieldMapping.startTime].getTime())\n            / util.MS_PER_DAY) >= 1;\n        return (isAllDay || isFullDay) ? true : false;\n    };\n    EventBase.prototype.addEventListener = function () {\n        this.parent.on(event.documentClick, this.appointmentBorderRemove, this);\n    };\n    EventBase.prototype.appointmentBorderRemove = function (event) {\n        var element = event.event.target;\n        if (closest(element, '.' + cls.APPOINTMENT_CLASS)) {\n            if (this.parent.currentView !== 'MonthAgenda') {\n                this.parent.removeSelectedClass();\n            }\n        }\n        else if (!closest(element, '.' + cls.POPUP_OPEN)) {\n            this.removeSelectedAppointmentClass();\n        }\n    };\n    EventBase.prototype.wireAppointmentEvents = function (element, event, isPreventCrud) {\n        if (isPreventCrud === void 0) { isPreventCrud = false; }\n        var isReadOnly = (!isNullOrUndefined(event)) ? event[this.parent.eventFields.isReadonly] : false;\n        if (Browser.isTouch && !this.parent.isAdaptive) {\n            EventHandler.add(element, 'touchstart', this.eventTouch, this);\n        }\n        else {\n            EventHandler.add(element, 'click', this.eventClick, this);\n        }\n        if (!this.parent.isAdaptive && !this.parent.activeViewOptions.readonly && !isReadOnly) {\n            EventHandler.add(element, 'dblclick', this.eventDoubleClick, this);\n        }\n        if (!this.parent.activeViewOptions.readonly && !isReadOnly && !isPreventCrud) {\n            if (this.parent.resizeModule) {\n                this.parent.resizeModule.wireResizeEvent(element);\n            }\n            if (this.parent.dragAndDropModule) {\n                this.parent.dragAndDropModule.wireDragEvent(element);\n            }\n        }\n    };\n    EventBase.prototype.eventTouch = function (eventData) {\n        var _this = this;\n        setTimeout(function () { return _this.isDoubleTapped = false; }, 250);\n        if (this.isDoubleTapped) {\n            eventData.preventDefault();\n            this.eventDoubleClick(eventData);\n        }\n        else {\n            this.isDoubleTapped = true;\n            this.eventClick(eventData);\n        }\n    };\n    EventBase.prototype.renderResizeHandler = function (element, spanEvent, isReadOnly) {\n        if (!this.parent.resizeModule || !this.parent.allowResizing || this.parent.activeViewOptions.readonly || isReadOnly) {\n            return;\n        }\n        for (var _i = 0, _a = Object.keys(spanEvent); _i < _a.length; _i++) {\n            var resizeEdge = _a[_i];\n            var resizeHandler = createElement('div', { className: cls.EVENT_RESIZE_CLASS });\n            switch (resizeEdge) {\n                case 'isLeft':\n                    if (!spanEvent.isLeft) {\n                        resizeHandler.appendChild(createElement('div', { className: 'e-left-right-resize' }));\n                        addClass([resizeHandler], this.parent.enableRtl ? cls.RIGHT_RESIZE_HANDLER : cls.LEFT_RESIZE_HANDLER);\n                        prepend([resizeHandler], element);\n                    }\n                    break;\n                case 'isRight':\n                    if (!spanEvent.isRight) {\n                        resizeHandler.appendChild(createElement('div', { className: 'e-left-right-resize' }));\n                        addClass([resizeHandler], this.parent.enableRtl ? cls.LEFT_RESIZE_HANDLER : cls.RIGHT_RESIZE_HANDLER);\n                        append([resizeHandler], element);\n                    }\n                    break;\n                case 'isTop':\n                    if (!spanEvent.isTop) {\n                        resizeHandler.appendChild(createElement('div', { className: 'e-top-bottom-resize' }));\n                        addClass([resizeHandler], cls.TOP_RESIZE_HANDLER);\n                        prepend([resizeHandler], element);\n                    }\n                    break;\n                case 'isBottom':\n                    if (!spanEvent.isBottom) {\n                        resizeHandler.appendChild(createElement('div', { className: 'e-top-bottom-resize' }));\n                        addClass([resizeHandler], cls.BOTTOM_RESIZE_HANDLER);\n                        append([resizeHandler], element);\n                    }\n                    break;\n            }\n        }\n    };\n    EventBase.prototype.eventClick = function (eventData) {\n        var _this = this;\n        var target = eventData.target;\n        if (target.classList.contains(cls.DRAG_CLONE_CLASS) || target.classList.contains(cls.RESIZE_CLONE_CLASS)) {\n            return;\n        }\n        if (eventData.ctrlKey && eventData.which === 1 && this.parent.keyboardInteractionModule) {\n            this.parent.quickPopup.quickPopup.hide();\n            this.parent.selectedElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n            var target_1 = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n            this.getSelectedEventElements(target_1);\n            this.activeEventData(eventData, false);\n            var selectArgs = {\n                data: this.parent.activeEventData.event,\n                element: this.parent.activeEventData.element,\n                event: eventData, requestType: 'eventSelect'\n            };\n            this.parent.trigger(event.select, selectArgs);\n            var args = extend(this.parent.activeEventData, { cancel: false, originalEvent: eventData });\n            this.parent.trigger(event.eventClick, args);\n        }\n        else {\n            this.removeSelectedAppointmentClass();\n            this.activeEventData(eventData, true);\n            var selectEventArgs = {\n                data: this.parent.activeEventData.event,\n                element: this.parent.activeEventData.element,\n                event: eventData, requestType: 'eventSelect'\n            };\n            this.parent.trigger(event.select, selectEventArgs);\n            var args = extend(this.parent.activeEventData, { cancel: false, originalEvent: eventData });\n            this.parent.trigger(event.eventClick, args, function (eventClickArgs) {\n                if (isBlazor()) {\n                    var eventFields = _this.parent.eventFields;\n                    var eventObj = eventClickArgs.event;\n                    eventObj[eventFields.startTime] = _this.parent.getDateTime(eventObj[eventFields.startTime]);\n                    eventObj[eventFields.endTime] = _this.parent.getDateTime(eventObj[eventFields.endTime]);\n                    if (eventClickArgs.element) {\n                        eventClickArgs.element = getElement(eventClickArgs.element);\n                    }\n                }\n                if (eventClickArgs.cancel) {\n                    _this.removeSelectedAppointmentClass();\n                    if (_this.parent.quickPopup) {\n                        _this.parent.quickPopup.quickPopupHide();\n                    }\n                }\n                else {\n                    if (_this.parent.currentView === 'Agenda' || _this.parent.currentView === 'MonthAgenda') {\n                        addClass([_this.parent.activeEventData.element], cls.AGENDA_SELECTED_CELL);\n                    }\n                    _this.parent.notify(event.eventClick, eventClickArgs);\n                }\n            });\n        }\n    };\n    EventBase.prototype.eventDoubleClick = function (e) {\n        this.parent.quickPopup.quickPopupHide(true);\n        if (e.type === 'touchstart') {\n            this.activeEventData(e, true);\n        }\n        this.removeSelectedAppointmentClass();\n        if (!isNullOrUndefined(this.parent.activeEventData.event) &&\n            isNullOrUndefined(this.parent.activeEventData.event[this.parent.eventFields.recurrenceID])) {\n            this.parent.eventWindow.openEditor(this.parent.activeEventData.event, 'Save');\n        }\n        else {\n            this.parent.currentAction = 'EditOccurrence';\n            this.parent.quickPopup.openRecurrenceAlert();\n        }\n    };\n    EventBase.prototype.getEventByGuid = function (guid) {\n        return this.parent.eventsProcessed.filter(function (data) { return data.Guid === guid; })[0];\n    };\n    EventBase.prototype.getEventById = function (id) {\n        var _this = this;\n        return this.parent.eventsData.filter(function (data) {\n            return data[_this.parent.eventFields.id] === id;\n        })[0];\n    };\n    EventBase.prototype.generateGuid = function () {\n        return 'xyxxxxyx-xxxy-yxxx-xyxx-xxyxxxxyyxxx'.replace(/[xy]/g, function (c) {\n            var r = Math.random() * 16 | 0;\n            var v = (c === 'x') ? r : (r & 0x3 | 0x8);\n            return v.toString(16);\n        });\n    };\n    EventBase.prototype.getEventIDType = function () {\n        if (this.parent.eventsData.length !== 0) {\n            return typeof (this.parent.eventsData[0][this.parent.eventFields.id]);\n        }\n        if (this.parent.blockData.length !== 0) {\n            return typeof (this.parent.blockData[0][this.parent.eventFields.id]);\n        }\n        return 'string';\n    };\n    EventBase.prototype.getEventMaxID = function (resourceId) {\n        var _this = this;\n        if (this.parent.eventsData.length < 1 && this.parent.blockData.length < 1) {\n            return 1;\n        }\n        var eventId;\n        var idType = this.getEventIDType();\n        if (idType === 'string') {\n            eventId = this.generateGuid();\n        }\n        if (idType === 'number') {\n            var datas = this.parent.eventsData.concat(this.parent.blockData);\n            var maxId = Math.max.apply(Math, datas.map(function (event) { return event[_this.parent.eventFields.id]; }));\n            maxId = isNullOrUndefined(resourceId) ? maxId : maxId + resourceId;\n            eventId = maxId + 1;\n        }\n        return eventId;\n    };\n    EventBase.prototype.activeEventData = function (eventData, isMultiple) {\n        var _this = this;\n        var target = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n        var guid = target.getAttribute('data-guid');\n        if (isMultiple) {\n            this.addSelectedAppointments([].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]')));\n            target.focus();\n        }\n        var eventObject = this.getEventByGuid(guid);\n        if (eventObject && eventObject.isSpanned) {\n            eventObject = this.parent.eventsData.filter(function (obj) {\n                return obj[_this.parent.eventFields.id] === eventObject[_this.parent.eventFields.id];\n            })[0];\n        }\n        this.parent.activeEventData = { event: eventObject, element: target };\n    };\n    EventBase.prototype.generateOccurrence = function (event, viewDate, oldTimezone, isMaxCount) {\n        var startDate = event[this.parent.eventFields.startTime];\n        var endDate = event[this.parent.eventFields.endTime];\n        var eventRule = event[this.parent.eventFields.recurrenceRule];\n        var duration = endDate.getTime() - startDate.getTime();\n        viewDate = new Date((viewDate || this.parent.activeView.startDate()).getTime() - duration);\n        var exception = event[this.parent.eventFields.recurrenceException];\n        var maxCount;\n        if (this.parent.currentView !== 'Agenda' && isMaxCount) {\n            maxCount = util.getDateCount(this.parent.activeView.startDate(), this.parent.activeView.endDate()) + 1;\n        }\n        var newTimezone = this.parent.timezone || this.parent.tzModule.getLocalTimezoneName();\n        var firstDay = this.parent.activeViewOptions.firstDayOfWeek;\n        var calendarMode = this.parent.calendarMode;\n        var dates = generate(startDate, eventRule, exception, firstDay, maxCount, viewDate, calendarMode, oldTimezone, newTimezone);\n        if (this.parent.currentView === 'Agenda' && eventRule.indexOf('COUNT') === -1 && eventRule.indexOf('UNTIL') === -1) {\n            if (isNullOrUndefined(event.generatedDates)) {\n                event.generatedDates = { start: new Date(dates[0]), end: new Date(dates[dates.length - 1]) };\n            }\n            else {\n                if (dates[0] < event.generatedDates.start.getTime()) {\n                    event.generatedDates.start = new Date(dates[0]);\n                }\n                if (dates[dates.length - 1] > event.generatedDates.end.getTime()) {\n                    event.generatedDates.end = new Date(dates[dates.length - 1]);\n                }\n            }\n        }\n        var occurrenceCollection = [];\n        for (var _i = 0, dates_1 = dates; _i < dates_1.length; _i++) {\n            var date = dates_1[_i];\n            var clonedObject = extend({}, event, null, true);\n            clonedObject[this.parent.eventFields.startTime] = new Date(date);\n            clonedObject[this.parent.eventFields.endTime] = new Date(new Date(date).setMilliseconds(duration));\n            clonedObject[this.parent.eventFields.recurrenceID] = clonedObject[this.parent.eventFields.id];\n            delete clonedObject[this.parent.eventFields.recurrenceException];\n            delete clonedObject[this.parent.eventFields.followingID];\n            clonedObject.Guid = this.generateGuid();\n            occurrenceCollection.push(clonedObject);\n        }\n        return occurrenceCollection;\n    };\n    EventBase.prototype.getParentEvent = function (eventObj, isParent) {\n        if (isParent === void 0) { isParent = false; }\n        var parentEvent;\n        do {\n            eventObj = this.getFollowingEvent(eventObj);\n            if (eventObj) {\n                parentEvent = extend({}, eventObj, null, true);\n            }\n        } while (eventObj && isParent);\n        if (isParent && parentEvent) {\n            var collection = this.getEventCollections(parentEvent);\n            var followObj = collection.follow.slice(-1)[0];\n            if (collection.occurrence.length > 0 && !parentEvent[this.parent.eventFields.recurrenceException]) {\n                followObj = collection.occurrence.slice(-1)[0];\n            }\n            if (followObj) {\n                parentEvent[this.parent.eventFields.recurrenceRule] = followObj[this.parent.eventFields.recurrenceRule];\n            }\n        }\n        return parentEvent;\n    };\n    EventBase.prototype.getEventCollections = function (parentObj, childObj) {\n        var followingCollection = [];\n        var occurrenceCollection = [];\n        var followingEvent = parentObj;\n        do {\n            followingEvent = this.getFollowingEvent(followingEvent, true);\n            if (followingEvent) {\n                followingCollection.push(followingEvent);\n            }\n            occurrenceCollection = occurrenceCollection.concat(this.getOccurrenceEvent(followingEvent || parentObj));\n        } while (followingEvent);\n        var collections = {};\n        if (childObj) {\n            var fields_1 = this.parent.eventFields;\n            collections = {\n                follow: followingCollection.filter(function (eventData) {\n                    return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\n                }),\n                occurrence: occurrenceCollection.filter(function (eventData) {\n                    return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\n                })\n            };\n        }\n        else {\n            collections = { follow: followingCollection, occurrence: occurrenceCollection };\n        }\n        return collections;\n    };\n    EventBase.prototype.getFollowingEvent = function (parentObj, isReverse) {\n        var fields = this.parent.eventFields;\n        var fieldValue;\n        if (isReverse) {\n            fieldValue = parentObj[fields.id];\n        }\n        else {\n            fieldValue = (parentObj[fields.recurrenceID] || parentObj[fields.followingID]);\n        }\n        var parentApp = this.parent.eventsData.filter(function (data) {\n            return data[isReverse ? fields.followingID : fields.id] === fieldValue;\n        });\n        return parentApp.shift();\n    };\n    EventBase.prototype.isFollowingEvent = function (parentObj, childObj) {\n        var parentStart = parentObj[this.parent.eventFields.startTime];\n        var childStart = childObj[this.parent.eventFields.startTime];\n        return parentStart.getHours() === childStart.getHours() && parentStart.getMinutes() === childStart.getMinutes() &&\n            parentStart.getSeconds() === childStart.getSeconds();\n    };\n    EventBase.prototype.getOccurrenceEvent = function (eventObj, isGuid, isFollowing) {\n        if (isGuid === void 0) { isGuid = false; }\n        if (isFollowing === void 0) { isFollowing = false; }\n        var idField = isGuid ? 'Guid' : (isFollowing) ? this.parent.eventFields.followingID : this.parent.eventFields.recurrenceID;\n        var fieldKey = isGuid ? 'Guid' : this.parent.eventFields.id;\n        var dataSource = isGuid ? this.parent.eventsProcessed : this.parent.eventsData;\n        return dataSource.filter(function (data) { return data[idField] === eventObj[fieldKey]; });\n    };\n    EventBase.prototype.getOccurrencesByID = function (id) {\n        var fields = this.parent.eventFields;\n        var occurrenceCollection = [];\n        var parentObject = this.parent.eventsData.filter(function (obj) { return obj[fields.id] === id; });\n        for (var _i = 0, _a = parentObject; _i < _a.length; _i++) {\n            var event_3 = _a[_i];\n            if (!isNullOrUndefined(event_3[fields.recurrenceRule])) {\n                occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_3));\n            }\n        }\n        return occurrenceCollection;\n    };\n    EventBase.prototype.getOccurrencesByRange = function (startTime, endTime) {\n        var fields = this.parent.eventFields;\n        var occurrenceCollection = [];\n        for (var _i = 0, _a = this.parent.eventsData; _i < _a.length; _i++) {\n            var event_4 = _a[_i];\n            if (!isNullOrUndefined(event_4[fields.recurrenceRule])) {\n                occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_4));\n            }\n        }\n        var filter = occurrenceCollection.filter(function (obj) {\n            return obj[fields.startTime] >= startTime && obj[fields.endTime] <= endTime && !isNullOrUndefined(obj[fields.recurrenceID]);\n        });\n        return filter;\n    };\n    EventBase.prototype.getDeletedOccurrences = function (recurrenceData) {\n        var _this = this;\n        var fields = this.parent.eventFields;\n        var parentObject;\n        var deletedOccurrences = [];\n        if (typeof recurrenceData === 'string' || typeof recurrenceData === 'number') {\n            parentObject = this.parent.eventsData.filter(function (obj) {\n                return obj[fields.id] === recurrenceData;\n            })[0];\n        }\n        else {\n            parentObject = extend({}, recurrenceData, null, true);\n        }\n        if (parentObject[fields.recurrenceException]) {\n            var exDateString = parentObject[fields.recurrenceException].split(',');\n            exDateString.forEach(function (date) {\n                var edited = _this.parent.eventsData.filter(function (eventObj) {\n                    return eventObj[fields.recurrenceID] === parentObject[fields.id] && eventObj[fields.recurrenceException] === date;\n                });\n                if (edited.length === 0) {\n                    var exDate = getDateFromRecurrenceDateString(date);\n                    var childObject = extend({}, recurrenceData, null, true);\n                    childObject[fields.recurrenceID] = parentObject[fields.id];\n                    delete childObject[fields.followingID];\n                    childObject[fields.recurrenceException] = date;\n                    var startDate = new Date(exDate.getTime());\n                    var time = parentObject[fields.endTime].getTime() - parentObject[fields.startTime].getTime();\n                    var endDate = new Date(startDate.getTime());\n                    endDate.setMilliseconds(time);\n                    childObject[fields.startTime] = new Date(startDate.getTime());\n                    childObject[fields.endTime] = new Date(endDate.getTime());\n                    deletedOccurrences.push(childObject);\n                }\n            });\n        }\n        return deletedOccurrences;\n    };\n    EventBase.prototype.applyResourceColor = function (element, data, type, index, alpha) {\n        if (!this.parent.resourceBase) {\n            return;\n        }\n        var alphaColor = function (color, alpha) {\n            color = color.replace('#', '');\n            var r = parseInt(color.substring(0, color.length / 3), 16);\n            var g = parseInt(color.substring(color.length / 3, 2 * color.length / 3), 16);\n            var b = parseInt(color.substring(2 * color.length / 3, 3 * color.length / 3), 16);\n            return \"rgba(\" + r + \", \" + g + \", \" + b + \", \" + alpha + \")\";\n        };\n        // index refers groupOrder\n        var color = this.parent.resourceBase.getResourceColor(data, index);\n        if (color) {\n            // tslint:disable-next-line:no-any\n            element.style[type] = !isNullOrUndefined(alpha) ? alphaColor(color, alpha) : color;\n        }\n    };\n    EventBase.prototype.createBlockAppointmentElement = function (record, resIndex) {\n        var eventSubject = (record[this.parent.eventFields.subject] || this.parent.eventSettings.fields.subject.default);\n        var appointmentWrapper = createElement('div', {\n            className: cls.BLOCK_APPOINTMENT_CLASS,\n            attrs: {\n                'data-id': 'Appointment_' + record[this.parent.eventFields.id],\n                'aria-readonly': 'true', 'aria-selected': 'false'\n            }\n        });\n        var templateElement;\n        if (!isNullOrUndefined(this.parent.activeViewOptions.eventTemplate)) {\n            var scheduleId = this.parent.element.id + '_';\n            var viewName = this.parent.activeViewOptions.eventTemplateName;\n            var templateId = scheduleId + viewName + 'eventTemplate';\n            var templateArgs = util.addLocalOffsetToEvent(record, this.parent.eventFields);\n            templateElement = this.parent.getAppointmentTemplate()(templateArgs, this.parent, 'eventTemplate', templateId, false);\n        }\n        else {\n            var appointmentSubject = createElement('div', {\n                className: cls.SUBJECT_CLASS, innerHTML: eventSubject\n            });\n            templateElement = [appointmentSubject];\n        }\n        append(templateElement, appointmentWrapper);\n        this.setWrapperAttributes(appointmentWrapper, resIndex);\n        return appointmentWrapper;\n    };\n    EventBase.prototype.setWrapperAttributes = function (appointmentWrapper, resIndex) {\n        if (!isNullOrUndefined(this.cssClass)) {\n            addClass([appointmentWrapper], this.cssClass);\n        }\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            appointmentWrapper.setAttribute('data-group-index', resIndex.toString());\n        }\n    };\n    EventBase.prototype.getReadonlyAttribute = function (event) {\n        return (event[this.parent.eventFields.isReadonly]) ?\n            event[this.parent.eventFields.isReadonly] : 'false';\n    };\n    EventBase.prototype.isBlockRange = function (eventData) {\n        var _this = this;\n        var eventCollection = (eventData instanceof Array) ? eventData : [eventData];\n        var isBlockAlert = false;\n        var fields = this.parent.eventFields;\n        eventCollection.forEach(function (event) {\n            var dataCol = [];\n            if (!isNullOrUndefined(event[fields.recurrenceRule]) &&\n                (isNullOrUndefined(event[fields.recurrenceID]) || event[fields.id] === event[fields.recurrenceID])) {\n                dataCol = _this.generateOccurrence(event);\n            }\n            else {\n                dataCol.push(event);\n            }\n            for (var _i = 0, dataCol_1 = dataCol; _i < dataCol_1.length; _i++) {\n                var data = dataCol_1[_i];\n                var filterBlockEvents = _this.filterBlockEvents(data);\n                if (filterBlockEvents.length > 0) {\n                    isBlockAlert = true;\n                    break;\n                }\n            }\n        });\n        this.parent.uiStateValues.isBlock = isBlockAlert;\n        return isBlockAlert;\n    };\n    EventBase.prototype.getFilterEventsList = function (dataSource, query) {\n        return new DataManager(dataSource).executeLocal(new Query().where(query));\n    };\n    EventBase.prototype.getSeriesEvents = function (parentEvent, startTime) {\n        var fields = this.parent.eventFields;\n        startTime = isNullOrUndefined(startTime) ? parentEvent[fields.startTime] : startTime;\n        var deleteFutureEditEvents;\n        var futureEvents;\n        var deleteFutureEditEventList = [];\n        var delId = parentEvent[fields.id];\n        var followingId = parentEvent[fields.followingID];\n        var deleteFutureEvent;\n        var startTimeQuery = this.parent.currentAction === 'EditSeries' ? 'greaterthan' : 'greaterthanorequal';\n        do {\n            deleteFutureEvent = ((new Predicate(fields.followingID, 'equal', delId))).\n                and(new Predicate(fields.startTime, startTimeQuery, startTime));\n            futureEvents = this.getFilterEventsList(this.parent.eventsData, deleteFutureEvent);\n            deleteFutureEditEvents = futureEvents.slice(-1)[0];\n            if (!isNullOrUndefined(deleteFutureEditEvents) && deleteFutureEditEvents[fields.id] !== followingId) {\n                deleteFutureEditEventList.push(deleteFutureEditEvents);\n                delId = deleteFutureEditEvents[fields.id];\n                followingId = deleteFutureEditEvents[fields.followingID];\n            }\n            else {\n                followingId = null;\n            }\n        } while (futureEvents.length === 1 && !isNullOrUndefined(deleteFutureEditEvents[fields.followingID]));\n        return deleteFutureEditEventList;\n    };\n    EventBase.prototype.getEditedOccurrences = function (deleteFutureEditEventList, startTime) {\n        var fields = this.parent.eventFields;\n        var deleteRecurrenceEventList = [];\n        var delEditedEvents;\n        for (var _i = 0, deleteFutureEditEventList_1 = deleteFutureEditEventList; _i < deleteFutureEditEventList_1.length; _i++) {\n            var event_5 = deleteFutureEditEventList_1[_i];\n            var delEventQuery = new Predicate(fields.recurrenceID, 'equal', event_5[fields.id]).\n                or(new Predicate(fields.recurrenceID, 'equal', event_5[fields.followingID]).\n                and(new Predicate(fields.recurrenceID, 'notequal', undefined)));\n            if (this.parent.currentAction === 'EditFollowingEvents' || this.parent.currentAction === 'DeleteFollowingEvents') {\n                delEventQuery = delEventQuery.and(new Predicate(fields.startTime, 'greaterthanorequal', startTime));\n            }\n            delEditedEvents = this.getFilterEventsList(this.parent.eventsData, delEventQuery);\n            deleteRecurrenceEventList = deleteRecurrenceEventList.concat(delEditedEvents);\n        }\n        return deleteRecurrenceEventList;\n    };\n    EventBase.prototype.getRenderedDates = function (dateRender) {\n        var firstDate = 0;\n        var lastDate = dateRender.length;\n        var filteredDates;\n        if ((dateRender[0] < this.parent.minDate) && dateRender[dateRender.length - 1] > this.parent.maxDate) {\n            for (var i = 0; i < dateRender.length; i++) {\n                if (dateRender[i].getTime() === this.parent.minDate.getTime()) {\n                    firstDate = i;\n                }\n                if (dateRender[i].getTime() === this.parent.maxDate.getTime()) {\n                    lastDate = i;\n                }\n            }\n            filteredDates = dateRender.filter(function (date) {\n                return ((date >= dateRender[firstDate]) && (date <= dateRender[lastDate]));\n            });\n        }\n        return filteredDates;\n    };\n    EventBase.prototype.isValidEvent = function (eventObj, start, end, schedule) {\n        var isHourRange = end.getTime() > schedule.startHour.getTime() && start.getTime() < schedule.endHour.getTime();\n        var isSameRange = schedule.startHour.getTime() <= start.getTime() &&\n            eventObj[this.parent.eventFields.startTime].getTime() >= schedule.startHour.getTime() &&\n            eventObj[this.parent.eventFields.endTime].getTime() < schedule.endHour.getTime() && start.getTime() === end.getTime();\n        return isHourRange || isSameRange;\n    };\n    return EventBase;\n}());\nexport { EventBase };\n"]},"metadata":{},"sourceType":"module"}