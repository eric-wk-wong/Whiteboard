{"ast":null,"code":"import { getValue, setValue, merge, isBlazor } from './util';\nimport { Base } from './base';\n/**\n * To detect the changes for inner properties.\n * @private\n */\n\nvar ChildProperty =\n/** @class */\nfunction () {\n  function ChildProperty(parent, propName, defaultValue, isArray) {\n    this.isComplexArraySetter = false;\n    this.properties = {};\n    this.changedProperties = {};\n    this.childChangedProperties = {};\n    this.oldProperties = {}; // tslint:disable-next-line:no-empty\n\n    this.finalUpdate = function () {};\n\n    this.callChildDataBind = getValue('callChildDataBind', Base);\n    this.parentObj = parent;\n    this.controlParent = this.parentObj.controlParent || this.parentObj;\n    this.propName = propName;\n    this.isParentArray = isArray;\n    this.setProperties(defaultValue, true);\n  }\n  /**\n   * Updates the property changes\n   * @param {boolean} val\n   * @param {string} propName\n   * @returns {void}\n   */\n\n\n  ChildProperty.prototype.updateChange = function (val, propName) {\n    if (val === true) {\n      this.parentObj.childChangedProperties[propName] = val;\n    } else {\n      delete this.parentObj.childChangedProperties[propName];\n    }\n\n    if (this.parentObj.updateChange) {\n      this.parentObj.updateChange(val, this.parentObj.propName);\n    }\n  };\n  /**\n   * Updates time out duration\n   */\n\n\n  ChildProperty.prototype.updateTimeOut = function () {\n    if (this.parentObj.updateTimeOut) {\n      this.parentObj.finalUpdate();\n      this.parentObj.updateTimeOut();\n    } else {\n      var changeTime_1 = setTimeout(this.parentObj.dataBind.bind(this.parentObj));\n\n      var clearUpdate = function () {\n        clearTimeout(changeTime_1);\n      };\n\n      this.finalUpdate = clearUpdate;\n    }\n  };\n  /**\n   * Clears changed properties\n   */\n\n\n  ChildProperty.prototype.clearChanges = function () {\n    this.finalUpdate();\n    this.updateChange(false, this.propName);\n    this.oldProperties = {};\n    this.changedProperties = {};\n  };\n  /**\n   * Set property changes\n   * @param {Object} prop\n   * @param {boolean} muteOnChange\n   * {void}\n   */\n\n\n  ChildProperty.prototype.setProperties = function (prop, muteOnChange) {\n    if (muteOnChange === true) {\n      merge(this, prop);\n      this.updateChange(false, this.propName);\n      this.clearChanges();\n    } else {\n      merge(this, prop);\n    }\n  };\n  /**\n   * Binds data\n   */\n\n\n  ChildProperty.prototype.dataBind = function () {\n    this.callChildDataBind(this.childChangedProperties, this);\n\n    if (this.isParentArray) {\n      var curIndex = this.parentObj[this.propName].indexOf(this);\n\n      if (Object.keys(this.changedProperties).length) {\n        setValue(this.propName + '.' + curIndex, this.changedProperties, this.parentObj.changedProperties);\n        setValue(this.propName + '.' + curIndex, this.oldProperties, this.parentObj.oldProperties);\n      }\n    } else {\n      this.parentObj.changedProperties[this.propName] = this.changedProperties;\n      this.parentObj.oldProperties[this.propName] = this.oldProperties;\n    }\n\n    this.clearChanges();\n  };\n  /**\n   * Saves changes to newer values\n   * @param {string} key\n   * @param {Object} newValue\n   * @param {Object} oldValue\n   * @returns {void}\n   */\n\n\n  ChildProperty.prototype.saveChanges = function (key, newValue, oldValue, restrictServerDataBind) {\n    if (this.controlParent.isProtectedOnChange) {\n      return;\n    }\n\n    if (!restrictServerDataBind) {\n      this.serverDataBind(key, newValue, true);\n    }\n\n    this.oldProperties[key] = oldValue;\n    this.changedProperties[key] = newValue;\n    this.updateChange(true, this.propName);\n    this.finalUpdate();\n    this.updateTimeOut();\n  };\n\n  ChildProperty.prototype.serverDataBind = function (key, value, isSaveChanges, action) {\n    if (isBlazor() && !this.parentObj.isComplexArraySetter) {\n      // tslint:disable-next-line:no-any\n      var parent_1;\n      var newChanges = {};\n      var parentKey = isSaveChanges ? this.getParentKey(true) + '.' + key : key;\n      /* istanbul ignore else  */\n\n      if (parentKey.indexOf('.') !== -1) {\n        var complexKeys = parentKey.split('.');\n        parent_1 = newChanges;\n\n        for (var i = 0; i < complexKeys.length; i++) {\n          var isFinal = i === complexKeys.length - 1;\n          parent_1[complexKeys[i]] = isFinal ? value : {};\n          parent_1 = isFinal ? parent_1 : parent_1[complexKeys[i]];\n        }\n      } else {\n        newChanges[parentKey] = {};\n        parent_1 = newChanges[parentKey];\n        newChanges[parentKey][key] = value;\n      }\n      /* istanbul ignore next */\n\n\n      if (this.isParentArray) {\n        var actionProperty = 'ejsAction';\n        parent_1[actionProperty] = action ? action : 'none';\n      }\n\n      this.controlParent.serverDataBind(newChanges);\n    }\n  };\n\n  ChildProperty.prototype.getParentKey = function (isSaveChanges) {\n    // tslint:disable-next-line:no-any\n    var index = '';\n    var propName = this.propName;\n    /* istanbul ignore next */\n\n    if (this.isParentArray) {\n      index = this.parentObj[this.propName].indexOf(this);\n      var valueLength = this.parentObj[this.propName].length;\n      valueLength = isSaveChanges ? valueLength : valueLength > 0 ? valueLength - 1 : 0;\n      index = index !== -1 ? '-' + index : '-' + valueLength;\n      propName = propName + index;\n    }\n\n    if (this.controlParent !== this.parentObj) {\n      propName = this.parentObj.getParentKey() + '.' + this.propName + index;\n    }\n\n    return propName;\n  };\n\n  return ChildProperty;\n}();\n\nexport { ChildProperty };","map":{"version":3,"sources":["D:/developing/projects/whiteboard/node_modules/@syncfusion/ej2-base/src/child-property.js"],"names":["getValue","setValue","merge","isBlazor","Base","ChildProperty","parent","propName","defaultValue","isArray","isComplexArraySetter","properties","changedProperties","childChangedProperties","oldProperties","finalUpdate","callChildDataBind","parentObj","controlParent","isParentArray","setProperties","prototype","updateChange","val","updateTimeOut","changeTime_1","setTimeout","dataBind","bind","clearUpdate","clearTimeout","clearChanges","prop","muteOnChange","curIndex","indexOf","Object","keys","length","saveChanges","key","newValue","oldValue","restrictServerDataBind","isProtectedOnChange","serverDataBind","value","isSaveChanges","action","parent_1","newChanges","parentKey","getParentKey","complexKeys","split","i","isFinal","actionProperty","index","valueLength"],"mappings":"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","sourcesContent":["import { getValue, setValue, merge, isBlazor } from './util';\nimport { Base } from './base';\n/**\n * To detect the changes for inner properties.\n * @private\n */\nvar ChildProperty = /** @class */ (function () {\n    function ChildProperty(parent, propName, defaultValue, isArray) {\n        this.isComplexArraySetter = false;\n        this.properties = {};\n        this.changedProperties = {};\n        this.childChangedProperties = {};\n        this.oldProperties = {};\n        // tslint:disable-next-line:no-empty\n        this.finalUpdate = function () { };\n        this.callChildDataBind = getValue('callChildDataBind', Base);\n        this.parentObj = parent;\n        this.controlParent = this.parentObj.controlParent || this.parentObj;\n        this.propName = propName;\n        this.isParentArray = isArray;\n        this.setProperties(defaultValue, true);\n    }\n    /**\n     * Updates the property changes\n     * @param {boolean} val\n     * @param {string} propName\n     * @returns {void}\n     */\n    ChildProperty.prototype.updateChange = function (val, propName) {\n        if (val === true) {\n            this.parentObj.childChangedProperties[propName] = val;\n        }\n        else {\n            delete this.parentObj.childChangedProperties[propName];\n        }\n        if (this.parentObj.updateChange) {\n            this.parentObj.updateChange(val, this.parentObj.propName);\n        }\n    };\n    /**\n     * Updates time out duration\n     */\n    ChildProperty.prototype.updateTimeOut = function () {\n        if (this.parentObj.updateTimeOut) {\n            this.parentObj.finalUpdate();\n            this.parentObj.updateTimeOut();\n        }\n        else {\n            var changeTime_1 = setTimeout(this.parentObj.dataBind.bind(this.parentObj));\n            var clearUpdate = function () {\n                clearTimeout(changeTime_1);\n            };\n            this.finalUpdate = clearUpdate;\n        }\n    };\n    /**\n     * Clears changed properties\n     */\n    ChildProperty.prototype.clearChanges = function () {\n        this.finalUpdate();\n        this.updateChange(false, this.propName);\n        this.oldProperties = {};\n        this.changedProperties = {};\n    };\n    /**\n     * Set property changes\n     * @param {Object} prop\n     * @param {boolean} muteOnChange\n     * {void}\n     */\n    ChildProperty.prototype.setProperties = function (prop, muteOnChange) {\n        if (muteOnChange === true) {\n            merge(this, prop);\n            this.updateChange(false, this.propName);\n            this.clearChanges();\n        }\n        else {\n            merge(this, prop);\n        }\n    };\n    /**\n     * Binds data\n     */\n    ChildProperty.prototype.dataBind = function () {\n        this.callChildDataBind(this.childChangedProperties, this);\n        if (this.isParentArray) {\n            var curIndex = this.parentObj[this.propName].indexOf(this);\n            if (Object.keys(this.changedProperties).length) {\n                setValue(this.propName + '.' + curIndex, this.changedProperties, this.parentObj.changedProperties);\n                setValue(this.propName + '.' + curIndex, this.oldProperties, this.parentObj.oldProperties);\n            }\n        }\n        else {\n            this.parentObj.changedProperties[this.propName] = this.changedProperties;\n            this.parentObj.oldProperties[this.propName] = this.oldProperties;\n        }\n        this.clearChanges();\n    };\n    /**\n     * Saves changes to newer values\n     * @param {string} key\n     * @param {Object} newValue\n     * @param {Object} oldValue\n     * @returns {void}\n     */\n    ChildProperty.prototype.saveChanges = function (key, newValue, oldValue, restrictServerDataBind) {\n        if (this.controlParent.isProtectedOnChange) {\n            return;\n        }\n        if (!restrictServerDataBind) {\n            this.serverDataBind(key, newValue, true);\n        }\n        this.oldProperties[key] = oldValue;\n        this.changedProperties[key] = newValue;\n        this.updateChange(true, this.propName);\n        this.finalUpdate();\n        this.updateTimeOut();\n    };\n    ChildProperty.prototype.serverDataBind = function (key, value, isSaveChanges, action) {\n        if (isBlazor() && !this.parentObj.isComplexArraySetter) {\n            // tslint:disable-next-line:no-any\n            var parent_1;\n            var newChanges = {};\n            var parentKey = isSaveChanges ? this.getParentKey(true) + '.' + key : key;\n            /* istanbul ignore else  */\n            if (parentKey.indexOf('.') !== -1) {\n                var complexKeys = parentKey.split('.');\n                parent_1 = newChanges;\n                for (var i = 0; i < complexKeys.length; i++) {\n                    var isFinal = i === complexKeys.length - 1;\n                    parent_1[complexKeys[i]] = isFinal ? value : {};\n                    parent_1 = isFinal ? parent_1 : parent_1[complexKeys[i]];\n                }\n            }\n            else {\n                newChanges[parentKey] = {};\n                parent_1 = newChanges[parentKey];\n                newChanges[parentKey][key] = value;\n            }\n            /* istanbul ignore next */\n            if (this.isParentArray) {\n                var actionProperty = 'ejsAction';\n                parent_1[actionProperty] = action ? action : 'none';\n            }\n            this.controlParent.serverDataBind(newChanges);\n        }\n    };\n    ChildProperty.prototype.getParentKey = function (isSaveChanges) {\n        // tslint:disable-next-line:no-any\n        var index = '';\n        var propName = this.propName;\n        /* istanbul ignore next */\n        if (this.isParentArray) {\n            index = this.parentObj[this.propName].indexOf(this);\n            var valueLength = this.parentObj[this.propName].length;\n            valueLength = isSaveChanges ? valueLength : (valueLength > 0 ? valueLength - 1 : 0);\n            index = index !== -1 ? '-' + index : '-' + valueLength;\n            propName = propName + index;\n        }\n        if (this.controlParent !== this.parentObj) {\n            propName = this.parentObj.getParentKey() + '.' + this.propName + index;\n        }\n        return propName;\n    };\n    return ChildProperty;\n}());\nexport { ChildProperty };\n"]},"metadata":{},"sourceType":"module"}