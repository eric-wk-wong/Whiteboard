{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { createElement, closest, Draggable, extend, formatUnit, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { addClass, remove, removeClass, setStyleAttribute, isBlazor, getElement } from '@syncfusion/ej2-base';\nimport { ActionBase } from '../actions/action-base';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport { MonthEvent } from '../event-renderer/month';\nimport { TimelineEvent } from '../event-renderer/timeline-view';\nimport { VerticalEvent } from '../event-renderer/vertical-view';\nvar MINUTES_PER_DAY = 1440;\n/**\n * Schedule events drag actions\n */\n\nvar DragAndDrop =\n/** @class */\nfunction (_super) {\n  __extends(DragAndDrop, _super);\n\n  function DragAndDrop() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.widthUptoCursorPoint = 0;\n    _this.heightUptoCursorPoint = 0;\n    _this.cursorPointIndex = 0;\n    _this.isHeaderRows = false;\n    _this.isTimelineDayProcess = false;\n    _this.widthPerMinute = 0;\n    _this.heightPerMinute = 0;\n    _this.minDiff = 0;\n    _this.isStepDragging = false;\n    _this.isMorePopupOpened = false;\n    _this.isAllDayDrag = false;\n    return _this;\n  }\n\n  DragAndDrop.prototype.wireDragEvent = function (element) {\n    new Draggable(element, {\n      abort: '.' + cls.EVENT_RESIZE_CLASS,\n      clone: true,\n      isDragScroll: true,\n      enableTapHold: this.parent.isAdaptive,\n      enableTailMode: this.parent.eventDragArea ? true : false,\n      cursorAt: this.parent.eventDragArea ? {\n        left: -20,\n        top: -20\n      } : {\n        left: 0,\n        top: 0\n      },\n      dragArea: this.parent.eventDragArea ? document.querySelector(this.parent.eventDragArea) : this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS),\n      dragStart: this.dragStart.bind(this),\n      drag: this.drag.bind(this),\n      dragStop: this.dragStop.bind(this),\n      enableAutoScroll: false,\n      helper: this.dragHelper.bind(this),\n      queryPositionInfo: this.dragPosition.bind(this)\n    });\n  };\n\n  DragAndDrop.prototype.dragHelper = function (e) {\n    this.setDragActionDefaultValues();\n    this.actionObj.element = e.element;\n    this.actionObj.action = 'drag';\n    this.actionObj.clone = this.createCloneElement(this.actionObj.element);\n\n    if (!this.parent.eventDragArea && this.parent.currentView !== 'Month' && this.parent.timeScale.enable && !this.parent.activeView.isTimelineView() && !this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n      setStyleAttribute(this.actionObj.clone, {\n        cursor: 'move',\n        left: '0%',\n        right: '0%',\n        width: '100%'\n      });\n    }\n\n    this.actionObj.clone.style.top = formatUnit(this.actionObj.element.offsetTop);\n    this.actionObj.cloneElement = [this.actionObj.clone];\n    this.actionObj.originalElement = [this.actionObj.element];\n    return this.actionObj.clone;\n  };\n\n  DragAndDrop.prototype.dragPosition = function (e) {\n    if (this.parent.eventDragArea) {\n      return {\n        left: e.left,\n        top: e.top\n      };\n    }\n\n    var cellHeight = this.actionObj.cellHeight / this.actionObj.slotInterval * this.actionObj.interval;\n    var leftValue = formatUnit(0);\n\n    if (this.parent.currentView === 'Month') {\n      leftValue = e.left;\n    }\n\n    if (this.parent.activeView.isTimelineView()) {\n      leftValue = formatUnit(this.actionObj.clone.offsetLeft);\n    }\n\n    var topValue;\n\n    if (this.parent.activeView.isTimelineView() || !this.parent.timeScale.enable || !isNullOrUndefined(this.actionObj.clone.offsetParent) && this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n      topValue = formatUnit(this.actionObj.clone.offsetTop);\n    } else if (this.parent.currentView === 'Month') {\n      topValue = formatUnit(0);\n    } else if (this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n      topValue = formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop);\n      setStyleAttribute(this.actionObj.clone, {\n        width: formatUnit(Math.ceil(this.actionObj.clone.offsetWidth / this.actionObj.cellWidth) * this.actionObj.cellWidth),\n        right: this.parent.enableRtl && formatUnit(0)\n      });\n    } else {\n      if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) && !this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n        setStyleAttribute(this.actionObj.clone, {\n          height: formatUnit(this.actionObj.cellHeight),\n          width: formatUnit(this.actionObj.cellWidth - 1),\n          pointerEvents: 'none'\n        });\n      }\n\n      var top_1 = parseInt(e.top, 10);\n      top_1 = top_1 < 0 ? 0 : top_1;\n      topValue = formatUnit(Math.ceil(top_1 / cellHeight) * cellHeight);\n      var scrollHeight = this.parent.element.querySelector('.e-content-wrap').scrollHeight;\n      var cloneBottom = parseInt(topValue, 10) + this.actionObj.clone.offsetHeight;\n\n      if (cloneBottom > scrollHeight) {\n        topValue = parseInt(topValue, 10) - (cloneBottom - scrollHeight) + 'px';\n      }\n    }\n\n    return {\n      left: leftValue,\n      top: topValue\n    };\n  };\n\n  DragAndDrop.prototype.setDragActionDefaultValues = function () {\n    this.actionObj.action = 'drag';\n    this.actionObj.isAllDay = null;\n    this.actionObj.slotInterval = this.parent.activeViewOptions.timeScale.interval / this.parent.activeViewOptions.timeScale.slotCount;\n    this.actionObj.interval = this.actionObj.slotInterval;\n    var workCell = this.parent.element.querySelector('.' + cls.WORK_CELLS_CLASS);\n    this.actionObj.cellWidth = workCell.offsetWidth;\n    this.actionObj.cellHeight = workCell.offsetHeight;\n  };\n\n  DragAndDrop.prototype.dragStart = function (e) {\n    var _this = this;\n\n    var eventGuid = this.actionObj.element.getAttribute('data-guid');\n    this.actionObj.event = this.parent.eventBase.getEventByGuid(eventGuid);\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var dragArgs = {\n      cancel: false,\n      data: eventObj,\n      event: e,\n      excludeSelectors: null,\n      element: this.actionObj.element,\n      interval: this.actionObj.interval,\n      navigation: {\n        enable: false,\n        timeDelay: 2000\n      },\n      scroll: {\n        enable: true,\n        scrollBy: 30,\n        timeDelay: 100\n      }\n    };\n    this.parent.trigger(events.dragStart, dragArgs, function (dragEventArgs) {\n      if (dragEventArgs.cancel || !isNullOrUndefined(_this.actionObj.element) && isNullOrUndefined(_this.actionObj.element.parentElement)) {\n        _this.actionObj.action = '';\n\n        _this.removeCloneElementClasses();\n\n        _this.removeCloneElement();\n\n        return;\n      } else if (isBlazor()) {\n        e.bindEvents(e.dragElement);\n\n        if (dragEventArgs.element) {\n          dragEventArgs.element = getElement(dragEventArgs.element);\n        }\n\n        dragEventArgs.data[_this.parent.eventFields.startTime] = _this.parent.getDateTime(dragEventArgs.data[_this.parent.eventFields.startTime]);\n        dragEventArgs.data[_this.parent.eventFields.endTime] = _this.parent.getDateTime(dragEventArgs.data[_this.parent.eventFields.endTime]);\n      }\n\n      _this.actionClass('addClass');\n\n      _this.parent.uiStateValues.action = true;\n      _this.actionObj.start = eventObj[_this.parent.eventFields.startTime];\n      _this.actionObj.end = eventObj[_this.parent.eventFields.endTime];\n      _this.actionObj.groupIndex = parseInt(_this.actionObj.element.getAttribute('data-group-index') || '0', 10);\n      _this.actionObj.interval = dragEventArgs.interval;\n      _this.actionObj.navigation = dragEventArgs.navigation;\n      _this.actionObj.scroll = dragEventArgs.scroll;\n      _this.actionObj.excludeSelectors = dragEventArgs.excludeSelectors;\n\n      var viewElement = _this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n\n      _this.scrollArgs = {\n        element: viewElement,\n        width: viewElement.scrollWidth,\n        height: viewElement.scrollHeight\n      };\n      _this.widthPerMinute = _this.actionObj.cellWidth / _this.actionObj.slotInterval * _this.actionObj.interval;\n      _this.heightPerMinute = _this.actionObj.cellHeight / _this.actionObj.slotInterval * _this.actionObj.interval;\n      _this.widthUptoCursorPoint = 0;\n      _this.heightUptoCursorPoint = 0;\n      _this.cursorPointIndex = -1;\n      _this.isHeaderRows = false;\n      _this.isTimelineDayProcess = false;\n      _this.minDiff = 0;\n      _this.isMorePopupOpened = false;\n      _this.daysVariation = -1;\n\n      if (_this.parent.activeView.isTimelineView() || !_this.parent.timeScale.enable) {\n        if (!isNullOrUndefined(_this.actionObj.clone.offsetParent) && _this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n          _this.isMorePopupOpened = true;\n        }\n\n        var rows = _this.parent.activeViewOptions.headerRows;\n        _this.isHeaderRows = rows.length > 0 && rows[rows.length - 1].option !== 'Hour' && rows[rows.length - 1].option !== 'Date';\n        _this.isTimelineDayProcess = !_this.parent.activeViewOptions.timeScale.enable || _this.isHeaderRows || _this.parent.currentView === 'TimelineMonth' || rows.length > 0 && rows[rows.length - 1].option === 'Date';\n        _this.isStepDragging = !_this.isTimelineDayProcess && _this.actionObj.slotInterval !== _this.actionObj.interval;\n\n        if (_this.isTimelineDayProcess) {\n          _this.timelineEventModule = new TimelineEvent(_this.parent, 'day');\n        } else {\n          _this.timelineEventModule = new TimelineEvent(_this.parent, 'hour');\n        }\n      }\n\n      if (_this.parent.currentView === 'Month') {\n        _this.updateOriginalElement(_this.actionObj.clone);\n\n        _this.monthEvent = new MonthEvent(_this.parent);\n      }\n\n      if (_this.parent.currentView === 'Day' || _this.parent.currentView === 'Week' || _this.parent.currentView === 'WorkWeek') {\n        _this.verticalEvent = new VerticalEvent(_this.parent);\n      }\n    });\n  };\n\n  DragAndDrop.prototype.drag = function (e) {\n    this.parent.quickPopup.quickPopupHide(true);\n\n    if (!isNullOrUndefined(e.target) && e.target.classList.contains(cls.DISABLE_DATES)) {\n      return;\n    }\n\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventArgs = this.getPageCoordinates(e);\n    this.actionObj.Y = this.actionObj.pageY = eventArgs.pageY;\n    this.actionObj.X = this.actionObj.pageX = eventArgs.pageX;\n    this.actionObj.target = e.target;\n    this.widthUptoCursorPoint = this.widthUptoCursorPoint === 0 ? Math.ceil(Math.abs(this.actionObj.clone.getBoundingClientRect().left - this.actionObj.X) / this.widthPerMinute) * this.widthPerMinute : this.widthUptoCursorPoint;\n    this.widthUptoCursorPoint = this.isMorePopupOpened ? this.actionObj.cellWidth : this.widthUptoCursorPoint;\n    this.heightUptoCursorPoint = this.heightUptoCursorPoint === 0 ? Math.ceil(Math.abs(this.actionObj.clone.getBoundingClientRect().top - this.actionObj.Y) / this.heightPerMinute) * this.heightPerMinute : this.heightUptoCursorPoint;\n    this.isAllDayDrag = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS);\n\n    if (this.isStepDragging && this.minDiff === 0) {\n      this.calculateMinutesDiff(eventObj);\n    }\n\n    if ((this.parent.currentView === 'Month' || this.isAllDayDrag) && this.daysVariation < 0) {\n      var date = this.parent.getDateFromElement(this.actionObj.target);\n\n      if (!isNullOrUndefined(date)) {\n        var currentDate = util.resetTime(date);\n        var startDate = util.resetTime(new Date(eventObj[this.parent.eventFields.startTime].getTime()));\n        this.daysVariation = (currentDate.getTime() - startDate.getTime()) / util.MS_PER_DAY;\n      } else {\n        this.daysVariation = 0;\n      }\n    }\n\n    if (this.parent.eventDragArea) {\n      var targetElement = eventArgs.target;\n      this.actionObj.clone.style.top = formatUnit(targetElement.offsetTop);\n      this.actionObj.clone.style.left = formatUnit(targetElement.offsetLeft);\n      var currentTarget = closest(targetElement, '.' + cls.ROOT);\n\n      if (!currentTarget) {\n        this.actionObj.clone.style.height = '';\n        this.actionObj.clone.style.width = '';\n      } else {\n        if (!(this.parent.currentView === 'Week' || this.parent.currentView === 'WorkWeek' || this.parent.currentView === 'Day')) {\n          this.actionObj.clone.style.width = formatUnit(this.actionObj.element.offsetWidth);\n        }\n      }\n    }\n\n    this.updateScrollPosition(e);\n    this.updateNavigatingPosition(e);\n    this.updateDraggingDateTime(e);\n    var dragArgs = {\n      data: eventObj,\n      event: e,\n      element: this.actionObj.element,\n      startTime: this.actionObj.start,\n      endTime: this.actionObj.end\n    };\n\n    if (this.parent.group.resources.length > 0) {\n      dragArgs.groupIndex = this.actionObj.groupIndex;\n    }\n\n    this.parent.trigger(events.drag, dragArgs);\n  };\n\n  DragAndDrop.prototype.calculateMinutesDiff = function (eventObj) {\n    if (this.parent.enableRtl) {\n      this.minDiff = (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint) / this.widthPerMinute * this.actionObj.interval;\n    } else {\n      this.minDiff = this.widthUptoCursorPoint / this.widthPerMinute * this.actionObj.interval;\n    }\n\n    var startDate = eventObj[this.parent.eventFields.startTime];\n    var startTime = this.parent.activeView.renderDates[0];\n    var startEndHours = util.getStartEndHours(startTime, this.parent.activeView.getStartHour(), this.parent.activeView.getEndHour());\n\n    if (startEndHours.startHour.getTime() > startDate.getTime()) {\n      this.minDiff = this.minDiff + (startEndHours.startHour.getTime() - startDate.getTime()) / util.MS_PER_MINUTE;\n    }\n  };\n\n  DragAndDrop.prototype.dragStop = function (e) {\n    var _this = this;\n\n    this.removeCloneElementClasses();\n    this.removeCloneElement();\n    clearInterval(this.actionObj.navigationInterval);\n    this.actionObj.navigationInterval = null;\n    clearInterval(this.actionObj.scrollInterval);\n    this.actionObj.scrollInterval = null;\n    this.actionClass('removeClass');\n    this.parent.uiStateValues.action = false;\n    this.actionObj.action = null;\n\n    if (this.isAllowDrop(e)) {\n      return;\n    }\n\n    var dragArgs = {\n      cancel: false,\n      data: this.getChangedData(),\n      event: e,\n      element: this.actionObj.element\n    };\n    this.parent.trigger(events.dragStop, dragArgs, function (dragEventArgs) {\n      if (dragEventArgs.cancel) {\n        return;\n      }\n\n      _this.saveChangedData(dragEventArgs);\n    });\n  };\n\n  DragAndDrop.prototype.updateNavigatingPosition = function (e) {\n    var _this = this;\n\n    if (this.actionObj.navigation.enable) {\n      var currentDate_1 = this.parent.getCurrentTime();\n\n      if (isNullOrUndefined(this.actionObj.navigationInterval)) {\n        this.actionObj.navigationInterval = window.setInterval(function () {\n          if (currentDate_1) {\n            var crtDate = _this.parent.getCurrentTime();\n\n            var end = crtDate.getSeconds();\n            var start = currentDate_1.getSeconds() + _this.actionObj.navigation.timeDelay / 1000;\n            start = start >= 60 ? start - 60 : start;\n\n            if (start === end) {\n              currentDate_1 = _this.parent.getCurrentTime();\n\n              _this.viewNavigation(e);\n\n              _this.updateDraggingDateTime(e);\n            }\n          }\n        }, this.actionObj.navigation.timeDelay);\n      }\n    }\n  };\n\n  DragAndDrop.prototype.updateDraggingDateTime = function (e) {\n    if (!isNullOrUndefined(this.actionObj.clone.offsetParent) && this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n      this.morePopupEventDragging(e);\n    } else if (this.parent.activeView.isTimelineView()) {\n      this.timelineEventModule.dateRender = this.parent.activeView.renderDates;\n      this.timelineEventModule.cellWidth = this.actionObj.cellWidth;\n      this.timelineEventModule.getSlotDates();\n      this.actionObj.cellWidth = this.isHeaderRows ? this.timelineEventModule.cellWidth : this.actionObj.cellWidth;\n      this.calculateTimelineTime(e);\n    } else {\n      if (this.parent.currentView === 'Month') {\n        this.calculateVerticalDate(e);\n      } else {\n        this.calculateVerticalTime(e);\n      }\n    }\n  };\n\n  DragAndDrop.prototype.navigationWrapper = function () {\n    if (!this.parent.activeView.isTimelineView()) {\n      if (this.parent.currentView === 'Month' || !this.parent.timeScale.enable) {\n        var outerWrapperCls = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n        this.actionObj.index = this.parent.activeView.renderDates.length < this.actionObj.index ? this.parent.activeView.renderDates.length - 1 : this.actionObj.index;\n        var targetWrapper = outerWrapperCls[this.actionObj.index].querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n        if (!targetWrapper) {\n          targetWrapper = createElement('div', {\n            className: cls.APPOINTMENT_WRAPPER_CLASS\n          });\n          outerWrapperCls[this.actionObj.index].appendChild(targetWrapper);\n        }\n\n        targetWrapper.appendChild(this.actionObj.clone);\n      } else {\n        var wrapperClass = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) ? '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n        this.parent.element.querySelectorAll(wrapperClass).item(this.actionObj.index).appendChild(this.actionObj.clone);\n\n        if (wrapperClass === '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS) {\n          var elementHeight_1 = this.getAllDayEventHeight();\n          var event_1 = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n\n          if (event_1[0].offsetHeight < elementHeight_1) {\n            event_1.forEach(function (element) {\n              return element.style.height = (elementHeight_1 + 2) / 12 + 'em';\n            });\n          }\n\n          this.actionObj.clone.style.height = formatUnit(elementHeight_1);\n        }\n\n        this.actionObj.height = parseInt(this.actionObj.clone.style.height, 0);\n      }\n    } else {\n      var outWrapper = void 0;\n\n      if (this.parent.activeViewOptions.group.resources.length > 0) {\n        outWrapper = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(this.actionObj.index);\n      } else {\n        outWrapper = this.parent.element.querySelector('.' + cls.APPOINTMENT_CONTAINER_CLASS);\n      }\n\n      var tarWrapper = outWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n      if (!tarWrapper) {\n        tarWrapper = createElement('div', {\n          className: cls.APPOINTMENT_WRAPPER_CLASS\n        });\n        outWrapper.appendChild(tarWrapper);\n      }\n\n      tarWrapper.appendChild(this.actionObj.clone);\n    }\n  };\n\n  DragAndDrop.prototype.viewNavigation = function (e) {\n    var navigationType;\n    var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n\n    if (dragArea && (!this.scrollEdges.top && !this.scrollEdges.bottom || closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS))) {\n      if (dragArea.scrollLeft === 0 && Math.round(this.actionObj.X) <= Math.round(dragArea.getBoundingClientRect().left + this.actionObj.cellWidth + window.pageXOffset)) {\n        navigationType = this.parent.enableRtl ? 'next' : 'previous';\n      } else if (Math.round(dragArea.scrollLeft) + dragArea.clientWidth === dragArea.scrollWidth && Math.round(this.actionObj.X) >= Math.round(dragArea.getBoundingClientRect().right - this.actionObj.cellWidth + window.pageXOffset)) {\n        navigationType = this.parent.enableRtl ? 'previous' : 'next';\n      }\n\n      if (navigationType) {\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate(navigationType));\n      }\n    }\n  };\n\n  DragAndDrop.prototype.morePopupEventDragging = function (e) {\n    if (isNullOrUndefined(e.target) || e.target && isNullOrUndefined(closest(e.target, 'td'))) {\n      return;\n    }\n\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() - eventObj[this.parent.eventFields.startTime].getTime();\n    var td = closest(e.target, 'td');\n    var dragStart = this.parent.getDateFromElement(td);\n    var dragEnd = new Date(dragStart.getTime());\n    dragEnd.setMilliseconds(eventDuration);\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n    }\n\n    this.actionObj.start = new Date(dragStart.getTime());\n    this.actionObj.end = new Date(dragEnd.getTime());\n    this.actionObj.clone.style.top = formatUnit(td.offsetParent.offsetTop);\n    this.actionObj.clone.style.left = formatUnit(td.offsetLeft);\n    this.actionObj.clone.style.width = formatUnit(td.offsetWidth);\n    var eventContainer = td;\n    var eventWrapper;\n\n    if (this.parent.activeView.isTimelineView()) {\n      var rowIndex = closest(td, 'tr').rowIndex;\n      eventContainer = this.parent.element.querySelectorAll('.e-appointment-container').item(rowIndex);\n    }\n\n    eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n    if (!eventWrapper) {\n      eventWrapper = createElement('div', {\n        className: cls.APPOINTMENT_WRAPPER_CLASS\n      });\n      eventContainer.appendChild(eventWrapper);\n    }\n\n    this.appendCloneElement(eventWrapper);\n  };\n\n  DragAndDrop.prototype.calculateVerticalTime = function (e) {\n    if (isNullOrUndefined(this.actionObj.target) || this.actionObj.target && isNullOrUndefined(closest(this.actionObj.target, 'tr')) || !closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS) && !closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      return;\n    }\n\n    if (this.parent.activeViewOptions.timeScale.enable) {\n      this.swapDragging(e);\n    }\n\n    var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventStart = eventObj[this.parent.eventFields.startTime];\n    var eventEnd = eventObj[this.parent.eventFields.endTime];\n    var eventDuration = eventEnd.getTime() - eventStart.getTime();\n    var offsetTop = Math.floor(parseInt(this.actionObj.clone.style.top, 10) / this.actionObj.cellHeight) * this.actionObj.cellHeight;\n    offsetTop = offsetTop < 0 ? 0 : offsetTop;\n\n    if (this.scrollEdges.top || this.scrollEdges.bottom) {\n      offsetTop = this.scrollEdges.top ? dragArea.scrollTop - this.heightUptoCursorPoint + this.actionObj.cellHeight + window.pageYOffset : dragArea.scrollTop + dragArea.offsetHeight - this.actionObj.clone.offsetHeight + window.pageYOffset + (this.actionObj.clone.offsetHeight - this.heightUptoCursorPoint);\n      offsetTop = Math.round(offsetTop / this.actionObj.cellHeight) * this.actionObj.cellHeight;\n      this.actionObj.clone.style.top = formatUnit(offsetTop);\n    }\n\n    var rowIndex = offsetTop / this.actionObj.cellHeight;\n    var heightPerMinute = this.actionObj.cellHeight / this.actionObj.slotInterval;\n    var diffInMinutes = parseInt(this.actionObj.clone.style.top, 10) - offsetTop;\n    var tr;\n\n    if (this.isAllDayDrag) {\n      tr = this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS);\n    } else {\n      var trCollections = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n      tr = trCollections[rowIndex];\n    }\n\n    var index;\n\n    if (closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS) || closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      index = closest(this.actionObj.target, 'td').cellIndex;\n    }\n\n    var colIndex = isNullOrUndefined(index) ? closest(this.actionObj.clone, 'td').cellIndex : index;\n    this.actionObj.index = colIndex;\n\n    if (isNullOrUndefined(tr)) {\n      return;\n    }\n\n    var td = tr.children[colIndex];\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n    }\n\n    var dragStart;\n    var dragEnd;\n\n    if (this.parent.activeViewOptions.timeScale.enable && !this.isAllDayDrag) {\n      this.appendCloneElement(this.getEventWrapper(colIndex));\n      dragStart = this.parent.getDateFromElement(td);\n      dragStart.setMinutes(dragStart.getMinutes() + diffInMinutes / heightPerMinute);\n      dragEnd = new Date(dragStart.getTime());\n\n      if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n        dragEnd.setMinutes(dragEnd.getMinutes() + this.actionObj.slotInterval);\n      } else {\n        dragEnd.setMilliseconds(eventDuration);\n      }\n    } else {\n      dragStart = this.parent.getDateFromElement(td);\n      dragStart.setDate(dragStart.getDate() - this.daysVariation);\n      dragStart.setHours(eventStart.getHours(), eventStart.getMinutes(), eventStart.getSeconds());\n      dragEnd = new Date(dragStart.getTime());\n      dragEnd.setMilliseconds(eventDuration);\n\n      if (!this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) && this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n        dragEnd = util.addDays(util.resetTime(dragEnd), 1);\n      }\n\n      this.updateAllDayEvents(dragStart, dragEnd, this.parent.activeViewOptions.group.byDate ? colIndex : undefined);\n    }\n\n    this.actionObj.start = new Date(+dragStart);\n    this.actionObj.end = new Date(+dragEnd);\n    var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n    this.updateEventHeight(event);\n    this.updateTimePosition(this.actionObj.start);\n  };\n\n  DragAndDrop.prototype.updateEventHeight = function (event) {\n    this.verticalEvent.initializeValues();\n    var datesCount = 0;\n\n    for (var i = 0; i < this.actionObj.groupIndex; i++) {\n      datesCount = datesCount + this.verticalEvent.dateRender[i].length;\n    }\n\n    var dayIndex = !this.parent.activeViewOptions.group.byDate ? this.actionObj.index - datesCount : this.parent.getIndexOfDate(this.verticalEvent.dateRender[this.actionObj.groupIndex], util.resetTime(this.parent.getDateFromElement(this.actionObj.target)));\n    var record = this.verticalEvent.isSpannedEvent(event, dayIndex, this.actionObj.groupIndex);\n    var eStart = record[this.verticalEvent.fields.startTime];\n    var eEnd = record[this.verticalEvent.fields.endTime];\n    var topValue = 0;\n    var appHeight = this.verticalEvent.getHeight(eStart, eEnd);\n    topValue = this.verticalEvent.getTopValue(eStart, dayIndex, this.actionObj.groupIndex);\n    this.actionObj.clone.style.top = formatUnit(topValue);\n    this.actionObj.clone.style.height = formatUnit(appHeight);\n  };\n\n  DragAndDrop.prototype.updateAllDayEvents = function (startDate, endDate, colIndex) {\n    var _this = this;\n\n    this.parent.eventBase.slots = [];\n    var event = this.getUpdatedEvent(startDate, endDate, this.actionObj.event);\n    var renderDates = this.parent.activeView.renderDates;\n    this.parent.eventBase.slots.push(this.parent.activeView.renderDates.map(function (date) {\n      return +date;\n    }));\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.parent.eventBase.slots = [];\n      var resources = this.parent.resourceBase.lastResourceLevel.filter(function (res) {\n        return res.groupIndex === _this.actionObj.groupIndex;\n      });\n      renderDates = resources[0].renderDates;\n      this.parent.eventBase.slots.push(renderDates.map(function (date) {\n        return +date;\n      }));\n    }\n\n    var events = this.parent.eventBase.splitEvent(event, renderDates);\n    var query = '.e-all-day-cells[data-date=\"' + this.parent.getMsFromDate(events[0][this.parent.eventFields.startTime]) + '\"]';\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      query = query.concat('[data-group-index = \"' + this.actionObj.groupIndex + '\"]');\n    }\n\n    var cell = [].slice.call(this.parent.element.querySelectorAll(query));\n\n    if (cell.length > 0 || !isNullOrUndefined(colIndex)) {\n      var cellIndex = !isNullOrUndefined(colIndex) ? colIndex : cell[0].cellIndex;\n      this.appendCloneElement(this.getEventWrapper(cellIndex));\n      this.actionObj.clone.style.width = formatUnit(events[0].data.count * this.actionObj.cellWidth);\n    }\n  };\n\n  DragAndDrop.prototype.swapDragging = function (e) {\n    var colIndex = closest(this.actionObj.target, 'td').cellIndex;\n\n    if (closest(this.actionObj.target, '.' + cls.DATE_HEADER_WRAP_CLASS) && !closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS)) {\n      addClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n      this.appendCloneElement(this.getEventWrapper(colIndex));\n      this.actionObj.isAllDay = true;\n      var eventHeight_1 = this.getAllDayEventHeight();\n      var allDayElement = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n\n      if (allDayElement[0].offsetHeight < eventHeight_1) {\n        allDayElement.forEach(function (element) {\n          return element.style.height = (eventHeight_1 + 2) / 12 + 'em';\n        });\n      }\n\n      setStyleAttribute(this.actionObj.clone, {\n        width: formatUnit(this.actionObj.cellWidth),\n        height: formatUnit(eventHeight_1),\n        top: formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop)\n      });\n    }\n\n    if (closest(this.actionObj.target, '.' + cls.WORK_CELLS_CLASS) && !closest(this.actionObj.clone, '.' + cls.DAY_WRAPPER_CLASS)) {\n      removeClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n      this.appendCloneElement(this.getEventWrapper(colIndex));\n      this.actionObj.isAllDay = false;\n      var height = this.actionObj.element.offsetHeight === 0 ? this.actionObj.height : this.actionObj.element.offsetHeight;\n      setStyleAttribute(this.actionObj.clone, {\n        left: formatUnit(0),\n        height: formatUnit(height),\n        width: formatUnit(this.actionObj.cellWidth)\n      });\n    }\n  };\n\n  DragAndDrop.prototype.calculateVerticalDate = function (e) {\n    if (isNullOrUndefined(e.target) || e.target && isNullOrUndefined(closest(e.target, 'tr')) || e.target && e.target.tagName === 'DIV') {\n      return;\n    }\n\n    this.removeCloneElement();\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() - eventObj[this.parent.eventFields.startTime].getTime();\n    var td = closest(this.actionObj.target, 'td');\n\n    if (!isNullOrUndefined(td)) {\n      var tr = td.parentElement;\n      this.actionObj.index = tr.rowIndex * tr.children.length + td.cellIndex;\n      var workCells = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n      td = workCells[this.actionObj.index];\n      var currentDate = this.parent.getDateFromElement(td);\n\n      if (!isNullOrUndefined(currentDate)) {\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n          this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n        }\n\n        var timeString = new Date(currentDate.setDate(currentDate.getDate() - this.daysVariation));\n        var dragStart = new Date(timeString.getTime());\n        var dragEnd = new Date(dragStart.getTime());\n        var startTimeDiff = eventObj[this.parent.eventFields.startTime].getTime() - util.resetTime(new Date(+eventObj[this.parent.eventFields.startTime])).getTime();\n        dragStart = new Date(dragStart.getTime() + startTimeDiff);\n        dragEnd = new Date(dragStart.getTime() + eventDuration);\n        this.actionObj.start = new Date(dragStart.getTime());\n        this.actionObj.end = new Date(dragEnd.getTime());\n      }\n    }\n\n    var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n    this.dynamicEventsRendering(event);\n  };\n\n  DragAndDrop.prototype.calculateTimelineTime = function (e) {\n    var eventObj = extend({}, this.actionObj.event, null, true);\n    var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() - eventObj[this.parent.eventFields.startTime].getTime();\n    var offsetLeft = this.parent.enableRtl ? Math.abs(this.actionObj.clone.offsetLeft) - this.actionObj.clone.offsetWidth : parseInt(this.actionObj.clone.style.left, 10);\n    offsetLeft = Math.floor(offsetLeft / this.actionObj.cellWidth) * this.actionObj.cellWidth;\n    var rightOffset;\n\n    if (this.parent.enableRtl) {\n      rightOffset = Math.abs(parseInt(this.actionObj.clone.style.right, 10));\n      this.actionObj.clone.style.right = formatUnit(rightOffset);\n    }\n\n    offsetLeft = this.getOffsetValue(offsetLeft, rightOffset);\n    var colIndex = this.getColumnIndex(offsetLeft);\n    var cloneIndex = Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().left) / this.actionObj.cellWidth);\n\n    if (this.parent.enableRtl) {\n      cloneIndex = Math.abs(Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().right) / this.actionObj.cellWidth)) - 1;\n    }\n\n    if (this.cursorPointIndex < 0) {\n      this.cursorIndex(e, eventObj, offsetLeft, cloneIndex);\n    }\n\n    var tr = this.parent.getContentTable().querySelector('tr');\n    var index = this.getCursorCurrentIndex(colIndex, cloneIndex, tr);\n    index = index < 0 ? 0 : index;\n    var eventStart = this.isHeaderRows ? new Date(this.timelineEventModule.dateRender[index].getTime()) : this.parent.getDateFromElement(tr.children[index]);\n\n    if (this.isStepDragging) {\n      var widthDiff = this.getWidthDiff(tr, index);\n\n      if (widthDiff !== 0) {\n        var timeDiff = Math.round(widthDiff / this.widthPerMinute);\n        eventStart.setMinutes(eventStart.getMinutes() + timeDiff * this.actionObj.interval);\n        eventStart.setMinutes(eventStart.getMinutes() - this.minDiff);\n      } else {\n        eventStart = this.actionObj.start;\n      }\n    } else {\n      eventStart.setMinutes(eventStart.getMinutes() - this.cursorPointIndex * (this.isTimelineDayProcess ? MINUTES_PER_DAY : this.actionObj.slotInterval));\n    }\n\n    eventStart = this.calculateIntervalTime(eventStart);\n\n    if (this.isTimelineDayProcess) {\n      var eventSrt = eventObj[this.parent.eventFields.startTime];\n      eventStart.setHours(eventSrt.getHours(), eventSrt.getMinutes(), eventSrt.getSeconds());\n    }\n\n    var eventEnd = new Date(eventStart.getTime());\n    eventEnd.setMilliseconds(eventDuration);\n    var event = this.getUpdatedEvent(eventStart, eventEnd, this.actionObj.event);\n    var events = this.timelineEventModule.splitEvent(event, this.timelineEventModule.dateRender);\n    var eventData = events[0].data;\n    var startTime = this.timelineEventModule.getStartTime(events[0], eventData);\n    var endTime = this.timelineEventModule.getEndTime(events[0], eventData);\n    var width = this.timelineEventModule.getEventWidth(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], eventData.count);\n    var day = this.parent.getIndexOfDate(this.timelineEventModule.dateRender, util.resetTime(new Date(startTime.getTime())));\n    day = day < 0 ? 0 : day;\n    var left = this.timelineEventModule.getPosition(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], day);\n\n    if (this.parent.enableRtl) {\n      this.actionObj.clone.style.right = formatUnit(left);\n    } else {\n      this.actionObj.clone.style.left = formatUnit(left);\n    }\n\n    if (!this.isMorePopupOpened) {\n      this.actionObj.clone.style.width = formatUnit(width);\n    }\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      this.calculateResourceGroupingPosition(e);\n    }\n\n    this.actionObj.start = new Date(eventStart.getTime());\n    this.actionObj.end = new Date(eventEnd.getTime());\n    this.updateTimePosition(this.actionObj.start);\n  };\n\n  DragAndDrop.prototype.getOffsetValue = function (offsetLeft, rightOffset) {\n    if (this.scrollEdges.left || this.scrollEdges.right) {\n      var viewEle = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n\n      if (this.parent.enableRtl) {\n        rightOffset = viewEle.offsetWidth - viewEle.scrollLeft;\n\n        if (this.scrollEdges.right) {\n          rightOffset = rightOffset - viewEle.offsetWidth + this.actionObj.clone.offsetWidth - (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n        } else {\n          rightOffset = rightOffset + this.widthUptoCursorPoint;\n\n          if (rightOffset - this.widthUptoCursorPoint >= viewEle.scrollWidth) {\n            this.actionObj.clone.style.width = formatUnit(this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint + this.actionObj.cellWidth);\n            rightOffset = viewEle.scrollLeft - viewEle.scrollWidth;\n          }\n        }\n\n        this.actionObj.clone.style.left = formatUnit(rightOffset);\n      } else {\n        if (this.scrollEdges.left) {\n          offsetLeft = viewEle.scrollLeft - this.widthUptoCursorPoint + this.actionObj.cellWidth;\n\n          if (viewEle.scrollLeft + viewEle.offsetWidth >= viewEle.offsetWidth) {\n            viewEle.scrollLeft = viewEle.scrollLeft - 1;\n          } else if (this.actionObj.clone.offsetLeft === 0) {\n            offsetLeft = viewEle.scrollLeft;\n          }\n        } else {\n          offsetLeft = viewEle.scrollLeft + viewEle.offsetWidth - this.actionObj.clone.offsetWidth + (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n        }\n\n        offsetLeft = offsetLeft < 0 ? 0 : offsetLeft;\n        this.actionObj.clone.style.left = formatUnit(offsetLeft);\n      }\n    }\n\n    return offsetLeft;\n  };\n\n  DragAndDrop.prototype.getWidthDiff = function (tr, index) {\n    var pages = this.scrollArgs.element.getBoundingClientRect();\n\n    if (pages.left <= this.actionObj.pageX && pages.right >= this.actionObj.pageX) {\n      var targetLeft = tr.children[index].offsetLeft;\n      var pageX = this.actionObj.pageX - pages.left;\n\n      if (this.parent.enableRtl) {\n        return targetLeft + this.actionObj.cellWidth - (this.scrollArgs.element.scrollLeft + pageX);\n      } else {\n        return this.scrollArgs.element.scrollLeft + pageX - targetLeft;\n      }\n    }\n\n    return 0;\n  };\n\n  DragAndDrop.prototype.getColumnIndex = function (offsetLeft) {\n    var index = Math.floor(offsetLeft / this.actionObj.cellWidth);\n\n    if (this.isHeaderRows) {\n      return index;\n    }\n\n    return this.getIndex(index);\n  };\n\n  DragAndDrop.prototype.getCursorCurrentIndex = function (colIndex, cloneIndex, tr) {\n    var index = colIndex + cloneIndex;\n\n    if (this.isHeaderRows) {\n      var dateLength = Math.floor(tr.offsetWidth / this.actionObj.cellWidth);\n      return index > dateLength - 1 ? dateLength - 1 : index;\n    }\n\n    return index > tr.children.length - 1 ? tr.children.length - 1 : index;\n  };\n\n  DragAndDrop.prototype.cursorIndex = function (e, event, left, index) {\n    var td = closest(e.target, '.e-work-cells');\n\n    if (!isNullOrUndefined(td) && !this.isMorePopupOpened) {\n      var targetDate = this.parent.getDateFromElement(td);\n\n      if (this.isHeaderRows) {\n        var currentIndex = Math.floor(left / this.actionObj.cellWidth);\n        targetDate = new Date(this.timelineEventModule.dateRender[currentIndex + index].getTime());\n      }\n\n      var timeDiff = targetDate.getTime() - event[this.parent.eventFields.startTime].getTime();\n\n      if (this.isTimelineDayProcess) {\n        this.cursorPointIndex = Math.abs(Math.ceil(timeDiff / util.MS_PER_DAY));\n      } else {\n        var widthDiff = Math.floor(timeDiff / util.MS_PER_MINUTE / (this.actionObj.slotInterval / this.actionObj.cellWidth));\n        this.cursorPointIndex = Math.floor(widthDiff / this.actionObj.cellWidth);\n        this.cursorPointIndex = this.cursorPointIndex < 0 ? 0 : this.cursorPointIndex;\n      }\n    } else {\n      this.cursorPointIndex = 0;\n    }\n  };\n\n  DragAndDrop.prototype.calculateResourceGroupingPosition = function (e) {\n    var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var trCollection = [].slice.call(this.parent.element.querySelectorAll('.e-content-wrap .e-content-table tr:not(.e-hidden)'));\n    var translateY = util.getTranslateY(dragArea.querySelector('table'));\n    translateY = isNullOrUndefined(translateY) ? 0 : translateY;\n    var rowHeight = this.parent.rowAutoHeight ? ~~(dragArea.querySelector('table').offsetHeight / trCollection.length) : this.actionObj.cellHeight;\n    var rowIndex = Math.floor(Math.floor(this.actionObj.Y + (dragArea.scrollTop - translateY - window.scrollY) - dragArea.getBoundingClientRect().top) / rowHeight);\n    rowIndex = rowIndex < 0 ? 0 : rowIndex > trCollection.length - 1 ? trCollection.length - 1 : rowIndex;\n    this.actionObj.index = rowIndex;\n    var eventContainer = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(rowIndex);\n    var eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n    if (!eventWrapper) {\n      eventWrapper = createElement('div', {\n        className: cls.APPOINTMENT_WRAPPER_CLASS\n      });\n      eventContainer.appendChild(eventWrapper);\n    }\n\n    this.appendCloneElement(eventWrapper);\n    var td = closest(e.target, 'td');\n    this.actionObj.groupIndex = td && !isNaN(parseInt(td.getAttribute('data-group-index'), 10)) ? parseInt(td.getAttribute('data-group-index'), 10) : this.actionObj.groupIndex;\n    var top = trCollection[rowIndex].offsetTop;\n\n    if (this.parent.rowAutoHeight) {\n      var cursorElement = this.getCursorElement(e);\n\n      if (cursorElement) {\n        top = cursorElement.classList.contains(cls.WORK_CELLS_CLASS) ? cursorElement.offsetTop : cursorElement.offsetParent.classList.contains(cls.APPOINTMENT_CLASS) ? cursorElement.offsetParent.offsetTop : top;\n      }\n    }\n\n    this.actionObj.clone.style.top = formatUnit(top);\n  };\n\n  DragAndDrop.prototype.appendCloneElement = function (element) {\n    if (this.parent.eventDragArea) {\n      document.querySelector(this.parent.eventDragArea).appendChild(this.actionObj.clone);\n    } else {\n      element.appendChild(this.actionObj.clone);\n    }\n  };\n\n  DragAndDrop.prototype.getEventWrapper = function (index) {\n    var eventWrapper;\n    var isAllDayDrag = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS);\n\n    if (this.parent.activeViewOptions.timeScale.enable) {\n      var wrapperClass = isAllDayDrag ? '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n      eventWrapper = this.parent.element.querySelectorAll(wrapperClass).item(index);\n    } else {\n      var targetWrapper = this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS).item(index);\n      eventWrapper = targetWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n      if (!eventWrapper) {\n        eventWrapper = createElement('div', {\n          className: cls.APPOINTMENT_WRAPPER_CLASS\n        });\n        targetWrapper.appendChild(eventWrapper);\n      }\n    }\n\n    return eventWrapper;\n  };\n\n  DragAndDrop.prototype.getAllDayEventHeight = function () {\n    var eventWrapper = createElement('div', {\n      className: cls.APPOINTMENT_CLASS\n    });\n    this.parent.element.querySelector('.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS).appendChild(eventWrapper);\n    var eventHeight = eventWrapper.offsetHeight;\n    remove(eventWrapper);\n    return eventHeight;\n  };\n\n  DragAndDrop.prototype.isAllowDrop = function (e) {\n    if (!this.actionObj.excludeSelectors) {\n      return false;\n    }\n\n    var dropSelectors = this.actionObj.excludeSelectors.split(',');\n    var isAllowDrop = false;\n\n    for (var _i = 0, dropSelectors_1 = dropSelectors; _i < dropSelectors_1.length; _i++) {\n      var selector = dropSelectors_1[_i];\n\n      if (e.target.classList.contains(selector)) {\n        isAllowDrop = true;\n        break;\n      }\n    }\n\n    return isAllowDrop;\n  };\n  /**\n   * Get module name.\n   */\n\n\n  DragAndDrop.prototype.getModuleName = function () {\n    return 'dragAndDrop';\n  };\n\n  return DragAndDrop;\n}(ActionBase);\n\nexport { DragAndDrop };","map":{"version":3,"sources":["/Users/jay/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/drag.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","createElement","closest","Draggable","extend","formatUnit","isNullOrUndefined","addClass","remove","removeClass","setStyleAttribute","isBlazor","getElement","ActionBase","events","util","cls","MonthEvent","TimelineEvent","VerticalEvent","MINUTES_PER_DAY","DragAndDrop","_super","_this","apply","arguments","widthUptoCursorPoint","heightUptoCursorPoint","cursorPointIndex","isHeaderRows","isTimelineDayProcess","widthPerMinute","heightPerMinute","minDiff","isStepDragging","isMorePopupOpened","isAllDayDrag","wireDragEvent","element","abort","EVENT_RESIZE_CLASS","clone","isDragScroll","enableTapHold","parent","isAdaptive","enableTailMode","eventDragArea","cursorAt","left","top","dragArea","document","querySelector","CONTENT_TABLE_CLASS","dragStart","bind","drag","dragStop","enableAutoScroll","helper","dragHelper","queryPositionInfo","dragPosition","e","setDragActionDefaultValues","actionObj","action","createCloneElement","currentView","timeScale","enable","activeView","isTimelineView","classList","contains","ALLDAY_APPOINTMENT_CLASS","cursor","right","width","style","offsetTop","cloneElement","originalElement","cellHeight","slotInterval","interval","leftValue","offsetLeft","topValue","offsetParent","MORE_EVENT_POPUP_CLASS","ALLDAY_ROW_CLASS","Math","ceil","offsetWidth","cellWidth","enableRtl","height","pointerEvents","top_1","parseInt","scrollHeight","cloneBottom","offsetHeight","isAllDay","activeViewOptions","slotCount","workCell","WORK_CELLS_CLASS","eventGuid","getAttribute","event","eventBase","getEventByGuid","eventObj","dragArgs","cancel","data","excludeSelectors","navigation","timeDelay","scroll","scrollBy","trigger","dragEventArgs","parentElement","removeCloneElementClasses","removeCloneElement","bindEvents","dragElement","eventFields","startTime","getDateTime","endTime","actionClass","uiStateValues","start","end","groupIndex","viewElement","CONTENT_WRAP_CLASS","scrollArgs","scrollWidth","daysVariation","rows","headerRows","length","option","timelineEventModule","updateOriginalElement","monthEvent","verticalEvent","quickPopup","quickPopupHide","target","DISABLE_DATES","eventArgs","getPageCoordinates","Y","pageY","X","pageX","abs","getBoundingClientRect","calculateMinutesDiff","date","getDateFromElement","currentDate","resetTime","startDate","Date","getTime","MS_PER_DAY","targetElement","currentTarget","ROOT","updateScrollPosition","updateNavigatingPosition","updateDraggingDateTime","group","resources","renderDates","startEndHours","getStartEndHours","getStartHour","getEndHour","startHour","MS_PER_MINUTE","clearInterval","navigationInterval","scrollInterval","isAllowDrop","getChangedData","saveChangedData","currentDate_1","getCurrentTime","window","setInterval","crtDate","getSeconds","viewNavigation","morePopupEventDragging","dateRender","getSlotDates","calculateTimelineTime","calculateVerticalDate","calculateVerticalTime","navigationWrapper","outerWrapperCls","slice","call","querySelectorAll","index","targetWrapper","APPOINTMENT_WRAPPER_CLASS","className","appendChild","wrapperClass","ALLDAY_APPOINTMENT_WRAPPER_CLASS","item","elementHeight_1","getAllDayEventHeight","event_1","ALLDAY_CELLS_CLASS","forEach","outWrapper","APPOINTMENT_CONTAINER_CLASS","tarWrapper","navigationType","scrollEdges","bottom","scrollLeft","round","pageXOffset","clientWidth","changeDate","getNextPreviousDate","eventDuration","td","dragEnd","setMilliseconds","eventContainer","eventWrapper","rowIndex","appendCloneElement","swapDragging","eventStart","eventEnd","floor","scrollTop","pageYOffset","diffInMinutes","tr","trCollections","getContentTable","cellIndex","colIndex","children","getEventWrapper","setMinutes","getMinutes","setDate","getDate","setHours","getHours","addDays","updateAllDayEvents","byDate","undefined","getUpdatedEvent","updateEventHeight","updateTimePosition","initializeValues","datesCount","i","dayIndex","getIndexOfDate","record","isSpannedEvent","eStart","fields","eEnd","appHeight","getHeight","getTopValue","endDate","slots","push","map","resourceBase","lastResourceLevel","filter","res","splitEvent","query","getMsFromDate","concat","cell","count","DATE_HEADER_WRAP_CLASS","eventHeight_1","allDayElement","DAY_WRAPPER_CLASS","tagName","workCells","timeString","startTimeDiff","dynamicEventsRendering","rightOffset","getOffsetValue","getColumnIndex","cloneIndex","cursorIndex","getCursorCurrentIndex","widthDiff","getWidthDiff","timeDiff","calculateIntervalTime","eventSrt","eventData","getStartTime","getEndTime","getEventWidth","day","getPosition","calculateResourceGroupingPosition","viewEle","pages","targetLeft","getIndex","dateLength","targetDate","currentIndex","trCollection","translateY","getTranslateY","rowHeight","rowAutoHeight","scrollY","isNaN","cursorElement","getCursorElement","APPOINTMENT_CLASS","eventHeight","dropSelectors","split","_i","dropSelectors_1","selector","getModuleName"],"mappings":"AAAA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,aAAa,GAAG,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,aAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIA,CAAC,CAACM,cAAF,CAAiBD,CAAjB,CAAJ,EAAyBN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAF9E;;AAGA,WAAOP,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnBF,IAAAA,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASO,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBT,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACU,SAAF,GAAcT,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACS,MAAP,CAAcV,CAAd,CAAb,IAAiCO,EAAE,CAACE,SAAH,GAAeT,CAAC,CAACS,SAAjB,EAA4B,IAAIF,EAAJ,EAA7D,CAAd;AACH,GAJD;AAKH,CAZ2C,EAA5C;;AAaA,SAASI,aAAT,EAAwBC,OAAxB,EAAiCC,SAAjC,EAA4CC,MAA5C,EAAoDC,UAApD,EAAgEC,iBAAhE,QAAyF,sBAAzF;AACA,SAASC,QAAT,EAAmBC,MAAnB,EAA2BC,WAA3B,EAAwCC,iBAAxC,EAA2DC,QAA3D,EAAqEC,UAArE,QAAuF,sBAAvF;AACA,SAASC,UAAT,QAA2B,wBAA3B;AACA,OAAO,KAAKC,MAAZ,MAAwB,kBAAxB;AACA,OAAO,KAAKC,IAAZ,MAAsB,cAAtB;AACA,OAAO,KAAKC,GAAZ,MAAqB,sBAArB;AACA,SAASC,UAAT,QAA2B,yBAA3B;AACA,SAASC,aAAT,QAA8B,iCAA9B;AACA,SAASC,aAAT,QAA8B,iCAA9B;AACA,IAAIC,eAAe,GAAG,IAAtB;AACA;;;;AAGA,IAAIC,WAAW;AAAG;AAAe,UAAUC,MAAV,EAAkB;AAC/CnC,EAAAA,SAAS,CAACkC,WAAD,EAAcC,MAAd,CAAT;;AACA,WAASD,WAAT,GAAuB;AACnB,QAAIE,KAAK,GAAGD,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACE,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAnB,IAAoD,IAAhE;;AACAF,IAAAA,KAAK,CAACG,oBAAN,GAA6B,CAA7B;AACAH,IAAAA,KAAK,CAACI,qBAAN,GAA8B,CAA9B;AACAJ,IAAAA,KAAK,CAACK,gBAAN,GAAyB,CAAzB;AACAL,IAAAA,KAAK,CAACM,YAAN,GAAqB,KAArB;AACAN,IAAAA,KAAK,CAACO,oBAAN,GAA6B,KAA7B;AACAP,IAAAA,KAAK,CAACQ,cAAN,GAAuB,CAAvB;AACAR,IAAAA,KAAK,CAACS,eAAN,GAAwB,CAAxB;AACAT,IAAAA,KAAK,CAACU,OAAN,GAAgB,CAAhB;AACAV,IAAAA,KAAK,CAACW,cAAN,GAAuB,KAAvB;AACAX,IAAAA,KAAK,CAACY,iBAAN,GAA0B,KAA1B;AACAZ,IAAAA,KAAK,CAACa,YAAN,GAAqB,KAArB;AACA,WAAOb,KAAP;AACH;;AACDF,EAAAA,WAAW,CAACtB,SAAZ,CAAsBsC,aAAtB,GAAsC,UAAUC,OAAV,EAAmB;AACrD,QAAInC,SAAJ,CAAcmC,OAAd,EAAuB;AACnBC,MAAAA,KAAK,EAAE,MAAMvB,GAAG,CAACwB,kBADE;AAEnBC,MAAAA,KAAK,EAAE,IAFY;AAGnBC,MAAAA,YAAY,EAAE,IAHK;AAInBC,MAAAA,aAAa,EAAE,KAAKC,MAAL,CAAYC,UAJR;AAKnBC,MAAAA,cAAc,EAAG,KAAKF,MAAL,CAAYG,aAAb,GAA8B,IAA9B,GAAqC,KALlC;AAMnBC,MAAAA,QAAQ,EAAG,KAAKJ,MAAL,CAAYG,aAAb,GAA8B;AAAEE,QAAAA,IAAI,EAAE,CAAC,EAAT;AAAaC,QAAAA,GAAG,EAAE,CAAC;AAAnB,OAA9B,GAAwD;AAAED,QAAAA,IAAI,EAAE,CAAR;AAAWC,QAAAA,GAAG,EAAE;AAAhB,OAN/C;AAOnBC,MAAAA,QAAQ,EAAG,KAAKP,MAAL,CAAYG,aAAb,GACNK,QAAQ,CAACC,aAAT,CAAuB,KAAKT,MAAL,CAAYG,aAAnC,CADM,GAEN,KAAKH,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAACsC,mBAA5C,CATe;AAUnBC,MAAAA,SAAS,EAAE,KAAKA,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAVQ;AAWnBC,MAAAA,IAAI,EAAE,KAAKA,IAAL,CAAUD,IAAV,CAAe,IAAf,CAXa;AAYnBE,MAAAA,QAAQ,EAAE,KAAKA,QAAL,CAAcF,IAAd,CAAmB,IAAnB,CAZS;AAanBG,MAAAA,gBAAgB,EAAE,KAbC;AAcnBC,MAAAA,MAAM,EAAE,KAAKC,UAAL,CAAgBL,IAAhB,CAAqB,IAArB,CAdW;AAenBM,MAAAA,iBAAiB,EAAE,KAAKC,YAAL,CAAkBP,IAAlB,CAAuB,IAAvB;AAfA,KAAvB;AAiBH,GAlBD;;AAmBAnC,EAAAA,WAAW,CAACtB,SAAZ,CAAsB8D,UAAtB,GAAmC,UAAUG,CAAV,EAAa;AAC5C,SAAKC,0BAAL;AACA,SAAKC,SAAL,CAAe5B,OAAf,GAAyB0B,CAAC,CAAC1B,OAA3B;AACA,SAAK4B,SAAL,CAAeC,MAAf,GAAwB,MAAxB;AACA,SAAKD,SAAL,CAAezB,KAAf,GAAuB,KAAK2B,kBAAL,CAAwB,KAAKF,SAAL,CAAe5B,OAAvC,CAAvB;;AACA,QAAI,CAAC,KAAKM,MAAL,CAAYG,aAAb,IAA8B,KAAKH,MAAL,CAAYyB,WAAZ,KAA4B,OAA1D,IACA,KAAKzB,MAAL,CAAY0B,SAAZ,CAAsBC,MADtB,IACgC,CAAC,KAAK3B,MAAL,CAAY4B,UAAZ,CAAuBC,cAAvB,EADjC,IAEA,CAAC,KAAKP,SAAL,CAAe5B,OAAf,CAAuBoC,SAAvB,CAAiCC,QAAjC,CAA0C3D,GAAG,CAAC4D,wBAA9C,CAFL,EAE8E;AAC1ElE,MAAAA,iBAAiB,CAAC,KAAKwD,SAAL,CAAezB,KAAhB,EAAuB;AAAEoC,QAAAA,MAAM,EAAE,MAAV;AAAkB5B,QAAAA,IAAI,EAAE,IAAxB;AAA8B6B,QAAAA,KAAK,EAAE,IAArC;AAA2CC,QAAAA,KAAK,EAAE;AAAlD,OAAvB,CAAjB;AACH;;AACD,SAAKb,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B9B,GAA3B,GAAiC7C,UAAU,CAAC,KAAK6D,SAAL,CAAe5B,OAAf,CAAuB2C,SAAxB,CAA3C;AACA,SAAKf,SAAL,CAAegB,YAAf,GAA8B,CAAC,KAAKhB,SAAL,CAAezB,KAAhB,CAA9B;AACA,SAAKyB,SAAL,CAAeiB,eAAf,GAAiC,CAAC,KAAKjB,SAAL,CAAe5B,OAAhB,CAAjC;AACA,WAAO,KAAK4B,SAAL,CAAezB,KAAtB;AACH,GAdD;;AAeApB,EAAAA,WAAW,CAACtB,SAAZ,CAAsBgE,YAAtB,GAAqC,UAAUC,CAAV,EAAa;AAC9C,QAAI,KAAKpB,MAAL,CAAYG,aAAhB,EAA+B;AAC3B,aAAO;AAAEE,QAAAA,IAAI,EAAEe,CAAC,CAACf,IAAV;AAAgBC,QAAAA,GAAG,EAAEc,CAAC,CAACd;AAAvB,OAAP;AACH;;AACD,QAAIkC,UAAU,GAAI,KAAKlB,SAAL,CAAekB,UAAf,GAA4B,KAAKlB,SAAL,CAAemB,YAA5C,GAA4D,KAAKnB,SAAL,CAAeoB,QAA5F;AACA,QAAIC,SAAS,GAAGlF,UAAU,CAAC,CAAD,CAA1B;;AACA,QAAI,KAAKuC,MAAL,CAAYyB,WAAZ,KAA4B,OAAhC,EAAyC;AACrCkB,MAAAA,SAAS,GAAGvB,CAAC,CAACf,IAAd;AACH;;AACD,QAAI,KAAKL,MAAL,CAAY4B,UAAZ,CAAuBC,cAAvB,EAAJ,EAA6C;AACzCc,MAAAA,SAAS,GAAGlF,UAAU,CAAC,KAAK6D,SAAL,CAAezB,KAAf,CAAqB+C,UAAtB,CAAtB;AACH;;AACD,QAAIC,QAAJ;;AACA,QAAK,KAAK7C,MAAL,CAAY4B,UAAZ,CAAuBC,cAAvB,MAA2C,CAAC,KAAK7B,MAAL,CAAY0B,SAAZ,CAAsBC,MAAlE,IACA,CAACjE,iBAAiB,CAAC,KAAK4D,SAAL,CAAezB,KAAf,CAAqBiD,YAAtB,CAAlB,IACG,KAAKxB,SAAL,CAAezB,KAAf,CAAqBiD,YAArB,CAAkChB,SAAlC,CAA4CC,QAA5C,CAAqD3D,GAAG,CAAC2E,sBAAzD,CAFR,EAE4F;AACxFF,MAAAA,QAAQ,GAAGpF,UAAU,CAAC,KAAK6D,SAAL,CAAezB,KAAf,CAAqBwC,SAAtB,CAArB;AACH,KAJD,MAKK,IAAI,KAAKrC,MAAL,CAAYyB,WAAZ,KAA4B,OAAhC,EAAyC;AAC1CoB,MAAAA,QAAQ,GAAGpF,UAAU,CAAC,CAAD,CAArB;AACH,KAFI,MAGA,IAAI,KAAK6D,SAAL,CAAezB,KAAf,CAAqBiC,SAArB,CAA+BC,QAA/B,CAAwC3D,GAAG,CAAC4D,wBAA5C,CAAJ,EAA2E;AAC5Ea,MAAAA,QAAQ,GAAGpF,UAAU,CAAC,KAAKuC,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAAC4E,gBAA5C,EAA8DX,SAA/D,CAArB;AACAvE,MAAAA,iBAAiB,CAAC,KAAKwD,SAAL,CAAezB,KAAhB,EAAuB;AACpCsC,QAAAA,KAAK,EAAE1E,UAAU,CAACwF,IAAI,CAACC,IAAL,CAAU,KAAK5B,SAAL,CAAezB,KAAf,CAAqBsD,WAArB,GAAmC,KAAK7B,SAAL,CAAe8B,SAA5D,IAAyE,KAAK9B,SAAL,CAAe8B,SAAzF,CADmB;AAEpClB,QAAAA,KAAK,EAAE,KAAKlC,MAAL,CAAYqD,SAAZ,IAAyB5F,UAAU,CAAC,CAAD;AAFN,OAAvB,CAAjB;AAIH,KANI,MAOA;AACD,UAAI,KAAK6D,SAAL,CAAe5B,OAAf,CAAuBoC,SAAvB,CAAiCC,QAAjC,CAA0C3D,GAAG,CAAC4D,wBAA9C,KACA,CAAC,KAAKV,SAAL,CAAezB,KAAf,CAAqBiC,SAArB,CAA+BC,QAA/B,CAAwC3D,GAAG,CAAC4D,wBAA5C,CADL,EAC4E;AACxElE,QAAAA,iBAAiB,CAAC,KAAKwD,SAAL,CAAezB,KAAhB,EAAuB;AACpCyD,UAAAA,MAAM,EAAE7F,UAAU,CAAC,KAAK6D,SAAL,CAAekB,UAAhB,CADkB;AAEpCL,UAAAA,KAAK,EAAE1E,UAAU,CAAC,KAAK6D,SAAL,CAAe8B,SAAf,GAA2B,CAA5B,CAFmB;AAGpCG,UAAAA,aAAa,EAAE;AAHqB,SAAvB,CAAjB;AAKH;;AACD,UAAIC,KAAK,GAAGC,QAAQ,CAACrC,CAAC,CAACd,GAAH,EAAQ,EAAR,CAApB;AACAkD,MAAAA,KAAK,GAAGA,KAAK,GAAG,CAAR,GAAY,CAAZ,GAAgBA,KAAxB;AACAX,MAAAA,QAAQ,GAAGpF,UAAU,CAACwF,IAAI,CAACC,IAAL,CAAUM,KAAK,GAAGhB,UAAlB,IAAgCA,UAAjC,CAArB;AACA,UAAIkB,YAAY,GAAG,KAAK1D,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,iBAAlC,EAAqDiD,YAAxE;AACA,UAAIC,WAAW,GAAGF,QAAQ,CAACZ,QAAD,EAAW,EAAX,CAAR,GAAyB,KAAKvB,SAAL,CAAezB,KAAf,CAAqB+D,YAAhE;;AACA,UAAID,WAAW,GAAGD,YAAlB,EAAgC;AAC5Bb,QAAAA,QAAQ,GAAIY,QAAQ,CAACZ,QAAD,EAAW,EAAX,CAAR,IAA0Bc,WAAW,GAAGD,YAAxC,CAAD,GAA0D,IAArE;AACH;AACJ;;AACD,WAAO;AAAErD,MAAAA,IAAI,EAAEsC,SAAR;AAAmBrC,MAAAA,GAAG,EAAEuC;AAAxB,KAAP;AACH,GA/CD;;AAgDApE,EAAAA,WAAW,CAACtB,SAAZ,CAAsBkE,0BAAtB,GAAmD,YAAY;AAC3D,SAAKC,SAAL,CAAeC,MAAf,GAAwB,MAAxB;AACA,SAAKD,SAAL,CAAeuC,QAAf,GAA0B,IAA1B;AACA,SAAKvC,SAAL,CAAemB,YAAf,GAA8B,KAAKzC,MAAL,CAAY8D,iBAAZ,CAA8BpC,SAA9B,CAAwCgB,QAAxC,GAAmD,KAAK1C,MAAL,CAAY8D,iBAAZ,CAA8BpC,SAA9B,CAAwCqC,SAAzH;AACA,SAAKzC,SAAL,CAAeoB,QAAf,GAA0B,KAAKpB,SAAL,CAAemB,YAAzC;AACA,QAAIuB,QAAQ,GAAG,KAAKhE,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAAC6F,gBAA5C,CAAf;AACA,SAAK3C,SAAL,CAAe8B,SAAf,GAA2BY,QAAQ,CAACb,WAApC;AACA,SAAK7B,SAAL,CAAekB,UAAf,GAA4BwB,QAAQ,CAACJ,YAArC;AACH,GARD;;AASAnF,EAAAA,WAAW,CAACtB,SAAZ,CAAsBwD,SAAtB,GAAkC,UAAUS,CAAV,EAAa;AAC3C,QAAIzC,KAAK,GAAG,IAAZ;;AACA,QAAIuF,SAAS,GAAG,KAAK5C,SAAL,CAAe5B,OAAf,CAAuByE,YAAvB,CAAoC,WAApC,CAAhB;AACA,SAAK7C,SAAL,CAAe8C,KAAf,GAAuB,KAAKpE,MAAL,CAAYqE,SAAZ,CAAsBC,cAAtB,CAAqCJ,SAArC,CAAvB;AACA,QAAIK,QAAQ,GAAG/G,MAAM,CAAC,EAAD,EAAK,KAAK8D,SAAL,CAAe8C,KAApB,EAA2B,IAA3B,EAAiC,IAAjC,CAArB;AACA,QAAII,QAAQ,GAAG;AACXC,MAAAA,MAAM,EAAE,KADG;AAEXC,MAAAA,IAAI,EAAEH,QAFK;AAGXH,MAAAA,KAAK,EAAEhD,CAHI;AAIXuD,MAAAA,gBAAgB,EAAE,IAJP;AAKXjF,MAAAA,OAAO,EAAE,KAAK4B,SAAL,CAAe5B,OALb;AAMXgD,MAAAA,QAAQ,EAAE,KAAKpB,SAAL,CAAeoB,QANd;AAOXkC,MAAAA,UAAU,EAAE;AAAEjD,QAAAA,MAAM,EAAE,KAAV;AAAiBkD,QAAAA,SAAS,EAAE;AAA5B,OAPD;AAQXC,MAAAA,MAAM,EAAE;AAAEnD,QAAAA,MAAM,EAAE,IAAV;AAAgBoD,QAAAA,QAAQ,EAAE,EAA1B;AAA8BF,QAAAA,SAAS,EAAE;AAAzC;AARG,KAAf;AAUA,SAAK7E,MAAL,CAAYgF,OAAZ,CAAoB9G,MAAM,CAACyC,SAA3B,EAAsC6D,QAAtC,EAAgD,UAAUS,aAAV,EAAyB;AACrE,UAAIA,aAAa,CAACR,MAAd,IAAyB,CAAC/G,iBAAiB,CAACiB,KAAK,CAAC2C,SAAN,CAAgB5B,OAAjB,CAAlB,IACzBhC,iBAAiB,CAACiB,KAAK,CAAC2C,SAAN,CAAgB5B,OAAhB,CAAwBwF,aAAzB,CADrB,EAC+D;AAC3DvG,QAAAA,KAAK,CAAC2C,SAAN,CAAgBC,MAAhB,GAAyB,EAAzB;;AACA5C,QAAAA,KAAK,CAACwG,yBAAN;;AACAxG,QAAAA,KAAK,CAACyG,kBAAN;;AACA;AACH,OAND,MAOK,IAAIrH,QAAQ,EAAZ,EAAgB;AACjBqD,QAAAA,CAAC,CAACiE,UAAF,CAAajE,CAAC,CAACkE,WAAf;;AACA,YAAIL,aAAa,CAACvF,OAAlB,EAA2B;AACvBuF,UAAAA,aAAa,CAACvF,OAAd,GAAwB1B,UAAU,CAACiH,aAAa,CAACvF,OAAf,CAAlC;AACH;;AACDuF,QAAAA,aAAa,CAACP,IAAd,CAAmB/F,KAAK,CAACqB,MAAN,CAAauF,WAAb,CAAyBC,SAA5C,IAAyD7G,KAAK,CAACqB,MAAN,CAAayF,WAAb,CAAyBR,aAAa,CAACP,IAAd,CAAmB/F,KAAK,CAACqB,MAAN,CAAauF,WAAb,CAAyBC,SAA5C,CAAzB,CAAzD;AACAP,QAAAA,aAAa,CAACP,IAAd,CAAmB/F,KAAK,CAACqB,MAAN,CAAauF,WAAb,CAAyBG,OAA5C,IAAuD/G,KAAK,CAACqB,MAAN,CAAayF,WAAb,CAAyBR,aAAa,CAACP,IAAd,CAAmB/F,KAAK,CAACqB,MAAN,CAAauF,WAAb,CAAyBG,OAA5C,CAAzB,CAAvD;AACH;;AACD/G,MAAAA,KAAK,CAACgH,WAAN,CAAkB,UAAlB;;AACAhH,MAAAA,KAAK,CAACqB,MAAN,CAAa4F,aAAb,CAA2BrE,MAA3B,GAAoC,IAApC;AACA5C,MAAAA,KAAK,CAAC2C,SAAN,CAAgBuE,KAAhB,GAAwBtB,QAAQ,CAAC5F,KAAK,CAACqB,MAAN,CAAauF,WAAb,CAAyBC,SAA1B,CAAhC;AACA7G,MAAAA,KAAK,CAAC2C,SAAN,CAAgBwE,GAAhB,GAAsBvB,QAAQ,CAAC5F,KAAK,CAACqB,MAAN,CAAauF,WAAb,CAAyBG,OAA1B,CAA9B;AACA/G,MAAAA,KAAK,CAAC2C,SAAN,CAAgByE,UAAhB,GAA6BtC,QAAQ,CAAC9E,KAAK,CAAC2C,SAAN,CAAgB5B,OAAhB,CAAwByE,YAAxB,CAAqC,kBAArC,KAA4D,GAA7D,EAAkE,EAAlE,CAArC;AACAxF,MAAAA,KAAK,CAAC2C,SAAN,CAAgBoB,QAAhB,GAA2BuC,aAAa,CAACvC,QAAzC;AACA/D,MAAAA,KAAK,CAAC2C,SAAN,CAAgBsD,UAAhB,GAA6BK,aAAa,CAACL,UAA3C;AACAjG,MAAAA,KAAK,CAAC2C,SAAN,CAAgBwD,MAAhB,GAAyBG,aAAa,CAACH,MAAvC;AACAnG,MAAAA,KAAK,CAAC2C,SAAN,CAAgBqD,gBAAhB,GAAmCM,aAAa,CAACN,gBAAjD;;AACA,UAAIqB,WAAW,GAAGrH,KAAK,CAACqB,MAAN,CAAaN,OAAb,CAAqBe,aAArB,CAAmC,MAAMrC,GAAG,CAAC6H,kBAA7C,CAAlB;;AACAtH,MAAAA,KAAK,CAACuH,UAAN,GAAmB;AAAExG,QAAAA,OAAO,EAAEsG,WAAX;AAAwB7D,QAAAA,KAAK,EAAE6D,WAAW,CAACG,WAA3C;AAAwD7C,QAAAA,MAAM,EAAE0C,WAAW,CAACtC;AAA5E,OAAnB;AACA/E,MAAAA,KAAK,CAACQ,cAAN,GAAwBR,KAAK,CAAC2C,SAAN,CAAgB8B,SAAhB,GAA4BzE,KAAK,CAAC2C,SAAN,CAAgBmB,YAA7C,GAA6D9D,KAAK,CAAC2C,SAAN,CAAgBoB,QAApG;AACA/D,MAAAA,KAAK,CAACS,eAAN,GAAyBT,KAAK,CAAC2C,SAAN,CAAgBkB,UAAhB,GAA6B7D,KAAK,CAAC2C,SAAN,CAAgBmB,YAA9C,GAA8D9D,KAAK,CAAC2C,SAAN,CAAgBoB,QAAtG;AACA/D,MAAAA,KAAK,CAACG,oBAAN,GAA6B,CAA7B;AACAH,MAAAA,KAAK,CAACI,qBAAN,GAA8B,CAA9B;AACAJ,MAAAA,KAAK,CAACK,gBAAN,GAAyB,CAAC,CAA1B;AACAL,MAAAA,KAAK,CAACM,YAAN,GAAqB,KAArB;AACAN,MAAAA,KAAK,CAACO,oBAAN,GAA6B,KAA7B;AACAP,MAAAA,KAAK,CAACU,OAAN,GAAgB,CAAhB;AACAV,MAAAA,KAAK,CAACY,iBAAN,GAA0B,KAA1B;AACAZ,MAAAA,KAAK,CAACyH,aAAN,GAAsB,CAAC,CAAvB;;AACA,UAAKzH,KAAK,CAACqB,MAAN,CAAa4B,UAAb,CAAwBC,cAAxB,MAA4C,CAAClD,KAAK,CAACqB,MAAN,CAAa0B,SAAb,CAAuBC,MAAzE,EAAkF;AAC9E,YAAI,CAACjE,iBAAiB,CAACiB,KAAK,CAAC2C,SAAN,CAAgBzB,KAAhB,CAAsBiD,YAAvB,CAAlB,IACAnE,KAAK,CAAC2C,SAAN,CAAgBzB,KAAhB,CAAsBiD,YAAtB,CAAmChB,SAAnC,CAA6CC,QAA7C,CAAsD3D,GAAG,CAAC2E,sBAA1D,CADJ,EACuF;AACnFpE,UAAAA,KAAK,CAACY,iBAAN,GAA0B,IAA1B;AACH;;AACD,YAAI8G,IAAI,GAAG1H,KAAK,CAACqB,MAAN,CAAa8D,iBAAb,CAA+BwC,UAA1C;AACA3H,QAAAA,KAAK,CAACM,YAAN,GAAqBoH,IAAI,CAACE,MAAL,GAAc,CAAd,IAAmBF,IAAI,CAACA,IAAI,CAACE,MAAL,GAAc,CAAf,CAAJ,CAAsBC,MAAtB,KAAiC,MAApD,IACjBH,IAAI,CAACA,IAAI,CAACE,MAAL,GAAc,CAAf,CAAJ,CAAsBC,MAAtB,KAAiC,MADrC;AAEA7H,QAAAA,KAAK,CAACO,oBAAN,GAA6B,CAACP,KAAK,CAACqB,MAAN,CAAa8D,iBAAb,CAA+BpC,SAA/B,CAAyCC,MAA1C,IAAoDhD,KAAK,CAACM,YAA1D,IACzBN,KAAK,CAACqB,MAAN,CAAayB,WAAb,KAA6B,eADJ,IACwB4E,IAAI,CAACE,MAAL,GAAc,CAAd,IAAmBF,IAAI,CAACA,IAAI,CAACE,MAAL,GAAc,CAAf,CAAJ,CAAsBC,MAAtB,KAAiC,MADzG;AAEA7H,QAAAA,KAAK,CAACW,cAAN,GAAuB,CAACX,KAAK,CAACO,oBAAP,IAAgCP,KAAK,CAAC2C,SAAN,CAAgBmB,YAAhB,KAAiC9D,KAAK,CAAC2C,SAAN,CAAgBoB,QAAxG;;AACA,YAAI/D,KAAK,CAACO,oBAAV,EAAgC;AAC5BP,UAAAA,KAAK,CAAC8H,mBAAN,GAA4B,IAAInI,aAAJ,CAAkBK,KAAK,CAACqB,MAAxB,EAAgC,KAAhC,CAA5B;AACH,SAFD,MAGK;AACDrB,UAAAA,KAAK,CAAC8H,mBAAN,GAA4B,IAAInI,aAAJ,CAAkBK,KAAK,CAACqB,MAAxB,EAAgC,MAAhC,CAA5B;AACH;AACJ;;AACD,UAAIrB,KAAK,CAACqB,MAAN,CAAayB,WAAb,KAA6B,OAAjC,EAA0C;AACtC9C,QAAAA,KAAK,CAAC+H,qBAAN,CAA4B/H,KAAK,CAAC2C,SAAN,CAAgBzB,KAA5C;;AACAlB,QAAAA,KAAK,CAACgI,UAAN,GAAmB,IAAItI,UAAJ,CAAeM,KAAK,CAACqB,MAArB,CAAnB;AACH;;AACD,UAAIrB,KAAK,CAACqB,MAAN,CAAayB,WAAb,KAA6B,KAA7B,IAAsC9C,KAAK,CAACqB,MAAN,CAAayB,WAAb,KAA6B,MAAnE,IAA6E9C,KAAK,CAACqB,MAAN,CAAayB,WAAb,KAA6B,UAA9G,EAA0H;AACtH9C,QAAAA,KAAK,CAACiI,aAAN,GAAsB,IAAIrI,aAAJ,CAAkBI,KAAK,CAACqB,MAAxB,CAAtB;AACH;AACJ,KA9DD;AA+DH,GA9ED;;AA+EAvB,EAAAA,WAAW,CAACtB,SAAZ,CAAsB0D,IAAtB,GAA6B,UAAUO,CAAV,EAAa;AACtC,SAAKpB,MAAL,CAAY6G,UAAZ,CAAuBC,cAAvB,CAAsC,IAAtC;;AACA,QAAK,CAACpJ,iBAAiB,CAAC0D,CAAC,CAAC2F,MAAH,CAAnB,IAAkC3F,CAAC,CAAC2F,MAAF,CAASjF,SAAT,CAAmBC,QAAnB,CAA4B3D,GAAG,CAAC4I,aAAhC,CAAtC,EAAsF;AAClF;AACH;;AACD,QAAIzC,QAAQ,GAAG/G,MAAM,CAAC,EAAD,EAAK,KAAK8D,SAAL,CAAe8C,KAApB,EAA2B,IAA3B,EAAiC,IAAjC,CAArB;AACA,QAAI6C,SAAS,GAAG,KAAKC,kBAAL,CAAwB9F,CAAxB,CAAhB;AACA,SAAKE,SAAL,CAAe6F,CAAf,GAAmB,KAAK7F,SAAL,CAAe8F,KAAf,GAAuBH,SAAS,CAACG,KAApD;AACA,SAAK9F,SAAL,CAAe+F,CAAf,GAAmB,KAAK/F,SAAL,CAAegG,KAAf,GAAuBL,SAAS,CAACK,KAApD;AACA,SAAKhG,SAAL,CAAeyF,MAAf,GAAwB3F,CAAC,CAAC2F,MAA1B;AACA,SAAKjI,oBAAL,GAA6B,KAAKA,oBAAL,KAA8B,CAA/B,GACxBmE,IAAI,CAACC,IAAL,CAAWD,IAAI,CAACsE,GAAL,CAAS,KAAKjG,SAAL,CAAezB,KAAf,CAAqB2H,qBAArB,GAA6CnH,IAA7C,GAAoD,KAAKiB,SAAL,CAAe+F,CAA5E,IAAiF,KAAKlI,cAAjG,IACI,KAAKA,cAFe,GAEE,KAAKL,oBAFnC;AAGA,SAAKA,oBAAL,GAA4B,KAAKS,iBAAL,GAAyB,KAAK+B,SAAL,CAAe8B,SAAxC,GAAoD,KAAKtE,oBAArF;AACA,SAAKC,qBAAL,GAA8B,KAAKA,qBAAL,KAA+B,CAAhC,GACzBkE,IAAI,CAACC,IAAL,CAAWD,IAAI,CAACsE,GAAL,CAAS,KAAKjG,SAAL,CAAezB,KAAf,CAAqB2H,qBAArB,GAA6ClH,GAA7C,GAAmD,KAAKgB,SAAL,CAAe6F,CAA3E,IAAgF,KAAK/H,eAAhG,IACI,KAAKA,eAFgB,GAEE,KAAKL,qBAFpC;AAGA,SAAKS,YAAL,GAAoB,KAAK8B,SAAL,CAAezB,KAAf,CAAqBiC,SAArB,CAA+BC,QAA/B,CAAwC3D,GAAG,CAAC4D,wBAA5C,CAApB;;AACA,QAAI,KAAK1C,cAAL,IAAuB,KAAKD,OAAL,KAAiB,CAA5C,EAA+C;AAC3C,WAAKoI,oBAAL,CAA0BlD,QAA1B;AACH;;AACD,QAAI,CAAC,KAAKvE,MAAL,CAAYyB,WAAZ,KAA4B,OAA5B,IAAuC,KAAKjC,YAA7C,KAA8D,KAAK4G,aAAL,GAAqB,CAAvF,EAA0F;AACtF,UAAIsB,IAAI,GAAG,KAAK1H,MAAL,CAAY2H,kBAAZ,CAA+B,KAAKrG,SAAL,CAAeyF,MAA9C,CAAX;;AACA,UAAI,CAACrJ,iBAAiB,CAACgK,IAAD,CAAtB,EAA8B;AAC1B,YAAIE,WAAW,GAAGzJ,IAAI,CAAC0J,SAAL,CAAeH,IAAf,CAAlB;AACA,YAAII,SAAS,GAAG3J,IAAI,CAAC0J,SAAL,CAAe,IAAIE,IAAJ,CAASxD,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBC,SAAzB,CAAR,CAA4CwC,OAA5C,EAAT,CAAf,CAAhB;AACA,aAAK5B,aAAL,GAAqB,CAACwB,WAAW,CAACI,OAAZ,KAAwBF,SAAS,CAACE,OAAV,EAAzB,IAAgD7J,IAAI,CAAC8J,UAA1E;AACH,OAJD,MAKK;AACD,aAAK7B,aAAL,GAAqB,CAArB;AACH;AACJ;;AACD,QAAI,KAAKpG,MAAL,CAAYG,aAAhB,EAA+B;AAC3B,UAAI+H,aAAa,GAAGjB,SAAS,CAACF,MAA9B;AACA,WAAKzF,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B9B,GAA3B,GAAiC7C,UAAU,CAACyK,aAAa,CAAC7F,SAAf,CAA3C;AACA,WAAKf,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B/B,IAA3B,GAAkC5C,UAAU,CAACyK,aAAa,CAACtF,UAAf,CAA5C;AACA,UAAIuF,aAAa,GAAG7K,OAAO,CAAC4K,aAAD,EAAgB,MAAM9J,GAAG,CAACgK,IAA1B,CAA3B;;AACA,UAAI,CAACD,aAAL,EAAoB;AAChB,aAAK7G,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BkB,MAA3B,GAAoC,EAApC;AACA,aAAKhC,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BD,KAA3B,GAAmC,EAAnC;AACH,OAHD,MAIK;AACD,YAAI,EAAE,KAAKnC,MAAL,CAAYyB,WAAZ,KAA4B,MAA5B,IAAsC,KAAKzB,MAAL,CAAYyB,WAAZ,KAA4B,UAAlE,IACC,KAAKzB,MAAL,CAAYyB,WAAZ,KAA4B,KAD/B,CAAJ,EAC2C;AACvC,eAAKH,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BD,KAA3B,GAAmC1E,UAAU,CAAC,KAAK6D,SAAL,CAAe5B,OAAf,CAAuByD,WAAxB,CAA7C;AACH;AACJ;AACJ;;AACD,SAAKkF,oBAAL,CAA0BjH,CAA1B;AACA,SAAKkH,wBAAL,CAA8BlH,CAA9B;AACA,SAAKmH,sBAAL,CAA4BnH,CAA5B;AACA,QAAIoD,QAAQ,GAAG;AACXE,MAAAA,IAAI,EAAEH,QADK;AACKH,MAAAA,KAAK,EAAEhD,CADZ;AACe1B,MAAAA,OAAO,EAAE,KAAK4B,SAAL,CAAe5B,OADvC;AACgD8F,MAAAA,SAAS,EAAE,KAAKlE,SAAL,CAAeuE,KAD1E;AAEXH,MAAAA,OAAO,EAAE,KAAKpE,SAAL,CAAewE;AAFb,KAAf;;AAIA,QAAI,KAAK9F,MAAL,CAAYwI,KAAZ,CAAkBC,SAAlB,CAA4BlC,MAA5B,GAAqC,CAAzC,EAA4C;AACxC/B,MAAAA,QAAQ,CAACuB,UAAT,GAAsB,KAAKzE,SAAL,CAAeyE,UAArC;AACH;;AACD,SAAK/F,MAAL,CAAYgF,OAAZ,CAAoB9G,MAAM,CAAC2C,IAA3B,EAAiC2D,QAAjC;AACH,GA3DD;;AA4DA/F,EAAAA,WAAW,CAACtB,SAAZ,CAAsBsK,oBAAtB,GAA6C,UAAUlD,QAAV,EAAoB;AAC7D,QAAI,KAAKvE,MAAL,CAAYqD,SAAhB,EAA2B;AACvB,WAAKhE,OAAL,GACK,CAAC,KAAKiC,SAAL,CAAezB,KAAf,CAAqBsD,WAArB,GAAmC,KAAKrE,oBAAzC,IAAiE,KAAKK,cAAvE,GAAyF,KAAKmC,SAAL,CAAeoB,QAD5G;AAEH,KAHD,MAIK;AACD,WAAKrD,OAAL,GAAgB,KAAKP,oBAAL,GAA4B,KAAKK,cAAlC,GAAoD,KAAKmC,SAAL,CAAeoB,QAAlF;AACH;;AACD,QAAIoF,SAAS,GAAGvD,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBC,SAAzB,CAAxB;AACA,QAAIA,SAAS,GAAG,KAAKxF,MAAL,CAAY4B,UAAZ,CAAuB8G,WAAvB,CAAmC,CAAnC,CAAhB;AACA,QAAIC,aAAa,GAAGxK,IAAI,CAACyK,gBAAL,CAAsBpD,SAAtB,EAAiC,KAAKxF,MAAL,CAAY4B,UAAZ,CAAuBiH,YAAvB,EAAjC,EAAwE,KAAK7I,MAAL,CAAY4B,UAAZ,CAAuBkH,UAAvB,EAAxE,CAApB;;AACA,QAAIH,aAAa,CAACI,SAAd,CAAwBf,OAAxB,KAAoCF,SAAS,CAACE,OAAV,EAAxC,EAA6D;AACzD,WAAK3I,OAAL,GAAe,KAAKA,OAAL,GAAgB,CAACsJ,aAAa,CAACI,SAAd,CAAwBf,OAAxB,KAAoCF,SAAS,CAACE,OAAV,EAArC,IAA4D7J,IAAI,CAAC6K,aAAhG;AACH;AACJ,GAdD;;AAeAvK,EAAAA,WAAW,CAACtB,SAAZ,CAAsB2D,QAAtB,GAAiC,UAAUM,CAAV,EAAa;AAC1C,QAAIzC,KAAK,GAAG,IAAZ;;AACA,SAAKwG,yBAAL;AACA,SAAKC,kBAAL;AACA6D,IAAAA,aAAa,CAAC,KAAK3H,SAAL,CAAe4H,kBAAhB,CAAb;AACA,SAAK5H,SAAL,CAAe4H,kBAAf,GAAoC,IAApC;AACAD,IAAAA,aAAa,CAAC,KAAK3H,SAAL,CAAe6H,cAAhB,CAAb;AACA,SAAK7H,SAAL,CAAe6H,cAAf,GAAgC,IAAhC;AACA,SAAKxD,WAAL,CAAiB,aAAjB;AACA,SAAK3F,MAAL,CAAY4F,aAAZ,CAA0BrE,MAA1B,GAAmC,KAAnC;AACA,SAAKD,SAAL,CAAeC,MAAf,GAAwB,IAAxB;;AACA,QAAI,KAAK6H,WAAL,CAAiBhI,CAAjB,CAAJ,EAAyB;AACrB;AACH;;AACD,QAAIoD,QAAQ,GAAG;AAAEC,MAAAA,MAAM,EAAE,KAAV;AAAiBC,MAAAA,IAAI,EAAE,KAAK2E,cAAL,EAAvB;AAA8CjF,MAAAA,KAAK,EAAEhD,CAArD;AAAwD1B,MAAAA,OAAO,EAAE,KAAK4B,SAAL,CAAe5B;AAAhF,KAAf;AACA,SAAKM,MAAL,CAAYgF,OAAZ,CAAoB9G,MAAM,CAAC4C,QAA3B,EAAqC0D,QAArC,EAA+C,UAAUS,aAAV,EAAyB;AACpE,UAAIA,aAAa,CAACR,MAAlB,EAA0B;AACtB;AACH;;AACD9F,MAAAA,KAAK,CAAC2K,eAAN,CAAsBrE,aAAtB;AACH,KALD;AAMH,GArBD;;AAsBAxG,EAAAA,WAAW,CAACtB,SAAZ,CAAsBmL,wBAAtB,GAAiD,UAAUlH,CAAV,EAAa;AAC1D,QAAIzC,KAAK,GAAG,IAAZ;;AACA,QAAI,KAAK2C,SAAL,CAAesD,UAAf,CAA0BjD,MAA9B,EAAsC;AAClC,UAAI4H,aAAa,GAAG,KAAKvJ,MAAL,CAAYwJ,cAAZ,EAApB;;AACA,UAAI9L,iBAAiB,CAAC,KAAK4D,SAAL,CAAe4H,kBAAhB,CAArB,EAA0D;AACtD,aAAK5H,SAAL,CAAe4H,kBAAf,GAAoCO,MAAM,CAACC,WAAP,CAAmB,YAAY;AAC/D,cAAIH,aAAJ,EAAmB;AACf,gBAAII,OAAO,GAAGhL,KAAK,CAACqB,MAAN,CAAawJ,cAAb,EAAd;;AACA,gBAAI1D,GAAG,GAAG6D,OAAO,CAACC,UAAR,EAAV;AACA,gBAAI/D,KAAK,GAAG0D,aAAa,CAACK,UAAd,KAA8BjL,KAAK,CAAC2C,SAAN,CAAgBsD,UAAhB,CAA2BC,SAA3B,GAAuC,IAAjF;AACAgB,YAAAA,KAAK,GAAIA,KAAK,IAAI,EAAV,GAAgBA,KAAK,GAAG,EAAxB,GAA6BA,KAArC;;AACA,gBAAIA,KAAK,KAAKC,GAAd,EAAmB;AACfyD,cAAAA,aAAa,GAAG5K,KAAK,CAACqB,MAAN,CAAawJ,cAAb,EAAhB;;AACA7K,cAAAA,KAAK,CAACkL,cAAN,CAAqBzI,CAArB;;AACAzC,cAAAA,KAAK,CAAC4J,sBAAN,CAA6BnH,CAA7B;AACH;AACJ;AACJ,SAZmC,EAYjC,KAAKE,SAAL,CAAesD,UAAf,CAA0BC,SAZO,CAApC;AAaH;AACJ;AACJ,GApBD;;AAqBApG,EAAAA,WAAW,CAACtB,SAAZ,CAAsBoL,sBAAtB,GAA+C,UAAUnH,CAAV,EAAa;AACxD,QAAI,CAAC1D,iBAAiB,CAAC,KAAK4D,SAAL,CAAezB,KAAf,CAAqBiD,YAAtB,CAAlB,IACA,KAAKxB,SAAL,CAAezB,KAAf,CAAqBiD,YAArB,CAAkChB,SAAlC,CAA4CC,QAA5C,CAAqD3D,GAAG,CAAC2E,sBAAzD,CADJ,EACsF;AAClF,WAAK+G,sBAAL,CAA4B1I,CAA5B;AACH,KAHD,MAIK,IAAI,KAAKpB,MAAL,CAAY4B,UAAZ,CAAuBC,cAAvB,EAAJ,EAA6C;AAC9C,WAAK4E,mBAAL,CAAyBsD,UAAzB,GAAsC,KAAK/J,MAAL,CAAY4B,UAAZ,CAAuB8G,WAA7D;AACA,WAAKjC,mBAAL,CAAyBrD,SAAzB,GAAqC,KAAK9B,SAAL,CAAe8B,SAApD;AACA,WAAKqD,mBAAL,CAAyBuD,YAAzB;AACA,WAAK1I,SAAL,CAAe8B,SAAf,GAA2B,KAAKnE,YAAL,GAAoB,KAAKwH,mBAAL,CAAyBrD,SAA7C,GAAyD,KAAK9B,SAAL,CAAe8B,SAAnG;AACA,WAAK6G,qBAAL,CAA2B7I,CAA3B;AACH,KANI,MAOA;AACD,UAAI,KAAKpB,MAAL,CAAYyB,WAAZ,KAA4B,OAAhC,EAAyC;AACrC,aAAKyI,qBAAL,CAA2B9I,CAA3B;AACH,OAFD,MAGK;AACD,aAAK+I,qBAAL,CAA2B/I,CAA3B;AACH;AACJ;AACJ,GApBD;;AAqBA3C,EAAAA,WAAW,CAACtB,SAAZ,CAAsBiN,iBAAtB,GAA0C,YAAY;AAClD,QAAI,CAAC,KAAKpK,MAAL,CAAY4B,UAAZ,CAAuBC,cAAvB,EAAL,EAA8C;AAC1C,UAAI,KAAK7B,MAAL,CAAYyB,WAAZ,KAA4B,OAA5B,IAAuC,CAAC,KAAKzB,MAAL,CAAY0B,SAAZ,CAAsBC,MAAlE,EAA0E;AACtE,YAAI0I,eAAe,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAc,KAAKvK,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqC,MAAMpM,GAAG,CAAC6F,gBAA/C,CAAd,CAAtB;AACA,aAAK3C,SAAL,CAAemJ,KAAf,GAAwB,KAAKzK,MAAL,CAAY4B,UAAZ,CAAuB8G,WAAvB,CAAmCnC,MAAnC,GAA4C,KAAKjF,SAAL,CAAemJ,KAA5D,GACnB,KAAKzK,MAAL,CAAY4B,UAAZ,CAAuB8G,WAAvB,CAAmCnC,MAAnC,GAA4C,CADzB,GAC6B,KAAKjF,SAAL,CAAemJ,KADnE;AAEA,YAAIC,aAAa,GAAGL,eAAe,CAAC,KAAK/I,SAAL,CAAemJ,KAAhB,CAAf,CAAsChK,aAAtC,CAAoD,MAAMrC,GAAG,CAACuM,yBAA9D,CAApB;;AACA,YAAI,CAACD,aAAL,EAAoB;AAChBA,UAAAA,aAAa,GAAGrN,aAAa,CAAC,KAAD,EAAQ;AAAEuN,YAAAA,SAAS,EAAExM,GAAG,CAACuM;AAAjB,WAAR,CAA7B;AACAN,UAAAA,eAAe,CAAC,KAAK/I,SAAL,CAAemJ,KAAhB,CAAf,CAAsCI,WAAtC,CAAkDH,aAAlD;AACH;;AACDA,QAAAA,aAAa,CAACG,WAAd,CAA0B,KAAKvJ,SAAL,CAAezB,KAAzC;AACH,OAVD,MAWK;AACD,YAAIiL,YAAY,GAAG,KAAKxJ,SAAL,CAAezB,KAAf,CAAqBiC,SAArB,CAA+BC,QAA/B,CAAwC3D,GAAG,CAAC4D,wBAA5C,IACf,MAAM5D,GAAG,CAAC2M,gCADK,GAC8B,MAAM3M,GAAG,CAACuM,yBAD3D;AAEA,aAAK3K,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqCM,YAArC,EACKE,IADL,CACU,KAAK1J,SAAL,CAAemJ,KADzB,EACgCI,WADhC,CAC4C,KAAKvJ,SAAL,CAAezB,KAD3D;;AAEA,YAAIiL,YAAY,KAAK,MAAM1M,GAAG,CAAC2M,gCAA/B,EAAiE;AAC7D,cAAIE,eAAe,GAAG,KAAKC,oBAAL,EAAtB;AACA,cAAIC,OAAO,GAAG,GAAGb,KAAH,CAASC,IAAT,CAAc,KAAKvK,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqC,MAAMpM,GAAG,CAACgN,kBAAV,GAA+B,cAApE,CAAd,CAAd;;AACA,cAAID,OAAO,CAAC,CAAD,CAAP,CAAWvH,YAAX,GAA0BqH,eAA9B,EAA+C;AAC3CE,YAAAA,OAAO,CAACE,OAAR,CAAgB,UAAU3L,OAAV,EAAmB;AAAE,qBAAOA,OAAO,CAAC0C,KAAR,CAAckB,MAAd,GAAwB,CAAC2H,eAAe,GAAG,CAAnB,IAAwB,EAAzB,GAA+B,IAA7D;AAAoE,aAAzG;AACH;;AACD,eAAK3J,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BkB,MAA3B,GAAoC7F,UAAU,CAACwN,eAAD,CAA9C;AACH;;AACD,aAAK3J,SAAL,CAAegC,MAAf,GAAwBG,QAAQ,CAAC,KAAKnC,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BkB,MAA5B,EAAoC,CAApC,CAAhC;AACH;AACJ,KA3BD,MA4BK;AACD,UAAIgI,UAAU,GAAG,KAAK,CAAtB;;AACA,UAAI,KAAKtL,MAAL,CAAY8D,iBAAZ,CAA8B0E,KAA9B,CAAoCC,SAApC,CAA8ClC,MAA9C,GAAuD,CAA3D,EAA8D;AAC1D+E,QAAAA,UAAU,GAAG,KAAKtL,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqC,yCAArC,EAAgFQ,IAAhF,CAAqF,KAAK1J,SAAL,CAAemJ,KAApG,CAAb;AACH,OAFD,MAGK;AACDa,QAAAA,UAAU,GAAG,KAAKtL,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAACmN,2BAA5C,CAAb;AACH;;AACD,UAAIC,UAAU,GAAGF,UAAU,CAAC7K,aAAX,CAAyB,MAAMrC,GAAG,CAACuM,yBAAnC,CAAjB;;AACA,UAAI,CAACa,UAAL,EAAiB;AACbA,QAAAA,UAAU,GAAGnO,aAAa,CAAC,KAAD,EAAQ;AAAEuN,UAAAA,SAAS,EAAExM,GAAG,CAACuM;AAAjB,SAAR,CAA1B;AACAW,QAAAA,UAAU,CAACT,WAAX,CAAuBW,UAAvB;AACH;;AACDA,MAAAA,UAAU,CAACX,WAAX,CAAuB,KAAKvJ,SAAL,CAAezB,KAAtC;AACH;AACJ,GA5CD;;AA6CApB,EAAAA,WAAW,CAACtB,SAAZ,CAAsB0M,cAAtB,GAAuC,UAAUzI,CAAV,EAAa;AAChD,QAAIqK,cAAJ;AACA,QAAIlL,QAAQ,GAAG,KAAKP,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAAC6H,kBAA5C,CAAf;;AACA,QAAI1F,QAAQ,KAAM,CAAC,KAAKmL,WAAL,CAAiBpL,GAAlB,IAAyB,CAAC,KAAKoL,WAAL,CAAiBC,MAA5C,IACbrO,OAAO,CAAC,KAAKgE,SAAL,CAAezB,KAAhB,EAAuB,MAAMzB,GAAG,CAAC2M,gCAAjC,CADC,CAAZ,EACgF;AAC5E,UAAKxK,QAAQ,CAACqL,UAAT,KAAwB,CAAzB,IACC3I,IAAI,CAAC4I,KAAL,CAAW,KAAKvK,SAAL,CAAe+F,CAA1B,KACGpE,IAAI,CAAC4I,KAAL,CAAWtL,QAAQ,CAACiH,qBAAT,GAAiCnH,IAAjC,GAAwC,KAAKiB,SAAL,CAAe8B,SAAvD,GAAmEqG,MAAM,CAACqC,WAArF,CAFR,EAE4G;AACxGL,QAAAA,cAAc,GAAG,KAAKzL,MAAL,CAAYqD,SAAZ,GAAwB,MAAxB,GAAiC,UAAlD;AACH,OAJD,MAKK,IAAKJ,IAAI,CAAC4I,KAAL,CAAWtL,QAAQ,CAACqL,UAApB,IAAkCrL,QAAQ,CAACwL,WAA3C,KAA2DxL,QAAQ,CAAC4F,WAArE,IACJlD,IAAI,CAAC4I,KAAL,CAAW,KAAKvK,SAAL,CAAe+F,CAA1B,KACGpE,IAAI,CAAC4I,KAAL,CAAWtL,QAAQ,CAACiH,qBAAT,GAAiCtF,KAAjC,GAAyC,KAAKZ,SAAL,CAAe8B,SAAxD,GAAoEqG,MAAM,CAACqC,WAAtF,CAFH,EAEwG;AACzGL,QAAAA,cAAc,GAAG,KAAKzL,MAAL,CAAYqD,SAAZ,GAAwB,UAAxB,GAAqC,MAAtD;AACH;;AACD,UAAIoI,cAAJ,EAAoB;AAChB,aAAKzL,MAAL,CAAYgM,UAAZ,CAAuB,KAAKhM,MAAL,CAAY4B,UAAZ,CAAuBqK,mBAAvB,CAA2CR,cAA3C,CAAvB;AACH;AACJ;AACJ,GAnBD;;AAoBAhN,EAAAA,WAAW,CAACtB,SAAZ,CAAsB2M,sBAAtB,GAA+C,UAAU1I,CAAV,EAAa;AACxD,QAAI1D,iBAAiB,CAAC0D,CAAC,CAAC2F,MAAH,CAAjB,IAAgC3F,CAAC,CAAC2F,MAAF,IAAYrJ,iBAAiB,CAACJ,OAAO,CAAC8D,CAAC,CAAC2F,MAAH,EAAW,IAAX,CAAR,CAAjE,EAA6F;AACzF;AACH;;AACD,QAAIxC,QAAQ,GAAG/G,MAAM,CAAC,EAAD,EAAK,KAAK8D,SAAL,CAAe8C,KAApB,EAA2B,IAA3B,EAAiC,IAAjC,CAArB;AACA,QAAI8H,aAAa,GAAG3H,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBG,OAAzB,CAAR,CAA0CsC,OAA1C,KAChBzD,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBC,SAAzB,CAAR,CAA4CwC,OAA5C,EADJ;AAEA,QAAImE,EAAE,GAAG7O,OAAO,CAAC8D,CAAC,CAAC2F,MAAH,EAAW,IAAX,CAAhB;AACA,QAAIpG,SAAS,GAAG,KAAKX,MAAL,CAAY2H,kBAAZ,CAA+BwE,EAA/B,CAAhB;AACA,QAAIC,OAAO,GAAG,IAAIrE,IAAJ,CAASpH,SAAS,CAACqH,OAAV,EAAT,CAAd;AACAoE,IAAAA,OAAO,CAACC,eAAR,CAAwBH,aAAxB;;AACA,QAAI,KAAKlM,MAAL,CAAY8D,iBAAZ,CAA8B0E,KAA9B,CAAoCC,SAApC,CAA8ClC,MAA9C,GAAuD,CAA3D,EAA8D;AAC1D,WAAKjF,SAAL,CAAeyE,UAAf,GAA4BtC,QAAQ,CAAC0I,EAAE,CAAChI,YAAH,CAAgB,kBAAhB,CAAD,EAAsC,EAAtC,CAApC;AACH;;AACD,SAAK7C,SAAL,CAAeuE,KAAf,GAAuB,IAAIkC,IAAJ,CAASpH,SAAS,CAACqH,OAAV,EAAT,CAAvB;AACA,SAAK1G,SAAL,CAAewE,GAAf,GAAqB,IAAIiC,IAAJ,CAASqE,OAAO,CAACpE,OAAR,EAAT,CAArB;AACA,SAAK1G,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B9B,GAA3B,GAAiC7C,UAAU,CAAC0O,EAAE,CAACrJ,YAAH,CAAgBT,SAAjB,CAA3C;AACA,SAAKf,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B/B,IAA3B,GAAkC5C,UAAU,CAAC0O,EAAE,CAACvJ,UAAJ,CAA5C;AACA,SAAKtB,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BD,KAA3B,GAAmC1E,UAAU,CAAC0O,EAAE,CAAChJ,WAAJ,CAA7C;AACA,QAAImJ,cAAc,GAAGH,EAArB;AACA,QAAII,YAAJ;;AACA,QAAI,KAAKvM,MAAL,CAAY4B,UAAZ,CAAuBC,cAAvB,EAAJ,EAA6C;AACzC,UAAI2K,QAAQ,GAAGlP,OAAO,CAAC6O,EAAD,EAAK,IAAL,CAAP,CAAkBK,QAAjC;AACAF,MAAAA,cAAc,GAAG,KAAKtM,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqC,0BAArC,EAAiEQ,IAAjE,CAAsEwB,QAAtE,CAAjB;AACH;;AACDD,IAAAA,YAAY,GAAGD,cAAc,CAAC7L,aAAf,CAA6B,MAAMrC,GAAG,CAACuM,yBAAvC,CAAf;;AACA,QAAI,CAAC4B,YAAL,EAAmB;AACfA,MAAAA,YAAY,GAAGlP,aAAa,CAAC,KAAD,EAAQ;AAAEuN,QAAAA,SAAS,EAAExM,GAAG,CAACuM;AAAjB,OAAR,CAA5B;AACA2B,MAAAA,cAAc,CAACzB,WAAf,CAA2B0B,YAA3B;AACH;;AACD,SAAKE,kBAAL,CAAwBF,YAAxB;AACH,GA/BD;;AAgCA9N,EAAAA,WAAW,CAACtB,SAAZ,CAAsBgN,qBAAtB,GAA8C,UAAU/I,CAAV,EAAa;AACvD,QAAI1D,iBAAiB,CAAC,KAAK4D,SAAL,CAAeyF,MAAhB,CAAjB,IACC,KAAKzF,SAAL,CAAeyF,MAAf,IAAyBrJ,iBAAiB,CAACJ,OAAO,CAAC,KAAKgE,SAAL,CAAeyF,MAAhB,EAAwB,IAAxB,CAAR,CAD3C,IAEC,CAAEzJ,OAAO,CAAC,KAAKgE,SAAL,CAAeyF,MAAhB,EAAwB,IAAxB,CAAP,CAAqCjF,SAArC,CAA+CC,QAA/C,CAAwD3D,GAAG,CAAC6F,gBAA5D,CAAF,IACG,CAAE3G,OAAO,CAAC,KAAKgE,SAAL,CAAeyF,MAAhB,EAAwB,IAAxB,CAAP,CAAqCjF,SAArC,CAA+CC,QAA/C,CAAwD3D,GAAG,CAACgN,kBAA5D,CAHV,EAG6F;AACzF;AACH;;AACD,QAAI,KAAKpL,MAAL,CAAY8D,iBAAZ,CAA8BpC,SAA9B,CAAwCC,MAA5C,EAAoD;AAChD,WAAK+K,YAAL,CAAkBtL,CAAlB;AACH;;AACD,QAAIb,QAAQ,GAAG,KAAKP,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAAC6H,kBAA5C,CAAf;AACA,QAAI1B,QAAQ,GAAG/G,MAAM,CAAC,EAAD,EAAK,KAAK8D,SAAL,CAAe8C,KAApB,EAA2B,IAA3B,EAAiC,IAAjC,CAArB;AACA,QAAIuI,UAAU,GAAGpI,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBC,SAAzB,CAAzB;AACA,QAAIoH,QAAQ,GAAGrI,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBG,OAAzB,CAAvB;AACA,QAAIwG,aAAa,GAAGU,QAAQ,CAAC5E,OAAT,KAAqB2E,UAAU,CAAC3E,OAAX,EAAzC;AACA,QAAI3F,SAAS,GAAGY,IAAI,CAAC4J,KAAL,CAAWpJ,QAAQ,CAAC,KAAKnC,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B9B,GAA5B,EAAiC,EAAjC,CAAR,GAA+C,KAAKgB,SAAL,CAAekB,UAAzE,IACV,KAAKlB,SAAL,CAAekB,UADrB;AAEAH,IAAAA,SAAS,GAAGA,SAAS,GAAG,CAAZ,GAAgB,CAAhB,GAAoBA,SAAhC;;AACA,QAAI,KAAKqJ,WAAL,CAAiBpL,GAAjB,IAAwB,KAAKoL,WAAL,CAAiBC,MAA7C,EAAqD;AACjDtJ,MAAAA,SAAS,GAAG,KAAKqJ,WAAL,CAAiBpL,GAAjB,GAAuBC,QAAQ,CAACuM,SAAT,GAAqB,KAAK/N,qBAA1B,GAC/B,KAAKuC,SAAL,CAAekB,UADgB,GACHiH,MAAM,CAACsD,WAD3B,GAEPxM,QAAQ,CAACuM,SAAT,GAAqBvM,QAAQ,CAACqD,YAA9B,GAA6C,KAAKtC,SAAL,CAAezB,KAAf,CAAqB+D,YAAlE,GAAiF6F,MAAM,CAACsD,WAAzF,IACK,KAAKzL,SAAL,CAAezB,KAAf,CAAqB+D,YAArB,GAAoC,KAAK7E,qBAD9C,CAFJ;AAIAsD,MAAAA,SAAS,GAAGY,IAAI,CAAC4I,KAAL,CAAWxJ,SAAS,GAAG,KAAKf,SAAL,CAAekB,UAAtC,IAAoD,KAAKlB,SAAL,CAAekB,UAA/E;AACA,WAAKlB,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B9B,GAA3B,GAAiC7C,UAAU,CAAC4E,SAAD,CAA3C;AACH;;AACD,QAAImK,QAAQ,GAAGnK,SAAS,GAAG,KAAKf,SAAL,CAAekB,UAA1C;AACA,QAAIpD,eAAe,GAAG,KAAKkC,SAAL,CAAekB,UAAf,GAA4B,KAAKlB,SAAL,CAAemB,YAAjE;AACA,QAAIuK,aAAa,GAAGvJ,QAAQ,CAAC,KAAKnC,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B9B,GAA5B,EAAiC,EAAjC,CAAR,GAA+C+B,SAAnE;AACA,QAAI4K,EAAJ;;AACA,QAAI,KAAKzN,YAAT,EAAuB;AACnByN,MAAAA,EAAE,GAAG,KAAKjN,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAAC4E,gBAA5C,CAAL;AACH,KAFD,MAGK;AACD,UAAIkK,aAAa,GAAG,GAAG5C,KAAH,CAASC,IAAT,CAAc,KAAKvK,MAAL,CAAYmN,eAAZ,GAA8B3C,gBAA9B,CAA+C,IAA/C,CAAd,CAApB;AACAyC,MAAAA,EAAE,GAAGC,aAAa,CAACV,QAAD,CAAlB;AACH;;AACD,QAAI/B,KAAJ;;AACA,QAAInN,OAAO,CAAC,KAAKgE,SAAL,CAAeyF,MAAhB,EAAwB,IAAxB,CAAP,CAAqCjF,SAArC,CAA+CC,QAA/C,CAAwD3D,GAAG,CAAC6F,gBAA5D,KACA3G,OAAO,CAAC,KAAKgE,SAAL,CAAeyF,MAAhB,EAAwB,IAAxB,CAAP,CAAqCjF,SAArC,CAA+CC,QAA/C,CAAwD3D,GAAG,CAACgN,kBAA5D,CADJ,EACqF;AACjFX,MAAAA,KAAK,GAAGnN,OAAO,CAAC,KAAKgE,SAAL,CAAeyF,MAAhB,EAAwB,IAAxB,CAAP,CAAqCqG,SAA7C;AACH;;AACD,QAAIC,QAAQ,GAAG3P,iBAAiB,CAAC+M,KAAD,CAAjB,GAA2BnN,OAAO,CAAC,KAAKgE,SAAL,CAAezB,KAAhB,EAAuB,IAAvB,CAAP,CAAoCuN,SAA/D,GAA2E3C,KAA1F;AACA,SAAKnJ,SAAL,CAAemJ,KAAf,GAAuB4C,QAAvB;;AACA,QAAI3P,iBAAiB,CAACuP,EAAD,CAArB,EAA2B;AACvB;AACH;;AACD,QAAId,EAAE,GAAGc,EAAE,CAACK,QAAH,CAAYD,QAAZ,CAAT;;AACA,QAAI,KAAKrN,MAAL,CAAY8D,iBAAZ,CAA8B0E,KAA9B,CAAoCC,SAApC,CAA8ClC,MAA9C,GAAuD,CAA3D,EAA8D;AAC1D,WAAKjF,SAAL,CAAeyE,UAAf,GAA4BtC,QAAQ,CAAC0I,EAAE,CAAChI,YAAH,CAAgB,kBAAhB,CAAD,EAAsC,EAAtC,CAApC;AACH;;AACD,QAAIxD,SAAJ;AACA,QAAIyL,OAAJ;;AACA,QAAI,KAAKpM,MAAL,CAAY8D,iBAAZ,CAA8BpC,SAA9B,CAAwCC,MAAxC,IAAkD,CAAC,KAAKnC,YAA5D,EAA0E;AACtE,WAAKiN,kBAAL,CAAwB,KAAKc,eAAL,CAAqBF,QAArB,CAAxB;AACA1M,MAAAA,SAAS,GAAG,KAAKX,MAAL,CAAY2H,kBAAZ,CAA+BwE,EAA/B,CAAZ;AACAxL,MAAAA,SAAS,CAAC6M,UAAV,CAAqB7M,SAAS,CAAC8M,UAAV,KAA0BT,aAAa,GAAG5N,eAA/D;AACAgN,MAAAA,OAAO,GAAG,IAAIrE,IAAJ,CAASpH,SAAS,CAACqH,OAAV,EAAT,CAAV;;AACA,UAAI,KAAK1G,SAAL,CAAe5B,OAAf,CAAuBoC,SAAvB,CAAiCC,QAAjC,CAA0C3D,GAAG,CAAC4D,wBAA9C,CAAJ,EAA6E;AACzEoK,QAAAA,OAAO,CAACoB,UAAR,CAAmBpB,OAAO,CAACqB,UAAR,KAAuB,KAAKnM,SAAL,CAAemB,YAAzD;AACH,OAFD,MAGK;AACD2J,QAAAA,OAAO,CAACC,eAAR,CAAwBH,aAAxB;AACH;AACJ,KAXD,MAYK;AACDvL,MAAAA,SAAS,GAAG,KAAKX,MAAL,CAAY2H,kBAAZ,CAA+BwE,EAA/B,CAAZ;AACAxL,MAAAA,SAAS,CAAC+M,OAAV,CAAkB/M,SAAS,CAACgN,OAAV,KAAsB,KAAKvH,aAA7C;AACAzF,MAAAA,SAAS,CAACiN,QAAV,CAAmBjB,UAAU,CAACkB,QAAX,EAAnB,EAA0ClB,UAAU,CAACc,UAAX,EAA1C,EAAmEd,UAAU,CAAC/C,UAAX,EAAnE;AACAwC,MAAAA,OAAO,GAAG,IAAIrE,IAAJ,CAASpH,SAAS,CAACqH,OAAV,EAAT,CAAV;AACAoE,MAAAA,OAAO,CAACC,eAAR,CAAwBH,aAAxB;;AACA,UAAI,CAAC,KAAK5K,SAAL,CAAe5B,OAAf,CAAuBoC,SAAvB,CAAiCC,QAAjC,CAA0C3D,GAAG,CAAC4D,wBAA9C,CAAD,IACA,KAAKV,SAAL,CAAezB,KAAf,CAAqBiC,SAArB,CAA+BC,QAA/B,CAAwC3D,GAAG,CAAC4D,wBAA5C,CADJ,EAC2E;AACvEoK,QAAAA,OAAO,GAAGjO,IAAI,CAAC2P,OAAL,CAAa3P,IAAI,CAAC0J,SAAL,CAAeuE,OAAf,CAAb,EAAsC,CAAtC,CAAV;AACH;;AACD,WAAK2B,kBAAL,CAAwBpN,SAAxB,EAAmCyL,OAAnC,EAA4C,KAAKpM,MAAL,CAAY8D,iBAAZ,CAA8B0E,KAA9B,CAAoCwF,MAApC,GAA6CX,QAA7C,GAAwDY,SAApG;AACH;;AACD,SAAK3M,SAAL,CAAeuE,KAAf,GAAuB,IAAIkC,IAAJ,CAAS,CAACpH,SAAV,CAAvB;AACA,SAAKW,SAAL,CAAewE,GAAf,GAAqB,IAAIiC,IAAJ,CAAS,CAACqE,OAAV,CAArB;AACA,QAAIhI,KAAK,GAAG,KAAK8J,eAAL,CAAqB,KAAK5M,SAAL,CAAeuE,KAApC,EAA2C,KAAKvE,SAAL,CAAewE,GAA1D,EAA+D,KAAKxE,SAAL,CAAe8C,KAA9E,CAAZ;AACA,SAAK+J,iBAAL,CAAuB/J,KAAvB;AACA,SAAKgK,kBAAL,CAAwB,KAAK9M,SAAL,CAAeuE,KAAvC;AACH,GAlFD;;AAmFApH,EAAAA,WAAW,CAACtB,SAAZ,CAAsBgR,iBAAtB,GAA0C,UAAU/J,KAAV,EAAiB;AACvD,SAAKwC,aAAL,CAAmByH,gBAAnB;AACA,QAAIC,UAAU,GAAG,CAAjB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKjN,SAAL,CAAeyE,UAAnC,EAA+CwI,CAAC,EAAhD,EAAoD;AAChDD,MAAAA,UAAU,GAAGA,UAAU,GAAG,KAAK1H,aAAL,CAAmBmD,UAAnB,CAA8BwE,CAA9B,EAAiChI,MAA3D;AACH;;AACD,QAAIiI,QAAQ,GAAG,CAAC,KAAKxO,MAAL,CAAY8D,iBAAZ,CAA8B0E,KAA9B,CAAoCwF,MAArC,GAA8C,KAAK1M,SAAL,CAAemJ,KAAf,GAAuB6D,UAArE,GACT,KAAKtO,MAAL,CAAYyO,cAAZ,CAA2B,KAAK7H,aAAL,CAAmBmD,UAAnB,CAA8B,KAAKzI,SAAL,CAAeyE,UAA7C,CAA3B,EAAqF5H,IAAI,CAAC0J,SAAL,CAAe,KAAK7H,MAAL,CAAY2H,kBAAZ,CAA+B,KAAKrG,SAAL,CAAeyF,MAA9C,CAAf,CAArF,CADN;AAEA,QAAI2H,MAAM,GAAG,KAAK9H,aAAL,CAAmB+H,cAAnB,CAAkCvK,KAAlC,EAAyCoK,QAAzC,EAAmD,KAAKlN,SAAL,CAAeyE,UAAlE,CAAb;AACA,QAAI6I,MAAM,GAAGF,MAAM,CAAC,KAAK9H,aAAL,CAAmBiI,MAAnB,CAA0BrJ,SAA3B,CAAnB;AACA,QAAIsJ,IAAI,GAAGJ,MAAM,CAAC,KAAK9H,aAAL,CAAmBiI,MAAnB,CAA0BnJ,OAA3B,CAAjB;AACA,QAAI7C,QAAQ,GAAG,CAAf;AACA,QAAIkM,SAAS,GAAG,KAAKnI,aAAL,CAAmBoI,SAAnB,CAA6BJ,MAA7B,EAAqCE,IAArC,CAAhB;AACAjM,IAAAA,QAAQ,GAAG,KAAK+D,aAAL,CAAmBqI,WAAnB,CAA+BL,MAA/B,EAAuCJ,QAAvC,EAAiD,KAAKlN,SAAL,CAAeyE,UAAhE,CAAX;AACA,SAAKzE,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B9B,GAA3B,GAAiC7C,UAAU,CAACoF,QAAD,CAA3C;AACA,SAAKvB,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BkB,MAA3B,GAAoC7F,UAAU,CAACsR,SAAD,CAA9C;AACH,GAhBD;;AAiBAtQ,EAAAA,WAAW,CAACtB,SAAZ,CAAsB4Q,kBAAtB,GAA2C,UAAUjG,SAAV,EAAqBoH,OAArB,EAA8B7B,QAA9B,EAAwC;AAC/E,QAAI1O,KAAK,GAAG,IAAZ;;AACA,SAAKqB,MAAL,CAAYqE,SAAZ,CAAsB8K,KAAtB,GAA8B,EAA9B;AACA,QAAI/K,KAAK,GAAG,KAAK8J,eAAL,CAAqBpG,SAArB,EAAgCoH,OAAhC,EAAyC,KAAK5N,SAAL,CAAe8C,KAAxD,CAAZ;AACA,QAAIsE,WAAW,GAAG,KAAK1I,MAAL,CAAY4B,UAAZ,CAAuB8G,WAAzC;AACA,SAAK1I,MAAL,CAAYqE,SAAZ,CAAsB8K,KAAtB,CAA4BC,IAA5B,CAAiC,KAAKpP,MAAL,CAAY4B,UAAZ,CAAuB8G,WAAvB,CAAmC2G,GAAnC,CAAuC,UAAU3H,IAAV,EAAgB;AAAE,aAAO,CAACA,IAAR;AAAe,KAAxE,CAAjC;;AACA,QAAI,KAAK1H,MAAL,CAAY8D,iBAAZ,CAA8B0E,KAA9B,CAAoCC,SAApC,CAA8ClC,MAA9C,GAAuD,CAA3D,EAA8D;AAC1D,WAAKvG,MAAL,CAAYqE,SAAZ,CAAsB8K,KAAtB,GAA8B,EAA9B;AACA,UAAI1G,SAAS,GAAG,KAAKzI,MAAL,CAAYsP,YAAZ,CAAyBC,iBAAzB,CACZC,MADY,CACL,UAAUC,GAAV,EAAe;AAAE,eAAOA,GAAG,CAAC1J,UAAJ,KAAmBpH,KAAK,CAAC2C,SAAN,CAAgByE,UAA1C;AAAuD,OADnE,CAAhB;AAEA2C,MAAAA,WAAW,GAAGD,SAAS,CAAC,CAAD,CAAT,CAAaC,WAA3B;AACA,WAAK1I,MAAL,CAAYqE,SAAZ,CAAsB8K,KAAtB,CAA4BC,IAA5B,CAAiC1G,WAAW,CAAC2G,GAAZ,CAAgB,UAAU3H,IAAV,EAAgB;AAAE,eAAO,CAACA,IAAR;AAAe,OAAjD,CAAjC;AACH;;AACD,QAAIxJ,MAAM,GAAG,KAAK8B,MAAL,CAAYqE,SAAZ,CAAsBqL,UAAtB,CAAiCtL,KAAjC,EAAwCsE,WAAxC,CAAb;AACA,QAAIiH,KAAK,GAAG,iCACR,KAAK3P,MAAL,CAAY4P,aAAZ,CAA0B1R,MAAM,CAAC,CAAD,CAAN,CAAU,KAAK8B,MAAL,CAAYuF,WAAZ,CAAwBC,SAAlC,CAA1B,CADQ,GACkE,IAD9E;;AAEA,QAAI,KAAKxF,MAAL,CAAY8D,iBAAZ,CAA8B0E,KAA9B,CAAoCC,SAApC,CAA8ClC,MAA9C,GAAuD,CAA3D,EAA8D;AAC1DoJ,MAAAA,KAAK,GAAGA,KAAK,CAACE,MAAN,CAAa,0BAA0B,KAAKvO,SAAL,CAAeyE,UAAzC,GAAsD,IAAnE,CAAR;AACH;;AACD,QAAI+J,IAAI,GAAG,GAAGxF,KAAH,CAASC,IAAT,CAAc,KAAKvK,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqCmF,KAArC,CAAd,CAAX;;AACA,QAAIG,IAAI,CAACvJ,MAAL,GAAc,CAAd,IAAmB,CAAC7I,iBAAiB,CAAC2P,QAAD,CAAzC,EAAqD;AACjD,UAAID,SAAS,GAAG,CAAC1P,iBAAiB,CAAC2P,QAAD,CAAlB,GAA+BA,QAA/B,GAA0CyC,IAAI,CAAC,CAAD,CAAJ,CAAQ1C,SAAlE;AACA,WAAKX,kBAAL,CAAwB,KAAKc,eAAL,CAAqBH,SAArB,CAAxB;AACA,WAAK9L,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BD,KAA3B,GACI1E,UAAU,CAACS,MAAM,CAAC,CAAD,CAAN,CAAUwG,IAAV,CAAeqL,KAAf,GAAuB,KAAKzO,SAAL,CAAe8B,SAAvC,CADd;AAEH;AACJ,GA1BD;;AA2BA3E,EAAAA,WAAW,CAACtB,SAAZ,CAAsBuP,YAAtB,GAAqC,UAAUtL,CAAV,EAAa;AAC9C,QAAIiM,QAAQ,GAAG/P,OAAO,CAAC,KAAKgE,SAAL,CAAeyF,MAAhB,EAAwB,IAAxB,CAAP,CAAqCqG,SAApD;;AACA,QAAI9P,OAAO,CAAC,KAAKgE,SAAL,CAAeyF,MAAhB,EAAwB,MAAM3I,GAAG,CAAC4R,sBAAlC,CAAP,IACA,CAAC1S,OAAO,CAAC,KAAKgE,SAAL,CAAezB,KAAhB,EAAuB,MAAMzB,GAAG,CAAC2M,gCAAjC,CADZ,EACgF;AAC5EpN,MAAAA,QAAQ,CAAC,CAAC,KAAK2D,SAAL,CAAezB,KAAhB,CAAD,EAAyBzB,GAAG,CAAC4D,wBAA7B,CAAR;AACA,WAAKyK,kBAAL,CAAwB,KAAKc,eAAL,CAAqBF,QAArB,CAAxB;AACA,WAAK/L,SAAL,CAAeuC,QAAf,GAA0B,IAA1B;AACA,UAAIoM,aAAa,GAAG,KAAK/E,oBAAL,EAApB;AACA,UAAIgF,aAAa,GAAG,GAAG5F,KAAH,CAASC,IAAT,CAAc,KAAKvK,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqC,MAAMpM,GAAG,CAACgN,kBAAV,GAA+B,cAApE,CAAd,CAApB;;AACA,UAAI8E,aAAa,CAAC,CAAD,CAAb,CAAiBtM,YAAjB,GAAgCqM,aAApC,EAAmD;AAC/CC,QAAAA,aAAa,CAAC7E,OAAd,CAAsB,UAAU3L,OAAV,EAAmB;AAAE,iBAAOA,OAAO,CAAC0C,KAAR,CAAckB,MAAd,GAAwB,CAAC2M,aAAa,GAAG,CAAjB,IAAsB,EAAvB,GAA6B,IAA3D;AAAkE,SAA7G;AACH;;AACDnS,MAAAA,iBAAiB,CAAC,KAAKwD,SAAL,CAAezB,KAAhB,EAAuB;AACpCsC,QAAAA,KAAK,EAAE1E,UAAU,CAAC,KAAK6D,SAAL,CAAe8B,SAAhB,CADmB;AAEpCE,QAAAA,MAAM,EAAE7F,UAAU,CAACwS,aAAD,CAFkB;AAGpC3P,QAAAA,GAAG,EAAE7C,UAAU,CAAC,KAAKuC,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAAC4E,gBAA5C,EAA8DX,SAA/D;AAHqB,OAAvB,CAAjB;AAKH;;AACD,QAAI/E,OAAO,CAAC,KAAKgE,SAAL,CAAeyF,MAAhB,EAAwB,MAAM3I,GAAG,CAAC6F,gBAAlC,CAAP,IACA,CAAC3G,OAAO,CAAC,KAAKgE,SAAL,CAAezB,KAAhB,EAAuB,MAAMzB,GAAG,CAAC+R,iBAAjC,CADZ,EACiE;AAC7DtS,MAAAA,WAAW,CAAC,CAAC,KAAKyD,SAAL,CAAezB,KAAhB,CAAD,EAAyBzB,GAAG,CAAC4D,wBAA7B,CAAX;AACA,WAAKyK,kBAAL,CAAwB,KAAKc,eAAL,CAAqBF,QAArB,CAAxB;AACA,WAAK/L,SAAL,CAAeuC,QAAf,GAA0B,KAA1B;AACA,UAAIP,MAAM,GAAI,KAAKhC,SAAL,CAAe5B,OAAf,CAAuBkE,YAAvB,KAAwC,CAAzC,GAA8C,KAAKtC,SAAL,CAAegC,MAA7D,GAAsE,KAAKhC,SAAL,CAAe5B,OAAf,CAAuBkE,YAA1G;AACA9F,MAAAA,iBAAiB,CAAC,KAAKwD,SAAL,CAAezB,KAAhB,EAAuB;AACpCQ,QAAAA,IAAI,EAAE5C,UAAU,CAAC,CAAD,CADoB;AAEpC6F,QAAAA,MAAM,EAAE7F,UAAU,CAAC6F,MAAD,CAFkB;AAGpCnB,QAAAA,KAAK,EAAE1E,UAAU,CAAC,KAAK6D,SAAL,CAAe8B,SAAhB;AAHmB,OAAvB,CAAjB;AAKH;AACJ,GA9BD;;AA+BA3E,EAAAA,WAAW,CAACtB,SAAZ,CAAsB+M,qBAAtB,GAA8C,UAAU9I,CAAV,EAAa;AACvD,QAAI1D,iBAAiB,CAAC0D,CAAC,CAAC2F,MAAH,CAAjB,IAAgC3F,CAAC,CAAC2F,MAAF,IAAYrJ,iBAAiB,CAACJ,OAAO,CAAC8D,CAAC,CAAC2F,MAAH,EAAW,IAAX,CAAR,CAA7D,IACC3F,CAAC,CAAC2F,MAAF,IAAY3F,CAAC,CAAC2F,MAAF,CAASqJ,OAAT,KAAqB,KADtC,EAC8C;AAC1C;AACH;;AACD,SAAKhL,kBAAL;AACA,QAAIb,QAAQ,GAAG/G,MAAM,CAAC,EAAD,EAAK,KAAK8D,SAAL,CAAe8C,KAApB,EAA2B,IAA3B,EAAiC,IAAjC,CAArB;AACA,QAAI8H,aAAa,GAAG3H,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBG,OAAzB,CAAR,CAA0CsC,OAA1C,KAChBzD,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBC,SAAzB,CAAR,CAA4CwC,OAA5C,EADJ;AAEA,QAAImE,EAAE,GAAG7O,OAAO,CAAC,KAAKgE,SAAL,CAAeyF,MAAhB,EAAwB,IAAxB,CAAhB;;AACA,QAAI,CAACrJ,iBAAiB,CAACyO,EAAD,CAAtB,EAA4B;AACxB,UAAIc,EAAE,GAAGd,EAAE,CAACjH,aAAZ;AACA,WAAK5D,SAAL,CAAemJ,KAAf,GAAwBwC,EAAE,CAACT,QAAH,GAAcS,EAAE,CAACK,QAAH,CAAY/G,MAA3B,GAAqC4F,EAAE,CAACiB,SAA/D;AACA,UAAIiD,SAAS,GAAG,GAAG/F,KAAH,CAASC,IAAT,CAAc,KAAKvK,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqC,MAAMpM,GAAG,CAAC6F,gBAA/C,CAAd,CAAhB;AACAkI,MAAAA,EAAE,GAAGkE,SAAS,CAAC,KAAK/O,SAAL,CAAemJ,KAAhB,CAAd;AACA,UAAI7C,WAAW,GAAG,KAAK5H,MAAL,CAAY2H,kBAAZ,CAA+BwE,EAA/B,CAAlB;;AACA,UAAI,CAACzO,iBAAiB,CAACkK,WAAD,CAAtB,EAAqC;AACjC,YAAI,KAAK5H,MAAL,CAAY8D,iBAAZ,CAA8B0E,KAA9B,CAAoCC,SAApC,CAA8ClC,MAA9C,GAAuD,CAA3D,EAA8D;AAC1D,eAAKjF,SAAL,CAAeyE,UAAf,GAA4BtC,QAAQ,CAAC0I,EAAE,CAAChI,YAAH,CAAgB,kBAAhB,CAAD,EAAsC,EAAtC,CAApC;AACH;;AACD,YAAImM,UAAU,GAAG,IAAIvI,IAAJ,CAASH,WAAW,CAAC8F,OAAZ,CAAoB9F,WAAW,CAAC+F,OAAZ,KAAwB,KAAKvH,aAAjD,CAAT,CAAjB;AACA,YAAIzF,SAAS,GAAG,IAAIoH,IAAJ,CAASuI,UAAU,CAACtI,OAAX,EAAT,CAAhB;AACA,YAAIoE,OAAO,GAAG,IAAIrE,IAAJ,CAASpH,SAAS,CAACqH,OAAV,EAAT,CAAd;AACA,YAAIuI,aAAa,GAAGhM,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBC,SAAzB,CAAR,CAA4CwC,OAA5C,KACf7J,IAAI,CAAC0J,SAAL,CAAe,IAAIE,IAAJ,CAAS,CAACxD,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBC,SAAzB,CAAlB,CAAf,CAAD,CAAyEwC,OAAzE,EADJ;AAEArH,QAAAA,SAAS,GAAG,IAAIoH,IAAJ,CAASpH,SAAS,CAACqH,OAAV,KAAsBuI,aAA/B,CAAZ;AACAnE,QAAAA,OAAO,GAAG,IAAIrE,IAAJ,CAASpH,SAAS,CAACqH,OAAV,KAAsBkE,aAA/B,CAAV;AACA,aAAK5K,SAAL,CAAeuE,KAAf,GAAuB,IAAIkC,IAAJ,CAASpH,SAAS,CAACqH,OAAV,EAAT,CAAvB;AACA,aAAK1G,SAAL,CAAewE,GAAf,GAAqB,IAAIiC,IAAJ,CAASqE,OAAO,CAACpE,OAAR,EAAT,CAArB;AACH;AACJ;;AACD,QAAI5D,KAAK,GAAG,KAAK8J,eAAL,CAAqB,KAAK5M,SAAL,CAAeuE,KAApC,EAA2C,KAAKvE,SAAL,CAAewE,GAA1D,EAA+D,KAAKxE,SAAL,CAAe8C,KAA9E,CAAZ;AACA,SAAKoM,sBAAL,CAA4BpM,KAA5B;AACH,GAjCD;;AAkCA3F,EAAAA,WAAW,CAACtB,SAAZ,CAAsB8M,qBAAtB,GAA8C,UAAU7I,CAAV,EAAa;AACvD,QAAImD,QAAQ,GAAG/G,MAAM,CAAC,EAAD,EAAK,KAAK8D,SAAL,CAAe8C,KAApB,EAA2B,IAA3B,EAAiC,IAAjC,CAArB;AACA,QAAI8H,aAAa,GAAG3H,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBG,OAAzB,CAAR,CAA0CsC,OAA1C,KAChBzD,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBC,SAAzB,CAAR,CAA4CwC,OAA5C,EADJ;AAEA,QAAIpF,UAAU,GAAG,KAAK5C,MAAL,CAAYqD,SAAZ,GAAwBJ,IAAI,CAACsE,GAAL,CAAS,KAAKjG,SAAL,CAAezB,KAAf,CAAqB+C,UAA9B,IAA4C,KAAKtB,SAAL,CAAezB,KAAf,CAAqBsD,WAAzF,GACbM,QAAQ,CAAC,KAAKnC,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B/B,IAA5B,EAAkC,EAAlC,CADZ;AAEAuC,IAAAA,UAAU,GAAGK,IAAI,CAAC4J,KAAL,CAAWjK,UAAU,GAAG,KAAKtB,SAAL,CAAe8B,SAAvC,IAAoD,KAAK9B,SAAL,CAAe8B,SAAhF;AACA,QAAIqN,WAAJ;;AACA,QAAI,KAAKzQ,MAAL,CAAYqD,SAAhB,EAA2B;AACvBoN,MAAAA,WAAW,GAAGxN,IAAI,CAACsE,GAAL,CAAS9D,QAAQ,CAAC,KAAKnC,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BF,KAA5B,EAAmC,EAAnC,CAAjB,CAAd;AACA,WAAKZ,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BF,KAA3B,GAAmCzE,UAAU,CAACgT,WAAD,CAA7C;AACH;;AACD7N,IAAAA,UAAU,GAAG,KAAK8N,cAAL,CAAoB9N,UAApB,EAAgC6N,WAAhC,CAAb;AACA,QAAIpD,QAAQ,GAAG,KAAKsD,cAAL,CAAoB/N,UAApB,CAAf;AACA,QAAIgO,UAAU,GAAG3N,IAAI,CAAC4J,KAAL,CAAW,CAAC,KAAKvL,SAAL,CAAegG,KAAf,GAAuB,KAAKhG,SAAL,CAAezB,KAAf,CAAqB2H,qBAArB,GAA6CnH,IAArE,IAA6E,KAAKiB,SAAL,CAAe8B,SAAvG,CAAjB;;AACA,QAAI,KAAKpD,MAAL,CAAYqD,SAAhB,EAA2B;AACvBuN,MAAAA,UAAU,GAAG3N,IAAI,CAACsE,GAAL,CAAStE,IAAI,CAAC4J,KAAL,CAAW,CAAC,KAAKvL,SAAL,CAAegG,KAAf,GAAuB,KAAKhG,SAAL,CAAezB,KAAf,CAAqB2H,qBAArB,GAA6CtF,KAArE,IAC7B,KAAKZ,SAAL,CAAe8B,SADG,CAAT,IACoB,CADjC;AAEH;;AACD,QAAI,KAAKpE,gBAAL,GAAwB,CAA5B,EAA+B;AAC3B,WAAK6R,WAAL,CAAiBzP,CAAjB,EAAoBmD,QAApB,EAA8B3B,UAA9B,EAA0CgO,UAA1C;AACH;;AACD,QAAI3D,EAAE,GAAG,KAAKjN,MAAL,CAAYmN,eAAZ,GAA8B1M,aAA9B,CAA4C,IAA5C,CAAT;AACA,QAAIgK,KAAK,GAAG,KAAKqG,qBAAL,CAA2BzD,QAA3B,EAAqCuD,UAArC,EAAiD3D,EAAjD,CAAZ;AACAxC,IAAAA,KAAK,GAAGA,KAAK,GAAG,CAAR,GAAY,CAAZ,GAAgBA,KAAxB;AACA,QAAIkC,UAAU,GAAG,KAAK1N,YAAL,GAAoB,IAAI8I,IAAJ,CAAS,KAAKtB,mBAAL,CAAyBsD,UAAzB,CAAoCU,KAApC,EAA2CzC,OAA3C,EAAT,CAApB,GACb,KAAKhI,MAAL,CAAY2H,kBAAZ,CAA+BsF,EAAE,CAACK,QAAH,CAAY7C,KAAZ,CAA/B,CADJ;;AAEA,QAAI,KAAKnL,cAAT,EAAyB;AACrB,UAAIyR,SAAS,GAAG,KAAKC,YAAL,CAAkB/D,EAAlB,EAAsBxC,KAAtB,CAAhB;;AACA,UAAIsG,SAAS,KAAK,CAAlB,EAAqB;AACjB,YAAIE,QAAQ,GAAGhO,IAAI,CAAC4I,KAAL,CAAWkF,SAAS,GAAG,KAAK5R,cAA5B,CAAf;AACAwN,QAAAA,UAAU,CAACa,UAAX,CAAsBb,UAAU,CAACc,UAAX,KAA2BwD,QAAQ,GAAG,KAAK3P,SAAL,CAAeoB,QAA3E;AACAiK,QAAAA,UAAU,CAACa,UAAX,CAAsBb,UAAU,CAACc,UAAX,KAA0B,KAAKpO,OAArD;AACH,OAJD,MAKK;AACDsN,QAAAA,UAAU,GAAG,KAAKrL,SAAL,CAAeuE,KAA5B;AACH;AACJ,KAVD,MAWK;AACD8G,MAAAA,UAAU,CAACa,UAAX,CAAsBb,UAAU,CAACc,UAAX,KACjB,KAAKzO,gBAAL,IAAyB,KAAKE,oBAAL,GAA4BV,eAA5B,GAA8C,KAAK8C,SAAL,CAAemB,YAAtF,CADL;AAEH;;AACDkK,IAAAA,UAAU,GAAG,KAAKuE,qBAAL,CAA2BvE,UAA3B,CAAb;;AACA,QAAI,KAAKzN,oBAAT,EAA+B;AAC3B,UAAIiS,QAAQ,GAAG5M,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwBC,SAAzB,CAAvB;AACAmH,MAAAA,UAAU,CAACiB,QAAX,CAAoBuD,QAAQ,CAACtD,QAAT,EAApB,EAAyCsD,QAAQ,CAAC1D,UAAT,EAAzC,EAAgE0D,QAAQ,CAACvH,UAAT,EAAhE;AACH;;AACD,QAAIgD,QAAQ,GAAG,IAAI7E,IAAJ,CAAS4E,UAAU,CAAC3E,OAAX,EAAT,CAAf;AACA4E,IAAAA,QAAQ,CAACP,eAAT,CAAyBH,aAAzB;AACA,QAAI9H,KAAK,GAAG,KAAK8J,eAAL,CAAqBvB,UAArB,EAAiCC,QAAjC,EAA2C,KAAKtL,SAAL,CAAe8C,KAA1D,CAAZ;AACA,QAAIlG,MAAM,GAAG,KAAKuI,mBAAL,CAAyBiJ,UAAzB,CAAoCtL,KAApC,EAA2C,KAAKqC,mBAAL,CAAyBsD,UAApE,CAAb;AACA,QAAIqH,SAAS,GAAGlT,MAAM,CAAC,CAAD,CAAN,CAAUwG,IAA1B;AACA,QAAIc,SAAS,GAAG,KAAKiB,mBAAL,CAAyB4K,YAAzB,CAAsCnT,MAAM,CAAC,CAAD,CAA5C,EAAiDkT,SAAjD,CAAhB;AACA,QAAI1L,OAAO,GAAG,KAAKe,mBAAL,CAAyB6K,UAAzB,CAAoCpT,MAAM,CAAC,CAAD,CAA1C,EAA+CkT,SAA/C,CAAd;AACA,QAAIjP,KAAK,GAAG,KAAKsE,mBAAL,CACR8K,aADQ,CACM/L,SADN,EACiBE,OADjB,EAC0BnB,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwB1B,QAAzB,CADlC,EACsEuN,SAAS,CAACrB,KADhF,CAAZ;AAEA,QAAIyB,GAAG,GAAG,KAAKxR,MAAL,CAAYyO,cAAZ,CAA2B,KAAKhI,mBAAL,CAAyBsD,UAApD,EAAgE5L,IAAI,CAAC0J,SAAL,CAAe,IAAIE,IAAJ,CAASvC,SAAS,CAACwC,OAAV,EAAT,CAAf,CAAhE,CAAV;AACAwJ,IAAAA,GAAG,GAAGA,GAAG,GAAG,CAAN,GAAU,CAAV,GAAcA,GAApB;AACA,QAAInR,IAAI,GAAG,KAAKoG,mBAAL,CAAyBgL,WAAzB,CAAqCjM,SAArC,EAAgDE,OAAhD,EAAyDnB,QAAQ,CAAC,KAAKvE,MAAL,CAAYuF,WAAZ,CAAwB1B,QAAzB,CAAjE,EAAqG2N,GAArG,CAAX;;AACA,QAAI,KAAKxR,MAAL,CAAYqD,SAAhB,EAA2B;AACvB,WAAK/B,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BF,KAA3B,GAAmCzE,UAAU,CAAC4C,IAAD,CAA7C;AACH,KAFD,MAGK;AACD,WAAKiB,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B/B,IAA3B,GAAkC5C,UAAU,CAAC4C,IAAD,CAA5C;AACH;;AACD,QAAI,CAAC,KAAKd,iBAAV,EAA6B;AACzB,WAAK+B,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BD,KAA3B,GAAmC1E,UAAU,CAAC0E,KAAD,CAA7C;AACH;;AACD,QAAI,KAAKnC,MAAL,CAAY8D,iBAAZ,CAA8B0E,KAA9B,CAAoCC,SAApC,CAA8ClC,MAA9C,GAAuD,CAA3D,EAA8D;AAC1D,WAAKmL,iCAAL,CAAuCtQ,CAAvC;AACH;;AACD,SAAKE,SAAL,CAAeuE,KAAf,GAAuB,IAAIkC,IAAJ,CAAS4E,UAAU,CAAC3E,OAAX,EAAT,CAAvB;AACA,SAAK1G,SAAL,CAAewE,GAAf,GAAqB,IAAIiC,IAAJ,CAAS6E,QAAQ,CAAC5E,OAAT,EAAT,CAArB;AACA,SAAKoG,kBAAL,CAAwB,KAAK9M,SAAL,CAAeuE,KAAvC;AACH,GA1ED;;AA2EApH,EAAAA,WAAW,CAACtB,SAAZ,CAAsBuT,cAAtB,GAAuC,UAAU9N,UAAV,EAAsB6N,WAAtB,EAAmC;AACtE,QAAI,KAAK/E,WAAL,CAAiBrL,IAAjB,IAAyB,KAAKqL,WAAL,CAAiBxJ,KAA9C,EAAqD;AACjD,UAAIyP,OAAO,GAAG,KAAK3R,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAAC6H,kBAA5C,CAAd;;AACA,UAAI,KAAKjG,MAAL,CAAYqD,SAAhB,EAA2B;AACvBoN,QAAAA,WAAW,GAAGkB,OAAO,CAACxO,WAAR,GAAsBwO,OAAO,CAAC/F,UAA5C;;AACA,YAAI,KAAKF,WAAL,CAAiBxJ,KAArB,EAA4B;AACxBuO,UAAAA,WAAW,GAAIA,WAAW,GAAGkB,OAAO,CAACxO,WAAtB,GAAoC,KAAK7B,SAAL,CAAezB,KAAf,CAAqBsD,WAA1D,IACT,KAAK7B,SAAL,CAAezB,KAAf,CAAqBsD,WAArB,GAAmC,KAAKrE,oBAD/B,CAAd;AAEH,SAHD,MAIK;AACD2R,UAAAA,WAAW,GAAGA,WAAW,GAAG,KAAK3R,oBAAjC;;AACA,cAAI2R,WAAW,GAAG,KAAK3R,oBAAnB,IAA2C6S,OAAO,CAACxL,WAAvD,EAAoE;AAChE,iBAAK7E,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2BD,KAA3B,GACI1E,UAAU,CAAC,KAAK6D,SAAL,CAAezB,KAAf,CAAqBsD,WAArB,GAAmC,KAAKrE,oBAAxC,GAA+D,KAAKwC,SAAL,CAAe8B,SAA/E,CADd;AAEAqN,YAAAA,WAAW,GAAIkB,OAAO,CAAC/F,UAAR,GAAqB+F,OAAO,CAACxL,WAA5C;AACH;AACJ;;AACD,aAAK7E,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B/B,IAA3B,GAAkC5C,UAAU,CAACgT,WAAD,CAA5C;AACH,OAfD,MAgBK;AACD,YAAI,KAAK/E,WAAL,CAAiBrL,IAArB,EAA2B;AACvBuC,UAAAA,UAAU,GAAG+O,OAAO,CAAC/F,UAAR,GAAqB,KAAK9M,oBAA1B,GAAiD,KAAKwC,SAAL,CAAe8B,SAA7E;;AACA,cAAIuO,OAAO,CAAC/F,UAAR,GAAqB+F,OAAO,CAACxO,WAA7B,IAA4CwO,OAAO,CAACxO,WAAxD,EAAqE;AACjEwO,YAAAA,OAAO,CAAC/F,UAAR,GAAqB+F,OAAO,CAAC/F,UAAR,GAAqB,CAA1C;AACH,WAFD,MAGK,IAAI,KAAKtK,SAAL,CAAezB,KAAf,CAAqB+C,UAArB,KAAoC,CAAxC,EAA2C;AAC5CA,YAAAA,UAAU,GAAG+O,OAAO,CAAC/F,UAArB;AACH;AACJ,SARD,MASK;AACDhJ,UAAAA,UAAU,GAAI+O,OAAO,CAAC/F,UAAR,GAAqB+F,OAAO,CAACxO,WAA7B,GACV,KAAK7B,SAAL,CAAezB,KAAf,CAAqBsD,WADZ,IAC4B,KAAK7B,SAAL,CAAezB,KAAf,CAAqBsD,WAArB,GAAmC,KAAKrE,oBADpE,CAAb;AAEH;;AACD8D,QAAAA,UAAU,GAAGA,UAAU,GAAG,CAAb,GAAiB,CAAjB,GAAqBA,UAAlC;AACA,aAAKtB,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B/B,IAA3B,GAAkC5C,UAAU,CAACmF,UAAD,CAA5C;AACH;AACJ;;AACD,WAAOA,UAAP;AACH,GAtCD;;AAuCAnE,EAAAA,WAAW,CAACtB,SAAZ,CAAsB6T,YAAtB,GAAqC,UAAU/D,EAAV,EAAcxC,KAAd,EAAqB;AACtD,QAAImH,KAAK,GAAG,KAAK1L,UAAL,CAAgBxG,OAAhB,CAAwB8H,qBAAxB,EAAZ;;AACA,QAAIoK,KAAK,CAACvR,IAAN,IAAc,KAAKiB,SAAL,CAAegG,KAA7B,IAAsCsK,KAAK,CAAC1P,KAAN,IAAe,KAAKZ,SAAL,CAAegG,KAAxE,EAA+E;AAC3E,UAAIuK,UAAU,GAAG5E,EAAE,CAACK,QAAH,CAAY7C,KAAZ,EAAmB7H,UAApC;AACA,UAAI0E,KAAK,GAAG,KAAKhG,SAAL,CAAegG,KAAf,GAAuBsK,KAAK,CAACvR,IAAzC;;AACA,UAAI,KAAKL,MAAL,CAAYqD,SAAhB,EAA2B;AACvB,eAAQwO,UAAU,GAAG,KAAKvQ,SAAL,CAAe8B,SAA7B,IAA2C,KAAK8C,UAAL,CAAgBxG,OAAhB,CAAwBkM,UAAxB,GAAqCtE,KAAhF,CAAP;AACH,OAFD,MAGK;AACD,eAAQ,KAAKpB,UAAL,CAAgBxG,OAAhB,CAAwBkM,UAAxB,GAAqCtE,KAAtC,GAA+CuK,UAAtD;AACH;AACJ;;AACD,WAAO,CAAP;AACH,GAbD;;AAcApT,EAAAA,WAAW,CAACtB,SAAZ,CAAsBwT,cAAtB,GAAuC,UAAU/N,UAAV,EAAsB;AACzD,QAAI6H,KAAK,GAAGxH,IAAI,CAAC4J,KAAL,CAAWjK,UAAU,GAAG,KAAKtB,SAAL,CAAe8B,SAAvC,CAAZ;;AACA,QAAI,KAAKnE,YAAT,EAAuB;AACnB,aAAOwL,KAAP;AACH;;AACD,WAAO,KAAKqH,QAAL,CAAcrH,KAAd,CAAP;AACH,GAND;;AAOAhM,EAAAA,WAAW,CAACtB,SAAZ,CAAsB2T,qBAAtB,GAA8C,UAAUzD,QAAV,EAAoBuD,UAApB,EAAgC3D,EAAhC,EAAoC;AAC9E,QAAIxC,KAAK,GAAG4C,QAAQ,GAAGuD,UAAvB;;AACA,QAAI,KAAK3R,YAAT,EAAuB;AACnB,UAAI8S,UAAU,GAAG9O,IAAI,CAAC4J,KAAL,CAAWI,EAAE,CAAC9J,WAAH,GAAiB,KAAK7B,SAAL,CAAe8B,SAA3C,CAAjB;AACA,aAAQqH,KAAK,GAAGsH,UAAU,GAAG,CAAtB,GAA2BA,UAAU,GAAG,CAAxC,GAA4CtH,KAAnD;AACH;;AACD,WAAQA,KAAK,GAAGwC,EAAE,CAACK,QAAH,CAAY/G,MAAZ,GAAqB,CAA9B,GAAmC0G,EAAE,CAACK,QAAH,CAAY/G,MAAZ,GAAqB,CAAxD,GAA4DkE,KAAnE;AACH,GAPD;;AAQAhM,EAAAA,WAAW,CAACtB,SAAZ,CAAsB0T,WAAtB,GAAoC,UAAUzP,CAAV,EAAagD,KAAb,EAAoB/D,IAApB,EAA0BoK,KAA1B,EAAiC;AACjE,QAAI0B,EAAE,GAAG7O,OAAO,CAAC8D,CAAC,CAAC2F,MAAH,EAAW,eAAX,CAAhB;;AACA,QAAI,CAACrJ,iBAAiB,CAACyO,EAAD,CAAlB,IAA0B,CAAC,KAAK5M,iBAApC,EAAuD;AACnD,UAAIyS,UAAU,GAAG,KAAKhS,MAAL,CAAY2H,kBAAZ,CAA+BwE,EAA/B,CAAjB;;AACA,UAAI,KAAKlN,YAAT,EAAuB;AACnB,YAAIgT,YAAY,GAAGhP,IAAI,CAAC4J,KAAL,CAAWxM,IAAI,GAAG,KAAKiB,SAAL,CAAe8B,SAAjC,CAAnB;AACA4O,QAAAA,UAAU,GAAG,IAAIjK,IAAJ,CAAS,KAAKtB,mBAAL,CAAyBsD,UAAzB,CAAoCkI,YAAY,GAAGxH,KAAnD,EAA0DzC,OAA1D,EAAT,CAAb;AACH;;AACD,UAAIiJ,QAAQ,GAAGe,UAAU,CAAChK,OAAX,KAAuB5D,KAAK,CAAC,KAAKpE,MAAL,CAAYuF,WAAZ,CAAwBC,SAAzB,CAAL,CAAyCwC,OAAzC,EAAtC;;AACA,UAAI,KAAK9I,oBAAT,EAA+B;AAC3B,aAAKF,gBAAL,GAAwBiE,IAAI,CAACsE,GAAL,CAAStE,IAAI,CAACC,IAAL,CAAU+N,QAAQ,GAAI9S,IAAI,CAAC8J,UAA3B,CAAT,CAAxB;AACH,OAFD,MAGK;AACD,YAAI8I,SAAS,GAAG9N,IAAI,CAAC4J,KAAL,CAAYoE,QAAQ,GAAG9S,IAAI,CAAC6K,aAAjB,IAAmC,KAAK1H,SAAL,CAAemB,YAAf,GAA8B,KAAKnB,SAAL,CAAe8B,SAAhF,CAAX,CAAhB;AACA,aAAKpE,gBAAL,GAAwBiE,IAAI,CAAC4J,KAAL,CAAWkE,SAAS,GAAG,KAAKzP,SAAL,CAAe8B,SAAtC,CAAxB;AACA,aAAKpE,gBAAL,GAAwB,KAAKA,gBAAL,GAAwB,CAAxB,GAA4B,CAA5B,GAAgC,KAAKA,gBAA7D;AACH;AACJ,KAfD,MAgBK;AACD,WAAKA,gBAAL,GAAwB,CAAxB;AACH;AACJ,GArBD;;AAsBAP,EAAAA,WAAW,CAACtB,SAAZ,CAAsBuU,iCAAtB,GAA0D,UAAUtQ,CAAV,EAAa;AACnE,QAAIb,QAAQ,GAAG,KAAKP,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAAC6H,kBAA5C,CAAf;AACA,QAAIiM,YAAY,GAAG,GAAG5H,KAAH,CAASC,IAAT,CAAc,KAAKvK,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqC,oDAArC,CAAd,CAAnB;AACA,QAAI2H,UAAU,GAAGhU,IAAI,CAACiU,aAAL,CAAmB7R,QAAQ,CAACE,aAAT,CAAuB,OAAvB,CAAnB,CAAjB;AACA0R,IAAAA,UAAU,GAAIzU,iBAAiB,CAACyU,UAAD,CAAlB,GAAkC,CAAlC,GAAsCA,UAAnD;AACA,QAAIE,SAAS,GAAI,KAAKrS,MAAL,CAAYsS,aAAb,GACZ,CAAC,EAAE/R,QAAQ,CAACE,aAAT,CAAuB,OAAvB,EAAgCmD,YAAhC,GAA+CsO,YAAY,CAAC3L,MAA9D,CADW,GAC6D,KAAKjF,SAAL,CAAekB,UAD5F;AAEA,QAAIgK,QAAQ,GAAGvJ,IAAI,CAAC4J,KAAL,CAAW5J,IAAI,CAAC4J,KAAL,CAAY,KAAKvL,SAAL,CAAe6F,CAAf,IAAoB5G,QAAQ,CAACuM,SAAT,GAAqBqF,UAArB,GAAkC1I,MAAM,CAAC8I,OAA7D,CAAD,GACjChS,QAAQ,CAACiH,qBAAT,GAAiClH,GADX,IACkB+R,SAD7B,CAAf;AAEA7F,IAAAA,QAAQ,GAAIA,QAAQ,GAAG,CAAZ,GAAiB,CAAjB,GAAsBA,QAAQ,GAAG0F,YAAY,CAAC3L,MAAb,GAAsB,CAAlC,GAAuC2L,YAAY,CAAC3L,MAAb,GAAsB,CAA7D,GAAiEiG,QAAjG;AACA,SAAKlL,SAAL,CAAemJ,KAAf,GAAuB+B,QAAvB;AACA,QAAIF,cAAc,GAAG,KAAKtM,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqC,yCAArC,EAAgFQ,IAAhF,CAAqFwB,QAArF,CAArB;AACA,QAAID,YAAY,GAAGD,cAAc,CAAC7L,aAAf,CAA6B,MAAMrC,GAAG,CAACuM,yBAAvC,CAAnB;;AACA,QAAI,CAAC4B,YAAL,EAAmB;AACfA,MAAAA,YAAY,GAAGlP,aAAa,CAAC,KAAD,EAAQ;AAAEuN,QAAAA,SAAS,EAAExM,GAAG,CAACuM;AAAjB,OAAR,CAA5B;AACA2B,MAAAA,cAAc,CAACzB,WAAf,CAA2B0B,YAA3B;AACH;;AACD,SAAKE,kBAAL,CAAwBF,YAAxB;AACA,QAAIJ,EAAE,GAAG7O,OAAO,CAAC8D,CAAC,CAAC2F,MAAH,EAAW,IAAX,CAAhB;AACA,SAAKzF,SAAL,CAAeyE,UAAf,GAA6BoG,EAAE,IAAI,CAACqG,KAAK,CAAC/O,QAAQ,CAAC0I,EAAE,CAAChI,YAAH,CAAgB,kBAAhB,CAAD,EAAsC,EAAtC,CAAT,CAAb,GACtBV,QAAQ,CAAC0I,EAAE,CAAChI,YAAH,CAAgB,kBAAhB,CAAD,EAAsC,EAAtC,CADc,GAC8B,KAAK7C,SAAL,CAAeyE,UADzE;AAEA,QAAIzF,GAAG,GAAG4R,YAAY,CAAC1F,QAAD,CAAZ,CAAuBnK,SAAjC;;AACA,QAAI,KAAKrC,MAAL,CAAYsS,aAAhB,EAA+B;AAC3B,UAAIG,aAAa,GAAG,KAAKC,gBAAL,CAAsBtR,CAAtB,CAApB;;AACA,UAAIqR,aAAJ,EAAmB;AACfnS,QAAAA,GAAG,GAAGmS,aAAa,CAAC3Q,SAAd,CAAwBC,QAAxB,CAAiC3D,GAAG,CAAC6F,gBAArC,IAAyDwO,aAAa,CAACpQ,SAAvE,GACFoQ,aAAa,CAAC3P,YAAd,CAA2BhB,SAA3B,CAAqCC,QAArC,CAA8C3D,GAAG,CAACuU,iBAAlD,IACIF,aAAa,CAAC3P,YAAd,CAA2BT,SAD/B,GAC2C/B,GAF/C;AAGH;AACJ;;AACD,SAAKgB,SAAL,CAAezB,KAAf,CAAqBuC,KAArB,CAA2B9B,GAA3B,GAAiC7C,UAAU,CAAC6C,GAAD,CAA3C;AACH,GA/BD;;AAgCA7B,EAAAA,WAAW,CAACtB,SAAZ,CAAsBsP,kBAAtB,GAA2C,UAAU/M,OAAV,EAAmB;AAC1D,QAAI,KAAKM,MAAL,CAAYG,aAAhB,EAA+B;AAC3BK,MAAAA,QAAQ,CAACC,aAAT,CAAuB,KAAKT,MAAL,CAAYG,aAAnC,EAAkD0K,WAAlD,CAA8D,KAAKvJ,SAAL,CAAezB,KAA7E;AACH,KAFD,MAGK;AACDH,MAAAA,OAAO,CAACmL,WAAR,CAAoB,KAAKvJ,SAAL,CAAezB,KAAnC;AACH;AACJ,GAPD;;AAQApB,EAAAA,WAAW,CAACtB,SAAZ,CAAsBoQ,eAAtB,GAAwC,UAAU9C,KAAV,EAAiB;AACrD,QAAI8B,YAAJ;AACA,QAAI/M,YAAY,GAAG,KAAK8B,SAAL,CAAezB,KAAf,CAAqBiC,SAArB,CAA+BC,QAA/B,CAAwC3D,GAAG,CAAC4D,wBAA5C,CAAnB;;AACA,QAAI,KAAKhC,MAAL,CAAY8D,iBAAZ,CAA8BpC,SAA9B,CAAwCC,MAA5C,EAAoD;AAChD,UAAImJ,YAAY,GAAGtL,YAAY,GAAG,MAAMpB,GAAG,CAAC2M,gCAAb,GAAgD,MAAM3M,GAAG,CAACuM,yBAAzF;AACA4B,MAAAA,YAAY,GAAG,KAAKvM,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqCM,YAArC,EAAmDE,IAAnD,CAAwDP,KAAxD,CAAf;AACH,KAHD,MAIK;AACD,UAAIC,aAAa,GAAG,KAAK1K,MAAL,CAAYN,OAAZ,CAAoB8K,gBAApB,CAAqC,MAAMpM,GAAG,CAAC6F,gBAA/C,EAAiE+G,IAAjE,CAAsEP,KAAtE,CAApB;AACA8B,MAAAA,YAAY,GAAG7B,aAAa,CAACjK,aAAd,CAA4B,MAAMrC,GAAG,CAACuM,yBAAtC,CAAf;;AACA,UAAI,CAAC4B,YAAL,EAAmB;AACfA,QAAAA,YAAY,GAAGlP,aAAa,CAAC,KAAD,EAAQ;AAAEuN,UAAAA,SAAS,EAAExM,GAAG,CAACuM;AAAjB,SAAR,CAA5B;AACAD,QAAAA,aAAa,CAACG,WAAd,CAA0B0B,YAA1B;AACH;AACJ;;AACD,WAAOA,YAAP;AACH,GAhBD;;AAiBA9N,EAAAA,WAAW,CAACtB,SAAZ,CAAsB+N,oBAAtB,GAA6C,YAAY;AACrD,QAAIqB,YAAY,GAAGlP,aAAa,CAAC,KAAD,EAAQ;AAAEuN,MAAAA,SAAS,EAAExM,GAAG,CAACuU;AAAjB,KAAR,CAAhC;AACA,SAAK3S,MAAL,CAAYN,OAAZ,CAAoBe,aAApB,CAAkC,MAAMrC,GAAG,CAAC2M,gCAA5C,EAA8EF,WAA9E,CAA0F0B,YAA1F;AACA,QAAIqG,WAAW,GAAGrG,YAAY,CAAC3I,YAA/B;AACAhG,IAAAA,MAAM,CAAC2O,YAAD,CAAN;AACA,WAAOqG,WAAP;AACH,GAND;;AAOAnU,EAAAA,WAAW,CAACtB,SAAZ,CAAsBiM,WAAtB,GAAoC,UAAUhI,CAAV,EAAa;AAC7C,QAAI,CAAC,KAAKE,SAAL,CAAeqD,gBAApB,EAAsC;AAClC,aAAO,KAAP;AACH;;AACD,QAAIkO,aAAa,GAAG,KAAKvR,SAAL,CAAeqD,gBAAf,CAAgCmO,KAAhC,CAAsC,GAAtC,CAApB;AACA,QAAI1J,WAAW,GAAG,KAAlB;;AACA,SAAK,IAAI2J,EAAE,GAAG,CAAT,EAAYC,eAAe,GAAGH,aAAnC,EAAkDE,EAAE,GAAGC,eAAe,CAACzM,MAAvE,EAA+EwM,EAAE,EAAjF,EAAqF;AACjF,UAAIE,QAAQ,GAAGD,eAAe,CAACD,EAAD,CAA9B;;AACA,UAAI3R,CAAC,CAAC2F,MAAF,CAASjF,SAAT,CAAmBC,QAAnB,CAA4BkR,QAA5B,CAAJ,EAA2C;AACvC7J,QAAAA,WAAW,GAAG,IAAd;AACA;AACH;AACJ;;AACD,WAAOA,WAAP;AACH,GAdD;AAeA;;;;;AAGA3K,EAAAA,WAAW,CAACtB,SAAZ,CAAsB+V,aAAtB,GAAsC,YAAY;AAC9C,WAAO,aAAP;AACH,GAFD;;AAGA,SAAOzU,WAAP;AACH,CAl2BgC,CAk2B/BR,UAl2B+B,CAAjC;;AAm2BA,SAASQ,WAAT","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { createElement, closest, Draggable, extend, formatUnit, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { addClass, remove, removeClass, setStyleAttribute, isBlazor, getElement } from '@syncfusion/ej2-base';\nimport { ActionBase } from '../actions/action-base';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport { MonthEvent } from '../event-renderer/month';\nimport { TimelineEvent } from '../event-renderer/timeline-view';\nimport { VerticalEvent } from '../event-renderer/vertical-view';\nvar MINUTES_PER_DAY = 1440;\n/**\n * Schedule events drag actions\n */\nvar DragAndDrop = /** @class */ (function (_super) {\n    __extends(DragAndDrop, _super);\n    function DragAndDrop() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.widthUptoCursorPoint = 0;\n        _this.heightUptoCursorPoint = 0;\n        _this.cursorPointIndex = 0;\n        _this.isHeaderRows = false;\n        _this.isTimelineDayProcess = false;\n        _this.widthPerMinute = 0;\n        _this.heightPerMinute = 0;\n        _this.minDiff = 0;\n        _this.isStepDragging = false;\n        _this.isMorePopupOpened = false;\n        _this.isAllDayDrag = false;\n        return _this;\n    }\n    DragAndDrop.prototype.wireDragEvent = function (element) {\n        new Draggable(element, {\n            abort: '.' + cls.EVENT_RESIZE_CLASS,\n            clone: true,\n            isDragScroll: true,\n            enableTapHold: this.parent.isAdaptive,\n            enableTailMode: (this.parent.eventDragArea) ? true : false,\n            cursorAt: (this.parent.eventDragArea) ? { left: -20, top: -20 } : { left: 0, top: 0 },\n            dragArea: (this.parent.eventDragArea) ?\n                document.querySelector(this.parent.eventDragArea) :\n                this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS),\n            dragStart: this.dragStart.bind(this),\n            drag: this.drag.bind(this),\n            dragStop: this.dragStop.bind(this),\n            enableAutoScroll: false,\n            helper: this.dragHelper.bind(this),\n            queryPositionInfo: this.dragPosition.bind(this)\n        });\n    };\n    DragAndDrop.prototype.dragHelper = function (e) {\n        this.setDragActionDefaultValues();\n        this.actionObj.element = e.element;\n        this.actionObj.action = 'drag';\n        this.actionObj.clone = this.createCloneElement(this.actionObj.element);\n        if (!this.parent.eventDragArea && this.parent.currentView !== 'Month' &&\n            this.parent.timeScale.enable && !this.parent.activeView.isTimelineView() &&\n            !this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n            setStyleAttribute(this.actionObj.clone, { cursor: 'move', left: '0%', right: '0%', width: '100%' });\n        }\n        this.actionObj.clone.style.top = formatUnit(this.actionObj.element.offsetTop);\n        this.actionObj.cloneElement = [this.actionObj.clone];\n        this.actionObj.originalElement = [this.actionObj.element];\n        return this.actionObj.clone;\n    };\n    DragAndDrop.prototype.dragPosition = function (e) {\n        if (this.parent.eventDragArea) {\n            return { left: e.left, top: e.top };\n        }\n        var cellHeight = (this.actionObj.cellHeight / this.actionObj.slotInterval) * this.actionObj.interval;\n        var leftValue = formatUnit(0);\n        if (this.parent.currentView === 'Month') {\n            leftValue = e.left;\n        }\n        if (this.parent.activeView.isTimelineView()) {\n            leftValue = formatUnit(this.actionObj.clone.offsetLeft);\n        }\n        var topValue;\n        if ((this.parent.activeView.isTimelineView() || !this.parent.timeScale.enable ||\n            (!isNullOrUndefined(this.actionObj.clone.offsetParent) &&\n                this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)))) {\n            topValue = formatUnit(this.actionObj.clone.offsetTop);\n        }\n        else if (this.parent.currentView === 'Month') {\n            topValue = formatUnit(0);\n        }\n        else if (this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n            topValue = formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop);\n            setStyleAttribute(this.actionObj.clone, {\n                width: formatUnit(Math.ceil(this.actionObj.clone.offsetWidth / this.actionObj.cellWidth) * this.actionObj.cellWidth),\n                right: this.parent.enableRtl && formatUnit(0)\n            });\n        }\n        else {\n            if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) &&\n                !this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n                setStyleAttribute(this.actionObj.clone, {\n                    height: formatUnit(this.actionObj.cellHeight),\n                    width: formatUnit(this.actionObj.cellWidth - 1),\n                    pointerEvents: 'none'\n                });\n            }\n            var top_1 = parseInt(e.top, 10);\n            top_1 = top_1 < 0 ? 0 : top_1;\n            topValue = formatUnit(Math.ceil(top_1 / cellHeight) * cellHeight);\n            var scrollHeight = this.parent.element.querySelector('.e-content-wrap').scrollHeight;\n            var cloneBottom = parseInt(topValue, 10) + this.actionObj.clone.offsetHeight;\n            if (cloneBottom > scrollHeight) {\n                topValue = (parseInt(topValue, 10) - (cloneBottom - scrollHeight)) + 'px';\n            }\n        }\n        return { left: leftValue, top: topValue };\n    };\n    DragAndDrop.prototype.setDragActionDefaultValues = function () {\n        this.actionObj.action = 'drag';\n        this.actionObj.isAllDay = null;\n        this.actionObj.slotInterval = this.parent.activeViewOptions.timeScale.interval / this.parent.activeViewOptions.timeScale.slotCount;\n        this.actionObj.interval = this.actionObj.slotInterval;\n        var workCell = this.parent.element.querySelector('.' + cls.WORK_CELLS_CLASS);\n        this.actionObj.cellWidth = workCell.offsetWidth;\n        this.actionObj.cellHeight = workCell.offsetHeight;\n    };\n    DragAndDrop.prototype.dragStart = function (e) {\n        var _this = this;\n        var eventGuid = this.actionObj.element.getAttribute('data-guid');\n        this.actionObj.event = this.parent.eventBase.getEventByGuid(eventGuid);\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var dragArgs = {\n            cancel: false,\n            data: eventObj,\n            event: e,\n            excludeSelectors: null,\n            element: this.actionObj.element,\n            interval: this.actionObj.interval,\n            navigation: { enable: false, timeDelay: 2000 },\n            scroll: { enable: true, scrollBy: 30, timeDelay: 100 }\n        };\n        this.parent.trigger(events.dragStart, dragArgs, function (dragEventArgs) {\n            if (dragEventArgs.cancel || (!isNullOrUndefined(_this.actionObj.element) &&\n                isNullOrUndefined(_this.actionObj.element.parentElement))) {\n                _this.actionObj.action = '';\n                _this.removeCloneElementClasses();\n                _this.removeCloneElement();\n                return;\n            }\n            else if (isBlazor()) {\n                e.bindEvents(e.dragElement);\n                if (dragEventArgs.element) {\n                    dragEventArgs.element = getElement(dragEventArgs.element);\n                }\n                dragEventArgs.data[_this.parent.eventFields.startTime] = _this.parent.getDateTime(dragEventArgs.data[_this.parent.eventFields.startTime]);\n                dragEventArgs.data[_this.parent.eventFields.endTime] = _this.parent.getDateTime(dragEventArgs.data[_this.parent.eventFields.endTime]);\n            }\n            _this.actionClass('addClass');\n            _this.parent.uiStateValues.action = true;\n            _this.actionObj.start = eventObj[_this.parent.eventFields.startTime];\n            _this.actionObj.end = eventObj[_this.parent.eventFields.endTime];\n            _this.actionObj.groupIndex = parseInt(_this.actionObj.element.getAttribute('data-group-index') || '0', 10);\n            _this.actionObj.interval = dragEventArgs.interval;\n            _this.actionObj.navigation = dragEventArgs.navigation;\n            _this.actionObj.scroll = dragEventArgs.scroll;\n            _this.actionObj.excludeSelectors = dragEventArgs.excludeSelectors;\n            var viewElement = _this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            _this.scrollArgs = { element: viewElement, width: viewElement.scrollWidth, height: viewElement.scrollHeight };\n            _this.widthPerMinute = (_this.actionObj.cellWidth / _this.actionObj.slotInterval) * _this.actionObj.interval;\n            _this.heightPerMinute = (_this.actionObj.cellHeight / _this.actionObj.slotInterval) * _this.actionObj.interval;\n            _this.widthUptoCursorPoint = 0;\n            _this.heightUptoCursorPoint = 0;\n            _this.cursorPointIndex = -1;\n            _this.isHeaderRows = false;\n            _this.isTimelineDayProcess = false;\n            _this.minDiff = 0;\n            _this.isMorePopupOpened = false;\n            _this.daysVariation = -1;\n            if ((_this.parent.activeView.isTimelineView() || !_this.parent.timeScale.enable)) {\n                if (!isNullOrUndefined(_this.actionObj.clone.offsetParent) &&\n                    _this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n                    _this.isMorePopupOpened = true;\n                }\n                var rows = _this.parent.activeViewOptions.headerRows;\n                _this.isHeaderRows = rows.length > 0 && rows[rows.length - 1].option !== 'Hour' &&\n                    rows[rows.length - 1].option !== 'Date';\n                _this.isTimelineDayProcess = !_this.parent.activeViewOptions.timeScale.enable || _this.isHeaderRows ||\n                    _this.parent.currentView === 'TimelineMonth' || (rows.length > 0 && rows[rows.length - 1].option === 'Date');\n                _this.isStepDragging = !_this.isTimelineDayProcess && (_this.actionObj.slotInterval !== _this.actionObj.interval);\n                if (_this.isTimelineDayProcess) {\n                    _this.timelineEventModule = new TimelineEvent(_this.parent, 'day');\n                }\n                else {\n                    _this.timelineEventModule = new TimelineEvent(_this.parent, 'hour');\n                }\n            }\n            if (_this.parent.currentView === 'Month') {\n                _this.updateOriginalElement(_this.actionObj.clone);\n                _this.monthEvent = new MonthEvent(_this.parent);\n            }\n            if (_this.parent.currentView === 'Day' || _this.parent.currentView === 'Week' || _this.parent.currentView === 'WorkWeek') {\n                _this.verticalEvent = new VerticalEvent(_this.parent);\n            }\n        });\n    };\n    DragAndDrop.prototype.drag = function (e) {\n        this.parent.quickPopup.quickPopupHide(true);\n        if ((!isNullOrUndefined(e.target)) && e.target.classList.contains(cls.DISABLE_DATES)) {\n            return;\n        }\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventArgs = this.getPageCoordinates(e);\n        this.actionObj.Y = this.actionObj.pageY = eventArgs.pageY;\n        this.actionObj.X = this.actionObj.pageX = eventArgs.pageX;\n        this.actionObj.target = e.target;\n        this.widthUptoCursorPoint = (this.widthUptoCursorPoint === 0) ?\n            Math.ceil((Math.abs(this.actionObj.clone.getBoundingClientRect().left - this.actionObj.X) / this.widthPerMinute)) *\n                this.widthPerMinute : this.widthUptoCursorPoint;\n        this.widthUptoCursorPoint = this.isMorePopupOpened ? this.actionObj.cellWidth : this.widthUptoCursorPoint;\n        this.heightUptoCursorPoint = (this.heightUptoCursorPoint === 0) ?\n            Math.ceil((Math.abs(this.actionObj.clone.getBoundingClientRect().top - this.actionObj.Y) / this.heightPerMinute)) *\n                this.heightPerMinute : this.heightUptoCursorPoint;\n        this.isAllDayDrag = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS);\n        if (this.isStepDragging && this.minDiff === 0) {\n            this.calculateMinutesDiff(eventObj);\n        }\n        if ((this.parent.currentView === 'Month' || this.isAllDayDrag) && this.daysVariation < 0) {\n            var date = this.parent.getDateFromElement(this.actionObj.target);\n            if (!isNullOrUndefined(date)) {\n                var currentDate = util.resetTime(date);\n                var startDate = util.resetTime(new Date(eventObj[this.parent.eventFields.startTime].getTime()));\n                this.daysVariation = (currentDate.getTime() - startDate.getTime()) / util.MS_PER_DAY;\n            }\n            else {\n                this.daysVariation = 0;\n            }\n        }\n        if (this.parent.eventDragArea) {\n            var targetElement = eventArgs.target;\n            this.actionObj.clone.style.top = formatUnit(targetElement.offsetTop);\n            this.actionObj.clone.style.left = formatUnit(targetElement.offsetLeft);\n            var currentTarget = closest(targetElement, '.' + cls.ROOT);\n            if (!currentTarget) {\n                this.actionObj.clone.style.height = '';\n                this.actionObj.clone.style.width = '';\n            }\n            else {\n                if (!(this.parent.currentView === 'Week' || this.parent.currentView === 'WorkWeek'\n                    || this.parent.currentView === 'Day')) {\n                    this.actionObj.clone.style.width = formatUnit(this.actionObj.element.offsetWidth);\n                }\n            }\n        }\n        this.updateScrollPosition(e);\n        this.updateNavigatingPosition(e);\n        this.updateDraggingDateTime(e);\n        var dragArgs = {\n            data: eventObj, event: e, element: this.actionObj.element, startTime: this.actionObj.start,\n            endTime: this.actionObj.end\n        };\n        if (this.parent.group.resources.length > 0) {\n            dragArgs.groupIndex = this.actionObj.groupIndex;\n        }\n        this.parent.trigger(events.drag, dragArgs);\n    };\n    DragAndDrop.prototype.calculateMinutesDiff = function (eventObj) {\n        if (this.parent.enableRtl) {\n            this.minDiff =\n                ((this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint) / this.widthPerMinute) * this.actionObj.interval;\n        }\n        else {\n            this.minDiff = (this.widthUptoCursorPoint / this.widthPerMinute) * this.actionObj.interval;\n        }\n        var startDate = eventObj[this.parent.eventFields.startTime];\n        var startTime = this.parent.activeView.renderDates[0];\n        var startEndHours = util.getStartEndHours(startTime, this.parent.activeView.getStartHour(), this.parent.activeView.getEndHour());\n        if (startEndHours.startHour.getTime() > startDate.getTime()) {\n            this.minDiff = this.minDiff + ((startEndHours.startHour.getTime() - startDate.getTime()) / util.MS_PER_MINUTE);\n        }\n    };\n    DragAndDrop.prototype.dragStop = function (e) {\n        var _this = this;\n        this.removeCloneElementClasses();\n        this.removeCloneElement();\n        clearInterval(this.actionObj.navigationInterval);\n        this.actionObj.navigationInterval = null;\n        clearInterval(this.actionObj.scrollInterval);\n        this.actionObj.scrollInterval = null;\n        this.actionClass('removeClass');\n        this.parent.uiStateValues.action = false;\n        this.actionObj.action = null;\n        if (this.isAllowDrop(e)) {\n            return;\n        }\n        var dragArgs = { cancel: false, data: this.getChangedData(), event: e, element: this.actionObj.element };\n        this.parent.trigger(events.dragStop, dragArgs, function (dragEventArgs) {\n            if (dragEventArgs.cancel) {\n                return;\n            }\n            _this.saveChangedData(dragEventArgs);\n        });\n    };\n    DragAndDrop.prototype.updateNavigatingPosition = function (e) {\n        var _this = this;\n        if (this.actionObj.navigation.enable) {\n            var currentDate_1 = this.parent.getCurrentTime();\n            if (isNullOrUndefined(this.actionObj.navigationInterval)) {\n                this.actionObj.navigationInterval = window.setInterval(function () {\n                    if (currentDate_1) {\n                        var crtDate = _this.parent.getCurrentTime();\n                        var end = crtDate.getSeconds();\n                        var start = currentDate_1.getSeconds() + (_this.actionObj.navigation.timeDelay / 1000);\n                        start = (start >= 60) ? start - 60 : start;\n                        if (start === end) {\n                            currentDate_1 = _this.parent.getCurrentTime();\n                            _this.viewNavigation(e);\n                            _this.updateDraggingDateTime(e);\n                        }\n                    }\n                }, this.actionObj.navigation.timeDelay);\n            }\n        }\n    };\n    DragAndDrop.prototype.updateDraggingDateTime = function (e) {\n        if (!isNullOrUndefined(this.actionObj.clone.offsetParent) &&\n            this.actionObj.clone.offsetParent.classList.contains(cls.MORE_EVENT_POPUP_CLASS)) {\n            this.morePopupEventDragging(e);\n        }\n        else if (this.parent.activeView.isTimelineView()) {\n            this.timelineEventModule.dateRender = this.parent.activeView.renderDates;\n            this.timelineEventModule.cellWidth = this.actionObj.cellWidth;\n            this.timelineEventModule.getSlotDates();\n            this.actionObj.cellWidth = this.isHeaderRows ? this.timelineEventModule.cellWidth : this.actionObj.cellWidth;\n            this.calculateTimelineTime(e);\n        }\n        else {\n            if (this.parent.currentView === 'Month') {\n                this.calculateVerticalDate(e);\n            }\n            else {\n                this.calculateVerticalTime(e);\n            }\n        }\n    };\n    DragAndDrop.prototype.navigationWrapper = function () {\n        if (!this.parent.activeView.isTimelineView()) {\n            if (this.parent.currentView === 'Month' || !this.parent.timeScale.enable) {\n                var outerWrapperCls = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n                this.actionObj.index = (this.parent.activeView.renderDates.length < this.actionObj.index) ?\n                    this.parent.activeView.renderDates.length - 1 : this.actionObj.index;\n                var targetWrapper = outerWrapperCls[this.actionObj.index].querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n                if (!targetWrapper) {\n                    targetWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n                    outerWrapperCls[this.actionObj.index].appendChild(targetWrapper);\n                }\n                targetWrapper.appendChild(this.actionObj.clone);\n            }\n            else {\n                var wrapperClass = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) ?\n                    '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n                this.parent.element.querySelectorAll(wrapperClass)\n                    .item(this.actionObj.index).appendChild(this.actionObj.clone);\n                if (wrapperClass === '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS) {\n                    var elementHeight_1 = this.getAllDayEventHeight();\n                    var event_1 = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n                    if (event_1[0].offsetHeight < elementHeight_1) {\n                        event_1.forEach(function (element) { return element.style.height = ((elementHeight_1 + 2) / 12) + 'em'; });\n                    }\n                    this.actionObj.clone.style.height = formatUnit(elementHeight_1);\n                }\n                this.actionObj.height = parseInt(this.actionObj.clone.style.height, 0);\n            }\n        }\n        else {\n            var outWrapper = void 0;\n            if (this.parent.activeViewOptions.group.resources.length > 0) {\n                outWrapper = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(this.actionObj.index);\n            }\n            else {\n                outWrapper = this.parent.element.querySelector('.' + cls.APPOINTMENT_CONTAINER_CLASS);\n            }\n            var tarWrapper = outWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n            if (!tarWrapper) {\n                tarWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n                outWrapper.appendChild(tarWrapper);\n            }\n            tarWrapper.appendChild(this.actionObj.clone);\n        }\n    };\n    DragAndDrop.prototype.viewNavigation = function (e) {\n        var navigationType;\n        var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        if (dragArea && ((!this.scrollEdges.top && !this.scrollEdges.bottom) ||\n            closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS))) {\n            if ((dragArea.scrollLeft === 0) &&\n                (Math.round(this.actionObj.X) <=\n                    Math.round(dragArea.getBoundingClientRect().left + this.actionObj.cellWidth + window.pageXOffset))) {\n                navigationType = this.parent.enableRtl ? 'next' : 'previous';\n            }\n            else if ((Math.round(dragArea.scrollLeft) + dragArea.clientWidth === dragArea.scrollWidth) &&\n                (Math.round(this.actionObj.X) >=\n                    Math.round(dragArea.getBoundingClientRect().right - this.actionObj.cellWidth + window.pageXOffset))) {\n                navigationType = this.parent.enableRtl ? 'previous' : 'next';\n            }\n            if (navigationType) {\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate(navigationType));\n            }\n        }\n    };\n    DragAndDrop.prototype.morePopupEventDragging = function (e) {\n        if (isNullOrUndefined(e.target) || (e.target && isNullOrUndefined(closest(e.target, 'td')))) {\n            return;\n        }\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() -\n            eventObj[this.parent.eventFields.startTime].getTime();\n        var td = closest(e.target, 'td');\n        var dragStart = this.parent.getDateFromElement(td);\n        var dragEnd = new Date(dragStart.getTime());\n        dragEnd.setMilliseconds(eventDuration);\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n        }\n        this.actionObj.start = new Date(dragStart.getTime());\n        this.actionObj.end = new Date(dragEnd.getTime());\n        this.actionObj.clone.style.top = formatUnit(td.offsetParent.offsetTop);\n        this.actionObj.clone.style.left = formatUnit(td.offsetLeft);\n        this.actionObj.clone.style.width = formatUnit(td.offsetWidth);\n        var eventContainer = td;\n        var eventWrapper;\n        if (this.parent.activeView.isTimelineView()) {\n            var rowIndex = closest(td, 'tr').rowIndex;\n            eventContainer = this.parent.element.querySelectorAll('.e-appointment-container').item(rowIndex);\n        }\n        eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n        if (!eventWrapper) {\n            eventWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n            eventContainer.appendChild(eventWrapper);\n        }\n        this.appendCloneElement(eventWrapper);\n    };\n    DragAndDrop.prototype.calculateVerticalTime = function (e) {\n        if (isNullOrUndefined(this.actionObj.target) ||\n            (this.actionObj.target && isNullOrUndefined(closest(this.actionObj.target, 'tr'))) ||\n            (!(closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS)) &&\n                !(closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)))) {\n            return;\n        }\n        if (this.parent.activeViewOptions.timeScale.enable) {\n            this.swapDragging(e);\n        }\n        var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventStart = eventObj[this.parent.eventFields.startTime];\n        var eventEnd = eventObj[this.parent.eventFields.endTime];\n        var eventDuration = eventEnd.getTime() - eventStart.getTime();\n        var offsetTop = Math.floor(parseInt(this.actionObj.clone.style.top, 10) / this.actionObj.cellHeight)\n            * this.actionObj.cellHeight;\n        offsetTop = offsetTop < 0 ? 0 : offsetTop;\n        if (this.scrollEdges.top || this.scrollEdges.bottom) {\n            offsetTop = this.scrollEdges.top ? dragArea.scrollTop - this.heightUptoCursorPoint +\n                this.actionObj.cellHeight + window.pageYOffset :\n                (dragArea.scrollTop + dragArea.offsetHeight - this.actionObj.clone.offsetHeight + window.pageYOffset) +\n                    (this.actionObj.clone.offsetHeight - this.heightUptoCursorPoint);\n            offsetTop = Math.round(offsetTop / this.actionObj.cellHeight) * this.actionObj.cellHeight;\n            this.actionObj.clone.style.top = formatUnit(offsetTop);\n        }\n        var rowIndex = offsetTop / this.actionObj.cellHeight;\n        var heightPerMinute = this.actionObj.cellHeight / this.actionObj.slotInterval;\n        var diffInMinutes = parseInt(this.actionObj.clone.style.top, 10) - offsetTop;\n        var tr;\n        if (this.isAllDayDrag) {\n            tr = this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS);\n        }\n        else {\n            var trCollections = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n            tr = trCollections[rowIndex];\n        }\n        var index;\n        if (closest(this.actionObj.target, 'td').classList.contains(cls.WORK_CELLS_CLASS) ||\n            closest(this.actionObj.target, 'td').classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            index = closest(this.actionObj.target, 'td').cellIndex;\n        }\n        var colIndex = isNullOrUndefined(index) ? closest(this.actionObj.clone, 'td').cellIndex : index;\n        this.actionObj.index = colIndex;\n        if (isNullOrUndefined(tr)) {\n            return;\n        }\n        var td = tr.children[colIndex];\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n        }\n        var dragStart;\n        var dragEnd;\n        if (this.parent.activeViewOptions.timeScale.enable && !this.isAllDayDrag) {\n            this.appendCloneElement(this.getEventWrapper(colIndex));\n            dragStart = this.parent.getDateFromElement(td);\n            dragStart.setMinutes(dragStart.getMinutes() + (diffInMinutes / heightPerMinute));\n            dragEnd = new Date(dragStart.getTime());\n            if (this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n                dragEnd.setMinutes(dragEnd.getMinutes() + this.actionObj.slotInterval);\n            }\n            else {\n                dragEnd.setMilliseconds(eventDuration);\n            }\n        }\n        else {\n            dragStart = this.parent.getDateFromElement(td);\n            dragStart.setDate(dragStart.getDate() - this.daysVariation);\n            dragStart.setHours(eventStart.getHours(), eventStart.getMinutes(), eventStart.getSeconds());\n            dragEnd = new Date(dragStart.getTime());\n            dragEnd.setMilliseconds(eventDuration);\n            if (!this.actionObj.element.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS) &&\n                this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS)) {\n                dragEnd = util.addDays(util.resetTime(dragEnd), 1);\n            }\n            this.updateAllDayEvents(dragStart, dragEnd, this.parent.activeViewOptions.group.byDate ? colIndex : undefined);\n        }\n        this.actionObj.start = new Date(+dragStart);\n        this.actionObj.end = new Date(+dragEnd);\n        var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n        this.updateEventHeight(event);\n        this.updateTimePosition(this.actionObj.start);\n    };\n    DragAndDrop.prototype.updateEventHeight = function (event) {\n        this.verticalEvent.initializeValues();\n        var datesCount = 0;\n        for (var i = 0; i < this.actionObj.groupIndex; i++) {\n            datesCount = datesCount + this.verticalEvent.dateRender[i].length;\n        }\n        var dayIndex = !this.parent.activeViewOptions.group.byDate ? this.actionObj.index - datesCount\n            : this.parent.getIndexOfDate(this.verticalEvent.dateRender[this.actionObj.groupIndex], util.resetTime(this.parent.getDateFromElement(this.actionObj.target)));\n        var record = this.verticalEvent.isSpannedEvent(event, dayIndex, this.actionObj.groupIndex);\n        var eStart = record[this.verticalEvent.fields.startTime];\n        var eEnd = record[this.verticalEvent.fields.endTime];\n        var topValue = 0;\n        var appHeight = this.verticalEvent.getHeight(eStart, eEnd);\n        topValue = this.verticalEvent.getTopValue(eStart, dayIndex, this.actionObj.groupIndex);\n        this.actionObj.clone.style.top = formatUnit(topValue);\n        this.actionObj.clone.style.height = formatUnit(appHeight);\n    };\n    DragAndDrop.prototype.updateAllDayEvents = function (startDate, endDate, colIndex) {\n        var _this = this;\n        this.parent.eventBase.slots = [];\n        var event = this.getUpdatedEvent(startDate, endDate, this.actionObj.event);\n        var renderDates = this.parent.activeView.renderDates;\n        this.parent.eventBase.slots.push(this.parent.activeView.renderDates.map(function (date) { return +date; }));\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.parent.eventBase.slots = [];\n            var resources = this.parent.resourceBase.lastResourceLevel.\n                filter(function (res) { return res.groupIndex === _this.actionObj.groupIndex; });\n            renderDates = resources[0].renderDates;\n            this.parent.eventBase.slots.push(renderDates.map(function (date) { return +date; }));\n        }\n        var events = this.parent.eventBase.splitEvent(event, renderDates);\n        var query = '.e-all-day-cells[data-date=\"' +\n            this.parent.getMsFromDate(events[0][this.parent.eventFields.startTime]) + '\"]';\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            query = query.concat('[data-group-index = \"' + this.actionObj.groupIndex + '\"]');\n        }\n        var cell = [].slice.call(this.parent.element.querySelectorAll(query));\n        if (cell.length > 0 || !isNullOrUndefined(colIndex)) {\n            var cellIndex = !isNullOrUndefined(colIndex) ? colIndex : cell[0].cellIndex;\n            this.appendCloneElement(this.getEventWrapper(cellIndex));\n            this.actionObj.clone.style.width =\n                formatUnit(events[0].data.count * this.actionObj.cellWidth);\n        }\n    };\n    DragAndDrop.prototype.swapDragging = function (e) {\n        var colIndex = closest(this.actionObj.target, 'td').cellIndex;\n        if (closest(this.actionObj.target, '.' + cls.DATE_HEADER_WRAP_CLASS) &&\n            !closest(this.actionObj.clone, '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS)) {\n            addClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n            this.appendCloneElement(this.getEventWrapper(colIndex));\n            this.actionObj.isAllDay = true;\n            var eventHeight_1 = this.getAllDayEventHeight();\n            var allDayElement = [].slice.call(this.parent.element.querySelectorAll('.' + cls.ALLDAY_CELLS_CLASS + ':first-child'));\n            if (allDayElement[0].offsetHeight < eventHeight_1) {\n                allDayElement.forEach(function (element) { return element.style.height = ((eventHeight_1 + 2) / 12) + 'em'; });\n            }\n            setStyleAttribute(this.actionObj.clone, {\n                width: formatUnit(this.actionObj.cellWidth),\n                height: formatUnit(eventHeight_1),\n                top: formatUnit(this.parent.element.querySelector('.' + cls.ALLDAY_ROW_CLASS).offsetTop)\n            });\n        }\n        if (closest(this.actionObj.target, '.' + cls.WORK_CELLS_CLASS) &&\n            !closest(this.actionObj.clone, '.' + cls.DAY_WRAPPER_CLASS)) {\n            removeClass([this.actionObj.clone], cls.ALLDAY_APPOINTMENT_CLASS);\n            this.appendCloneElement(this.getEventWrapper(colIndex));\n            this.actionObj.isAllDay = false;\n            var height = (this.actionObj.element.offsetHeight === 0) ? this.actionObj.height : this.actionObj.element.offsetHeight;\n            setStyleAttribute(this.actionObj.clone, {\n                left: formatUnit(0),\n                height: formatUnit(height),\n                width: formatUnit(this.actionObj.cellWidth)\n            });\n        }\n    };\n    DragAndDrop.prototype.calculateVerticalDate = function (e) {\n        if (isNullOrUndefined(e.target) || (e.target && isNullOrUndefined(closest(e.target, 'tr'))) ||\n            (e.target && e.target.tagName === 'DIV')) {\n            return;\n        }\n        this.removeCloneElement();\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() -\n            eventObj[this.parent.eventFields.startTime].getTime();\n        var td = closest(this.actionObj.target, 'td');\n        if (!isNullOrUndefined(td)) {\n            var tr = td.parentElement;\n            this.actionObj.index = (tr.rowIndex * tr.children.length) + td.cellIndex;\n            var workCells = [].slice.call(this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS));\n            td = workCells[this.actionObj.index];\n            var currentDate = this.parent.getDateFromElement(td);\n            if (!isNullOrUndefined(currentDate)) {\n                if (this.parent.activeViewOptions.group.resources.length > 0) {\n                    this.actionObj.groupIndex = parseInt(td.getAttribute('data-group-index'), 10);\n                }\n                var timeString = new Date(currentDate.setDate(currentDate.getDate() - this.daysVariation));\n                var dragStart = new Date(timeString.getTime());\n                var dragEnd = new Date(dragStart.getTime());\n                var startTimeDiff = eventObj[this.parent.eventFields.startTime].getTime() -\n                    (util.resetTime(new Date(+eventObj[this.parent.eventFields.startTime]))).getTime();\n                dragStart = new Date(dragStart.getTime() + startTimeDiff);\n                dragEnd = new Date(dragStart.getTime() + eventDuration);\n                this.actionObj.start = new Date(dragStart.getTime());\n                this.actionObj.end = new Date(dragEnd.getTime());\n            }\n        }\n        var event = this.getUpdatedEvent(this.actionObj.start, this.actionObj.end, this.actionObj.event);\n        this.dynamicEventsRendering(event);\n    };\n    DragAndDrop.prototype.calculateTimelineTime = function (e) {\n        var eventObj = extend({}, this.actionObj.event, null, true);\n        var eventDuration = eventObj[this.parent.eventFields.endTime].getTime() -\n            eventObj[this.parent.eventFields.startTime].getTime();\n        var offsetLeft = this.parent.enableRtl ? Math.abs(this.actionObj.clone.offsetLeft) - this.actionObj.clone.offsetWidth :\n            parseInt(this.actionObj.clone.style.left, 10);\n        offsetLeft = Math.floor(offsetLeft / this.actionObj.cellWidth) * this.actionObj.cellWidth;\n        var rightOffset;\n        if (this.parent.enableRtl) {\n            rightOffset = Math.abs(parseInt(this.actionObj.clone.style.right, 10));\n            this.actionObj.clone.style.right = formatUnit(rightOffset);\n        }\n        offsetLeft = this.getOffsetValue(offsetLeft, rightOffset);\n        var colIndex = this.getColumnIndex(offsetLeft);\n        var cloneIndex = Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().left) / this.actionObj.cellWidth);\n        if (this.parent.enableRtl) {\n            cloneIndex = Math.abs(Math.floor((this.actionObj.pageX - this.actionObj.clone.getBoundingClientRect().right) /\n                this.actionObj.cellWidth)) - 1;\n        }\n        if (this.cursorPointIndex < 0) {\n            this.cursorIndex(e, eventObj, offsetLeft, cloneIndex);\n        }\n        var tr = this.parent.getContentTable().querySelector('tr');\n        var index = this.getCursorCurrentIndex(colIndex, cloneIndex, tr);\n        index = index < 0 ? 0 : index;\n        var eventStart = this.isHeaderRows ? new Date(this.timelineEventModule.dateRender[index].getTime()) :\n            this.parent.getDateFromElement(tr.children[index]);\n        if (this.isStepDragging) {\n            var widthDiff = this.getWidthDiff(tr, index);\n            if (widthDiff !== 0) {\n                var timeDiff = Math.round(widthDiff / this.widthPerMinute);\n                eventStart.setMinutes(eventStart.getMinutes() + (timeDiff * this.actionObj.interval));\n                eventStart.setMinutes(eventStart.getMinutes() - this.minDiff);\n            }\n            else {\n                eventStart = this.actionObj.start;\n            }\n        }\n        else {\n            eventStart.setMinutes(eventStart.getMinutes() -\n                (this.cursorPointIndex * (this.isTimelineDayProcess ? MINUTES_PER_DAY : this.actionObj.slotInterval)));\n        }\n        eventStart = this.calculateIntervalTime(eventStart);\n        if (this.isTimelineDayProcess) {\n            var eventSrt = eventObj[this.parent.eventFields.startTime];\n            eventStart.setHours(eventSrt.getHours(), eventSrt.getMinutes(), eventSrt.getSeconds());\n        }\n        var eventEnd = new Date(eventStart.getTime());\n        eventEnd.setMilliseconds(eventDuration);\n        var event = this.getUpdatedEvent(eventStart, eventEnd, this.actionObj.event);\n        var events = this.timelineEventModule.splitEvent(event, this.timelineEventModule.dateRender);\n        var eventData = events[0].data;\n        var startTime = this.timelineEventModule.getStartTime(events[0], eventData);\n        var endTime = this.timelineEventModule.getEndTime(events[0], eventData);\n        var width = this.timelineEventModule.\n            getEventWidth(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], eventData.count);\n        var day = this.parent.getIndexOfDate(this.timelineEventModule.dateRender, util.resetTime(new Date(startTime.getTime())));\n        day = day < 0 ? 0 : day;\n        var left = this.timelineEventModule.getPosition(startTime, endTime, eventObj[this.parent.eventFields.isAllDay], day);\n        if (this.parent.enableRtl) {\n            this.actionObj.clone.style.right = formatUnit(left);\n        }\n        else {\n            this.actionObj.clone.style.left = formatUnit(left);\n        }\n        if (!this.isMorePopupOpened) {\n            this.actionObj.clone.style.width = formatUnit(width);\n        }\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            this.calculateResourceGroupingPosition(e);\n        }\n        this.actionObj.start = new Date(eventStart.getTime());\n        this.actionObj.end = new Date(eventEnd.getTime());\n        this.updateTimePosition(this.actionObj.start);\n    };\n    DragAndDrop.prototype.getOffsetValue = function (offsetLeft, rightOffset) {\n        if (this.scrollEdges.left || this.scrollEdges.right) {\n            var viewEle = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            if (this.parent.enableRtl) {\n                rightOffset = viewEle.offsetWidth - viewEle.scrollLeft;\n                if (this.scrollEdges.right) {\n                    rightOffset = (rightOffset - viewEle.offsetWidth + this.actionObj.clone.offsetWidth) -\n                        (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n                }\n                else {\n                    rightOffset = rightOffset + this.widthUptoCursorPoint;\n                    if (rightOffset - this.widthUptoCursorPoint >= viewEle.scrollWidth) {\n                        this.actionObj.clone.style.width =\n                            formatUnit(this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint + this.actionObj.cellWidth);\n                        rightOffset = (viewEle.scrollLeft - viewEle.scrollWidth);\n                    }\n                }\n                this.actionObj.clone.style.left = formatUnit(rightOffset);\n            }\n            else {\n                if (this.scrollEdges.left) {\n                    offsetLeft = viewEle.scrollLeft - this.widthUptoCursorPoint + this.actionObj.cellWidth;\n                    if (viewEle.scrollLeft + viewEle.offsetWidth >= viewEle.offsetWidth) {\n                        viewEle.scrollLeft = viewEle.scrollLeft - 1;\n                    }\n                    else if (this.actionObj.clone.offsetLeft === 0) {\n                        offsetLeft = viewEle.scrollLeft;\n                    }\n                }\n                else {\n                    offsetLeft = (viewEle.scrollLeft + viewEle.offsetWidth -\n                        this.actionObj.clone.offsetWidth) + (this.actionObj.clone.offsetWidth - this.widthUptoCursorPoint);\n                }\n                offsetLeft = offsetLeft < 0 ? 0 : offsetLeft;\n                this.actionObj.clone.style.left = formatUnit(offsetLeft);\n            }\n        }\n        return offsetLeft;\n    };\n    DragAndDrop.prototype.getWidthDiff = function (tr, index) {\n        var pages = this.scrollArgs.element.getBoundingClientRect();\n        if (pages.left <= this.actionObj.pageX && pages.right >= this.actionObj.pageX) {\n            var targetLeft = tr.children[index].offsetLeft;\n            var pageX = this.actionObj.pageX - pages.left;\n            if (this.parent.enableRtl) {\n                return (targetLeft + this.actionObj.cellWidth) - (this.scrollArgs.element.scrollLeft + pageX);\n            }\n            else {\n                return (this.scrollArgs.element.scrollLeft + pageX) - targetLeft;\n            }\n        }\n        return 0;\n    };\n    DragAndDrop.prototype.getColumnIndex = function (offsetLeft) {\n        var index = Math.floor(offsetLeft / this.actionObj.cellWidth);\n        if (this.isHeaderRows) {\n            return index;\n        }\n        return this.getIndex(index);\n    };\n    DragAndDrop.prototype.getCursorCurrentIndex = function (colIndex, cloneIndex, tr) {\n        var index = colIndex + cloneIndex;\n        if (this.isHeaderRows) {\n            var dateLength = Math.floor(tr.offsetWidth / this.actionObj.cellWidth);\n            return (index > dateLength - 1) ? dateLength - 1 : index;\n        }\n        return (index > tr.children.length - 1) ? tr.children.length - 1 : index;\n    };\n    DragAndDrop.prototype.cursorIndex = function (e, event, left, index) {\n        var td = closest(e.target, '.e-work-cells');\n        if (!isNullOrUndefined(td) && !this.isMorePopupOpened) {\n            var targetDate = this.parent.getDateFromElement(td);\n            if (this.isHeaderRows) {\n                var currentIndex = Math.floor(left / this.actionObj.cellWidth);\n                targetDate = new Date(this.timelineEventModule.dateRender[currentIndex + index].getTime());\n            }\n            var timeDiff = targetDate.getTime() - event[this.parent.eventFields.startTime].getTime();\n            if (this.isTimelineDayProcess) {\n                this.cursorPointIndex = Math.abs(Math.ceil(timeDiff / (util.MS_PER_DAY)));\n            }\n            else {\n                var widthDiff = Math.floor((timeDiff / util.MS_PER_MINUTE) / (this.actionObj.slotInterval / this.actionObj.cellWidth));\n                this.cursorPointIndex = Math.floor(widthDiff / this.actionObj.cellWidth);\n                this.cursorPointIndex = this.cursorPointIndex < 0 ? 0 : this.cursorPointIndex;\n            }\n        }\n        else {\n            this.cursorPointIndex = 0;\n        }\n    };\n    DragAndDrop.prototype.calculateResourceGroupingPosition = function (e) {\n        var dragArea = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var trCollection = [].slice.call(this.parent.element.querySelectorAll('.e-content-wrap .e-content-table tr:not(.e-hidden)'));\n        var translateY = util.getTranslateY(dragArea.querySelector('table'));\n        translateY = (isNullOrUndefined(translateY)) ? 0 : translateY;\n        var rowHeight = (this.parent.rowAutoHeight) ?\n            ~~(dragArea.querySelector('table').offsetHeight / trCollection.length) : this.actionObj.cellHeight;\n        var rowIndex = Math.floor(Math.floor((this.actionObj.Y + (dragArea.scrollTop - translateY - window.scrollY)) -\n            dragArea.getBoundingClientRect().top) / rowHeight);\n        rowIndex = (rowIndex < 0) ? 0 : (rowIndex > trCollection.length - 1) ? trCollection.length - 1 : rowIndex;\n        this.actionObj.index = rowIndex;\n        var eventContainer = this.parent.element.querySelectorAll('.e-appointment-container:not(.e-hidden)').item(rowIndex);\n        var eventWrapper = eventContainer.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n        if (!eventWrapper) {\n            eventWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n            eventContainer.appendChild(eventWrapper);\n        }\n        this.appendCloneElement(eventWrapper);\n        var td = closest(e.target, 'td');\n        this.actionObj.groupIndex = (td && !isNaN(parseInt(td.getAttribute('data-group-index'), 10)))\n            ? parseInt(td.getAttribute('data-group-index'), 10) : this.actionObj.groupIndex;\n        var top = trCollection[rowIndex].offsetTop;\n        if (this.parent.rowAutoHeight) {\n            var cursorElement = this.getCursorElement(e);\n            if (cursorElement) {\n                top = cursorElement.classList.contains(cls.WORK_CELLS_CLASS) ? cursorElement.offsetTop :\n                    cursorElement.offsetParent.classList.contains(cls.APPOINTMENT_CLASS) ?\n                        cursorElement.offsetParent.offsetTop : top;\n            }\n        }\n        this.actionObj.clone.style.top = formatUnit(top);\n    };\n    DragAndDrop.prototype.appendCloneElement = function (element) {\n        if (this.parent.eventDragArea) {\n            document.querySelector(this.parent.eventDragArea).appendChild(this.actionObj.clone);\n        }\n        else {\n            element.appendChild(this.actionObj.clone);\n        }\n    };\n    DragAndDrop.prototype.getEventWrapper = function (index) {\n        var eventWrapper;\n        var isAllDayDrag = this.actionObj.clone.classList.contains(cls.ALLDAY_APPOINTMENT_CLASS);\n        if (this.parent.activeViewOptions.timeScale.enable) {\n            var wrapperClass = isAllDayDrag ? '.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS : '.' + cls.APPOINTMENT_WRAPPER_CLASS;\n            eventWrapper = this.parent.element.querySelectorAll(wrapperClass).item(index);\n        }\n        else {\n            var targetWrapper = this.parent.element.querySelectorAll('.' + cls.WORK_CELLS_CLASS).item(index);\n            eventWrapper = targetWrapper.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n            if (!eventWrapper) {\n                eventWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n                targetWrapper.appendChild(eventWrapper);\n            }\n        }\n        return eventWrapper;\n    };\n    DragAndDrop.prototype.getAllDayEventHeight = function () {\n        var eventWrapper = createElement('div', { className: cls.APPOINTMENT_CLASS });\n        this.parent.element.querySelector('.' + cls.ALLDAY_APPOINTMENT_WRAPPER_CLASS).appendChild(eventWrapper);\n        var eventHeight = eventWrapper.offsetHeight;\n        remove(eventWrapper);\n        return eventHeight;\n    };\n    DragAndDrop.prototype.isAllowDrop = function (e) {\n        if (!this.actionObj.excludeSelectors) {\n            return false;\n        }\n        var dropSelectors = this.actionObj.excludeSelectors.split(',');\n        var isAllowDrop = false;\n        for (var _i = 0, dropSelectors_1 = dropSelectors; _i < dropSelectors_1.length; _i++) {\n            var selector = dropSelectors_1[_i];\n            if (e.target.classList.contains(selector)) {\n                isAllowDrop = true;\n                break;\n            }\n        }\n        return isAllowDrop;\n    };\n    /**\n     * Get module name.\n     */\n    DragAndDrop.prototype.getModuleName = function () {\n        return 'dragAndDrop';\n    };\n    return DragAndDrop;\n}(ActionBase));\nexport { DragAndDrop };\n"]},"metadata":{},"sourceType":"module"}